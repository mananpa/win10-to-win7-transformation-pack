/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/(function(){var J=["require","exports","vs/base/common/lifecycle","vs/base/common/async","vs/base/common/event","vs/base/common/types","vs/nls","vs/nls!vs/code/node/cliProcessMain","vs/platform/instantiation/common/instantiation","vs/platform/log/common/log","vs/base/common/errors","vs/base/common/uri","vs/base/common/platform","vs/platform/files/common/files","vs/base/common/path","vs/base/common/buffer","vs/base/common/network","vs/base/common/resources","vs/platform/environment/common/environment","vs/base/common/arrays","vs/base/node/pfs","vs/platform/configuration/common/configuration","vs/base/common/cancellation","vs/platform/extensionManagement/common/extensionManagement","vs/platform/extensionManagement/common/extensionManagementUtil","vs/platform/userDataProfile/common/userDataProfile","vs/platform/product/common/productService","vs/platform/extensions/common/extensions","vs/platform/uriIdentity/common/uriIdentity","vs/base/common/objects","vs/base/common/uuid","vs/base/common/strings","vs/platform/telemetry/common/telemetry","vs/base/common/errorMessage","vs/base/common/map","vs/platform/registry/common/platform","os","vs/base/common/process","vs/platform/policy/common/policy","vs/base/common/semver/semver","vs/platform/configuration/common/configurationRegistry","vs/platform/telemetry/common/telemetryUtils","vs/platform/extensionManagement/common/extensionsProfileScannerService","vs/base/common/stream","vs/base/common/marshalling","vs/platform/extensions/common/extensionValidator","vs/platform/instantiation/common/descriptors","vs/platform/request/common/request","vs/platform/extensionManagement/common/extensionsScannerService","vs/base/common/decorators","vs/base/common/json","vs/base/common/processes","vs/base/common/hash","vs/base/common/severity","vs/base/common/ternarySearchTree","vs/base/node/processes","vs/base/parts/ipc/common/ipc","child_process","vs/platform/download/common/download","vs/platform/extensionManagement/node/extensionSignatureVerificationService","vs/platform/files/common/io","vs/platform/files/common/watcher","vs/platform/instantiation/common/serviceCollection","vs/platform/languagePacks/common/languagePacks","vs/base/common/iterator","vs/platform/configuration/common/configurationModels","vs/platform/remote/common/remoteHosts","vs/platform/state/node/state","vs/platform/telemetry/common/commonProperties","vs/base/node/zip","vs/base/common/assert","vs/base/common/skipList","vs/base/node/macAddress","vs/nls!vs/base/common/date","vs/base/common/date","vs/nls!vs/base/common/errorMessage","vs/nls!vs/base/common/jsonErrorMessages","vs/base/common/jsonErrorMessages","vs/base/common/console","vs/base/node/id","vs/base/node/powershell","vs/base/node/shell","vs/base/parts/ipc/node/ipc.cp","vs/base/parts/storage/common/storage","vs/nls!vs/base/node/zip","vs/nls!vs/platform/configuration/common/configurationRegistry","vs/nls!vs/platform/extensionManagement/common/abstractExtensionManagementService","vs/nls!vs/platform/extensionManagement/common/extensionManagement","vs/nls!vs/platform/extensionManagement/common/extensionManagementCLI","vs/nls!vs/platform/extensionManagement/common/extensionNls","vs/nls!vs/platform/extensionManagement/common/extensionsScannerService","vs/nls!vs/platform/extensionManagement/node/extensionManagementService","vs/nls!vs/platform/extensionManagement/node/extensionManagementUtil","vs/nls!vs/platform/extensions/common/extensionValidator","vs/nls!vs/platform/files/common/fileService","vs/nls!vs/platform/files/common/io","vs/nls!vs/platform/files/node/diskFileSystemProvider","vs/nls!vs/platform/languagePacks/common/languagePacks","vs/nls!vs/platform/request/common/request","vs/nls!vs/platform/shell/node/shellEnv","vs/nls!vs/platform/telemetry/common/telemetryService","vs/nls!vs/platform/userDataProfile/common/userDataProfile","vs/nls!vs/platform/workspace/common/workspace","vs/platform/environment/common/environmentService","vs/platform/environment/node/environmentService","vs/platform/extensionManagement/common/extensionNls","vs/platform/extensionManagement/common/implicitActivationEvents","vs/platform/externalServices/common/serviceMachineId","vs/platform/instantiation/common/extensions","vs/platform/instantiation/common/graph","vs/platform/files/node/watcher/nodejs/nodejsWatcher","vs/platform/files/node/watcher/nodejs/nodejsClient","vs/platform/files/node/watcher/watcherClient","vs/platform/instantiation/common/instantiationService","vs/platform/files/common/diskFileSystemProvider","vs/platform/files/common/fileService","vs/base/common/performance","vs/platform/files/node/diskFileSystemProvider","fs","vs/platform/log/node/spdlogLog","vs/platform/policy/common/filePolicyService","vs/platform/jsonschemas/common/jsonContributionRegistry","vs/platform/configuration/common/configurations","vs/platform/configuration/common/configurationService","vs/platform/extensionManagement/common/extensionManagementCLI","vs/platform/extensionManagement/node/extensionDownloader","vs/platform/extensionManagement/node/extensionsManifestCache","vs/platform/extensionManagement/node/extensionsWatcher","vs/platform/languagePacks/node/languagePacks","vs/platform/download/common/downloadService","vs/platform/request/node/proxy","url","vs/platform/shell/node/shellEnv","vs/platform/state/node/stateService","vs/platform/externalServices/common/marketplace","vs/platform/telemetry/common/1dsAppender","vs/platform/telemetry/common/telemetryService","vs/platform/product/common/product","vs/platform/telemetry/node/1dsAppender","vs/platform/telemetry/node/telemetry","vs/platform/telemetry/node/telemetryUtils","vs/platform/uriIdentity/common/uriIdentityService","vs/platform/workspace/common/workspace","vs/platform/extensionManagement/common/abstractExtensionManagementService","vs/platform/extensionManagement/node/extensionLifecycle","vs/platform/extensionManagement/node/extensionsScannerService","vs/platform/storage/common/storage","vs/platform/extensionManagement/common/extensionGalleryService","vs/platform/userDataProfile/node/userDataProfile","vs/platform/policy/node/nativePolicyService","vs/platform/extensionManagement/node/extensionManagementUtil","vs/platform/extensionManagement/node/extensionManagementService","vs/platform/request/node/requestService","vs/platform/environment/node/userDataPath","vs/base/common/glob","vs/platform/files/node/watcher/nodejs/nodejsWatcherLib","vs/base/common/linkedList","graceful-fs","vs/base/common/extpath","crypto","vs/platform/environment/node/argvHelper","https","vscode-policy-watcher","yauzl","yazl","zlib","vs/code/node/cliProcessMain"],Y=function(j){for(var e=[],O=0,k=j.length;O<k;O++)e[O]=J[j[O]];return e};define(J[49],Y([0,1]),function(j,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.throttle=e.debounce=e.memoize=void 0;function O(T){return(I,g,u)=>{let m=null,S=null;if(typeof u.value=="function"?(m="value",S=u.value):typeof u.get=="function"&&(m="get",S=u.get),!S)throw new Error("not supported");u[m]=T(S,g)}}function k(T,I,g){let u=null,m=null;if(typeof g.value=="function"?(u="value",m=g.value,m.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof g.get=="function"&&(u="get",m=g.get),!m)throw new Error("not supported");const S=`$memoize$${I}`;g[u]=function(...p){return this.hasOwnProperty(S)||Object.defineProperty(this,S,{configurable:!1,enumerable:!1,writable:!1,value:m.apply(this,p)}),this[S]}}e.memoize=k;function D(T,I,g){return O((u,m)=>{const S=`$debounce$${m}`,p=`$debounce$result$${m}`;return function(...b){this[p]||(this[p]=g?g():void 0),clearTimeout(this[S]),I&&(this[p]=I(this[p],...b),b=[this[p]]),this[S]=setTimeout(()=>{u.apply(this,b),this[p]=g?g():void 0},T)}})}e.debounce=D;function L(T,I,g){return O((u,m)=>{const S=`$throttle$timer$${m}`,p=`$throttle$result$${m}`,b=`$throttle$lastRun$${m}`,y=`$throttle$pending$${m}`;return function(...w){if(this[p]||(this[p]=g?g():void 0),(this[b]===null||this[b]===void 0)&&(this[b]=-Number.MAX_VALUE),I&&(this[p]=I(this[p],...w)),this[y])return;const E=this[b]+T;E<=Date.now()?(this[b]=Date.now(),u.apply(this,[this[p]]),this[p]=g?g():void 0):(this[y]=!0,this[S]=setTimeout(()=>{this[y]=!1,this[b]=Date.now(),u.apply(this,[this[p]]),this[p]=g?g():void 0},E-Date.now()))}})}e.throttle=L}),define(J[70],Y([0,1,10]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.checkAdjacentItems=e.assertFn=e.assert=e.assertNever=e.ok=void 0;function k(g,u){if(!g)throw new Error(u?`Assertion failed (${u})`:"Assertion Failed")}e.ok=k;function D(g,u="Unreachable"){throw new Error(u)}e.assertNever=D;function L(g){if(!g)throw new O.BugIndicatingError("Assertion Failed")}e.assert=L;function T(g){if(!g()){debugger;g(),(0,O.onUnexpectedError)(new O.BugIndicatingError("Assertion Failed"))}}e.assertFn=T;function I(g,u){let m=0;for(;m<g.length-1;){const S=g[m],p=g[m+1];if(!u(S,p))return!1;m++}return!0}e.checkAdjacentItems=I}),define(J[50],Y([0,1]),function(j,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getNodeType=e.stripComments=e.visit=e.findNodeAtOffset=e.contains=e.getNodeValue=e.getNodePath=e.findNodeAtLocation=e.parseTree=e.parse=e.getLocation=e.createScanner=e.ParseOptions=e.ParseErrorCode=e.SyntaxKind=e.ScanError=void 0;var O;(function(t){t[t.None=0]="None",t[t.UnexpectedEndOfComment=1]="UnexpectedEndOfComment",t[t.UnexpectedEndOfString=2]="UnexpectedEndOfString",t[t.UnexpectedEndOfNumber=3]="UnexpectedEndOfNumber",t[t.InvalidUnicode=4]="InvalidUnicode",t[t.InvalidEscapeCharacter=5]="InvalidEscapeCharacter",t[t.InvalidCharacter=6]="InvalidCharacter"})(O=e.ScanError||(e.ScanError={}));var k;(function(t){t[t.OpenBraceToken=1]="OpenBraceToken",t[t.CloseBraceToken=2]="CloseBraceToken",t[t.OpenBracketToken=3]="OpenBracketToken",t[t.CloseBracketToken=4]="CloseBracketToken",t[t.CommaToken=5]="CommaToken",t[t.ColonToken=6]="ColonToken",t[t.NullKeyword=7]="NullKeyword",t[t.TrueKeyword=8]="TrueKeyword",t[t.FalseKeyword=9]="FalseKeyword",t[t.StringLiteral=10]="StringLiteral",t[t.NumericLiteral=11]="NumericLiteral",t[t.LineCommentTrivia=12]="LineCommentTrivia",t[t.BlockCommentTrivia=13]="BlockCommentTrivia",t[t.LineBreakTrivia=14]="LineBreakTrivia",t[t.Trivia=15]="Trivia",t[t.Unknown=16]="Unknown",t[t.EOF=17]="EOF"})(k=e.SyntaxKind||(e.SyntaxKind={}));var D;(function(t){t[t.InvalidSymbol=1]="InvalidSymbol",t[t.InvalidNumberFormat=2]="InvalidNumberFormat",t[t.PropertyNameExpected=3]="PropertyNameExpected",t[t.ValueExpected=4]="ValueExpected",t[t.ColonExpected=5]="ColonExpected",t[t.CommaExpected=6]="CommaExpected",t[t.CloseBraceExpected=7]="CloseBraceExpected",t[t.CloseBracketExpected=8]="CloseBracketExpected",t[t.EndOfFileExpected=9]="EndOfFileExpected",t[t.InvalidCommentToken=10]="InvalidCommentToken",t[t.UnexpectedEndOfComment=11]="UnexpectedEndOfComment",t[t.UnexpectedEndOfString=12]="UnexpectedEndOfString",t[t.UnexpectedEndOfNumber=13]="UnexpectedEndOfNumber",t[t.InvalidUnicode=14]="InvalidUnicode",t[t.InvalidEscapeCharacter=15]="InvalidEscapeCharacter",t[t.InvalidCharacter=16]="InvalidCharacter"})(D=e.ParseErrorCode||(e.ParseErrorCode={}));var L;(function(t){t.DEFAULT={allowTrailingComma:!0}})(L=e.ParseOptions||(e.ParseOptions={}));function T(t,n=!1){let i=0;const r=t.length;let o="",c=0,a=16,h=0;function C(Q){let ge=0,le=0;for(;ge<Q;){const ae=t.charCodeAt(i);if(ae>=48&&ae<=57)le=le*16+ae-48;else if(ae>=65&&ae<=70)le=le*16+ae-65+10;else if(ae>=97&&ae<=102)le=le*16+ae-97+10;else break;i++,ge++}return ge<Q&&(le=-1),le}function M(Q){i=Q,o="",c=0,a=16,h=0}function _(){const Q=i;if(t.charCodeAt(i)===48)i++;else for(i++;i<t.length&&u(t.charCodeAt(i));)i++;if(i<t.length&&t.charCodeAt(i)===46)if(i++,i<t.length&&u(t.charCodeAt(i)))for(i++;i<t.length&&u(t.charCodeAt(i));)i++;else return h=3,t.substring(Q,i);let ge=i;if(i<t.length&&(t.charCodeAt(i)===69||t.charCodeAt(i)===101))if(i++,(i<t.length&&t.charCodeAt(i)===43||t.charCodeAt(i)===45)&&i++,i<t.length&&u(t.charCodeAt(i))){for(i++;i<t.length&&u(t.charCodeAt(i));)i++;ge=i}else h=3;return t.substring(Q,ge)}function H(){let Q="",ge=i;for(;;){if(i>=r){Q+=t.substring(ge,i),h=2;break}const le=t.charCodeAt(i);if(le===34){Q+=t.substring(ge,i),i++;break}if(le===92){if(Q+=t.substring(ge,i),i++,i>=r){h=2;break}switch(t.charCodeAt(i++)){case 34:Q+='"';break;case 92:Q+="\\";break;case 47:Q+="/";break;case 98:Q+="\b";break;case 102:Q+="\f";break;case 110:Q+=`
`;break;case 114:Q+="\r";break;case 116:Q+="	";break;case 117:{const de=C(4);de>=0?Q+=String.fromCharCode(de):h=4;break}default:h=5}ge=i;continue}if(le>=0&&le<=31)if(g(le)){Q+=t.substring(ge,i),h=2;break}else h=6;i++}return Q}function X(){if(o="",h=0,c=i,i>=r)return c=r,a=17;let Q=t.charCodeAt(i);if(I(Q)){do i++,o+=String.fromCharCode(Q),Q=t.charCodeAt(i);while(I(Q));return a=15}if(g(Q))return i++,o+=String.fromCharCode(Q),Q===13&&t.charCodeAt(i)===10&&(i++,o+=`
`),a=14;switch(Q){case 123:return i++,a=1;case 125:return i++,a=2;case 91:return i++,a=3;case 93:return i++,a=4;case 58:return i++,a=6;case 44:return i++,a=5;case 34:return i++,o=H(),a=10;case 47:{const ge=i-1;if(t.charCodeAt(i+1)===47){for(i+=2;i<r&&!g(t.charCodeAt(i));)i++;return o=t.substring(ge,i),a=12}if(t.charCodeAt(i+1)===42){i+=2;const le=r-1;let ae=!1;for(;i<le;){if(t.charCodeAt(i)===42&&t.charCodeAt(i+1)===47){i+=2,ae=!0;break}i++}return ae||(i++,h=1),o=t.substring(ge,i),a=13}return o+=String.fromCharCode(Q),i++,a=16}case 45:if(o+=String.fromCharCode(Q),i++,i===r||!u(t.charCodeAt(i)))return a=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return o+=_(),a=11;default:for(;i<r&&ie(Q);)i++,Q=t.charCodeAt(i);if(c!==i){switch(o=t.substring(c,i),o){case"true":return a=8;case"false":return a=9;case"null":return a=7}return a=16}return o+=String.fromCharCode(Q),i++,a=16}}function ie(Q){if(I(Q)||g(Q))return!1;switch(Q){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function ne(){let Q;do Q=X();while(Q>=12&&Q<=15);return Q}return{setPosition:M,getPosition:()=>i,scan:n?ne:X,getToken:()=>a,getTokenValue:()=>o,getTokenOffset:()=>c,getTokenLength:()=>i-c,getTokenError:()=>h}}e.createScanner=T;function I(t){return t===32||t===9||t===11||t===12||t===160||t===5760||t>=8192&&t<=8203||t===8239||t===8287||t===12288||t===65279}function g(t){return t===10||t===13||t===8232||t===8233}function u(t){return t>=48&&t<=57}var m;(function(t){t[t.nullCharacter=0]="nullCharacter",t[t.maxAsciiCharacter=127]="maxAsciiCharacter",t[t.lineFeed=10]="lineFeed",t[t.carriageReturn=13]="carriageReturn",t[t.lineSeparator=8232]="lineSeparator",t[t.paragraphSeparator=8233]="paragraphSeparator",t[t.nextLine=133]="nextLine",t[t.space=32]="space",t[t.nonBreakingSpace=160]="nonBreakingSpace",t[t.enQuad=8192]="enQuad",t[t.emQuad=8193]="emQuad",t[t.enSpace=8194]="enSpace",t[t.emSpace=8195]="emSpace",t[t.threePerEmSpace=8196]="threePerEmSpace",t[t.fourPerEmSpace=8197]="fourPerEmSpace",t[t.sixPerEmSpace=8198]="sixPerEmSpace",t[t.figureSpace=8199]="figureSpace",t[t.punctuationSpace=8200]="punctuationSpace",t[t.thinSpace=8201]="thinSpace",t[t.hairSpace=8202]="hairSpace",t[t.zeroWidthSpace=8203]="zeroWidthSpace",t[t.narrowNoBreakSpace=8239]="narrowNoBreakSpace",t[t.ideographicSpace=12288]="ideographicSpace",t[t.mathematicalSpace=8287]="mathematicalSpace",t[t.ogham=5760]="ogham",t[t._=95]="_",t[t.$=36]="$",t[t._0=48]="_0",t[t._1=49]="_1",t[t._2=50]="_2",t[t._3=51]="_3",t[t._4=52]="_4",t[t._5=53]="_5",t[t._6=54]="_6",t[t._7=55]="_7",t[t._8=56]="_8",t[t._9=57]="_9",t[t.a=97]="a",t[t.b=98]="b",t[t.c=99]="c",t[t.d=100]="d",t[t.e=101]="e",t[t.f=102]="f",t[t.g=103]="g",t[t.h=104]="h",t[t.i=105]="i",t[t.j=106]="j",t[t.k=107]="k",t[t.l=108]="l",t[t.m=109]="m",t[t.n=110]="n",t[t.o=111]="o",t[t.p=112]="p",t[t.q=113]="q",t[t.r=114]="r",t[t.s=115]="s",t[t.t=116]="t",t[t.u=117]="u",t[t.v=118]="v",t[t.w=119]="w",t[t.x=120]="x",t[t.y=121]="y",t[t.z=122]="z",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.ampersand=38]="ampersand",t[t.asterisk=42]="asterisk",t[t.at=64]="at",t[t.backslash=92]="backslash",t[t.bar=124]="bar",t[t.caret=94]="caret",t[t.closeBrace=125]="closeBrace",t[t.closeBracket=93]="closeBracket",t[t.closeParen=41]="closeParen",t[t.colon=58]="colon",t[t.comma=44]="comma",t[t.dot=46]="dot",t[t.doubleQuote=34]="doubleQuote",t[t.equals=61]="equals",t[t.exclamation=33]="exclamation",t[t.greaterThan=62]="greaterThan",t[t.lessThan=60]="lessThan",t[t.minus=45]="minus",t[t.openBrace=123]="openBrace",t[t.openBracket=91]="openBracket",t[t.openParen=40]="openParen",t[t.percent=37]="percent",t[t.plus=43]="plus",t[t.question=63]="question",t[t.semicolon=59]="semicolon",t[t.singleQuote=39]="singleQuote",t[t.slash=47]="slash",t[t.tilde=126]="tilde",t[t.backspace=8]="backspace",t[t.formFeed=12]="formFeed",t[t.byteOrderMark=65279]="byteOrderMark",t[t.tab=9]="tab",t[t.verticalTab=11]="verticalTab"})(m||(m={}));function S(t,n){const i=[],r=new Object;let o;const c={value:{},offset:0,length:0,type:"object",parent:void 0};let a=!1;function h(C,M,_,H){c.value=C,c.offset=M,c.length=_,c.type=H,c.colonOffset=void 0,o=c}try{v(t,{onObjectBegin:(C,M)=>{if(n<=C)throw r;o=void 0,a=n>C,i.push("")},onObjectProperty:(C,M,_)=>{if(n<M||(h(C,M,_,"property"),i[i.length-1]=C,n<=M+_))throw r},onObjectEnd:(C,M)=>{if(n<=C)throw r;o=void 0,i.pop()},onArrayBegin:(C,M)=>{if(n<=C)throw r;o=void 0,i.push(0)},onArrayEnd:(C,M)=>{if(n<=C)throw r;o=void 0,i.pop()},onLiteralValue:(C,M,_)=>{if(n<M||(h(C,M,_,s(C)),n<=M+_))throw r},onSeparator:(C,M,_)=>{if(n<=M)throw r;if(C===":"&&o&&o.type==="property")o.colonOffset=M,a=!1,o=void 0;else if(C===","){const H=i[i.length-1];typeof H=="number"?i[i.length-1]=H+1:(a=!0,i[i.length-1]=""),o=void 0}}})}catch(C){if(C!==r)throw C}return{path:i,previousNode:o,isAtPropertyKey:a,matches:C=>{let M=0;for(let _=0;M<C.length&&_<i.length;_++)if(C[M]===i[_]||C[M]==="*")M++;else if(C[M]!=="**")return!1;return M===C.length}}}e.getLocation=S;function p(t,n=[],i=L.DEFAULT){let r=null,o=[];const c=[];function a(C){Array.isArray(o)?o.push(C):r!==null&&(o[r]=C)}return v(t,{onObjectBegin:()=>{const C={};a(C),c.push(o),o=C,r=null},onObjectProperty:C=>{r=C},onObjectEnd:()=>{o=c.pop()},onArrayBegin:()=>{const C=[];a(C),c.push(o),o=C,r=null},onArrayEnd:()=>{o=c.pop()},onLiteralValue:a,onError:(C,M,_)=>{n.push({error:C,offset:M,length:_})}},i),o[0]}e.parse=p;function b(t,n=[],i=L.DEFAULT){let r={type:"array",offset:-1,length:-1,children:[],parent:void 0};function o(C){r.type==="property"&&(r.length=C-r.offset,r=r.parent)}function c(C){return r.children.push(C),C}v(t,{onObjectBegin:C=>{r=c({type:"object",offset:C,length:-1,parent:r,children:[]})},onObjectProperty:(C,M,_)=>{r=c({type:"property",offset:M,length:-1,parent:r,children:[]}),r.children.push({type:"string",value:C,offset:M,length:_,parent:r})},onObjectEnd:(C,M)=>{r.length=C+M-r.offset,r=r.parent,o(C+M)},onArrayBegin:(C,M)=>{r=c({type:"array",offset:C,length:-1,parent:r,children:[]})},onArrayEnd:(C,M)=>{r.length=C+M-r.offset,r=r.parent,o(C+M)},onLiteralValue:(C,M,_)=>{c({type:s(C),offset:M,length:_,parent:r,value:C}),o(M+_)},onSeparator:(C,M,_)=>{r.type==="property"&&(C===":"?r.colonOffset=M:C===","&&o(M))},onError:(C,M,_)=>{n.push({error:C,offset:M,length:_})}},i);const h=r.children[0];return h&&delete h.parent,h}e.parseTree=b;function y(t,n){if(!t)return;let i=t;for(const r of n)if(typeof r=="string"){if(i.type!=="object"||!Array.isArray(i.children))return;let o=!1;for(const c of i.children)if(Array.isArray(c.children)&&c.children[0].value===r){i=c.children[1],o=!0;break}if(!o)return}else{const o=r;if(i.type!=="array"||o<0||!Array.isArray(i.children)||o>=i.children.length)return;i=i.children[o]}return i}e.findNodeAtLocation=y;function w(t){if(!t.parent||!t.parent.children)return[];const n=w(t.parent);if(t.parent.type==="property"){const i=t.parent.children[0].value;n.push(i)}else if(t.parent.type==="array"){const i=t.parent.children.indexOf(t);i!==-1&&n.push(i)}return n}e.getNodePath=w;function E(t){switch(t.type){case"array":return t.children.map(E);case"object":{const n=Object.create(null);for(const i of t.children){const r=i.children[1];r&&(n[i.children[0].value]=E(r))}return n}case"null":case"string":case"number":case"boolean":return t.value;default:return}}e.getNodeValue=E;function l(t,n,i=!1){return n>=t.offset&&n<t.offset+t.length||i&&n===t.offset+t.length}e.contains=l;function d(t,n,i=!1){if(l(t,n,i)){const r=t.children;if(Array.isArray(r))for(let o=0;o<r.length&&r[o].offset<=n;o++){const c=d(r[o],n,i);if(c)return c}return t}}e.findNodeAtOffset=d;function v(t,n,i=L.DEFAULT){const r=T(t,!1);function o(B){return B?()=>B(r.getTokenOffset(),r.getTokenLength()):()=>!0}function c(B){return B?ee=>B(ee,r.getTokenOffset(),r.getTokenLength()):()=>!0}const a=o(n.onObjectBegin),h=c(n.onObjectProperty),C=o(n.onObjectEnd),M=o(n.onArrayBegin),_=o(n.onArrayEnd),H=c(n.onLiteralValue),X=c(n.onSeparator),ie=o(n.onComment),ne=c(n.onError),Q=i&&i.disallowComments,ge=i&&i.allowTrailingComma;function le(){for(;;){const B=r.scan();switch(r.getTokenError()){case 4:ae(14);break;case 5:ae(15);break;case 3:ae(13);break;case 1:Q||ae(11);break;case 2:ae(12);break;case 6:ae(16);break}switch(B){case 12:case 13:Q?ae(10):ie();break;case 16:ae(1);break;case 15:case 14:break;default:return B}}}function ae(B,ee=[],P=[]){if(ne(B),ee.length+P.length>0){let R=r.getToken();for(;R!==17;){if(ee.indexOf(R)!==-1){le();break}else if(P.indexOf(R)!==-1)break;R=le()}}}function de(B){const ee=r.getTokenValue();return B?H(ee):h(ee),le(),!0}function F(){switch(r.getToken()){case 11:{let B=0;try{B=JSON.parse(r.getTokenValue()),typeof B!="number"&&(ae(2),B=0)}catch{ae(2)}H(B);break}case 7:H(null);break;case 8:H(!0);break;case 9:H(!1);break;default:return!1}return le(),!0}function A(){return r.getToken()!==10?(ae(3,[],[2,5]),!1):(de(!1),r.getToken()===6?(X(":"),le(),q()||ae(4,[],[2,5])):ae(5,[],[2,5]),!0)}function x(){a(),le();let B=!1;for(;r.getToken()!==2&&r.getToken()!==17;){if(r.getToken()===5){if(B||ae(4,[],[]),X(","),le(),r.getToken()===2&&ge)break}else B&&ae(6,[],[]);A()||ae(4,[],[2,5]),B=!0}return C(),r.getToken()!==2?ae(7,[2],[]):le(),!0}function W(){M(),le();let B=!1;for(;r.getToken()!==4&&r.getToken()!==17;){if(r.getToken()===5){if(B||ae(4,[],[]),X(","),le(),r.getToken()===4&&ge)break}else B&&ae(6,[],[]);q()||ae(4,[],[4,5]),B=!0}return _(),r.getToken()!==4?ae(8,[4],[]):le(),!0}function q(){switch(r.getToken()){case 3:return W();case 1:return x();case 10:return de(!0);default:return F()}}return le(),r.getToken()===17?i.allowEmptyContent?!0:(ae(4,[],[]),!1):q()?(r.getToken()!==17&&ae(9,[],[]),!0):(ae(4,[],[]),!1)}e.visit=v;function f(t,n){const i=T(t),r=[];let o,c=0,a;do switch(a=i.getPosition(),o=i.scan(),o){case 12:case 13:case 17:c!==a&&r.push(t.substring(c,a)),n!==void 0&&r.push(i.getTokenValue().replace(/[^\r\n]/g,n)),c=i.getPosition();break}while(o!==17);return r.join("")}e.stripComments=f;function s(t){switch(typeof t){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(t){if(Array.isArray(t))return"array"}else return"null";return"object"}default:return"null"}}e.getNodeType=s}),function(){function j(D){const L=[];typeof D=="number"&&L.push("code/timeOrigin",D);function T(g){L.push(g,Date.now())}function I(){const g=[];for(let u=0;u<L.length;u+=2)g.push({name:L[u],startTime:L[u+1]});return g}return{mark:T,getMarks:I}}function e(){if(typeof performance=="object"&&typeof performance.mark=="function"&&!performance.nodeTiming)return typeof performance.timeOrigin!="number"&&!performance.timing?j():{mark(D){performance.mark(D)},getMarks(){let D=performance.timeOrigin;typeof D!="number"&&(D=performance.timing.navigationStart||performance.timing.redirectStart||performance.timing.fetchStart);const L=[{name:"code/timeOrigin",startTime:Math.round(D)}];for(const T of performance.getEntriesByType("mark"))L.push({name:T.name,startTime:Math.round(D+T.startTime)});return L}};if(typeof process=="object"){const D=Math.round((require.__$__nodeRequire||require)("perf_hooks").performance.timeOrigin);return j(D)}else return console.trace("perf-util loaded in UNKNOWN environment"),j()}function O(D){return D.MonacoPerformanceMarks||(D.MonacoPerformanceMarks=e()),D.MonacoPerformanceMarks}var k;typeof global=="object"?k=global:typeof self=="object"?k=self:k={},typeof define=="function"?define("vs/base/common/performance",[],function(){return O(k)}):typeof module=="object"&&typeof module.exports=="object"?module.exports=O(k):(console.trace("perf-util defined in UNKNOWN context (neither requirejs or commonjs)"),k.perf=O(k))}(),function(j,e){if(typeof exports=="object"&&typeof module=="object")module.exports=e();else if(typeof define=="function"&&define.amd)define("vs/base/common/semver/semver",[],e);else{var O=e();for(var k in O)(typeof exports=="object"?exports:j)[k]=O[k]}}(typeof self<"u"?self:this,function(){return function(j){var e={};function O(k){if(e[k])return e[k].exports;var D=e[k]={i:k,l:!1,exports:{}};return j[k].call(D.exports,D,D.exports,O),D.l=!0,D.exports}return O.m=j,O.c=e,O.d=function(k,D,L){O.o(k,D)||Object.defineProperty(k,D,{enumerable:!0,get:L})},O.r=function(k){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(k,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(k,"__esModule",{value:!0})},O.t=function(k,D){if(1&D&&(k=O(k)),8&D||4&D&&typeof k=="object"&&k&&k.__esModule)return k;var L=Object.create(null);if(O.r(L),Object.defineProperty(L,"default",{enumerable:!0,value:k}),2&D&&typeof k!="string")for(var T in k)O.d(L,T,function(I){return k[I]}.bind(null,T));return L},O.n=function(k){var D=k&&k.__esModule?function(){return k.default}:function(){return k};return O.d(D,"a",D),D},O.o=function(k,D){return Object.prototype.hasOwnProperty.call(k,D)},O.p="",O(O.s=0)}([function(j,e,O){(function(k){var D;e=j.exports=P,D=typeof k=="object"&&k.env&&k.env.NODE_DEBUG&&/\bsemver\b/i.test(k.env.NODE_DEBUG)?function(){var V=Array.prototype.slice.call(arguments,0);V.unshift("SEMVER"),console.log.apply(console,V)}:function(){},e.SEMVER_SPEC_VERSION="2.0.0";var L=256,T=Number.MAX_SAFE_INTEGER||9007199254740991,I=e.re=[],g=e.src=[],u=0,m=u++;g[m]="0|[1-9]\\d*";var S=u++;g[S]="[0-9]+";var p=u++;g[p]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var b=u++;g[b]="("+g[m]+")\\.("+g[m]+")\\.("+g[m]+")";var y=u++;g[y]="("+g[S]+")\\.("+g[S]+")\\.("+g[S]+")";var w=u++;g[w]="(?:"+g[m]+"|"+g[p]+")";var E=u++;g[E]="(?:"+g[S]+"|"+g[p]+")";var l=u++;g[l]="(?:-("+g[w]+"(?:\\."+g[w]+")*))";var d=u++;g[d]="(?:-?("+g[E]+"(?:\\."+g[E]+")*))";var v=u++;g[v]="[0-9A-Za-z-]+";var f=u++;g[f]="(?:\\+("+g[v]+"(?:\\."+g[v]+")*))";var s=u++,t="v?"+g[b]+g[l]+"?"+g[f]+"?";g[s]="^"+t+"$";var n="[v=\\s]*"+g[y]+g[d]+"?"+g[f]+"?",i=u++;g[i]="^"+n+"$";var r=u++;g[r]="((?:<|>)?=?)";var o=u++;g[o]=g[S]+"|x|X|\\*";var c=u++;g[c]=g[m]+"|x|X|\\*";var a=u++;g[a]="[v=\\s]*("+g[c]+")(?:\\.("+g[c]+")(?:\\.("+g[c]+")(?:"+g[l]+")?"+g[f]+"?)?)?";var h=u++;g[h]="[v=\\s]*("+g[o]+")(?:\\.("+g[o]+")(?:\\.("+g[o]+")(?:"+g[d]+")?"+g[f]+"?)?)?";var C=u++;g[C]="^"+g[r]+"\\s*"+g[a]+"$";var M=u++;g[M]="^"+g[r]+"\\s*"+g[h]+"$";var _=u++;g[_]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var H=u++;g[H]="(?:~>?)";var X=u++;g[X]="(\\s*)"+g[H]+"\\s+",I[X]=new RegExp(g[X],"g");var ie=u++;g[ie]="^"+g[H]+g[a]+"$";var ne=u++;g[ne]="^"+g[H]+g[h]+"$";var Q=u++;g[Q]="(?:\\^)";var ge=u++;g[ge]="(\\s*)"+g[Q]+"\\s+",I[ge]=new RegExp(g[ge],"g");var le=u++;g[le]="^"+g[Q]+g[a]+"$";var ae=u++;g[ae]="^"+g[Q]+g[h]+"$";var de=u++;g[de]="^"+g[r]+"\\s*("+n+")$|^$";var F=u++;g[F]="^"+g[r]+"\\s*("+t+")$|^$";var A=u++;g[A]="(\\s*)"+g[r]+"\\s*("+n+"|"+g[a]+")",I[A]=new RegExp(g[A],"g");var x=u++;g[x]="^\\s*("+g[a]+")\\s+-\\s+("+g[a]+")\\s*$";var W=u++;g[W]="^\\s*("+g[h]+")\\s+-\\s+("+g[h]+")\\s*$";var q=u++;g[q]="(<|>)?=?\\s*\\*";for(var B=0;B<35;B++)D(B,g[B]),I[B]||(I[B]=new RegExp(g[B]));function ee(V,G){if(V instanceof P)return V;if(typeof V!="string"||V.length>L||!(G?I[i]:I[s]).test(V))return null;try{return new P(V,G)}catch{return null}}function P(V,G){if(V instanceof P){if(V.loose===G)return V;V=V.version}else if(typeof V!="string")throw new TypeError("Invalid Version: "+V);if(V.length>L)throw new TypeError("version is longer than "+L+" characters");if(!(this instanceof P))return new P(V,G);D("SemVer",V,G),this.loose=G;var K=V.trim().match(G?I[i]:I[s]);if(!K)throw new TypeError("Invalid Version: "+V);if(this.raw=V,this.major=+K[1],this.minor=+K[2],this.patch=+K[3],this.major>T||this.major<0)throw new TypeError("Invalid major version");if(this.minor>T||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>T||this.patch<0)throw new TypeError("Invalid patch version");K[4]?this.prerelease=K[4].split(".").map(function(he){if(/^[0-9]+$/.test(he)){var ve=+he;if(ve>=0&&ve<T)return ve}return he}):this.prerelease=[],this.build=K[5]?K[5].split("."):[],this.format()}e.parse=ee,e.valid=function(V,G){var K=ee(V,G);return K?K.version:null},e.clean=function(V,G){var K=ee(V.trim().replace(/^[=v]+/,""),G);return K?K.version:null},e.SemVer=P,P.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},P.prototype.toString=function(){return this.version},P.prototype.compare=function(V){return D("SemVer.compare",this.version,this.loose,V),V instanceof P||(V=new P(V,this.loose)),this.compareMain(V)||this.comparePre(V)},P.prototype.compareMain=function(V){return V instanceof P||(V=new P(V,this.loose)),N(this.major,V.major)||N(this.minor,V.minor)||N(this.patch,V.patch)},P.prototype.comparePre=function(V){if(V instanceof P||(V=new P(V,this.loose)),this.prerelease.length&&!V.prerelease.length)return-1;if(!this.prerelease.length&&V.prerelease.length)return 1;if(!this.prerelease.length&&!V.prerelease.length)return 0;var G=0;do{var K=this.prerelease[G],he=V.prerelease[G];if(D("prerelease compare",G,K,he),K===void 0&&he===void 0)return 0;if(he===void 0)return 1;if(K===void 0)return-1;if(K!==he)return N(K,he)}while(++G)},P.prototype.inc=function(V,G){switch(V){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",G);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",G);break;case"prepatch":this.prerelease.length=0,this.inc("patch",G),this.inc("pre",G);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",G),this.inc("pre",G);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var K=this.prerelease.length;--K>=0;)typeof this.prerelease[K]=="number"&&(this.prerelease[K]++,K=-2);K===-1&&this.prerelease.push(0)}G&&(this.prerelease[0]===G?isNaN(this.prerelease[1])&&(this.prerelease=[G,0]):this.prerelease=[G,0]);break;default:throw new Error("invalid increment argument: "+V)}return this.format(),this.raw=this.version,this},e.inc=function(V,G,K,he){typeof K=="string"&&(he=K,K=void 0);try{return new P(V,K).inc(G,he).version}catch{return null}},e.diff=function(V,G){if(te(V,G))return null;var K=ee(V),he=ee(G);if(K.prerelease.length||he.prerelease.length){for(var ve in K)if((ve==="major"||ve==="minor"||ve==="patch")&&K[ve]!==he[ve])return"pre"+ve;return"prerelease"}for(var ve in K)if((ve==="major"||ve==="minor"||ve==="patch")&&K[ve]!==he[ve])return ve},e.compareIdentifiers=N;var R=/^[0-9]+$/;function N(V,G){var K=R.test(V),he=R.test(G);return K&&he&&(V=+V,G=+G),K&&!he?-1:he&&!K?1:V<G?-1:V>G?1:0}function U(V,G,K){return new P(V,K).compare(new P(G,K))}function z(V,G,K){return U(V,G,K)>0}function $(V,G,K){return U(V,G,K)<0}function te(V,G,K){return U(V,G,K)===0}function re(V,G,K){return U(V,G,K)!==0}function pe(V,G,K){return U(V,G,K)>=0}function Se(V,G,K){return U(V,G,K)<=0}function oe(V,G,K,he){var ve;switch(G){case"===":typeof V=="object"&&(V=V.version),typeof K=="object"&&(K=K.version),ve=V===K;break;case"!==":typeof V=="object"&&(V=V.version),typeof K=="object"&&(K=K.version),ve=V!==K;break;case"":case"=":case"==":ve=te(V,K,he);break;case"!=":ve=re(V,K,he);break;case">":ve=z(V,K,he);break;case">=":ve=pe(V,K,he);break;case"<":ve=$(V,K,he);break;case"<=":ve=Se(V,K,he);break;default:throw new TypeError("Invalid operator: "+G)}return ve}function ue(V,G){if(V instanceof ue){if(V.loose===G)return V;V=V.value}if(!(this instanceof ue))return new ue(V,G);D("comparator",V,G),this.loose=G,this.parse(V),this.semver===ce?this.value="":this.value=this.operator+this.semver.version,D("comp",this)}e.rcompareIdentifiers=function(V,G){return N(G,V)},e.major=function(V,G){return new P(V,G).major},e.minor=function(V,G){return new P(V,G).minor},e.patch=function(V,G){return new P(V,G).patch},e.compare=U,e.compareLoose=function(V,G){return U(V,G,!0)},e.rcompare=function(V,G,K){return U(G,V,K)},e.sort=function(V,G){return V.sort(function(K,he){return e.compare(K,he,G)})},e.rsort=function(V,G){return V.sort(function(K,he){return e.rcompare(K,he,G)})},e.gt=z,e.lt=$,e.eq=te,e.neq=re,e.gte=pe,e.lte=Se,e.cmp=oe,e.Comparator=ue;var ce={};function se(V,G){if(V instanceof se)return V.loose===G?V:new se(V.raw,G);if(V instanceof ue)return new se(V.value,G);if(!(this instanceof se))return new se(V,G);if(this.loose=G,this.raw=V,this.set=V.split(/\s*\|\|\s*/).map(function(K){return this.parseRange(K.trim())},this).filter(function(K){return K.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+V);this.format()}function fe(V){return!V||V.toLowerCase()==="x"||V==="*"}function Le(V,G,K,he,ve,Ce,we,Oe,Ie,ke,Me,be,Te){return((G=fe(K)?"":fe(he)?">="+K+".0.0":fe(ve)?">="+K+"."+he+".0":">="+G)+" "+(Oe=fe(Ie)?"":fe(ke)?"<"+(+Ie+1)+".0.0":fe(Me)?"<"+Ie+"."+(+ke+1)+".0":be?"<="+Ie+"."+ke+"."+Me+"-"+be:"<="+Oe)).trim()}function Ue(V,G){for(var K=0;K<V.length;K++)if(!V[K].test(G))return!1;if(G.prerelease.length){for(K=0;K<V.length;K++)if(D(V[K].semver),V[K].semver!==ce&&V[K].semver.prerelease.length>0){var he=V[K].semver;if(he.major===G.major&&he.minor===G.minor&&he.patch===G.patch)return!0}return!1}return!0}function Re(V,G,K){try{G=new se(G,K)}catch{return!1}return G.test(V)}function Fe(V,G,K,he){var ve,Ce,we,Oe,Ie;switch(V=new P(V,he),G=new se(G,he),K){case">":ve=z,Ce=Se,we=$,Oe=">",Ie=">=";break;case"<":ve=$,Ce=pe,we=z,Oe="<",Ie="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Re(V,G,he))return!1;for(var ke=0;ke<G.set.length;++ke){var Me=G.set[ke],be=null,Te=null;if(Me.forEach(function(Ne){Ne.semver===ce&&(Ne=new ue(">=0.0.0")),be=be||Ne,Te=Te||Ne,ve(Ne.semver,be.semver,he)?be=Ne:we(Ne.semver,Te.semver,he)&&(Te=Ne)}),be.operator===Oe||be.operator===Ie||(!Te.operator||Te.operator===Oe)&&Ce(V,Te.semver)||Te.operator===Ie&&we(V,Te.semver))return!1}return!0}ue.prototype.parse=function(V){var G=this.loose?I[de]:I[F],K=V.match(G);if(!K)throw new TypeError("Invalid comparator: "+V);this.operator=K[1],this.operator==="="&&(this.operator=""),K[2]?this.semver=new P(K[2],this.loose):this.semver=ce},ue.prototype.toString=function(){return this.value},ue.prototype.test=function(V){return D("Comparator.test",V,this.loose),this.semver===ce||(typeof V=="string"&&(V=new P(V,this.loose)),oe(V,this.operator,this.semver,this.loose))},ue.prototype.intersects=function(V,G){if(!(V instanceof ue))throw new TypeError("a Comparator is required");var K;if(this.operator==="")return K=new se(V.value,G),Re(this.value,K,G);if(V.operator==="")return K=new se(this.value,G),Re(V.semver,K,G);var he=!(this.operator!==">="&&this.operator!==">"||V.operator!==">="&&V.operator!==">"),ve=!(this.operator!=="<="&&this.operator!=="<"||V.operator!=="<="&&V.operator!=="<"),Ce=this.semver.version===V.semver.version,we=!(this.operator!==">="&&this.operator!=="<="||V.operator!==">="&&V.operator!=="<="),Oe=oe(this.semver,"<",V.semver,G)&&(this.operator===">="||this.operator===">")&&(V.operator==="<="||V.operator==="<"),Ie=oe(this.semver,">",V.semver,G)&&(this.operator==="<="||this.operator==="<")&&(V.operator===">="||V.operator===">");return he||ve||Ce&&we||Oe||Ie},e.Range=se,se.prototype.format=function(){return this.range=this.set.map(function(V){return V.join(" ").trim()}).join("||").trim(),this.range},se.prototype.toString=function(){return this.range},se.prototype.parseRange=function(V){var G=this.loose;V=V.trim(),D("range",V,G);var K=G?I[W]:I[x];V=V.replace(K,Le),D("hyphen replace",V),V=V.replace(I[A],"$1$2$3"),D("comparator trim",V,I[A]),V=(V=(V=V.replace(I[X],"$1~")).replace(I[ge],"$1^")).split(/\s+/).join(" ");var he=G?I[de]:I[F],ve=V.split(" ").map(function(Ce){return function(we,Oe){return D("comp",we),we=function(Ie,ke){return Ie.trim().split(/\s+/).map(function(Me){return function(be,Te){D("caret",be,Te);var Ne=Te?I[ae]:I[le];return be.replace(Ne,function(xe,ye,Ee,Pe,De){var Ae;return D("caret",be,xe,ye,Ee,Pe,De),fe(ye)?Ae="":fe(Ee)?Ae=">="+ye+".0.0 <"+(+ye+1)+".0.0":fe(Pe)?Ae=ye==="0"?">="+ye+"."+Ee+".0 <"+ye+"."+(+Ee+1)+".0":">="+ye+"."+Ee+".0 <"+(+ye+1)+".0.0":De?(D("replaceCaret pr",De),De.charAt(0)!=="-"&&(De="-"+De),Ae=ye==="0"?Ee==="0"?">="+ye+"."+Ee+"."+Pe+De+" <"+ye+"."+Ee+"."+(+Pe+1):">="+ye+"."+Ee+"."+Pe+De+" <"+ye+"."+(+Ee+1)+".0":">="+ye+"."+Ee+"."+Pe+De+" <"+(+ye+1)+".0.0"):(D("no pr"),Ae=ye==="0"?Ee==="0"?">="+ye+"."+Ee+"."+Pe+" <"+ye+"."+Ee+"."+(+Pe+1):">="+ye+"."+Ee+"."+Pe+" <"+ye+"."+(+Ee+1)+".0":">="+ye+"."+Ee+"."+Pe+" <"+(+ye+1)+".0.0"),D("caret return",Ae),Ae})}(Me,ke)}).join(" ")}(we,Oe),D("caret",we),we=function(Ie,ke){return Ie.trim().split(/\s+/).map(function(Me){return function(be,Te){var Ne=Te?I[ne]:I[ie];return be.replace(Ne,function(xe,ye,Ee,Pe,De){var Ae;return D("tilde",be,xe,ye,Ee,Pe,De),fe(ye)?Ae="":fe(Ee)?Ae=">="+ye+".0.0 <"+(+ye+1)+".0.0":fe(Pe)?Ae=">="+ye+"."+Ee+".0 <"+ye+"."+(+Ee+1)+".0":De?(D("replaceTilde pr",De),De.charAt(0)!=="-"&&(De="-"+De),Ae=">="+ye+"."+Ee+"."+Pe+De+" <"+ye+"."+(+Ee+1)+".0"):Ae=">="+ye+"."+Ee+"."+Pe+" <"+ye+"."+(+Ee+1)+".0",D("tilde return",Ae),Ae})}(Me,ke)}).join(" ")}(we,Oe),D("tildes",we),we=function(Ie,ke){return D("replaceXRanges",Ie,ke),Ie.split(/\s+/).map(function(Me){return function(be,Te){be=be.trim();var Ne=Te?I[M]:I[C];return be.replace(Ne,function(xe,ye,Ee,Pe,De,Ae){D("xRange",be,xe,ye,Ee,Pe,De,Ae);var _e=fe(Ee),Ve=_e||fe(Pe),ze=Ve||fe(De);return ye==="="&&ze&&(ye=""),_e?xe=ye===">"||ye==="<"?"<0.0.0":"*":ye&&ze?(Ve&&(Pe=0),ze&&(De=0),ye===">"?(ye=">=",Ve?(Ee=+Ee+1,Pe=0,De=0):ze&&(Pe=+Pe+1,De=0)):ye==="<="&&(ye="<",Ve?Ee=+Ee+1:Pe=+Pe+1),xe=ye+Ee+"."+Pe+"."+De):Ve?xe=">="+Ee+".0.0 <"+(+Ee+1)+".0.0":ze&&(xe=">="+Ee+"."+Pe+".0 <"+Ee+"."+(+Pe+1)+".0"),D("xRange return",xe),xe})}(Me,ke)}).join(" ")}(we,Oe),D("xrange",we),we=function(Ie,ke){return D("replaceStars",Ie,ke),Ie.trim().replace(I[q],"")}(we,Oe),D("stars",we),we}(Ce,G)}).join(" ").split(/\s+/);return this.loose&&(ve=ve.filter(function(Ce){return!!Ce.match(he)})),ve=ve.map(function(Ce){return new ue(Ce,G)})},se.prototype.intersects=function(V,G){if(!(V instanceof se))throw new TypeError("a Range is required");return this.set.some(function(K){return K.every(function(he){return V.set.some(function(ve){return ve.every(function(Ce){return he.intersects(Ce,G)})})})})},e.toComparators=function(V,G){return new se(V,G).set.map(function(K){return K.map(function(he){return he.value}).join(" ").trim().split(" ")})},se.prototype.test=function(V){if(!V)return!1;typeof V=="string"&&(V=new P(V,this.loose));for(var G=0;G<this.set.length;G++)if(Ue(this.set[G],V))return!0;return!1},e.satisfies=Re,e.maxSatisfying=function(V,G,K){var he=null,ve=null;try{var Ce=new se(G,K)}catch{return null}return V.forEach(function(we){Ce.test(we)&&(he&&ve.compare(we)!==-1||(ve=new P(he=we,K)))}),he},e.minSatisfying=function(V,G,K){var he=null,ve=null;try{var Ce=new se(G,K)}catch{return null}return V.forEach(function(we){Ce.test(we)&&(he&&ve.compare(we)!==1||(ve=new P(he=we,K)))}),he},e.validRange=function(V,G){try{return new se(V,G).range||"*"}catch{return null}},e.ltr=function(V,G,K){return Fe(V,G,"<",K)},e.gtr=function(V,G,K){return Fe(V,G,">",K)},e.outside=Fe,e.prerelease=function(V,G){var K=ee(V,G);return K&&K.prerelease.length?K.prerelease:null},e.intersects=function(V,G,K){return V=new se(V,K),G=new se(G,K),V.intersects(G)},e.coerce=function(V){if(V instanceof P)return V;if(typeof V!="string")return null;var G=V.match(I[_]);return G==null?null:ee((G[1]||"0")+"."+(G[2]||"0")+"."+(G[3]||"0"))}}).call(this,O(1))},function(j,e){var O,k,D=j.exports={};function L(){throw new Error("setTimeout has not been defined")}function T(){throw new Error("clearTimeout has not been defined")}function I(E){if(O===setTimeout)return setTimeout(E,0);if((O===L||!O)&&setTimeout)return O=setTimeout,setTimeout(E,0);try{return O(E,0)}catch{try{return O.call(null,E,0)}catch{return O.call(this,E,0)}}}(function(){try{O=typeof setTimeout=="function"?setTimeout:L}catch{O=L}try{k=typeof clearTimeout=="function"?clearTimeout:T}catch{k=T}})();var g,u=[],m=!1,S=-1;function p(){m&&g&&(m=!1,g.length?u=g.concat(u):S=-1,u.length&&b())}function b(){if(!m){var E=I(p);m=!0;for(var l=u.length;l;){for(g=u,u=[];++S<l;)g&&g[S].run();S=-1,l=u.length}g=null,m=!1,function(d){if(k===clearTimeout)return clearTimeout(d);if((k===T||!k)&&clearTimeout)return k=clearTimeout,clearTimeout(d);try{k(d)}catch{try{return k.call(null,d)}catch{return k.call(this,d)}}}(E)}}function y(E,l){this.fun=E,this.array=l}function w(){}D.nextTick=function(E){var l=new Array(arguments.length-1);if(arguments.length>1)for(var d=1;d<arguments.length;d++)l[d-1]=arguments[d];u.push(new y(E,l)),u.length!==1||m||I(b)},y.prototype.run=function(){this.fun.apply(null,this.array)},D.title="browser",D.browser=!0,D.env={},D.argv=[],D.version="",D.versions={},D.on=w,D.addListener=w,D.once=w,D.off=w,D.removeListener=w,D.removeAllListeners=w,D.emit=w,D.prependListener=w,D.prependOnceListener=w,D.listeners=function(E){return[]},D.binding=function(E){throw new Error("process.binding is not supported")},D.cwd=function(){return"/"},D.chdir=function(E){throw new Error("process.chdir is not supported")},D.umask=function(){return 0}}])}),define(J[71],Y([0,1]),function(j,e){"use strict";var O;Object.defineProperty(e,"__esModule",{value:!0}),e.SkipList=void 0;class k{constructor(I,g,u){this.level=I,this.key=g,this.value=u,this.forward=[]}}const D=void 0;class L{constructor(I,g=2**16){this.comparator=I,this[O]="SkipList",this._level=0,this._size=0,this._maxLevel=Math.max(1,Math.log2(g)|0),this._header=new k(this._maxLevel,D,D)}get size(){return this._size}clear(){this._header=new k(this._maxLevel,D,D)}has(I){return Boolean(L._search(this,I,this.comparator))}get(I){return L._search(this,I,this.comparator)?.value}set(I,g){return L._insert(this,I,g,this.comparator)&&(this._size+=1),this}delete(I){const g=L._delete(this,I,this.comparator);return g&&(this._size-=1),g}forEach(I,g){let u=this._header.forward[0];for(;u;)I.call(g,u.value,u.key,this),u=u.forward[0]}[(O=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}*entries(){let I=this._header.forward[0];for(;I;)yield[I.key,I.value],I=I.forward[0]}*keys(){let I=this._header.forward[0];for(;I;)yield I.key,I=I.forward[0]}*values(){let I=this._header.forward[0];for(;I;)yield I.value,I=I.forward[0]}toString(){let I="[SkipList]:",g=this._header.forward[0];for(;g;)I+=`node(${g.key}, ${g.value}, lvl:${g.level})`,g=g.forward[0];return I}static _search(I,g,u){let m=I._header;for(let S=I._level-1;S>=0;S--)for(;m.forward[S]&&u(m.forward[S].key,g)<0;)m=m.forward[S];if(m=m.forward[0],m&&u(m.key,g)===0)return m}static _insert(I,g,u,m){const S=[];let p=I._header;for(let b=I._level-1;b>=0;b--){for(;p.forward[b]&&m(p.forward[b].key,g)<0;)p=p.forward[b];S[b]=p}if(p=p.forward[0],p&&m(p.key,g)===0)return p.value=u,!1;{const b=L._randomLevel(I);if(b>I._level){for(let y=I._level;y<b;y++)S[y]=I._header;I._level=b}p=new k(b,g,u);for(let y=0;y<b;y++)p.forward[y]=S[y].forward[y],S[y].forward[y]=p;return!0}}static _randomLevel(I,g=.5){let u=1;for(;Math.random()<g&&u<I._maxLevel;)u+=1;return u}static _delete(I,g,u){const m=[];let S=I._header;for(let p=I._level-1;p>=0;p--){for(;S.forward[p]&&u(S.forward[p].key,g)<0;)S=S.forward[p];m[p]=S}if(S=S.forward[0],!S||u(S.key,g)!==0)return!1;for(let p=0;p<I._level&&m[p].forward[p]===S;p++)m[p].forward[p]=S.forward[p];for(;I._level>0&&I._header.forward[I._level-1]===D;)I._level-=1;return!0}}e.SkipList=L}),define(J[43],Y([0,1,10,2]),function(j,e,O,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.prefixedStream=e.prefixedReadable=e.transform=e.toReadable=e.emptyStream=e.toStream=e.peekStream=e.listenStream=e.consumeStream=e.peekReadable=e.consumeReadable=e.newWriteableStream=e.isReadableBufferedStream=e.isReadableStream=e.isReadable=void 0;function D(f){const s=f;return s?typeof s.read=="function":!1}e.isReadable=D;function L(f){const s=f;return s?[s.on,s.pause,s.resume,s.destroy].every(t=>typeof t=="function"):!1}e.isReadableStream=L;function T(f){const s=f;return s?L(s.stream)&&Array.isArray(s.buffer)&&typeof s.ended=="boolean":!1}e.isReadableBufferedStream=T;function I(f,s){return new g(f,s)}e.newWriteableStream=I;class g{constructor(s,t){this.reducer=s,this.options=t,this.state={flowing:!1,ended:!1,destroyed:!1},this.buffer={data:[],error:[]},this.listeners={data:[],error:[],end:[]},this.pendingWritePromises=[]}pause(){this.state.destroyed||(this.state.flowing=!1)}resume(){this.state.destroyed||this.state.flowing||(this.state.flowing=!0,this.flowData(),this.flowErrors(),this.flowEnd())}write(s){if(!this.state.destroyed){if(this.state.flowing)this.emitData(s);else if(this.buffer.data.push(s),typeof this.options?.highWaterMark=="number"&&this.buffer.data.length>this.options.highWaterMark)return new Promise(t=>this.pendingWritePromises.push(t))}}error(s){this.state.destroyed||(this.state.flowing?this.emitError(s):this.buffer.error.push(s))}end(s){this.state.destroyed||(typeof s<"u"&&this.write(s),this.state.flowing?(this.emitEnd(),this.destroy()):this.state.ended=!0)}emitData(s){this.listeners.data.slice(0).forEach(t=>t(s))}emitError(s){this.listeners.error.length===0?(0,O.onUnexpectedError)(s):this.listeners.error.slice(0).forEach(t=>t(s))}emitEnd(){this.listeners.end.slice(0).forEach(s=>s())}on(s,t){if(!this.state.destroyed)switch(s){case"data":this.listeners.data.push(t),this.resume();break;case"end":this.listeners.end.push(t),this.state.flowing&&this.flowEnd()&&this.destroy();break;case"error":this.listeners.error.push(t),this.state.flowing&&this.flowErrors();break}}removeListener(s,t){if(this.state.destroyed)return;let n;switch(s){case"data":n=this.listeners.data;break;case"end":n=this.listeners.end;break;case"error":n=this.listeners.error;break}if(n){const i=n.indexOf(t);i>=0&&n.splice(i,1)}}flowData(){if(this.buffer.data.length>0){const s=this.reducer(this.buffer.data);this.emitData(s),this.buffer.data.length=0;const t=[...this.pendingWritePromises];this.pendingWritePromises.length=0,t.forEach(n=>n())}}flowErrors(){if(this.listeners.error.length>0){for(const s of this.buffer.error)this.emitError(s);this.buffer.error.length=0}}flowEnd(){return this.state.ended?(this.emitEnd(),this.listeners.end.length>0):!1}destroy(){this.state.destroyed||(this.state.destroyed=!0,this.state.ended=!0,this.buffer.data.length=0,this.buffer.error.length=0,this.listeners.data.length=0,this.listeners.error.length=0,this.listeners.end.length=0,this.pendingWritePromises.length=0)}}function u(f,s){const t=[];let n;for(;(n=f.read())!==null;)t.push(n);return s(t)}e.consumeReadable=u;function m(f,s,t){const n=[];let i;for(;(i=f.read())!==null&&n.length<t;)n.push(i);return i===null&&n.length>0?s(n):{read:()=>{if(n.length>0)return n.shift();if(typeof i<"u"){const r=i;return i=void 0,r}return f.read()}}}e.peekReadable=m;function S(f,s){return new Promise((t,n)=>{const i=[];p(f,{onData:r=>{s&&i.push(r)},onError:r=>{s?n(r):t(void 0)},onEnd:()=>{t(s?s(i):void 0)}})})}e.consumeStream=S;function p(f,s){let t=!1;return f.on("error",n=>{t||s.onError(n)}),f.on("end",()=>{t||s.onEnd()}),f.on("data",n=>{t||s.onData(n)}),(0,k.toDisposable)(()=>t=!0)}e.listenStream=p;function b(f,s){return new Promise((t,n)=>{const i=new k.DisposableStore,r=[],o=h=>{if(r.push(h),r.length>s)return i.dispose(),f.pause(),t({stream:f,buffer:r,ended:!1})},c=h=>n(h),a=()=>t({stream:f,buffer:r,ended:!0});i.add((0,k.toDisposable)(()=>f.removeListener("error",c))),f.on("error",c),i.add((0,k.toDisposable)(()=>f.removeListener("end",a))),f.on("end",a),i.add((0,k.toDisposable)(()=>f.removeListener("data",o))),f.on("data",o)})}e.peekStream=b;function y(f,s){const t=I(s);return t.end(f),t}e.toStream=y;function w(){const f=I(()=>{throw new Error("not supported")});return f.end(),f}e.emptyStream=w;function E(f){let s=!1;return{read:()=>s?null:(s=!0,f)}}e.toReadable=E;function l(f,s,t){const n=I(t);return p(f,{onData:i=>n.write(s.data(i)),onError:i=>n.error(s.error?s.error(i):i),onEnd:()=>n.end()}),n}e.transform=l;function d(f,s,t){let n=!1;return{read:()=>{const i=s.read();return n?i:(n=!0,i!==null?t([f,i]):f)}}}e.prefixedReadable=d;function v(f,s,t){let n=!1;const i=I(t);return p(s,{onData:r=>n?i.write(r):(n=!0,i.write(t([f,r]))),onError:r=>i.error(r),onEnd:()=>{n||(n=!0,i.write(f)),i.end()}}),i}e.prefixedStream=v}),define(J[15],Y([0,1,43]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.encodeBase64=e.decodeBase64=e.prefixedBufferStream=e.prefixedBufferReadable=e.newWriteableBufferStream=e.streamToBufferReadableStream=e.bufferToStream=e.bufferedStreamToBuffer=e.streamToBuffer=e.bufferToReadable=e.readableToBuffer=e.writeUInt8=e.readUInt8=e.writeUInt32LE=e.readUInt32LE=e.writeUInt32BE=e.readUInt32BE=e.writeUInt16LE=e.readUInt16LE=e.VSBuffer=void 0;const k=typeof Buffer<"u";let D,L;class T{static alloc(h){return k?new T(Buffer.allocUnsafe(h)):new T(new Uint8Array(h))}static wrap(h){return k&&!Buffer.isBuffer(h)&&(h=Buffer.from(h.buffer,h.byteOffset,h.byteLength)),new T(h)}static fromString(h,C){return!(C?.dontUseNodeBuffer||!1)&&k?new T(Buffer.from(h)):(D||(D=new TextEncoder),new T(D.encode(h)))}static fromByteArray(h){const C=T.alloc(h.length);for(let M=0,_=h.length;M<_;M++)C.buffer[M]=h[M];return C}static concat(h,C){if(typeof C>"u"){C=0;for(let H=0,X=h.length;H<X;H++)C+=h[H].byteLength}const M=T.alloc(C);let _=0;for(let H=0,X=h.length;H<X;H++){const ie=h[H];M.set(ie,_),_+=ie.byteLength}return M}constructor(h){this.buffer=h,this.byteLength=this.buffer.byteLength}clone(){const h=T.alloc(this.byteLength);return h.set(this),h}toString(){return k?this.buffer.toString():(L||(L=new TextDecoder),L.decode(this.buffer))}slice(h,C){return new T(this.buffer.subarray(h,C))}set(h,C){if(h instanceof T)this.buffer.set(h.buffer,C);else if(h instanceof Uint8Array)this.buffer.set(h,C);else if(h instanceof ArrayBuffer)this.buffer.set(new Uint8Array(h),C);else if(ArrayBuffer.isView(h))this.buffer.set(new Uint8Array(h.buffer,h.byteOffset,h.byteLength),C);else throw new Error("Unknown argument 'array'")}readUInt32BE(h){return u(this.buffer,h)}writeUInt32BE(h,C){m(this.buffer,h,C)}readUInt32LE(h){return S(this.buffer,h)}writeUInt32LE(h,C){p(this.buffer,h,C)}readUInt8(h){return b(this.buffer,h)}writeUInt8(h,C){y(this.buffer,h,C)}}e.VSBuffer=T;function I(a,h){return a[h+0]<<0>>>0|a[h+1]<<8>>>0}e.readUInt16LE=I;function g(a,h,C){a[C+0]=h&255,h=h>>>8,a[C+1]=h&255}e.writeUInt16LE=g;function u(a,h){return a[h]*2**24+a[h+1]*2**16+a[h+2]*2**8+a[h+3]}e.readUInt32BE=u;function m(a,h,C){a[C+3]=h,h=h>>>8,a[C+2]=h,h=h>>>8,a[C+1]=h,h=h>>>8,a[C]=h}e.writeUInt32BE=m;function S(a,h){return a[h+0]<<0>>>0|a[h+1]<<8>>>0|a[h+2]<<16>>>0|a[h+3]<<24>>>0}e.readUInt32LE=S;function p(a,h,C){a[C+0]=h&255,h=h>>>8,a[C+1]=h&255,h=h>>>8,a[C+2]=h&255,h=h>>>8,a[C+3]=h&255}e.writeUInt32LE=p;function b(a,h){return a[h]}e.readUInt8=b;function y(a,h,C){a[C]=h}e.writeUInt8=y;function w(a){return O.consumeReadable(a,h=>T.concat(h))}e.readableToBuffer=w;function E(a){return O.toReadable(a)}e.bufferToReadable=E;function l(a){return O.consumeStream(a,h=>T.concat(h))}e.streamToBuffer=l;async function d(a){return a.ended?T.concat(a.buffer):T.concat([...a.buffer,await l(a.stream)])}e.bufferedStreamToBuffer=d;function v(a){return O.toStream(a,h=>T.concat(h))}e.bufferToStream=v;function f(a){return O.transform(a,{data:h=>typeof h=="string"?T.fromString(h):T.wrap(h)},h=>T.concat(h))}e.streamToBufferReadableStream=f;function s(a){return O.newWriteableStream(h=>T.concat(h),a)}e.newWriteableBufferStream=s;function t(a,h){return O.prefixedReadable(a,h,C=>T.concat(C))}e.prefixedBufferReadable=t;function n(a,h){return O.prefixedStream(a,h,C=>T.concat(C))}e.prefixedBufferStream=n;function i(a){let h=0,C=0,M=0;const _=new Uint8Array(Math.floor(a.length/4*3)),H=ie=>{switch(C){case 3:_[M++]=h|ie,C=0;break;case 2:_[M++]=h|ie>>>2,h=ie<<6,C=3;break;case 1:_[M++]=h|ie>>>4,h=ie<<4,C=2;break;default:h=ie<<2,C=1}};for(let ie=0;ie<a.length;ie++){const ne=a.charCodeAt(ie);if(ne>=65&&ne<=90)H(ne-65);else if(ne>=97&&ne<=122)H(ne-97+26);else if(ne>=48&&ne<=57)H(ne-48+52);else if(ne===43||ne===45)H(62);else if(ne===47||ne===95)H(63);else{if(ne===61)break;throw new SyntaxError(`Unexpected base64 character ${a[ie]}`)}}const X=M;for(;C>0;)H(0);return T.wrap(_).slice(0,X)}e.decodeBase64=i;const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function c({buffer:a},h=!0,C=!1){const M=C?o:r;let _="";const H=a.byteLength%3;let X=0;for(;X<a.byteLength-H;X+=3){const ie=a[X+0],ne=a[X+1],Q=a[X+2];_+=M[ie>>>2],_+=M[(ie<<4|ne>>>4)&63],_+=M[(ne<<2|Q>>>6)&63],_+=M[Q&63]}if(H===1){const ie=a[X+0];_+=M[ie>>>2],_+=M[ie<<4&63],h&&(_+="==")}else if(H===2){const ie=a[X+0],ne=a[X+1];_+=M[ie>>>2],_+=M[(ie<<4|ne>>>4)&63],_+=M[ne<<2&63],h&&(_+="=")}return _}e.encodeBase64=c}),define(J[29],Y([0,1,5]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createProxyObject=e.getAllMethodNames=e.getAllPropertyNames=e.filter=e.getCaseInsensitive=e.distinct=e.safeStringify=e.equals=e.mixin=e.cloneAndChange=e.deepFreeze=e.deepClone=void 0;function k(l){if(!l||typeof l!="object"||l instanceof RegExp)return l;const d=Array.isArray(l)?[]:{};return Object.entries(l).forEach(([v,f])=>{d[v]=f&&typeof f=="object"?k(f):f}),d}e.deepClone=k;function D(l){if(!l||typeof l!="object")return l;const d=[l];for(;d.length>0;){const v=d.shift();Object.freeze(v);for(const f in v)if(L.call(v,f)){const s=v[f];typeof s=="object"&&!Object.isFrozen(s)&&!(0,O.isTypedArray)(s)&&d.push(s)}}return l}e.deepFreeze=D;const L=Object.prototype.hasOwnProperty;function T(l,d){return I(l,d,new Set)}e.cloneAndChange=T;function I(l,d,v){if((0,O.isUndefinedOrNull)(l))return l;const f=d(l);if(typeof f<"u")return f;if(Array.isArray(l)){const s=[];for(const t of l)s.push(I(t,d,v));return s}if((0,O.isObject)(l)){if(v.has(l))throw new Error("Cannot clone recursive data-structure");v.add(l);const s={};for(const t in l)L.call(l,t)&&(s[t]=I(l[t],d,v));return v.delete(l),s}return l}function g(l,d,v=!0){return(0,O.isObject)(l)?((0,O.isObject)(d)&&Object.keys(d).forEach(f=>{f in l?v&&((0,O.isObject)(l[f])&&(0,O.isObject)(d[f])?g(l[f],d[f],v):l[f]=d[f]):l[f]=d[f]}),l):d}e.mixin=g;function u(l,d){if(l===d)return!0;if(l==null||d===null||d===void 0||typeof l!=typeof d||typeof l!="object"||Array.isArray(l)!==Array.isArray(d))return!1;let v,f;if(Array.isArray(l)){if(l.length!==d.length)return!1;for(v=0;v<l.length;v++)if(!u(l[v],d[v]))return!1}else{const s=[];for(f in l)s.push(f);s.sort();const t=[];for(f in d)t.push(f);if(t.sort(),!u(s,t))return!1;for(v=0;v<s.length;v++)if(!u(l[s[v]],d[s[v]]))return!1}return!0}e.equals=u;function m(l){const d=new Set;return JSON.stringify(l,(v,f)=>{if((0,O.isObject)(f)||Array.isArray(f)){if(d.has(f))return"[Circular]";d.add(f)}return f})}e.safeStringify=m;function S(l,d){const v=Object.create(null);return!l||!d||Object.keys(d).forEach(s=>{const t=l[s],n=d[s];u(t,n)||(v[s]=n)}),v}e.distinct=S;function p(l,d){const v=d.toLowerCase(),f=Object.keys(l).find(s=>s.toLowerCase()===v);return f?l[f]:l[d]}e.getCaseInsensitive=p;function b(l,d){const v=Object.create(null);for(const[f,s]of Object.entries(l))d(f,s)&&(v[f]=s);return v}e.filter=b;function y(l){let d=[],v=Object.getPrototypeOf(l);for(;Object.prototype!==v;)d=d.concat(Object.getOwnPropertyNames(v)),v=Object.getPrototypeOf(v);return d}e.getAllPropertyNames=y;function w(l){const d=[];for(const v of y(l))typeof l[v]=="function"&&d.push(v);return d}e.getAllMethodNames=w;function E(l,d){const v=s=>function(){const t=Array.prototype.slice.call(arguments,0);return d(s,t)},f={};for(const s of l)f[s]=v(s);return f}e.createProxyObject=E}),define(J[30],Y([0,1]),function(j,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.generateUuid=e.isUUID=void 0;const O=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function k(D){return O.test(D)}e.isUUID=k,e.generateUuid=function(){if(typeof crypto=="object"&&typeof crypto.randomUUID=="function")return crypto.randomUUID.bind(crypto);let D;typeof crypto=="object"&&typeof crypto.getRandomValues=="function"?D=crypto.getRandomValues.bind(crypto):D=function(I){for(let g=0;g<I.length;g++)I[g]=Math.floor(Math.random()*256);return I};const L=new Uint8Array(16),T=[];for(let I=0;I<256;I++)T.push(I.toString(16).padStart(2,"0"));return function(){D(L),L[6]=L[6]&15|64,L[8]=L[8]&63|128;let g=0,u="";return u+=T[L[g++]],u+=T[L[g++]],u+=T[L[g++]],u+=T[L[g++]],u+="-",u+=T[L[g++]],u+=T[L[g++]],u+="-",u+=T[L[g++]],u+=T[L[g++]],u+="-",u+=T[L[g++]],u+=T[L[g++]],u+="-",u+=T[L[g++]],u+=T[L[g++]],u+=T[L[g++]],u+=T[L[g++]],u+=T[L[g++]],u+=T[L[g++]],u}}()}),define(J[72],Y([0,1,36]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getMac=void 0;const k=new Set(["00:00:00:00:00:00","ff:ff:ff:ff:ff:ff","ac:de:48:00:11:22"]);function D(T){const I=T.replace(/\-/g,":").toLowerCase();return!k.has(I)}function L(){const T=(0,O.networkInterfaces)();for(const I in T){const g=T[I];if(g){for(const{mac:u}of g)if(D(u))return u}}throw new Error("Unable to retrieve mac address (unexpected format)")}e.getMac=L}),define(J[73],Y([6,7]),function(j,e){return j.create("vs/base/common/date",e)}),define(J[74],Y([0,1,73]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.toLocalISOString=e.fromNow=void 0;const k=60,D=k*60,L=D*24,T=L*7,I=L*30,g=L*365;function u(S,p,b){typeof S!="number"&&(S=S.getTime());const y=Math.round((new Date().getTime()-S)/1e3);if(y<-30)return(0,O.localize)(0,null,u(new Date().getTime()+y*1e3,!1));if(y<30)return(0,O.localize)(1,null);let w;return y<k?(w=y,p?w===1?b?(0,O.localize)(2,null,w):(0,O.localize)(3,null,w):b?(0,O.localize)(4,null,w):(0,O.localize)(5,null,w):w===1?b?(0,O.localize)(6,null,w):(0,O.localize)(7,null,w):b?(0,O.localize)(8,null,w):(0,O.localize)(9,null,w)):y<D?(w=Math.floor(y/k),p?w===1?b?(0,O.localize)(10,null,w):(0,O.localize)(11,null,w):b?(0,O.localize)(12,null,w):(0,O.localize)(13,null,w):w===1?b?(0,O.localize)(14,null,w):(0,O.localize)(15,null,w):b?(0,O.localize)(16,null,w):(0,O.localize)(17,null,w)):y<L?(w=Math.floor(y/D),p?w===1?b?(0,O.localize)(18,null,w):(0,O.localize)(19,null,w):b?(0,O.localize)(20,null,w):(0,O.localize)(21,null,w):w===1?b?(0,O.localize)(22,null,w):(0,O.localize)(23,null,w):b?(0,O.localize)(24,null,w):(0,O.localize)(25,null,w)):y<T?(w=Math.floor(y/L),p?w===1?(0,O.localize)(26,null,w):(0,O.localize)(27,null,w):w===1?(0,O.localize)(28,null,w):(0,O.localize)(29,null,w)):y<I?(w=Math.floor(y/T),p?w===1?b?(0,O.localize)(30,null,w):(0,O.localize)(31,null,w):b?(0,O.localize)(32,null,w):(0,O.localize)(33,null,w):w===1?b?(0,O.localize)(34,null,w):(0,O.localize)(35,null,w):b?(0,O.localize)(36,null,w):(0,O.localize)(37,null,w)):y<g?(w=Math.floor(y/I),p?w===1?b?(0,O.localize)(38,null,w):(0,O.localize)(39,null,w):b?(0,O.localize)(40,null,w):(0,O.localize)(41,null,w):w===1?b?(0,O.localize)(42,null,w):(0,O.localize)(43,null,w):b?(0,O.localize)(44,null,w):(0,O.localize)(45,null,w)):(w=Math.floor(y/g),p?w===1?b?(0,O.localize)(46,null,w):(0,O.localize)(47,null,w):b?(0,O.localize)(48,null,w):(0,O.localize)(49,null,w):w===1?b?(0,O.localize)(50,null,w):(0,O.localize)(51,null,w):b?(0,O.localize)(52,null,w):(0,O.localize)(53,null,w))}e.fromNow=u;function m(S){return S.getFullYear()+"-"+String(S.getMonth()+1).padStart(2,"0")+"-"+String(S.getDate()).padStart(2,"0")+"T"+String(S.getHours()).padStart(2,"0")+":"+String(S.getMinutes()).padStart(2,"0")+":"+String(S.getSeconds()).padStart(2,"0")+"."+(S.getMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}e.toLocalISOString=m}),define(J[75],Y([6,7]),function(j,e){return j.create("vs/base/common/errorMessage",e)}),define(J[33],Y([0,1,19,5,75]),function(j,e,O,k,D){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createErrorWithActions=e.isErrorWithActions=e.toErrorMessage=void 0;function L(S,p){return p&&(S.stack||S.stacktrace)?D.localize(0,null,I(S),T(S.stack)||T(S.stacktrace)):I(S)}function T(S){return Array.isArray(S)?S.join(`
`):S}function I(S){return typeof S.code=="string"&&typeof S.errno=="number"&&typeof S.syscall=="string"?D.localize(1,null,S.message):S.message||D.localize(2,null)}function g(S=null,p=!1){if(!S)return D.localize(3,null);if(Array.isArray(S)){const b=O.coalesce(S),y=g(b[0],p);return b.length>1?D.localize(4,null,y,b.length):y}if(k.isString(S))return S;if(S.detail){const b=S.detail;if(b.error)return L(b.error,p);if(b.exception)return L(b.exception,p)}return S.stack?L(S,p):S.message?S.message:D.localize(5,null)}e.toErrorMessage=g;function u(S){const p=S;return p instanceof Error&&Array.isArray(p.actions)}e.isErrorWithActions=u;function m(S,p){let b;return typeof S=="string"?b=new Error(S):b=S,b.actions=p,b}e.createErrorWithActions=m}),define(J[76],Y([6,7]),function(j,e){return j.create("vs/base/common/jsonErrorMessages",e)}),define(J[77],Y([0,1,76]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getParseErrorMessage=void 0;function k(D){switch(D){case 1:return(0,O.localize)(0,null);case 2:return(0,O.localize)(1,null);case 3:return(0,O.localize)(2,null);case 4:return(0,O.localize)(3,null);case 5:return(0,O.localize)(4,null);case 6:return(0,O.localize)(5,null);case 7:return(0,O.localize)(6,null);case 8:return(0,O.localize)(7,null);case 9:return(0,O.localize)(8,null);default:return""}}e.getParseErrorMessage=k}),define(J[51],Y([0,1,12]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.removeDangerousEnvVariables=e.sanitizeProcessEnvironment=e.TerminateResponseCode=e.Source=void 0;var k;(function(I){I[I.stdout=0]="stdout",I[I.stderr=1]="stderr"})(k=e.Source||(e.Source={}));var D;(function(I){I[I.Success=0]="Success",I[I.Unknown=1]="Unknown",I[I.AccessDenied=2]="AccessDenied",I[I.ProcessNotFound=3]="ProcessNotFound"})(D=e.TerminateResponseCode||(e.TerminateResponseCode={}));function L(I,...g){const u=g.reduce((p,b)=>(p[b]=!0,p),{}),m=[/^ELECTRON_.+$/,/^VSCODE_(?!SHELL_LOGIN).+$/,/^SNAP(|_.*)$/,/^GDK_PIXBUF_.+$/];Object.keys(I).filter(p=>!u[p]).forEach(p=>{for(let b=0;b<m.length;b++)if(p.search(m[b])!==-1){delete I[p];break}})}e.sanitizeProcessEnvironment=L;function T(I){!I||(delete I.DEBUG,O.isMacintosh&&delete I.DYLD_LIBRARY_PATH,O.isLinux&&delete I.LD_PRELOAD)}e.removeDangerousEnvVariables=T}),define(J[52],Y([0,1,31]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StringSHA1=e.toHexString=e.Hasher=e.stringHash=e.numberHash=e.doHash=e.hash=void 0;function k(l){return D(l,0)}e.hash=k;function D(l,d){switch(typeof l){case"object":return l===null?L(349,d):Array.isArray(l)?g(l,d):u(l,d);case"string":return I(l,d);case"boolean":return T(l,d);case"number":return L(l,d);case"undefined":return L(937,d);default:return L(617,d)}}e.doHash=D;function L(l,d){return(d<<5)-d+l|0}e.numberHash=L;function T(l,d){return L(l?433:863,d)}function I(l,d){d=L(149417,d);for(let v=0,f=l.length;v<f;v++)d=L(l.charCodeAt(v),d);return d}e.stringHash=I;function g(l,d){return d=L(104579,d),l.reduce((v,f)=>D(f,v),d)}function u(l,d){return d=L(181387,d),Object.keys(l).sort().reduce((v,f)=>(v=I(f,v),D(l[f],v)),d)}class m{constructor(){this._value=0}get value(){return this._value}hash(d){return this._value=D(d,this._value),this._value}}e.Hasher=m;var S;(function(l){l[l.BLOCK_SIZE=64]="BLOCK_SIZE",l[l.UNICODE_REPLACEMENT=65533]="UNICODE_REPLACEMENT"})(S||(S={}));function p(l,d,v=32){const f=v-d,s=~((1<<f)-1);return(l<<d|(s&l)>>>f)>>>0}function b(l,d=0,v=l.byteLength,f=0){for(let s=0;s<v;s++)l[d+s]=f}function y(l,d,v="0"){for(;l.length<d;)l=v+l;return l}function w(l,d=32){return l instanceof ArrayBuffer?Array.from(new Uint8Array(l)).map(v=>v.toString(16).padStart(2,"0")).join(""):y((l>>>0).toString(16),d/4)}e.toHexString=w;class E{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(64+3),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(d){const v=d.length;if(v===0)return;const f=this._buff;let s=this._buffLen,t=this._leftoverHighSurrogate,n,i;for(t!==0?(n=t,i=-1,t=0):(n=d.charCodeAt(0),i=0);;){let r=n;if(O.isHighSurrogate(n))if(i+1<v){const o=d.charCodeAt(i+1);O.isLowSurrogate(o)?(i++,r=O.computeCodePoint(n,o)):r=65533}else{t=n;break}else O.isLowSurrogate(n)&&(r=65533);if(s=this._push(f,s,r),i++,i<v)n=d.charCodeAt(i);else break}this._buffLen=s,this._leftoverHighSurrogate=t}_push(d,v,f){return f<128?d[v++]=f:f<2048?(d[v++]=192|(f&1984)>>>6,d[v++]=128|(f&63)>>>0):f<65536?(d[v++]=224|(f&61440)>>>12,d[v++]=128|(f&4032)>>>6,d[v++]=128|(f&63)>>>0):(d[v++]=240|(f&1835008)>>>18,d[v++]=128|(f&258048)>>>12,d[v++]=128|(f&4032)>>>6,d[v++]=128|(f&63)>>>0),v>=64&&(this._step(),v-=64,this._totalLen+=64,d[0]=d[64+0],d[1]=d[64+1],d[2]=d[64+2]),v}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),w(this._h0)+w(this._h1)+w(this._h2)+w(this._h3)+w(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,b(this._buff,this._buffLen),this._buffLen>56&&(this._step(),b(this._buff));const d=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(d/4294967296),!1),this._buffDV.setUint32(60,d%4294967296,!1),this._step()}_step(){const d=E._bigBlock32,v=this._buffDV;for(let a=0;a<64;a+=4)d.setUint32(a,v.getUint32(a,!1),!1);for(let a=64;a<320;a+=4)d.setUint32(a,p(d.getUint32(a-12,!1)^d.getUint32(a-32,!1)^d.getUint32(a-56,!1)^d.getUint32(a-64,!1),1),!1);let f=this._h0,s=this._h1,t=this._h2,n=this._h3,i=this._h4,r,o,c;for(let a=0;a<80;a++)a<20?(r=s&t|~s&n,o=1518500249):a<40?(r=s^t^n,o=1859775393):a<60?(r=s&t|s&n|t&n,o=2400959708):(r=s^t^n,o=3395469782),c=p(f,5)+r+i+o+d.getUint32(a*4,!1)&4294967295,i=n,n=t,t=p(s,30),s=f,f=c;this._h0=this._h0+f&4294967295,this._h1=this._h1+s&4294967295,this._h2=this._h2+t&4294967295,this._h3=this._h3+n&4294967295,this._h4=this._h4+i&4294967295}}e.StringSHA1=E,E._bigBlock32=new DataView(new ArrayBuffer(320))}),define(J[53],Y([0,1,31]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var k;(function(D){D[D.Ignore=0]="Ignore",D[D.Info=1]="Info",D[D.Warning=2]="Warning",D[D.Error=3]="Error"})(k||(k={})),function(D){const L="error",T="warning",I="warn",g="info",u="ignore";function m(p){return p?O.equalsIgnoreCase(L,p)?D.Error:O.equalsIgnoreCase(T,p)||O.equalsIgnoreCase(I,p)?D.Warning:O.equalsIgnoreCase(g,p)?D.Info:D.Ignore:D.Ignore}D.fromValue=m;function S(p){switch(p){case D.Error:return L;case D.Warning:return T;case D.Info:return g;default:return u}}D.toString=S}(k||(k={})),e.default=k}),define(J[78],Y([0,1,11]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.log=e.getFirstFrame=e.parse=e.isRemoteConsoleLog=void 0;function k(u){const m=u;return m&&typeof m.type=="string"&&typeof m.severity=="string"}e.isRemoteConsoleLog=k;function D(u){const m=[];let S;try{const p=JSON.parse(u.arguments),b=p[p.length-1];b&&b.__$stack&&(p.pop(),S=b.__$stack),m.push(...p)}catch{m.push("Unable to log remote console arguments",u.arguments)}return{args:m,stack:S}}e.parse=D;function L(u){if(typeof u!="string")return L(D(u).stack);const m=u;if(m){const S=T(m),p=/at [^\/]*((?:(?:[a-zA-Z]+:)|(?:[\/])|(?:\\\\))(?:.+)):(\d+):(\d+)/.exec(S||"");if(p&&p.length===4)return{uri:O.URI.file(p[1]),line:Number(p[2]),column:Number(p[3])}}}e.getFirstFrame=L;function T(u){if(!u)return u;const m=u.indexOf(`
`);return m===-1?u:u.substring(0,m)}function I(u,m){const{args:S,stack:p}=D(u),b=typeof S[0]=="string"&&S.length===1;let y=T(p);y&&(y=`(${y.trim()})`);let w=[];if(typeof S[0]=="string"?y&&b?w=[`%c[${m}] %c${S[0]} %c${y}`,g("blue"),g(""),g("grey")]:w=[`%c[${m}] %c${S[0]}`,g("blue"),g(""),...S.slice(1)]:w=[`%c[${m}]%`,g("blue"),...S],y&&!b&&w.push(y),typeof console[u.severity]!="function")throw new Error("Unknown console method");console[u.severity].apply(console,w)}e.log=I;function g(u){return`color: ${u}`}}),define(J[44],Y([0,1,15,31,11]),function(j,e,O,k,D){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.revive=e.parse=e.stringify=void 0;function L(u){return JSON.stringify(u,I)}e.stringify=L;function T(u){let m=JSON.parse(u);return m=g(m),m}e.parse=T;function I(u,m){return m instanceof RegExp?{$mid:2,source:m.source,flags:(0,k.regExpFlags)(m)}:m}function g(u,m=0){if(!u||m>200)return u;if(typeof u=="object"){switch(u.$mid){case 1:return D.URI.revive(u);case 2:return new RegExp(u.source,u.flags);case 16:return new Date(u.source)}if(u instanceof O.VSBuffer||u instanceof Uint8Array)return u;if(Array.isArray(u))for(let S=0;S<u.length;++S)u[S]=g(u[S],m+1);else for(const S in u)Object.hasOwnProperty.call(u,S)&&(u[S]=g(u[S],m+1))}return u}e.revive=g}),define(J[79],Y([0,1,36,10,54,30,72]),function(j,e,O,k,D,L,T){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getMachineId=e.virtualMachineHint=void 0,e.virtualMachineHint=new class{_isVirtualMachineMacAddress(m){return this._virtualMachineOUIs||(this._virtualMachineOUIs=D.TernarySearchTree.forStrings(),this._virtualMachineOUIs.set("00-50-56",!0),this._virtualMachineOUIs.set("00-0C-29",!0),this._virtualMachineOUIs.set("00-05-69",!0),this._virtualMachineOUIs.set("00-03-FF",!0),this._virtualMachineOUIs.set("00-1C-42",!0),this._virtualMachineOUIs.set("00-16-3E",!0),this._virtualMachineOUIs.set("08-00-27",!0),this._virtualMachineOUIs.set("00:50:56",!0),this._virtualMachineOUIs.set("00:0C:29",!0),this._virtualMachineOUIs.set("00:05:69",!0),this._virtualMachineOUIs.set("00:03:FF",!0),this._virtualMachineOUIs.set("00:1C:42",!0),this._virtualMachineOUIs.set("00:16:3E",!0),this._virtualMachineOUIs.set("08:00:27",!0)),!!this._virtualMachineOUIs.findSubstr(m)}value(){if(this._value===void 0){let m=0,S=0;const p=(0,O.networkInterfaces)();for(const b in p){const y=p[b];if(y)for(const{mac:w,internal:E}of y)E||(S+=1,this._isVirtualMachineMacAddress(w.toUpperCase())&&(m+=1))}this._value=S>0?m/S:0}return this._value}};let I;async function g(){return I||(I=(async()=>await u()||L.generateUuid())()),I}e.getMachineId=g;async function u(){try{const m=await new Promise((p,b)=>{j(["crypto"],p,b)}),S=(0,T.getMac)();return m.createHash("sha256").update(S,"utf8").digest("hex")}catch(m){k.onUnexpectedError(m);return}}}),define(J[80],Y([0,1,36,14,20]),function(j,e,O,k,D){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getFirstAvailablePowerShellInstallation=e.enumeratePowerShellInstallations=void 0;const L=/^\d+$/,T=/^Microsoft.PowerShell_.*/,I=/^Microsoft.PowerShellPreview_.*/;var g;(function(f){f[f.x64=0]="x64",f[f.x86=1]="x86",f[f.ARM=2]="ARM"})(g||(g={}));let u;switch(process.arch){case"ia32":case"x32":u=1;break;case"arm":case"arm64":u=2;break;default:u=0;break}let m;process.env.PROCESSOR_ARCHITEW6432?m=process.env.PROCESSOR_ARCHITEW6432==="ARM64"?2:0:process.env.PROCESSOR_ARCHITECTURE==="ARM64"?m=2:process.env.PROCESSOR_ARCHITECTURE==="X86"?m=1:m=0;class S{constructor(s,t,n){this.exePath=s,this.displayName=t,this.knownToExist=n}async exists(){return this.knownToExist===void 0&&(this.knownToExist=await D.SymlinkSupport.existsFile(this.exePath)),this.knownToExist}}function p({useAlternateBitness:f=!1}={}){return f?u===0?process.env["ProgramFiles(x86)"]||null:m===0&&process.env.ProgramW6432||null:process.env.ProgramFiles||null}async function b({useAlternateBitness:f=!1,findPreview:s=!1}={}){const t=p({useAlternateBitness:f});if(!t)return null;const n=k.join(t,"PowerShell");if(!await D.SymlinkSupport.existsDirectory(n))return null;let i=-1,r=null;for(const a of await D.Promises.readdir(n)){let h=-1;if(s){const M=a.indexOf("-");if(M<0)continue;const _=a.substring(0,M);if(!L.test(_)||a.substring(M+1)!=="preview")continue;h=parseInt(_,10)}else{if(!L.test(a))continue;h=parseInt(a,10)}if(h<=i)continue;const C=k.join(n,a,"pwsh.exe");!await D.SymlinkSupport.existsFile(C)||(r=C,i=h)}if(!r)return null;const o=t.includes("x86")?" (x86)":"",c=s?" Preview":"";return new S(r,`PowerShell${c}${o}`,!0)}async function y({findPreview:f}={}){if(!process.env.LOCALAPPDATA)return null;const s=k.join(process.env.LOCALAPPDATA,"Microsoft","WindowsApps");if(!await D.SymlinkSupport.existsDirectory(s))return null;const{pwshMsixDirRegex:t,pwshMsixName:n}=f?{pwshMsixDirRegex:I,pwshMsixName:"PowerShell Preview (Store)"}:{pwshMsixDirRegex:T,pwshMsixName:"PowerShell (Store)"};for(const i of await D.Promises.readdir(s))if(t.test(i)){const r=k.join(s,i,"pwsh.exe");return new S(r,n)}return null}function w(){const f=k.join(O.homedir(),".dotnet","tools","pwsh.exe");return new S(f,".NET Core PowerShell Global Tool")}function E(){const f=k.join(process.env.windir,u===1&&m!==1?"SysNative":"System32","WindowsPowerShell","v1.0","powershell.exe");return new S(f,"Windows PowerShell",!0)}async function*l(){let f=await b();f&&(yield f),f=await b({useAlternateBitness:!0}),f&&(yield f),f=await y(),f&&(yield f),f=w(),f&&(yield f),f=await b({findPreview:!0}),f&&(yield f),f=await y({findPreview:!0}),f&&(yield f),f=await b({useAlternateBitness:!0,findPreview:!0}),f&&(yield f),f=E(),f&&(yield f)}async function*d(){for await(const f of l())await f.exists()&&(yield f)}e.enumeratePowerShellInstallations=d;async function v(){for await(const f of d())return f;return null}e.getFirstAvailablePowerShellInstallation=v}),define(J[55],Y([0,1,14,12,37,51,5,20]),function(j,e,O,k,D,L,T,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.win32=e.createQueuedSender=e.getWindowsShell=e.TerminateResponseCode=e.Source=void 0,Object.defineProperty(e,"Source",{enumerable:!0,get:function(){return L.Source}}),Object.defineProperty(e,"TerminateResponseCode",{enumerable:!0,get:function(){return L.TerminateResponseCode}});function g(S=D.env){return S.comspec||"cmd.exe"}e.getWindowsShell=g;function u(S){let p=[],b=!1;const y=function(w){if(b){p.push(w);return}(!S.send(w,l=>{if(l&&console.error(l),b=!1,p.length>0){const d=p.slice(0);p=[],d.forEach(v=>y(v))}})||k.isWindows)&&(b=!0)};return{send:y}}e.createQueuedSender=u;var m;(function(S){async function p(b,y,w){if(O.isAbsolute(b))return b;if(y===void 0&&(y=D.cwd()),O.dirname(b)!=="."||(w===void 0&&T.isString(D.env.PATH)&&(w=D.env.PATH.split(O.delimiter)),w===void 0||w.length===0))return O.join(y,b);async function l(d){if(await I.Promises.exists(d)){let v;try{v=await I.Promises.stat(d)}catch(f){f.message.startsWith("EACCES")&&(v=await I.Promises.lstat(d))}return v?!v.isDirectory():!1}return!1}for(const d of w){let v;if(O.isAbsolute(d)?v=O.join(d,b):v=O.join(y,d,b),await l(v))return v;let f=v+".com";if(await l(f)||(f=v+".exe",await l(f)))return f}return O.join(y,b)}S.findExecutable=p})(m=e.win32||(e.win32={}))}),define(J[81],Y([0,1,36,12,80,55]),function(j,e,O,k,D,L){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getSystemShellSync=e.getSystemShell=void 0;async function T(b,y){return b===1?k.isWindows?S():L.getWindowsShell(y):u(b,y)}e.getSystemShell=T;function I(b,y){return b===1?k.isWindows?p(y):L.getWindowsShell(y):u(b,y)}e.getSystemShellSync=I;let g=null;function u(b,y){if(k.isLinux&&b===2||k.isMacintosh&&b===3)return"/bin/bash";if(!g){let w;if(k.isWindows)w="/bin/bash";else{if(w=y.SHELL,!w)try{w=(0,O.userInfo)().shell}catch{}w||(w="sh"),w==="/bin/false"&&(w="/bin/bash")}g=w}return g}let m=null;async function S(){return m||(m=(await(0,D.getFirstAvailablePowerShellInstallation)()).exePath),m}function p(b){if(m)return m;const y=k.isWindows&&parseFloat((0,O.release)())>=10,w=b.hasOwnProperty("PROCESSOR_ARCHITEW6432"),E=`${b.windir}\\${w?"Sysnative":"System32"}\\WindowsPowerShell\\v1.0\\powershell.exe`;return y?E:L.getWindowsShell(b)}});var me=this&&this.__decorate||function(j,e,O,k){var D=arguments.length,L=D<3?e:k===null?k=Object.getOwnPropertyDescriptor(e,O):k,T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(j,e,O,k);else for(var I=j.length-1;I>=0;I--)(T=j[I])&&(L=(D<3?T(L):D>3?T(e,O,L):T(e,O))||L);return D>3&&L&&Object.defineProperty(e,O,L),L};define(J[56],Y([0,1,19,3,15,22,49,10,4,2,44,31,5]),function(j,e,O,k,D,L,T,I,g,u,m,S,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IPCLogger=e.ProxyChannel=e.StaticRouter=e.getNextTickChannel=e.getDelayedChannel=e.IPCClient=e.IPCServer=e.ChannelClient=e.RequestInitiator=e.ChannelServer=void 0;var b;(function(F){F[F.Promise=100]="Promise",F[F.PromiseCancel=101]="PromiseCancel",F[F.EventListen=102]="EventListen",F[F.EventDispose=103]="EventDispose"})(b||(b={}));function y(F){switch(F){case 100:return"req";case 101:return"cancel";case 102:return"subscribe";case 103:return"unsubscribe"}}var w;(function(F){F[F.Initialize=200]="Initialize",F[F.PromiseSuccess=201]="PromiseSuccess",F[F.PromiseError=202]="PromiseError",F[F.PromiseErrorObj=203]="PromiseErrorObj",F[F.EventFire=204]="EventFire"})(w||(w={}));function E(F){switch(F){case 200:return"init";case 201:return"reply:";case 202:case 203:return"replyErr:";case 204:return"event:"}}var l;(function(F){F[F.Uninitialized=0]="Uninitialized",F[F.Idle=1]="Idle"})(l||(l={}));class d{constructor(A){this.buffer=A,this.pos=0}read(A){const x=this.buffer.slice(this.pos,this.pos+A);return this.pos+=x.byteLength,x}}class v{constructor(){this.buffers=[]}get buffer(){return D.VSBuffer.concat(this.buffers)}write(A){this.buffers.push(A)}}var f;(function(F){F[F.Undefined=0]="Undefined",F[F.String=1]="String",F[F.Buffer=2]="Buffer",F[F.VSBuffer=3]="VSBuffer",F[F.Array=4]="Array",F[F.Object=5]="Object"})(f||(f={}));function s(F){const A=D.VSBuffer.alloc(4);return A.writeUInt32BE(F,0),A}function t(F){return F.read(4).readUInt32BE(0)}function n(F){const A=D.VSBuffer.alloc(1);return A.writeUInt8(F,0),A}const i={Undefined:n(f.Undefined),String:n(f.String),Buffer:n(f.Buffer),VSBuffer:n(f.VSBuffer),Array:n(f.Array),Object:n(f.Object)},r=typeof Buffer<"u";function o(F,A){if(typeof A>"u")F.write(i.Undefined);else if(typeof A=="string"){const x=D.VSBuffer.fromString(A);F.write(i.String),F.write(s(x.byteLength)),F.write(x)}else if(r&&Buffer.isBuffer(A)){const x=D.VSBuffer.wrap(A);F.write(i.Buffer),F.write(s(x.byteLength)),F.write(x)}else if(A instanceof D.VSBuffer)F.write(i.VSBuffer),F.write(s(A.byteLength)),F.write(A);else if(Array.isArray(A)){F.write(i.Array),F.write(s(A.length));for(const x of A)o(F,x)}else{const x=D.VSBuffer.fromString(JSON.stringify(A));F.write(i.Object),F.write(s(x.byteLength)),F.write(x)}}function c(F){switch(F.read(1).readUInt8(0)){case f.Undefined:return;case f.String:return F.read(t(F)).toString();case f.Buffer:return F.read(t(F)).buffer;case f.VSBuffer:return F.read(t(F));case f.Array:{const x=t(F),W=[];for(let q=0;q<x;q++)W.push(c(F));return W}case f.Object:return JSON.parse(F.read(t(F)).toString())}}class a{constructor(A,x,W=null,q=1e3){this.protocol=A,this.ctx=x,this.logger=W,this.timeoutDelay=q,this.channels=new Map,this.activeRequests=new Map,this.pendingRequests=new Map,this.protocolListener=this.protocol.onMessage(B=>this.onRawMessage(B)),this.sendResponse({type:200})}registerChannel(A,x){this.channels.set(A,x),setTimeout(()=>this.flushPendingRequests(A),0)}sendResponse(A){switch(A.type){case 200:{const x=this.send([A.type]);this.logger?.logOutgoing(x,0,1,E(A.type));return}case 201:case 202:case 204:case 203:{const x=this.send([A.type,A.id],A.data);this.logger?.logOutgoing(x,A.id,1,E(A.type),A.data);return}}}send(A,x=void 0){const W=new v;return o(W,A),o(W,x),this.sendBuffer(W.buffer)}sendBuffer(A){try{return this.protocol.send(A),A.byteLength}catch{return 0}}onRawMessage(A){const x=new d(A),W=c(x),q=c(x),B=W[0];switch(B){case 100:return this.logger?.logIncoming(A.byteLength,W[1],1,`${y(B)}: ${W[2]}.${W[3]}`,q),this.onPromise({type:B,id:W[1],channelName:W[2],name:W[3],arg:q});case 102:return this.logger?.logIncoming(A.byteLength,W[1],1,`${y(B)}: ${W[2]}.${W[3]}`,q),this.onEventListen({type:B,id:W[1],channelName:W[2],name:W[3],arg:q});case 101:return this.logger?.logIncoming(A.byteLength,W[1],1,`${y(B)}`),this.disposeActiveRequest({type:B,id:W[1]});case 103:return this.logger?.logIncoming(A.byteLength,W[1],1,`${y(B)}`),this.disposeActiveRequest({type:B,id:W[1]})}}onPromise(A){const x=this.channels.get(A.channelName);if(!x){this.collectPendingRequest(A);return}const W=new L.CancellationTokenSource;let q;try{q=x.call(this.ctx,A.name,A.arg,W.token)}catch(P){q=Promise.reject(P)}const B=A.id;q.then(P=>{this.sendResponse({id:B,data:P,type:201}),this.activeRequests.delete(A.id)},P=>{P instanceof Error?this.sendResponse({id:B,data:{message:P.message,name:P.name,stack:P.stack?P.stack.split?P.stack.split(`
`):P.stack:void 0},type:202}):this.sendResponse({id:B,data:P,type:203}),this.activeRequests.delete(A.id)});const ee=(0,u.toDisposable)(()=>W.cancel());this.activeRequests.set(A.id,ee)}onEventListen(A){const x=this.channels.get(A.channelName);if(!x){this.collectPendingRequest(A);return}const W=A.id,B=x.listen(this.ctx,A.name,A.arg)(ee=>this.sendResponse({id:W,data:ee,type:204}));this.activeRequests.set(A.id,B)}disposeActiveRequest(A){const x=this.activeRequests.get(A.id);x&&(x.dispose(),this.activeRequests.delete(A.id))}collectPendingRequest(A){let x=this.pendingRequests.get(A.channelName);x||(x=[],this.pendingRequests.set(A.channelName,x));const W=setTimeout(()=>{console.error(`Unknown channel: ${A.channelName}`),A.type===100&&this.sendResponse({id:A.id,data:{name:"Unknown channel",message:`Channel name '${A.channelName}' timed out after ${this.timeoutDelay}ms`,stack:void 0},type:202})},this.timeoutDelay);x.push({request:A,timeoutTimer:W})}flushPendingRequests(A){const x=this.pendingRequests.get(A);if(x){for(const W of x)switch(clearTimeout(W.timeoutTimer),W.request.type){case 100:this.onPromise(W.request);break;case 102:this.onEventListen(W.request);break}this.pendingRequests.delete(A)}}dispose(){this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),(0,u.dispose)(this.activeRequests.values()),this.activeRequests.clear()}}e.ChannelServer=a;var h;(function(F){F[F.LocalSide=0]="LocalSide",F[F.OtherSide=1]="OtherSide"})(h=e.RequestInitiator||(e.RequestInitiator={}));class C{constructor(A,x=null){this.protocol=A,this.isDisposed=!1,this.state=l.Uninitialized,this.activeRequests=new Set,this.handlers=new Map,this.lastRequestId=0,this._onDidInitialize=new g.Emitter,this.onDidInitialize=this._onDidInitialize.event,this.protocolListener=this.protocol.onMessage(W=>this.onBuffer(W)),this.logger=x}getChannel(A){const x=this;return{call(W,q,B){return x.isDisposed?Promise.reject(new I.CancellationError):x.requestPromise(A,W,q,B)},listen(W,q){return x.isDisposed?g.Event.None:x.requestEvent(A,W,q)}}}requestPromise(A,x,W,q=L.CancellationToken.None){const B=this.lastRequestId++,P={id:B,type:100,channelName:A,name:x,arg:W};if(q.isCancellationRequested)return Promise.reject(new I.CancellationError);let R;return new Promise((U,z)=>{if(q.isCancellationRequested)return z(new I.CancellationError);const $=()=>{const Se=oe=>{switch(oe.type){case 201:this.handlers.delete(B),U(oe.data);break;case 202:{this.handlers.delete(B);const ue=new Error(oe.data.message);ue.stack=Array.isArray(oe.data.stack)?oe.data.stack.join(`
`):oe.data.stack,ue.name=oe.data.name,z(ue);break}case 203:this.handlers.delete(B),z(oe.data);break}};this.handlers.set(B,Se),this.sendRequest(P)};let te=null;this.state===l.Idle?$():(te=(0,k.createCancelablePromise)(Se=>this.whenInitialized()),te.then(()=>{te=null,$()}));const re=()=>{te?(te.cancel(),te=null):this.sendRequest({id:B,type:101}),z(new I.CancellationError)},pe=q.onCancellationRequested(re);R=(0,u.combinedDisposable)((0,u.toDisposable)(re),pe),this.activeRequests.add(R)}).finally(()=>{this.activeRequests.delete(R)})}requestEvent(A,x,W){const q=this.lastRequestId++,ee={id:q,type:102,channelName:A,name:x,arg:W};let P=null;const R=new g.Emitter({onWillAddFirstListener:()=>{P=(0,k.createCancelablePromise)(U=>this.whenInitialized()),P.then(()=>{P=null,this.activeRequests.add(R),this.sendRequest(ee)})},onDidRemoveLastListener:()=>{P?(P.cancel(),P=null):(this.activeRequests.delete(R),this.sendRequest({id:q,type:103}))}}),N=U=>R.fire(U.data);return this.handlers.set(q,N),R.event}sendRequest(A){switch(A.type){case 100:case 102:{const x=this.send([A.type,A.id,A.channelName,A.name],A.arg);this.logger?.logOutgoing(x,A.id,0,`${y(A.type)}: ${A.channelName}.${A.name}`,A.arg);return}case 101:case 103:{const x=this.send([A.type,A.id]);this.logger?.logOutgoing(x,A.id,0,y(A.type));return}}}send(A,x=void 0){const W=new v;return o(W,A),o(W,x),this.sendBuffer(W.buffer)}sendBuffer(A){try{return this.protocol.send(A),A.byteLength}catch{return 0}}onBuffer(A){const x=new d(A),W=c(x),q=c(x),B=W[0];switch(B){case 200:return this.logger?.logIncoming(A.byteLength,0,0,E(B)),this.onResponse({type:W[0]});case 201:case 202:case 204:case 203:return this.logger?.logIncoming(A.byteLength,W[1],0,E(B),q),this.onResponse({type:W[0],id:W[1],data:q})}}onResponse(A){if(A.type===200){this.state=l.Idle,this._onDidInitialize.fire();return}this.handlers.get(A.id)?.(A)}get onDidInitializePromise(){return g.Event.toPromise(this.onDidInitialize)}whenInitialized(){return this.state===l.Idle?Promise.resolve():this.onDidInitializePromise}dispose(){this.isDisposed=!0,this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),(0,u.dispose)(this.activeRequests.values()),this.activeRequests.clear()}}me([T.memoize],C.prototype,"onDidInitializePromise",null),e.ChannelClient=C;class M{get connections(){const A=[];return this._connections.forEach(x=>A.push(x)),A}constructor(A){this.channels=new Map,this._connections=new Set,this._onDidAddConnection=new g.Emitter,this.onDidAddConnection=this._onDidAddConnection.event,this._onDidRemoveConnection=new g.Emitter,this.onDidRemoveConnection=this._onDidRemoveConnection.event,A(({protocol:x,onDidClientDisconnect:W})=>{g.Event.once(x.onMessage)(B=>{const ee=new d(B),P=c(ee),R=new a(x,P),N=new C(x);this.channels.forEach((z,$)=>R.registerChannel($,z));const U={channelServer:R,channelClient:N,ctx:P};this._connections.add(U),this._onDidAddConnection.fire(U),W(()=>{R.dispose(),N.dispose(),this._connections.delete(U),this._onDidRemoveConnection.fire(U)})})})}getChannel(A,x){const W=this;return{call(q,B,ee){let P;if((0,p.isFunction)(x)){const N=(0,O.getRandomElement)(W.connections.filter(x));P=N?Promise.resolve(N):g.Event.toPromise(g.Event.filter(W.onDidAddConnection,x))}else P=x.routeCall(W,q,B);const R=P.then(N=>N.channelClient.getChannel(A));return H(R).call(q,B,ee)},listen(q,B){if((0,p.isFunction)(x))return W.getMulticastEvent(A,x,q,B);const ee=x.routeEvent(W,q,B).then(P=>P.channelClient.getChannel(A));return H(ee).listen(q,B)}}}getMulticastEvent(A,x,W,q){const B=this;let ee=new u.DisposableStore;const P=new g.Emitter({onWillAddFirstListener:()=>{ee=new u.DisposableStore;const R=new g.EventMultiplexer,N=new Map,U=$=>{const re=$.channelClient.getChannel(A).listen(W,q),pe=R.add(re);N.set($,pe)},z=$=>{const te=N.get($);!te||(te.dispose(),N.delete($))};B.connections.filter(x).forEach(U),g.Event.filter(B.onDidAddConnection,x)(U,void 0,ee),B.onDidRemoveConnection(z,void 0,ee),R.event(P.fire,P,ee),ee.add(R)},onDidRemoveLastListener:()=>{ee.dispose()}});return P.event}registerChannel(A,x){this.channels.set(A,x),this._connections.forEach(W=>{W.channelServer.registerChannel(A,x)})}dispose(){this.channels.clear(),this._connections.clear(),this._onDidAddConnection.dispose(),this._onDidRemoveConnection.dispose()}}e.IPCServer=M;class _{constructor(A,x,W=null){const q=new v;o(q,x),A.send(q.buffer),this.channelClient=new C(A,W),this.channelServer=new a(A,x,W)}getChannel(A){return this.channelClient.getChannel(A)}registerChannel(A,x){this.channelServer.registerChannel(A,x)}dispose(){this.channelClient.dispose(),this.channelServer.dispose()}}e.IPCClient=_;function H(F){return{call(A,x,W){return F.then(q=>q.call(A,x,W))},listen(A,x){const W=new g.Relay;return F.then(q=>W.input=q.listen(A,x)),W.event}}}e.getDelayedChannel=H;function X(F){let A=!1;return{call(x,W,q){return A?F.call(x,W,q):(0,k.timeout)(0).then(()=>A=!0).then(()=>F.call(x,W,q))},listen(x,W){if(A)return F.listen(x,W);const q=new g.Relay;return(0,k.timeout)(0).then(()=>A=!0).then(()=>q.input=F.listen(x,W)),q.event}}}e.getNextTickChannel=X;class ie{constructor(A){this.fn=A}routeCall(A){return this.route(A)}routeEvent(A){return this.route(A)}async route(A){for(const x of A.connections)if(await Promise.resolve(this.fn(x.ctx)))return Promise.resolve(x);return await g.Event.toPromise(A.onDidAddConnection),await this.route(A)}}e.StaticRouter=ie;var ne;(function(F){function A(B,ee){const P=B,R=ee&&ee.disableMarshalling,N=new Map;for(const U in P)W(U)&&N.set(U,g.Event.buffer(P[U],!0));return new class{listen(U,z,$){const te=N.get(z);if(te)return te;if(q(z)){const re=P[z];if(typeof re=="function")return re.call(P,$)}throw new Error(`Event not found: ${z}`)}call(U,z,$){const te=P[z];if(typeof te=="function"){if(!R&&Array.isArray($))for(let re=0;re<$.length;re++)$[re]=(0,m.revive)($[re]);return te.apply(P,$)}throw new Error(`Method not found: ${z}`)}}}F.fromService=A;function x(B,ee){const P=ee&&ee.disableMarshalling;return new Proxy({},{get(R,N){if(typeof N=="string")return ee?.properties?.has(N)?ee.properties.get(N):q(N)?function(U){return B.listen(N,U)}:W(N)?B.listen(N):async function(...U){let z;ee&&!(0,p.isUndefinedOrNull)(ee.context)?z=[ee.context,...U]:z=U;const $=await B.call(N,z);return P?$:(0,m.revive)($)};throw new Error(`Property not found: ${String(N)}`)}})}F.toService=x;function W(B){return B[0]==="o"&&B[1]==="n"&&S.isUpperAsciiLetter(B.charCodeAt(2))}function q(B){return/^onDynamic/.test(B)&&S.isUpperAsciiLetter(B.charCodeAt(9))}})(ne=e.ProxyChannel||(e.ProxyChannel={}));const Q=[["#2977B1","#FC802D","#34A13A","#D3282F","#9366BA"],["#8B564C","#E177C0","#7F7F7F","#BBBE3D","#2EBECD"]];function ge(F){if(Array.isArray(F))return F;if(F&&typeof F=="object"&&typeof F.toString=="function"){const A=F.toString();if(A!=="[object Object]")return A}return F}function le(F){return Array.isArray(F)?F.map(ge):ge(F)}function ae(F,A,x,W,q,B,ee){ee=le(ee);const P=Q[q],R=P[W%P.length];let N=[`%c[${F}]%c[${String(A).padStart(7," ")}]%c[len: ${String(x).padStart(5," ")}]%c${String(W).padStart(5," ")} - ${B}`,"color: darkgreen","color: grey","color: grey",`color: ${R}`];/\($/.test(B)?(N=N.concat(ee),N.push(")")):N.push(ee),console.log.apply(console,N)}class de{constructor(A,x){this._outgoingPrefix=A,this._incomingPrefix=x,this._totalIncoming=0,this._totalOutgoing=0}logOutgoing(A,x,W,q,B){this._totalOutgoing+=A,ae(this._outgoingPrefix,this._totalOutgoing,A,x,W,q,B)}logIncoming(A,x,W,q,B){this._totalIncoming+=A,ae(this._incomingPrefix,this._totalIncoming,A,x,W,q,B)}}e.IPCLogger=de}),define(J[82],Y([0,1,57,3,15,22,78,10,4,2,29,55,51,56]),function(j,e,O,k,D,L,T,I,g,u,m,S,p,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Client=e.Server=void 0;class y extends b.ChannelServer{constructor(l){super({send:d=>{try{process.send?.(d.buffer.toString("base64"))}catch{}},onMessage:g.Event.fromNodeEventEmitter(process,"message",d=>D.VSBuffer.wrap(Buffer.from(d,"base64")))},l),process.once("disconnect",()=>this.dispose())}}e.Server=y;class w{constructor(l,d){this.modulePath=l,this.options=d,this.activeRequests=new Set,this.channels=new Map,this._onDidProcessExit=new g.Emitter,this.onDidProcessExit=this._onDidProcessExit.event;const v=d&&d.timeout?d.timeout:6e4;this.disposeDelayer=new k.Delayer(v),this.child=null,this._client=null}getChannel(l){const d=this;return{call(v,f,s){return d.requestPromise(l,v,f,s)},listen(v,f){return d.requestEvent(l,v,f)}}}requestPromise(l,d,v,f=L.CancellationToken.None){if(!this.disposeDelayer)return Promise.reject(new Error("disposed"));if(f.isCancellationRequested)return Promise.reject(I.canceled());this.disposeDelayer.cancel();const s=this.getCachedChannel(l),t=(0,k.createCancelablePromise)(r=>s.call(d,v,r)),n=f.onCancellationRequested(()=>t.cancel()),i=(0,u.toDisposable)(()=>t.cancel());return this.activeRequests.add(i),t.finally(()=>{n.dispose(),this.activeRequests.delete(i),this.activeRequests.size===0&&this.disposeDelayer&&this.disposeDelayer.trigger(()=>this.disposeClient())}),t}requestEvent(l,d,v){if(!this.disposeDelayer)return g.Event.None;this.disposeDelayer.cancel();let f;const s=new g.Emitter({onWillAddFirstListener:()=>{f=this.getCachedChannel(l).listen(d,v)(s.fire,s),this.activeRequests.add(f)},onDidRemoveLastListener:()=>{this.activeRequests.delete(f),f.dispose(),this.activeRequests.size===0&&this.disposeDelayer&&this.disposeDelayer.trigger(()=>this.disposeClient())}});return s.event}get client(){if(!this._client){const l=this.options&&this.options.args?this.options.args:[],d=Object.create(null);d.env={...(0,m.deepClone)(process.env),VSCODE_PARENT_PID:String(process.pid)},this.options&&this.options.env&&(d.env={...d.env,...this.options.env}),this.options&&this.options.freshExecArgv&&(d.execArgv=[]),this.options&&typeof this.options.debug=="number"&&(d.execArgv=["--nolazy","--inspect="+this.options.debug]),this.options&&typeof this.options.debugBrk=="number"&&(d.execArgv=["--nolazy","--inspect-brk="+this.options.debugBrk]),d.execArgv===void 0&&(d.execArgv=process.execArgv.filter(o=>!/^--inspect(-brk)?=/.test(o))),(0,p.removeDangerousEnvVariables)(d.env),this.child=(0,O.fork)(this.modulePath,l,d);const v=new g.Emitter;g.Event.fromNodeEventEmitter(this.child,"message",o=>o)(o=>{if((0,T.isRemoteConsoleLog)(o)){(0,T.log)(o,`IPC Library: ${this.options.serverName}`);return}v.fire(D.VSBuffer.wrap(Buffer.from(o,"base64")))});const s=this.options.useQueue?(0,S.createQueuedSender)(this.child):this.child,t=o=>this.child&&this.child.connected&&s.send(o.buffer.toString("base64")),n=v.event,i={send:t,onMessage:n};this._client=new b.ChannelClient(i);const r=()=>this.disposeClient();process.once("exit",r),this.child.on("error",o=>console.warn('IPC "'+this.options.serverName+'" errored with '+o)),this.child.on("exit",(o,c)=>{process.removeListener("exit",r),this.activeRequests.forEach(a=>(0,u.dispose)(a)),this.activeRequests.clear(),o!==0&&c!=="SIGTERM"&&console.warn('IPC "'+this.options.serverName+'" crashed with exit code '+o+" and signal "+c),this.disposeDelayer?.cancel(),this.disposeClient(),this._onDidProcessExit.fire({code:o,signal:c})})}return this._client}getCachedChannel(l){let d=this.channels.get(l);return d||(d=this.client.getChannel(l),this.channels.set(l,d)),d}disposeClient(){this._client&&(this.child&&(this.child.kill(),this.child=null),this._client=null,this.channels.clear())}dispose(){this._onDidProcessExit.dispose(),this.disposeDelayer?.cancel(),this.disposeDelayer=void 0,this.disposeClient(),this.activeRequests.clear()}}e.Client=w}),define(J[83],Y([0,1,3,4,2,5]),function(j,e,O,k,D,L){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InMemoryStorageDatabase=e.Storage=e.StorageState=e.isStorageItemsChangeEvent=e.StorageHint=void 0;var T;(function(S){S[S.STORAGE_DOES_NOT_EXIST=0]="STORAGE_DOES_NOT_EXIST",S[S.STORAGE_IN_MEMORY=1]="STORAGE_IN_MEMORY"})(T=e.StorageHint||(e.StorageHint={}));function I(S){const p=S;return p?.changed instanceof Map||p?.deleted instanceof Set}e.isStorageItemsChangeEvent=I;var g;(function(S){S[S.None=0]="None",S[S.Initialized=1]="Initialized",S[S.Closed=2]="Closed"})(g=e.StorageState||(e.StorageState={}));class u extends D.Disposable{constructor(p,b=Object.create(null)){super(),this.database=p,this.options=b,this._onDidChangeStorage=this._register(new k.Emitter),this.onDidChangeStorage=this._onDidChangeStorage.event,this.state=g.None,this.cache=new Map,this.flushDelayer=new O.ThrottledDelayer(u.DEFAULT_FLUSH_DELAY),this.pendingDeletes=new Set,this.pendingInserts=new Map,this.pendingClose=void 0,this.whenFlushedCallbacks=[],this.registerListeners()}registerListeners(){this._register(this.database.onDidChangeItemsExternal(p=>this.onDidChangeItemsExternal(p)))}onDidChangeItemsExternal(p){p.changed?.forEach((b,y)=>this.accept(y,b)),p.deleted?.forEach(b=>this.accept(b,void 0))}accept(p,b){if(this.state===g.Closed)return;let y=!1;(0,L.isUndefinedOrNull)(b)?y=this.cache.delete(p):this.cache.get(p)!==b&&(this.cache.set(p,b),y=!0),y&&this._onDidChangeStorage.fire(p)}get items(){return this.cache}get size(){return this.cache.size}async init(){this.state===g.None&&(this.state=g.Initialized,this.options.hint!==T.STORAGE_DOES_NOT_EXIST&&(this.cache=await this.database.getItems()))}get(p,b){const y=this.cache.get(p);return(0,L.isUndefinedOrNull)(y)?b:y}getBoolean(p,b){const y=this.get(p);return(0,L.isUndefinedOrNull)(y)?b:y==="true"}getNumber(p,b){const y=this.get(p);return(0,L.isUndefinedOrNull)(y)?b:parseInt(y,10)}async set(p,b){if(this.state===g.Closed)return;if((0,L.isUndefinedOrNull)(b))return this.delete(p);const y=String(b);if(this.cache.get(p)!==y)return this.cache.set(p,y),this.pendingInserts.set(p,y),this.pendingDeletes.delete(p),this._onDidChangeStorage.fire(p),this.doFlush()}async delete(p){if(!(this.state===g.Closed||!this.cache.delete(p)))return this.pendingDeletes.has(p)||this.pendingDeletes.add(p),this.pendingInserts.delete(p),this._onDidChangeStorage.fire(p),this.doFlush()}async close(){return this.pendingClose||(this.pendingClose=this.doClose()),this.pendingClose}async doClose(){this.state=g.Closed;try{await this.doFlush(0)}catch{}await this.database.close(()=>this.cache)}get hasPending(){return this.pendingInserts.size>0||this.pendingDeletes.size>0}async flushPending(){if(!this.hasPending)return;const p={insert:this.pendingInserts,delete:this.pendingDeletes};return this.pendingDeletes=new Set,this.pendingInserts=new Map,this.database.updateItems(p).finally(()=>{if(!this.hasPending)for(;this.whenFlushedCallbacks.length;)this.whenFlushedCallbacks.pop()?.()})}async flush(p){if(!!this.hasPending)return this.doFlush(p)}async doFlush(p){return this.flushDelayer.trigger(()=>this.flushPending(),p)}async whenFlushed(){if(!!this.hasPending)return new Promise(p=>this.whenFlushedCallbacks.push(p))}isInMemory(){return this.options.hint===T.STORAGE_IN_MEMORY}dispose(){this.flushDelayer.dispose(),super.dispose()}}e.Storage=u,u.DEFAULT_FLUSH_DELAY=100;class m{constructor(){this.onDidChangeItemsExternal=k.Event.None,this.items=new Map}async getItems(){return this.items}async updateItems(p){p.insert?.forEach((b,y)=>this.items.set(y,b)),p.delete?.forEach(b=>this.items.delete(b))}async close(){}}e.InMemoryStorageDatabase=m}),define(J[84],Y([6,7]),function(j,e){return j.create("vs/base/node/zip",e)}),define(J[85],Y([6,7]),function(j,e){return j.create("vs/platform/configuration/common/configurationRegistry",e)}),define(J[86],Y([6,7]),function(j,e){return j.create("vs/platform/extensionManagement/common/abstractExtensionManagementService",e)}),define(J[87],Y([6,7]),function(j,e){return j.create("vs/platform/extensionManagement/common/extensionManagement",e)}),define(J[88],Y([6,7]),function(j,e){return j.create("vs/platform/extensionManagement/common/extensionManagementCLI",e)}),define(J[89],Y([6,7]),function(j,e){return j.create("vs/platform/extensionManagement/common/extensionNls",e)}),define(J[90],Y([6,7]),function(j,e){return j.create("vs/platform/extensionManagement/common/extensionsScannerService",e)}),define(J[91],Y([6,7]),function(j,e){return j.create("vs/platform/extensionManagement/node/extensionManagementService",e)}),define(J[92],Y([6,7]),function(j,e){return j.create("vs/platform/extensionManagement/node/extensionManagementUtil",e)}),define(J[93],Y([6,7]),function(j,e){return j.create("vs/platform/extensions/common/extensionValidator",e)}),define(J[94],Y([6,7]),function(j,e){return j.create("vs/platform/files/common/fileService",e)}),define(J[95],Y([6,7]),function(j,e){return j.create("vs/platform/files/common/io",e)}),define(J[96],Y([6,7]),function(j,e){return j.create("vs/platform/files/node/diskFileSystemProvider",e)}),define(J[97],Y([6,7]),function(j,e){return j.create("vs/platform/languagePacks/common/languagePacks",e)}),define(J[98],Y([6,7]),function(j,e){return j.create("vs/platform/request/common/request",e)}),define(J[99],Y([6,7]),function(j,e){return j.create("vs/platform/shell/node/shellEnv",e)}),define(J[100],Y([6,7]),function(j,e){return j.create("vs/platform/telemetry/common/telemetryService",e)}),define(J[101],Y([6,7]),function(j,e){return j.create("vs/platform/userDataProfile/common/userDataProfile",e)}),define(J[102],Y([6,7]),function(j,e){return j.create("vs/platform/workspace/common/workspace",e)}),define(J[103],Y([0,1,74,49,16,14,37,17,11]),function(j,e,O,k,D,L,T,I,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parsePtyHostPort=e.parseSearchPort=e.parseExtensionHostPort=e.AbstractNativeEnvironmentService=e.EXTENSION_IDENTIFIER_WITH_LOG_REGEX=void 0,e.EXTENSION_IDENTIFIER_WITH_LOG_REGEX=/^([^.]+\..+):(.+)$/;class u{get appRoot(){return(0,L.dirname)(D.FileAccess.asFileUri("").fsPath)}get userHome(){return g.URI.file(this.paths.homeDir)}get userDataPath(){return this.paths.userDataDir}get appSettingsHome(){return g.URI.file((0,L.join)(this.userDataPath,"User"))}get tmpDir(){return g.URI.file(this.paths.tmpDir)}get cacheHome(){return g.URI.file(this.userDataPath)}get stateResource(){return(0,I.joinPath)(this.appSettingsHome,"globalStorage","storage.json")}get userRoamingDataHome(){return this.appSettingsHome}get userDataSyncHome(){return(0,I.joinPath)(this.userRoamingDataHome,"sync")}get logsPath(){if(!this.args.logsPath){const w=(0,O.toLocalISOString)(new Date).replace(/-|:|\.\d+Z$/g,"");this.args.logsPath=(0,L.join)(this.userDataPath,"logs",w)}return this.args.logsPath}get userDataSyncLogResource(){return g.URI.file((0,L.join)(this.logsPath,"userDataSync.log"))}get editSessionsLogResource(){return g.URI.file((0,L.join)(this.logsPath,"editSessions.log"))}get sync(){return this.args.sync}get machineSettingsResource(){return(0,I.joinPath)(g.URI.file((0,L.join)(this.userDataPath,"Machine")),"settings.json")}get workspaceStorageHome(){return(0,I.joinPath)(this.appSettingsHome,"workspaceStorage")}get localHistoryHome(){return(0,I.joinPath)(this.appSettingsHome,"History")}get keyboardLayoutResource(){return(0,I.joinPath)(this.userRoamingDataHome,"keyboardLayout.json")}get argvResource(){const w=T.env.VSCODE_PORTABLE;return w?g.URI.file((0,L.join)(w,"argv.json")):(0,I.joinPath)(this.userHome,this.productService.dataFolderName,"argv.json")}get isExtensionDevelopment(){return!!this.args.extensionDevelopmentPath}get untitledWorkspacesHome(){return g.URI.file((0,L.join)(this.userDataPath,"Workspaces"))}get installSourcePath(){return(0,L.join)(this.userDataPath,"installSource")}get builtinExtensionsPath(){const w=this.args["builtin-extensions-dir"];return w?(0,L.resolve)(w):(0,L.normalize)((0,L.join)(D.FileAccess.asFileUri("").fsPath,"..","extensions"))}get extensionsDownloadLocation(){const w=this.args["extensions-download-dir"];return w?g.URI.file((0,L.resolve)(w)):g.URI.file((0,L.join)(this.userDataPath,"CachedExtensionVSIXs"))}get extensionsPath(){const w=this.args["extensions-dir"];if(w)return(0,L.resolve)(w);const E=T.env.VSCODE_EXTENSIONS;if(E)return E;const l=T.env.VSCODE_PORTABLE;return l?(0,L.join)(l,"extensions"):(0,I.joinPath)(this.userHome,this.productService.dataFolderName,"extensions").fsPath}get extensionDevelopmentLocationURI(){const w=this.args.extensionDevelopmentPath;if(Array.isArray(w))return w.map(E=>/^[^:/?#]+?:\/\//.test(E)?g.URI.parse(E):g.URI.file((0,L.normalize)(E)))}get extensionDevelopmentKind(){return this.args.extensionDevelopmentKind?.map(w=>w==="ui"||w==="workspace"||w==="web"?w:"workspace")}get extensionTestsLocationURI(){const w=this.args.extensionTestsPath;if(w)return/^[^:/?#]+?:\/\//.test(w)?g.URI.parse(w):g.URI.file((0,L.normalize)(w))}get disableExtensions(){if(this.args["disable-extensions"])return!0;const w=this.args["disable-extension"];if(w){if(typeof w=="string")return[w];if(Array.isArray(w)&&w.length>0)return w}return!1}get debugExtensionHost(){return m(this.args,this.isBuilt)}get debugRenderer(){return!!this.args.debugRenderer}get isBuilt(){return!T.env.VSCODE_DEV}get verbose(){return!!this.args.verbose}get logLevel(){return this.args.log?.find(w=>!e.EXTENSION_IDENTIFIER_WITH_LOG_REGEX.test(w))}get extensionLogLevel(){const w=[];for(const E of this.args.log||[]){const l=e.EXTENSION_IDENTIFIER_WITH_LOG_REGEX.exec(E);l&&l[1]&&l[2]&&w.push([l[1],l[2]])}return w.length?w:void 0}get serviceMachineIdResource(){return(0,I.joinPath)(g.URI.file(this.userDataPath),"machineid")}get crashReporterId(){return this.args["crash-reporter-id"]}get crashReporterDirectory(){return this.args["crash-reporter-directory"]}get telemetryLogResource(){return g.URI.file((0,L.join)(this.logsPath,"telemetry.log"))}get disableTelemetry(){return!!this.args["disable-telemetry"]}get disableWorkspaceTrust(){return!!this.args["disable-workspace-trust"]}get policyFile(){if(this.args["__enable-file-policy"]){const w=T.env.VSCODE_PORTABLE;return w?g.URI.file((0,L.join)(w,"policy.json")):(0,I.joinPath)(this.userHome,this.productService.dataFolderName,"policy.json")}}get continueOn(){return this.args.continueOn}set continueOn(w){this.args.continueOn=w}get args(){return this._args}constructor(w,E,l){this._args=w,this.paths=E,this.productService=l,this.editSessionId=this.args.editSessionId}}me([k.memoize],u.prototype,"appRoot",null),me([k.memoize],u.prototype,"userHome",null),me([k.memoize],u.prototype,"userDataPath",null),me([k.memoize],u.prototype,"appSettingsHome",null),me([k.memoize],u.prototype,"tmpDir",null),me([k.memoize],u.prototype,"cacheHome",null),me([k.memoize],u.prototype,"stateResource",null),me([k.memoize],u.prototype,"userRoamingDataHome",null),me([k.memoize],u.prototype,"userDataSyncHome",null),me([k.memoize],u.prototype,"userDataSyncLogResource",null),me([k.memoize],u.prototype,"editSessionsLogResource",null),me([k.memoize],u.prototype,"sync",null),me([k.memoize],u.prototype,"machineSettingsResource",null),me([k.memoize],u.prototype,"workspaceStorageHome",null),me([k.memoize],u.prototype,"localHistoryHome",null),me([k.memoize],u.prototype,"keyboardLayoutResource",null),me([k.memoize],u.prototype,"argvResource",null),me([k.memoize],u.prototype,"isExtensionDevelopment",null),me([k.memoize],u.prototype,"untitledWorkspacesHome",null),me([k.memoize],u.prototype,"installSourcePath",null),me([k.memoize],u.prototype,"builtinExtensionsPath",null),me([k.memoize],u.prototype,"extensionsPath",null),me([k.memoize],u.prototype,"extensionDevelopmentLocationURI",null),me([k.memoize],u.prototype,"extensionDevelopmentKind",null),me([k.memoize],u.prototype,"extensionTestsLocationURI",null),me([k.memoize],u.prototype,"debugExtensionHost",null),me([k.memoize],u.prototype,"logLevel",null),me([k.memoize],u.prototype,"extensionLogLevel",null),me([k.memoize],u.prototype,"serviceMachineIdResource",null),me([k.memoize],u.prototype,"telemetryLogResource",null),me([k.memoize],u.prototype,"disableWorkspaceTrust",null),me([k.memoize],u.prototype,"policyFile",null),e.AbstractNativeEnvironmentService=u;function m(y,w){return b(y["inspect-extensions"],y["inspect-brk-extensions"],5870,w,y.debugId,y.extensionEnvironment)}e.parseExtensionHostPort=m;function S(y,w){return b(y["inspect-search"],y["inspect-brk-search"],5876,w,y.extensionEnvironment)}e.parseSearchPort=S;function p(y,w){return b(y["inspect-ptyhost"],y["inspect-brk-ptyhost"],5877,w,y.extensionEnvironment)}e.parsePtyHostPort=p;function b(y,w,E,l,d,v){const s=Number(w||y)||(l?null:E),t=s?Boolean(!!w):!1;let n;if(v)try{n=JSON.parse(v)}catch{}return{port:s,break:t,debugId:d,env:n}}}),define(J[104],Y([0,1,36,103,153]),function(j,e,O,k,D){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NativeEnvironmentService=void 0;class L extends k.AbstractNativeEnvironmentService{constructor(I,g){super(I,{homeDir:(0,O.homedir)(),tmpDir:(0,O.tmpdir)(),userDataDir:(0,D.getUserDataPath)(I,g.nameShort)},g)}}e.NativeEnvironmentService=L}),define(J[105],Y([0,1,5,89]),function(j,e,O,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.localizeManifest=void 0;function D(T,I,g){try{L(T,I,g)}catch(u){console.error(u?.message??u)}return T}e.localizeManifest=D;function L(T,I,g){const u=(m,S,p)=>{const b=m[S];if((0,O.isString)(b)){const y=b,w=y.length;if(w>1&&y[0]==="%"&&y[w-1]==="%"){const E=y.substr(1,w-2);let l=I[E];l===void 0&&g&&(l=g[E]);const d=typeof l=="string"?l:l?.message,v=g?.[E],f=typeof v=="string"?v:v?.message;if(!d){f||console.warn(`[${T.name}]: ${(0,k.localize)(0,null,E)}`);return}if(p&&(S==="title"||S==="category")&&f&&f!==d){const s={value:d,original:f};m[S]=s}else m[S]=d}}else if((0,O.isObject)(b))for(const y in b)b.hasOwnProperty(y)&&(y==="commands"?u(b,y,!0):u(b,y,p));else if(Array.isArray(b))for(let y=0;y<b.length;y++)u(b,y,p)};for(const m in T)T.hasOwnProperty(m)&&u(T,m)}}),define(J[106],Y([0,1,10]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ImplicitActivationEvents=e.ImplicitActivationEventsImpl=void 0;class k{constructor(){this._generators=new Map}register(L,T){this._generators.set(L,T)}updateManifest(L){if(!(typeof L.main>"u"&&typeof L.browser>"u")&&(L.activationEvents===void 0&&Object.assign(L,{activationEvents:[]}),!(!Array.isArray(L.activationEvents)||!L.contributes)))for(const T in L.contributes){const I=this._generators.get(T);if(!I)continue;const g=L.contributes[T],u=Array.isArray(g)?g:[g];try{I(u,L.activationEvents)}catch(m){(0,O.onUnexpectedError)(m)}}}}e.ImplicitActivationEventsImpl=k,e.ImplicitActivationEvents=new k}),define(J[45],Y([0,1,17,53,93,39]),function(j,e,O,k,D,L){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isEngineValid=e.isValidExtensionVersion=e.validateExtensionManifest=e.isValidVersion=e.normalizeVersion=e.parseVersion=e.isValidVersionStr=void 0;const T=/^(\^|>=)?((\d+)|x)\.((\d+)|x)\.((\d+)|x)(\-.*)?$/,I=/^-(\d{4})(\d{2})(\d{2})$/;function g(l){return l=l.trim(),l==="*"||T.test(l)}e.isValidVersionStr=g;function u(l){if(!g(l))return null;if(l=l.trim(),l==="*")return{hasCaret:!1,hasGreaterEquals:!1,majorBase:0,majorMustEqual:!1,minorBase:0,minorMustEqual:!1,patchBase:0,patchMustEqual:!1,preRelease:null};const d=l.match(T);return d?{hasCaret:d[1]==="^",hasGreaterEquals:d[1]===">=",majorBase:d[2]==="x"?0:parseInt(d[2],10),majorMustEqual:d[2]!=="x",minorBase:d[4]==="x"?0:parseInt(d[4],10),minorMustEqual:d[4]!=="x",patchBase:d[6]==="x"?0:parseInt(d[6],10),patchMustEqual:d[6]!=="x",preRelease:d[8]||null}:null}e.parseVersion=u;function m(l){if(!l)return null;const d=l.majorBase,v=l.majorMustEqual,f=l.minorBase;let s=l.minorMustEqual;const t=l.patchBase;let n=l.patchMustEqual;l.hasCaret&&(d===0||(s=!1),n=!1);let i=0;if(l.preRelease){const r=I.exec(l.preRelease);if(r){const[,o,c,a]=r;i=Date.UTC(Number(o),Number(c)-1,Number(a))}}return{majorBase:d,majorMustEqual:v,minorBase:f,minorMustEqual:s,patchBase:t,patchMustEqual:n,isMinimum:l.hasGreaterEquals,notBefore:i}}e.normalizeVersion=m;function S(l,d,v){let f;typeof l=="string"?f=m(u(l)):f=l;let s;d instanceof Date?s=d.getTime():typeof d=="string"&&(s=new Date(d).getTime());let t;if(typeof v=="string"?t=m(u(v)):t=v,!f||!t)return!1;const n=f.majorBase,i=f.minorBase,r=f.patchBase;let o=t.majorBase,c=t.minorBase,a=t.patchBase;const h=t.notBefore;let C=t.majorMustEqual,M=t.minorMustEqual,_=t.patchMustEqual;return t.isMinimum?n>o?!0:n<o?!1:i>c?!0:i<c||s&&s<h?!1:r>=a:(n===1&&o===0&&(!C||!M||!_)&&(o=1,c=0,a=0,C=!0,M=!1,_=!1),n<o?!1:n>o?!C:i<c?!1:i>c?!M:r<a?!1:r>a?!_:!(s&&s<h))}e.isValidVersion=S;function p(l,d,v,f,s){const t=[];if(typeof f.publisher<"u"&&typeof f.publisher!="string")return t.push([k.default.Error,D.localize(0,null)]),t;if(typeof f.name!="string")return t.push([k.default.Error,D.localize(1,null,"name")]),t;if(typeof f.version!="string")return t.push([k.default.Error,D.localize(2,null,"version")]),t;if(!f.engines)return t.push([k.default.Error,D.localize(3,null,"engines")]),t;if(typeof f.engines.vscode!="string")return t.push([k.default.Error,D.localize(4,null,"engines.vscode")]),t;if(typeof f.extensionDependencies<"u"&&!E(f.extensionDependencies))return t.push([k.default.Error,D.localize(5,null,"extensionDependencies")]),t;if(typeof f.activationEvents<"u"){if(!E(f.activationEvents))return t.push([k.default.Error,D.localize(6,null,"activationEvents")]),t;if(typeof f.main>"u"&&typeof f.browser>"u")return t.push([k.default.Error,D.localize(7,null,"activationEvents","main")]),t}if(typeof f.extensionKind<"u"&&typeof f.main>"u"&&t.push([k.default.Warning,D.localize(8,null,"extensionKind")]),typeof f.main<"u"){if(typeof f.main!="string")return t.push([k.default.Error,D.localize(9,null,"main")]),t;{const r=(0,O.joinPath)(v,f.main);(0,O.isEqualOrParent)(r,v)||t.push([k.default.Warning,D.localize(10,null,r.path,v.path)])}if(typeof f.activationEvents>"u")return t.push([k.default.Error,D.localize(11,null,"activationEvents","main")]),t}if(typeof f.browser<"u"){if(typeof f.browser!="string")return t.push([k.default.Error,D.localize(12,null,"browser")]),t;{const r=(0,O.joinPath)(v,f.browser);(0,O.isEqualOrParent)(r,v)||t.push([k.default.Warning,D.localize(13,null,r.path,v.path)])}if(typeof f.activationEvents>"u")return t.push([k.default.Error,D.localize(14,null,"activationEvents","browser")]),t}if(!L.valid(f.version))return t.push([k.default.Error,D.localize(15,null)]),t;const n=[];if(!b(l,d,f,s,n))for(const r of n)t.push([k.default.Error,r]);return t}e.validateExtensionManifest=p;function b(l,d,v,f,s){return f||typeof v.main>"u"&&typeof v.browser>"u"?!0:w(l,d,v.engines.vscode,s)}e.isValidExtensionVersion=b;function y(l,d,v){return l==="*"||w(d,v,l)}e.isEngineValid=y;function w(l,d,v,f=[]){const s=m(u(v));if(!s)return f.push(D.localize(16,null,v)),!1;if(s.majorBase===0){if(!s.majorMustEqual||!s.minorMustEqual)return f.push(D.localize(17,null,v)),!1}else if(!s.majorMustEqual)return f.push(D.localize(18,null,v)),!1;return S(l,d,s)?!0:(f.push(D.localize(19,null,l,v)),!1)}function E(l){if(!Array.isArray(l))return!1;for(let d=0,v=l.length;d<v;d++)if(typeof l[d]!="string")return!1;return!0}}),define(J[107],Y([0,1,15,30]),function(j,e,O,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getServiceMachineId=void 0;async function D(L,T,I){let g=I&&I.get("storage.serviceMachineId",-1)||null;if(g)return g;try{const m=(await T.readFile(L.serviceMachineIdResource)).value.toString();g=(0,k.isUUID)(m)?m:null}catch{g=null}if(!g){g=(0,k.generateUuid)();try{await T.writeFile(L.serviceMachineIdResource,O.VSBuffer.fromString(g))}catch{}}return I?.store("storage.serviceMachineId",g,-1,1),g}e.getServiceMachineId=D}),define(J[46],Y([0,1]),function(j,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SyncDescriptor=void 0;class O{constructor(D,L=[],T=!1){this.ctor=D,this.staticArguments=L,this.supportsDelayedInstantiation=T}}e.SyncDescriptor=O}),define(J[108],Y([0,1,46]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getSingletonServiceDescriptors=e.registerSingleton=e.InstantiationType=void 0;const k=[];var D;(function(I){I[I.Eager=0]="Eager",I[I.Delayed=1]="Delayed"})(D=e.InstantiationType||(e.InstantiationType={}));function L(I,g,u){g instanceof O.SyncDescriptor||(g=new O.SyncDescriptor(g,[],Boolean(u))),k.push([I,g])}e.registerSingleton=L;function T(){return k}e.getSingletonServiceDescriptors=T}),define(J[109],Y([0,1]),function(j,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Graph=e.Node=void 0;class O{constructor(L,T){this.key=L,this.data=T,this.incoming=new Map,this.outgoing=new Map}}e.Node=O;class k{constructor(L){this._hashFn=L,this._nodes=new Map}roots(){const L=[];for(const T of this._nodes.values())T.outgoing.size===0&&L.push(T);return L}insertEdge(L,T){const I=this.lookupOrInsertNode(L),g=this.lookupOrInsertNode(T);I.outgoing.set(g.key,g),g.incoming.set(I.key,I)}removeNode(L){const T=this._hashFn(L);this._nodes.delete(T);for(const I of this._nodes.values())I.outgoing.delete(T),I.incoming.delete(T)}lookupOrInsertNode(L){const T=this._hashFn(L);let I=this._nodes.get(T);return I||(I=new O(T,L),this._nodes.set(T,I)),I}lookup(L){return this._nodes.get(this._hashFn(L))}isEmpty(){return this._nodes.size===0}toString(){const L=[];for(const[T,I]of this._nodes)L.push(`${T}
	(-> incoming)[${[...I.incoming.keys()].join(", ")}]
	(outgoing ->)[${[...I.outgoing.keys()].join(",")}]
`);return L.join(`
`)}findCycleSlow(){for(const[L,T]of this._nodes){const I=new Set([L]),g=this._findCycle(T,I);if(g)return g}}_findCycle(L,T){for(const[I,g]of L.outgoing){if(T.has(I))return[...T,I].join(" -> ");T.add(I);const u=this._findCycle(g,T);if(u)return u;T.delete(I)}}}e.Graph=k}),define(J[21],Y([0,1,5,11,8]),function(j,e,O,k,D){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getLanguageTagSettingPlainKey=e.getMigratedSettingValue=e.merge=e.getConfigurationValue=e.removeFromValueTree=e.addToValueTree=e.toValuesTree=e.ConfigurationTargetToString=e.ConfigurationTarget=e.isConfigurationUpdateOverrides=e.isConfigurationOverrides=e.IConfigurationService=void 0,e.IConfigurationService=(0,D.createDecorator)("configurationService");function L(l){return l&&typeof l=="object"&&(!l.overrideIdentifier||typeof l.overrideIdentifier=="string")&&(!l.resource||l.resource instanceof k.URI)}e.isConfigurationOverrides=L;function T(l){return l&&typeof l=="object"&&(!l.overrideIdentifiers||Array.isArray(l.overrideIdentifiers))&&!l.overrideIdentifier&&(!l.resource||l.resource instanceof k.URI)}e.isConfigurationUpdateOverrides=T;var I;(function(l){l[l.APPLICATION=1]="APPLICATION",l[l.USER=2]="USER",l[l.USER_LOCAL=3]="USER_LOCAL",l[l.USER_REMOTE=4]="USER_REMOTE",l[l.WORKSPACE=5]="WORKSPACE",l[l.WORKSPACE_FOLDER=6]="WORKSPACE_FOLDER",l[l.DEFAULT=7]="DEFAULT",l[l.MEMORY=8]="MEMORY"})(I=e.ConfigurationTarget||(e.ConfigurationTarget={}));function g(l){switch(l){case 1:return"APPLICATION";case 2:return"USER";case 3:return"USER_LOCAL";case 4:return"USER_REMOTE";case 5:return"WORKSPACE";case 6:return"WORKSPACE_FOLDER";case 7:return"DEFAULT";case 8:return"MEMORY"}}e.ConfigurationTargetToString=g;function u(l,d){const v=Object.create(null);for(const f in l)m(v,f,l[f],d);return v}e.toValuesTree=u;function m(l,d,v,f){const s=d.split("."),t=s.pop();let n=l;for(let i=0;i<s.length;i++){const r=s[i];let o=n[r];switch(typeof o){case"undefined":o=n[r]=Object.create(null);break;case"object":break;default:f(`Ignoring ${d} as ${s.slice(0,i+1).join(".")} is ${JSON.stringify(o)}`);return}n=o}if(typeof n=="object"&&n!==null)try{n[t]=v}catch{f(`Ignoring ${d} as ${s.join(".")} is ${JSON.stringify(n)}`)}else f(`Ignoring ${d} as ${s.join(".")} is ${JSON.stringify(n)}`)}e.addToValueTree=m;function S(l,d){const v=d.split(".");p(l,v)}e.removeFromValueTree=S;function p(l,d){const v=d.shift();if(d.length===0){delete l[v];return}if(Object.keys(l).indexOf(v)!==-1){const f=l[v];typeof f=="object"&&!Array.isArray(f)&&(p(f,d),Object.keys(f).length===0&&delete l[v])}}function b(l,d,v){function f(n,i){let r=n;for(const o of i){if(typeof r!="object"||r===null)return;r=r[o]}return r}const s=d.split("."),t=f(l,s);return typeof t>"u"?v:t}e.getConfigurationValue=b;function y(l,d,v){Object.keys(d).forEach(f=>{f!=="__proto__"&&(f in l?O.isObject(l[f])&&O.isObject(d[f])?y(l[f],d[f],v):v&&(l[f]=d[f]):l[f]=d[f])})}e.merge=y;function w(l,d,v){const f=l.inspect(d),s=l.inspect(v);return typeof f.userValue<"u"||typeof f.workspaceValue<"u"||typeof f.workspaceFolderValue<"u"?f.value:typeof s.userValue<"u"||typeof s.workspaceValue<"u"||typeof s.workspaceFolderValue<"u"?s.value:f.defaultValue}e.getMigratedSettingValue=w;function E(l){return l.replace(/[\[\]]/g,"")}e.getLanguageTagSettingPlainKey=E}),define(J[58],Y([0,1,8]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IDownloadService=void 0,e.IDownloadService=(0,O.createDecorator)("downloadService")}),define(J[18],Y([0,1,8]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.INativeEnvironmentService=e.IEnvironmentService=void 0,e.IEnvironmentService=(0,O.createDecorator)("environmentService"),e.INativeEnvironmentService=(0,O.refineServiceDecorator)(e.IEnvironmentService)}),define(J[23],Y([0,1,87,8]),function(j,e,O,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PreferencesLocalizedLabel=e.PreferencesLabel=e.ExtensionsLocalizedLabel=e.ExtensionsLabel=e.IExtensionTipsService=e.IGlobalExtensionEnablementService=e.ENABLED_EXTENSIONS_STORAGE_PATH=e.DISABLED_EXTENSIONS_STORAGE_PATH=e.IExtensionManagementService=e.ExtensionManagementError=e.ExtensionManagementErrorCode=e.IExtensionGalleryService=e.InstallOperation=e.StatisticType=e.SortOrder=e.SortBy=e.isIExtensionIdentifier=e.getFallbackTargetPlarforms=e.isTargetPlatformCompatible=e.isNotWebExtensionInWebTargetPlatform=e.getTargetPlatform=e.toTargetPlatform=e.TargetPlatformToString=e.WEB_EXTENSION_TAG=e.EXTENSION_IDENTIFIER_REGEX=e.EXTENSION_IDENTIFIER_PATTERN=void 0,e.EXTENSION_IDENTIFIER_PATTERN="^([a-z0-9A-Z][a-z0-9-A-Z]*)\\.([a-z0-9A-Z][a-z0-9-A-Z]*)$",e.EXTENSION_IDENTIFIER_REGEX=new RegExp(e.EXTENSION_IDENTIFIER_PATTERN),e.WEB_EXTENSION_TAG="__web_extension";function D(l){switch(l){case"win32-x64":return"Windows 64 bit";case"win32-ia32":return"Windows 32 bit";case"win32-arm64":return"Windows ARM";case"linux-x64":return"Linux 64 bit";case"linux-arm64":return"Linux ARM 64";case"linux-armhf":return"Linux ARM";case"alpine-x64":return"Alpine Linux 64 bit";case"alpine-arm64":return"Alpine ARM 64";case"darwin-x64":return"Mac";case"darwin-arm64":return"Mac Silicon";case"web":return"Web";case"universal":return"universal";case"unknown":return"unknown";case"undefined":return"undefined"}}e.TargetPlatformToString=D;function L(l){switch(l){case"win32-x64":return"win32-x64";case"win32-ia32":return"win32-ia32";case"win32-arm64":return"win32-arm64";case"linux-x64":return"linux-x64";case"linux-arm64":return"linux-arm64";case"linux-armhf":return"linux-armhf";case"alpine-x64":return"alpine-x64";case"alpine-arm64":return"alpine-arm64";case"darwin-x64":return"darwin-x64";case"darwin-arm64":return"darwin-arm64";case"web":return"web";case"universal":return"universal";default:return"unknown"}}e.toTargetPlatform=L;function T(l,d){switch(l){case 3:return d==="x64"?"win32-x64":d==="ia32"?"win32-ia32":d==="arm64"?"win32-arm64":"unknown";case 2:return d==="x64"?"linux-x64":d==="arm64"?"linux-arm64":d==="arm"?"linux-armhf":"unknown";case"alpine":return d==="x64"?"alpine-x64":d==="arm64"?"alpine-arm64":"unknown";case 1:return d==="x64"?"darwin-x64":d==="arm64"?"darwin-arm64":"unknown";case 0:return"web"}}e.getTargetPlatform=T;function I(l,d){return d==="web"&&!l.includes("web")}e.isNotWebExtensionInWebTargetPlatform=I;function g(l,d,v){return I(d,v)?!1:l==="undefined"||l==="universal"?!0:l==="unknown"?!1:l===v?!0:u(v).includes(l)}e.isTargetPlatformCompatible=g;function u(l){switch(l){case"win32-x64":return["win32-ia32"];case"win32-arm64":return["win32-ia32"]}return[]}e.getFallbackTargetPlarforms=u;function m(l){return l&&typeof l=="object"&&typeof l.id=="string"&&(!l.uuid||typeof l.uuid=="string")}e.isIExtensionIdentifier=m;var S;(function(l){l[l.NoneOrRelevance=0]="NoneOrRelevance",l[l.LastUpdatedDate=1]="LastUpdatedDate",l[l.Title=2]="Title",l[l.PublisherName=3]="PublisherName",l[l.InstallCount=4]="InstallCount",l[l.PublishedDate=10]="PublishedDate",l[l.AverageRating=6]="AverageRating",l[l.WeightedRating=12]="WeightedRating"})(S=e.SortBy||(e.SortBy={}));var p;(function(l){l[l.Default=0]="Default",l[l.Ascending=1]="Ascending",l[l.Descending=2]="Descending"})(p=e.SortOrder||(e.SortOrder={}));var b;(function(l){l.Install="install",l.Uninstall="uninstall"})(b=e.StatisticType||(e.StatisticType={}));var y;(function(l){l[l.None=1]="None",l[l.Install=2]="Install",l[l.Update=3]="Update",l[l.Migrate=4]="Migrate"})(y=e.InstallOperation||(e.InstallOperation={})),e.IExtensionGalleryService=(0,k.createDecorator)("extensionGalleryService");var w;(function(l){l.Unsupported="Unsupported",l.Deprecated="Deprecated",l.Malicious="Malicious",l.Incompatible="Incompatible",l.IncompatiblePreRelease="IncompatiblePreRelease",l.IncompatibleTargetPlatform="IncompatibleTargetPlatform",l.ReleaseVersionNotFound="ReleaseVersionNotFound",l.Invalid="Invalid",l.Download="Download",l.Extract="Extract",l.Delete="Delete",l.Rename="Rename",l.CorruptZip="CorruptZip",l.IncompleteZip="IncompleteZip",l.Internal="Internal",l.Signature="Signature"})(w=e.ExtensionManagementErrorCode||(e.ExtensionManagementErrorCode={}));class E extends Error{constructor(d,v){super(d),this.code=v,this.name=v}}e.ExtensionManagementError=E,e.IExtensionManagementService=(0,k.createDecorator)("extensionManagementService"),e.DISABLED_EXTENSIONS_STORAGE_PATH="extensionsIdentifiers/disabled",e.ENABLED_EXTENSIONS_STORAGE_PATH="extensionsIdentifiers/enabled",e.IGlobalExtensionEnablementService=(0,k.createDecorator)("IGlobalExtensionEnablementService"),e.IExtensionTipsService=(0,k.createDecorator)("IExtensionTipsService"),e.ExtensionsLabel=(0,O.localize)(0,null),e.ExtensionsLocalizedLabel={value:e.ExtensionsLabel,original:"Extensions"},e.PreferencesLabel=(0,O.localize)(1,null),e.PreferencesLocalizedLabel={value:e.PreferencesLabel,original:"Preferences"}}),define(J[59],Y([0,1,8]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExtensionSignatureVerificationService=e.IExtensionSignatureVerificationService=void 0,e.IExtensionSignatureVerificationService=(0,O.createDecorator)("IExtensionSignatureVerificationService");class k{vsceSign(){return this.moduleLoadingPromise||(this.moduleLoadingPromise=new Promise((L,T)=>j(["node-vsce-sign"],async I=>L(I),T))),this.moduleLoadingPromise}async verify(L,T){let I;try{I=await this.vsceSign()}catch{return!1}return I.verify(L,T)}}e.ExtensionSignatureVerificationService=k}),define(J[60],Y([0,1,15,10,95,13]),function(j,e,O,k,D,L){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.readFileIntoStream=void 0;async function T(m,S,p,b,y,w){let E;try{await I(m,S,p,b,y,w)}catch(l){E=l}finally{E&&y.errorTransformer&&(E=y.errorTransformer(E)),typeof E<"u"&&p.error(E),p.end()}}e.readFileIntoStream=T;async function I(m,S,p,b,y,w){g(w);const E=await m.open(S,{create:!1});try{g(w);let l=0,d=0,v=y&&typeof y.length=="number"?y.length:void 0,f=O.VSBuffer.alloc(Math.min(y.bufferSize,typeof v=="number"?v:y.bufferSize)),s=y&&typeof y.position=="number"?y.position:0,t=0;do d=await m.read(E,s,f.buffer,t,f.byteLength-t),s+=d,t+=d,l+=d,typeof v=="number"&&(v-=d),t===f.byteLength&&(await p.write(b(f)),f=O.VSBuffer.alloc(Math.min(y.bufferSize,typeof v=="number"?v:y.bufferSize)),t=0);while(d>0&&(typeof v!="number"||v>0)&&g(w)&&u(l,y));if(t>0){let n=t;typeof v=="number"&&(n=Math.min(t,v)),p.write(b(f.slice(0,n)))}}catch(l){throw(0,L.ensureFileSystemProviderError)(l)}finally{await m.close(E)}}function g(m){if(m.isCancellationRequested)throw(0,k.canceled)();return!0}function u(m,S){if(S?.limits){if(typeof S.limits.memory=="number"&&m>S.limits.memory)throw(0,L.createFileSystemProviderError)((0,D.localize)(0,null),L.FileSystemProviderErrorCode.FileExceedsMemoryLimit);if(typeof S.limits.size=="number"&&m>S.limits.size)throw(0,L.createFileSystemProviderError)((0,D.localize)(1,null),L.FileSystemProviderErrorCode.FileTooLarge)}return!0}}),define(J[110],Y([0,1,4,154,2,12,155]),function(j,e,O,k,D,L,T){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NodeJSWatcher=void 0;class I extends D.Disposable{constructor(){super(...arguments),this._onDidChangeFile=this._register(new O.Emitter),this.onDidChangeFile=this._onDidChangeFile.event,this._onDidLogMessage=this._register(new O.Emitter),this.onDidLogMessage=this._onDidLogMessage.event,this.onDidError=O.Event.None,this.watchers=new Map,this.verboseLogging=!1}async watch(u){const m=this.normalizeRequests(u),S=m.filter(b=>{const y=this.watchers.get(b.path);return y?!(0,k.patternsEquals)(y.request.excludes,b.excludes)||!(0,k.patternsEquals)(y.request.includes,b.includes):!0}),p=Array.from(this.watchers.values()).filter(({request:b})=>!m.find(y=>y.path===b.path&&(0,k.patternsEquals)(y.excludes,b.excludes)&&(0,k.patternsEquals)(y.includes,b.includes))).map(({request:b})=>b.path);S.length&&this.trace(`Request to start watching: ${S.map(b=>`${b.path} (excludes: ${b.excludes.length>0?b.excludes:"<none>"}, includes: ${b.includes&&b.includes.length>0?JSON.stringify(b.includes):"<all>"})`).join(",")}`),p.length&&this.trace(`Request to stop watching: ${p.join(",")}`);for(const b of p)this.stopWatching(b);for(const b of S)this.startWatching(b)}startWatching(u){const m=new T.NodeJSFileWatcherLibrary(u,p=>this._onDidChangeFile.fire(p),p=>this._onDidLogMessage.fire(p),this.verboseLogging),S={request:u,instance:m};this.watchers.set(u.path,S)}async stop(){for(const[u]of this.watchers)this.stopWatching(u);this.watchers.clear()}stopWatching(u){const m=this.watchers.get(u);m&&(this.watchers.delete(u),m.instance.dispose())}normalizeRequests(u){const m=new Map;for(const S of u){const p=L.isLinux?S.path:S.path.toLowerCase();m.set(p,S)}return Array.from(m.values())}async setVerboseLogging(u){this.verboseLogging=u;for(const[,m]of this.watchers)m.instance.setVerboseLogging(u)}trace(u){this.verboseLogging&&this._onDidLogMessage.fire({type:"trace",message:this.toMessage(u)})}toMessage(u,m){return m?`[File Watcher (node.js)] ${u} (path: ${m.request.path})`:`[File Watcher (node.js)] ${u}`}}e.NodeJSWatcher=I}),define(J[111],Y([0,1,61,110]),function(j,e,O,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NodeJSWatcherClient=void 0;class D extends O.AbstractNonRecursiveWatcherClient{constructor(T,I,g){super(T,I,g),this.init()}createWatcher(){return new k.NodeJSWatcher}}e.NodeJSWatcherClient=D}),define(J[112],Y([0,1,16,56,82,61]),function(j,e,O,k,D,L){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UniversalWatcherClient=void 0;class T extends L.AbstractUniversalWatcherClient{constructor(g,u,m){super(g,u,m),this.init()}createWatcher(g){const u=g.add(new D.Client(O.FileAccess.asFileUri("bootstrap-fork").fsPath,{serverName:"File Watcher",args:["--type=fileWatcher"],env:{VSCODE_AMD_ENTRYPOINT:"vs/platform/files/node/watcher/watcherMain",VSCODE_PIPE_LOGGING:"true",VSCODE_VERBOSE_LOGGING:"true"}}));return g.add(u.onDidProcessExit(({code:m,signal:S})=>this.onError(`terminated by itself with code ${m}, signal: ${S}`))),k.ProxyChannel.toService((0,k.getNextTickChannel)(u.getChannel("watcher")))}}e.UniversalWatcherClient=T}),define(J[62],Y([0,1]),function(j,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ServiceCollection=void 0;class O{constructor(...D){this._entries=new Map;for(const[L,T]of D)this.set(L,T)}set(D,L){const T=this._entries.get(D);return this._entries.set(D,L),T}has(D){return this._entries.has(D)}get(D){return this._entries.get(D)}}e.ServiceCollection=O}),define(J[113],Y([0,1,3,10,2,46,109,8,62,156]),function(j,e,O,k,D,L,T,I,g,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Trace=e.InstantiationService=void 0;const m=!1;class S extends Error{constructor(E){super("cyclic dependency between services"),this.message=E.findCycleSlow()??`UNABLE to detect cycle, dumping graph: 
${E.toString()}`}}class p{constructor(E=new g.ServiceCollection,l=!1,d,v=m){this._services=E,this._strict=l,this._parent=d,this._enableTracing=v,this._activeInstantiations=new Set,this._services.set(I.IInstantiationService,this),this._globalGraph=v?d?._globalGraph??new T.Graph(f=>f):void 0}createChild(E){return new p(E,this._strict,this,this._enableTracing)}invokeFunction(E,...l){const d=y.traceInvocation(this._enableTracing,E);let v=!1;try{return E({get:s=>{if(v)throw(0,k.illegalState)("service accessor is only valid during the invocation of its target method");const t=this._getOrCreateServiceInstance(s,d);if(!t)throw new Error(`[invokeFunction] unknown service '${s}'`);return t}},...l)}finally{v=!0,d.stop()}}createInstance(E,...l){let d,v;return E instanceof L.SyncDescriptor?(d=y.traceCreation(this._enableTracing,E.ctor),v=this._createInstance(E.ctor,E.staticArguments.concat(l),d)):(d=y.traceCreation(this._enableTracing,E),v=this._createInstance(E,l,d)),d.stop(),v}_createInstance(E,l=[],d){const v=I._util.getServiceDependencies(E).sort((t,n)=>t.index-n.index),f=[];for(const t of v){const n=this._getOrCreateServiceInstance(t.id,d);n||this._throwIfStrict(`[createInstance] ${E.name} depends on UNKNOWN service ${t.id}.`,!1),f.push(n)}const s=v.length>0?v[0].index:l.length;if(l.length!==s){console.trace(`[createInstance] First service dependency of ${E.name} at position ${s+1} conflicts with ${l.length} static arguments`);const t=s-l.length;t>0?l=l.concat(new Array(t)):l=l.slice(0,s)}return Reflect.construct(E,l.concat(f))}_setServiceInstance(E,l){if(this._services.get(E)instanceof L.SyncDescriptor)this._services.set(E,l);else if(this._parent)this._parent._setServiceInstance(E,l);else throw new Error("illegalState - setting UNKNOWN service instance")}_getServiceInstanceOrDescriptor(E){const l=this._services.get(E);return!l&&this._parent?this._parent._getServiceInstanceOrDescriptor(E):l}_getOrCreateServiceInstance(E,l){this._globalGraph&&this._globalGraphImplicitDependency&&this._globalGraph.insertEdge(this._globalGraphImplicitDependency,String(E));const d=this._getServiceInstanceOrDescriptor(E);return d instanceof L.SyncDescriptor?this._safeCreateAndCacheServiceInstance(E,d,l.branch(E,!0)):(l.branch(E,!1),d)}_safeCreateAndCacheServiceInstance(E,l,d){if(this._activeInstantiations.has(E))throw new Error(`illegal state - RECURSIVELY instantiating service '${E}'`);this._activeInstantiations.add(E);try{return this._createAndCacheServiceInstance(E,l,d)}finally{this._activeInstantiations.delete(E)}}_createAndCacheServiceInstance(E,l,d){const v=new T.Graph(t=>t.id.toString());let f=0;const s=[{id:E,desc:l,_trace:d}];for(;s.length;){const t=s.pop();if(v.lookupOrInsertNode(t),f++>1e3)throw new S(v);for(const n of I._util.getServiceDependencies(t.desc.ctor)){const i=this._getServiceInstanceOrDescriptor(n.id);if(i||this._throwIfStrict(`[createInstance] ${E} depends on ${n.id} which is NOT registered.`,!0),this._globalGraph?.insertEdge(String(t.id),String(n.id)),i instanceof L.SyncDescriptor){const r={id:n.id,desc:i,_trace:t._trace.branch(n.id,!0)};v.insertEdge(t,r),s.push(r)}}}for(;;){const t=v.roots();if(t.length===0){if(!v.isEmpty())throw new S(v);break}for(const{data:n}of t){if(this._getServiceInstanceOrDescriptor(n.id)instanceof L.SyncDescriptor){const r=this._createServiceInstanceWithOwner(n.id,n.desc.ctor,n.desc.staticArguments,n.desc.supportsDelayedInstantiation,n._trace);this._setServiceInstance(n.id,r)}v.removeNode(n)}}return this._getServiceInstanceOrDescriptor(E)}_createServiceInstanceWithOwner(E,l,d=[],v,f){if(this._services.get(E)instanceof L.SyncDescriptor)return this._createServiceInstance(E,l,d,v,f);if(this._parent)return this._parent._createServiceInstanceWithOwner(E,l,d,v,f);throw new Error(`illegalState - creating UNKNOWN service instance ${l.name}`)}_createServiceInstance(E,l,d=[],v,f){if(v){const s=new p(void 0,this._strict,this,this._enableTracing);s._globalGraphImplicitDependency=String(E);const t=new Map,n=new O.IdleValue(()=>{const i=s._createInstance(l,d,f);for(const[r,o]of t){const c=i[r];if(typeof c=="function")for(const a of o)c.apply(i,a)}return t.clear(),i});return new Proxy(Object.create(null),{get(i,r){if(!n.isInitialized&&typeof r=="string"&&(r.startsWith("onDid")||r.startsWith("onWill"))){let a=t.get(r);return a||(a=new u.LinkedList,t.set(r,a)),(C,M,_)=>{const H=a.push([C,M,_]);return(0,D.toDisposable)(H)}}if(r in i)return i[r];const o=n.value;let c=o[r];return typeof c!="function"||(c=c.bind(o),i[r]=c),c},set(i,r,o){return n.value[r]=o,!0},getPrototypeOf(i){return l.prototype}})}else return this._createInstance(l,d,f)}_throwIfStrict(E,l){if(l&&console.warn(E),this._strict)throw new Error(E)}}e.InstantiationService=p;var b;(function(w){w[w.Creation=0]="Creation",w[w.Invocation=1]="Invocation",w[w.Branch=2]="Branch"})(b||(b={}));class y{static traceInvocation(E,l){return E?new y(1,l.name||new Error().stack.split(`
`).slice(3,4).join(`
`)):y._None}static traceCreation(E,l){return E?new y(0,l.name):y._None}constructor(E,l){this.type=E,this.name=l,this._start=Date.now(),this._dep=[]}branch(E,l){const d=new y(2,E.toString());return this._dep.push([E,l,d]),d}stop(){const E=Date.now()-this._start;y._totals+=E;let l=!1;function d(f,s){const t=[],n=new Array(f+1).join("	");for(const[i,r,o]of s._dep)if(r&&o){l=!0,t.push(`${n}CREATES -> ${i}`);const c=d(f+1,o);c&&t.push(c)}else t.push(`${n}uses -> ${i}`);return t.join(`
`)}const v=[`${this.type===0?"CREATE":"CALL"} ${this.name}`,`${d(1,this)}`,`DONE, took ${E.toFixed(2)}ms (grand total ${y._totals.toFixed(2)}ms)`];(E>2||l)&&y.all.add(v.join(`
`))}}e.Trace=y,y.all=new Set,y._None=new class extends y{constructor(){super(-1,null)}stop(){}branch(){return this}},y._totals=0});var Z=this&&this.__param||function(j,e){return function(O,k){e(O,k,j)}};define(J[63],Y([0,1,22,2,12,97,23,8]),function(j,e,O,k,D,L,T,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LanguagePackBaseService=e.ILanguagePackService=e.getLocale=void 0;function g(m){return m.tags.find(S=>S.startsWith("lp-"))?.split("lp-")[1]}e.getLocale=g,e.ILanguagePackService=(0,I.createDecorator)("languagePackService");let u=class extends k.Disposable{constructor(S){super(),this.extensionGalleryService=S}async getAvailableLanguages(){const S=new O.CancellationTokenSource;setTimeout(()=>S.cancel(),1e3);let p;try{p=await this.extensionGalleryService.query({text:'category:"language packs"',pageSize:20},S.token)}catch{return[]}const y=p.firstPage.filter(w=>w.properties.localizedLanguages?.length&&w.tags.some(E=>E.startsWith("lp-"))).map(w=>{const E=w.properties.localizedLanguages?.[0],l=g(w);return{...this.createQuickPickItem(l,E,w),extensionId:w.identifier.id,galleryExtension:w}});return y.push({...this.createQuickPickItem("en","English"),extensionId:"default"}),y}createQuickPickItem(S,p,b){const y=p??S;let w;if(y!==S&&(w=`(${S})`),S.toLowerCase()===D.language.toLowerCase()&&(w??="",w+=(0,L.localize)(0,null)),b?.installCount){w??="";const E=b.installCount;let l;E>1e6?l=`${Math.floor(E/1e5)/10}M`:E>1e3?l=`${Math.floor(E/1e3)}K`:l=String(E),w+=` $(cloud-download) ${l}`}return{id:S,label:y,description:w}}};u=me([Z(0,T.IExtensionGalleryService)],u),e.LanguagePackBaseService=u}),define(J[9],Y([0,1,33,4,2,34,12,11,8]),function(j,e,O,k,D,L,T,I,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseLogLevel=e.LogLevelToString=e.getLogLevel=e.NullLoggerService=e.NullLogService=e.NullLogger=e.AbstractLoggerService=e.LogService=e.MultiplexLogService=e.AdapterLogger=e.ConsoleLogger=e.ConsoleMainLogger=e.AbstractMessageLogger=e.AbstractLogger=e.format=e.log=e.DEFAULT_LOG_LEVEL=e.LogLevel=e.ILoggerService=e.ILogService=void 0,e.ILogService=(0,g.createDecorator)("logService"),e.ILoggerService=(0,g.createDecorator)("loggerService");function u(){return new Date().toISOString()}var m;(function(c){c[c.Off=0]="Off",c[c.Trace=1]="Trace",c[c.Debug=2]="Debug",c[c.Info=3]="Info",c[c.Warning=4]="Warning",c[c.Error=5]="Error"})(m=e.LogLevel||(e.LogLevel={})),e.DEFAULT_LOG_LEVEL=m.Info;function S(c,a,h){switch(a){case m.Trace:c.trace(h);break;case m.Debug:c.debug(h);break;case m.Info:c.info(h);break;case m.Warning:c.warn(h);break;case m.Error:c.error(h);break;case m.Off:break;default:throw new Error(`Invalid log level ${a}`)}}e.log=S;function p(c){let a="";for(let h=0;h<c.length;h++){let C=c[h];if(typeof C=="object")try{C=JSON.stringify(C)}catch{}a+=(h>0?" ":"")+C}return a}e.format=p;class b extends D.Disposable{constructor(){super(...arguments),this.level=e.DEFAULT_LOG_LEVEL,this._onDidChangeLogLevel=this._register(new k.Emitter),this.onDidChangeLogLevel=this._onDidChangeLogLevel.event}setLevel(a){this.level!==a&&(this.level=a,this._onDidChangeLogLevel.fire(this.level))}getLevel(){return this.level}checkLogLevel(a){return this.level!==m.Off&&this.level<=a}}e.AbstractLogger=b;class y extends b{constructor(a){super(),this.logAlways=a}checkLogLevel(a){return this.logAlways||super.checkLogLevel(a)}trace(a,...h){this.checkLogLevel(m.Trace)&&this.log(m.Trace,p([a,...h]))}debug(a,...h){this.checkLogLevel(m.Debug)&&this.log(m.Debug,p([a,...h]))}info(a,...h){this.checkLogLevel(m.Info)&&this.log(m.Info,p([a,...h]))}warn(a,...h){this.checkLogLevel(m.Warning)&&this.log(m.Warning,p([a,...h]))}error(a,...h){if(this.checkLogLevel(m.Error))if(a instanceof Error){const C=Array.prototype.slice.call(arguments);C[0]=a.stack,this.log(m.Error,p(C))}else this.log(m.Error,p([a,...h]))}flush(){}}e.AbstractMessageLogger=y;class w extends b{constructor(a=e.DEFAULT_LOG_LEVEL){super(),this.setLevel(a),this.useColors=!T.isWindows}trace(a,...h){this.checkLogLevel(m.Trace)&&(this.useColors?console.log(`\x1B[90m[main ${u()}]\x1B[0m`,a,...h):console.log(`[main ${u()}]`,a,...h))}debug(a,...h){this.checkLogLevel(m.Debug)&&(this.useColors?console.log(`\x1B[90m[main ${u()}]\x1B[0m`,a,...h):console.log(`[main ${u()}]`,a,...h))}info(a,...h){this.checkLogLevel(m.Info)&&(this.useColors?console.log(`\x1B[90m[main ${u()}]\x1B[0m`,a,...h):console.log(`[main ${u()}]`,a,...h))}warn(a,...h){this.checkLogLevel(m.Warning)&&(this.useColors?console.warn(`\x1B[93m[main ${u()}]\x1B[0m`,a,...h):console.warn(`[main ${u()}]`,a,...h))}error(a,...h){this.checkLogLevel(m.Error)&&(this.useColors?console.error(`\x1B[91m[main ${u()}]\x1B[0m`,a,...h):console.error(`[main ${u()}]`,a,...h))}dispose(){}flush(){}}e.ConsoleMainLogger=w;class E extends b{constructor(a=e.DEFAULT_LOG_LEVEL){super(),this.setLevel(a)}trace(a,...h){this.checkLogLevel(m.Trace)&&console.log("%cTRACE","color: #888",a,...h)}debug(a,...h){this.checkLogLevel(m.Debug)&&console.log("%cDEBUG","background: #eee; color: #888",a,...h)}info(a,...h){this.checkLogLevel(m.Info)&&console.log("%c INFO","color: #33f",a,...h)}warn(a,...h){this.checkLogLevel(m.Warning)&&console.log("%c WARN","color: #993",a,...h)}error(a,...h){this.checkLogLevel(m.Error)&&console.log("%c  ERR","color: #f33",a,...h)}dispose(){}flush(){}}e.ConsoleLogger=E;class l extends b{constructor(a,h=e.DEFAULT_LOG_LEVEL){super(),this.adapter=a,this.setLevel(h)}trace(a,...h){this.checkLogLevel(m.Trace)&&this.adapter.log(m.Trace,[this.extractMessage(a),...h])}debug(a,...h){this.checkLogLevel(m.Debug)&&this.adapter.log(m.Debug,[this.extractMessage(a),...h])}info(a,...h){this.checkLogLevel(m.Info)&&this.adapter.log(m.Info,[this.extractMessage(a),...h])}warn(a,...h){this.checkLogLevel(m.Warning)&&this.adapter.log(m.Warning,[this.extractMessage(a),...h])}error(a,...h){this.checkLogLevel(m.Error)&&this.adapter.log(m.Error,[this.extractMessage(a),...h])}extractMessage(a){return typeof a=="string"?a:(0,O.toErrorMessage)(a,this.checkLogLevel(m.Trace))}dispose(){}flush(){}}e.AdapterLogger=l;class d extends b{constructor(a){super(),this.logServices=a,a.length&&this.setLevel(a[0].getLevel())}setLevel(a){for(const h of this.logServices)h.setLevel(a);super.setLevel(a)}trace(a,...h){for(const C of this.logServices)C.trace(a,...h)}debug(a,...h){for(const C of this.logServices)C.debug(a,...h)}info(a,...h){for(const C of this.logServices)C.info(a,...h)}warn(a,...h){for(const C of this.logServices)C.warn(a,...h)}error(a,...h){for(const C of this.logServices)C.error(a,...h)}flush(){for(const a of this.logServices)a.flush()}dispose(){for(const a of this.logServices)a.dispose()}}e.MultiplexLogService=d;class v extends D.Disposable{constructor(a){super(),this.logger=a,this._register(a)}get onDidChangeLogLevel(){return this.logger.onDidChangeLogLevel}setLevel(a){this.logger.setLevel(a)}getLevel(){return this.logger.getLevel()}trace(a,...h){this.logger.trace(a,...h)}debug(a,...h){this.logger.debug(a,...h)}info(a,...h){this.logger.info(a,...h)}warn(a,...h){this.logger.warn(a,...h)}error(a,...h){this.logger.error(a,...h)}flush(){this.logger.flush()}}e.LogService=v;class f extends D.Disposable{constructor(a,h){super(),this.logLevel=a,this.loggerItems=new L.ResourceMap,this._register(h(C=>this.setLevel(C)))}getLoggers(){return[...this.loggerItems.values()].map(({logger:a})=>a)}getLogger(a){return this.loggerItems.get(a)?.logger}createLogger(a,h,C){let M=this.loggerItems.get(a)?.logger;return M||(C=h?.always?m.Trace:C,M=this.doCreateLogger(a,C??this.logLevel,h),this.loggerItems.set(a,{logger:M,logLevel:C})),M}setLevel(a,h){const C=I.URI.isUri(a)?a:void 0,M=C?h:a;if(C){const _=this.loggerItems.get(C);_&&_.logLevel!==M&&(_.logLevel=M,_.logger.setLevel(M))}else this.logLevel=M,this.loggerItems.forEach(({logLevel:_,logger:H})=>{_===void 0&&H.setLevel(this.logLevel)})}getLogLevel(a){return this.loggerItems.get(a)?.logLevel}dispose(){this.loggerItems.forEach(({logger:a})=>a.dispose()),this.loggerItems.clear(),super.dispose()}}e.AbstractLoggerService=f;class s{constructor(){this.onDidChangeLogLevel=new k.Emitter().event}setLevel(a){}getLevel(){return m.Info}trace(a,...h){}debug(a,...h){}info(a,...h){}warn(a,...h){}error(a,...h){}critical(a,...h){}dispose(){}flush(){}}e.NullLogger=s;class t extends s{}e.NullLogService=t;class n extends f{constructor(){super(m.Info,k.Event.None)}doCreateLogger(a,h,C){return new s}}e.NullLoggerService=n;function i(c){if(c.verbose)return m.Trace;if(typeof c.logLevel=="string"){const a=o(c.logLevel.toLowerCase());if(a!==void 0)return a}return e.DEFAULT_LOG_LEVEL}e.getLogLevel=i;function r(c){switch(c){case m.Trace:return"trace";case m.Debug:return"debug";case m.Info:return"info";case m.Warning:return"warn";case m.Error:return"error";case m.Off:return"off"}}e.LogLevelToString=r;function o(c){switch(c){case"trace":return m.Trace;case"debug":return m.Debug;case"info":return m.Info;case"warn":return m.Warning;case"error":return m.Error;case"critical":return m.Error;case"off":return m.Off}}e.parseLogLevel=o}),define(J[114],Y([0,1,19,3,10,4,2,14,61,9]),function(j,e,O,k,D,L,T,I,g,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractDiskFileSystemProvider=void 0;class m extends T.Disposable{constructor(p,b){super(),this.logService=p,this.options=b,this._onDidChangeFile=this._register(new L.Emitter),this.onDidChangeFile=this._onDidChangeFile.event,this._onDidWatchError=this._register(new L.Emitter),this.onDidWatchError=this._onDidWatchError.event,this.universalPathsToWatch=[],this.universalWatchRequestDelayer=this._register(new k.ThrottledDelayer(0)),this.nonRecursivePathsToWatch=[],this.nonRecursiveWatchRequestDelayer=this._register(new k.ThrottledDelayer(0))}watch(p,b){return b.recursive||this.options?.watcher?.forceUniversal?this.watchUniversal(p,b):this.watchNonRecursive(p,b)}watchUniversal(p,b){const y={path:this.toFilePath(p),excludes:b.excludes,includes:b.includes,recursive:b.recursive},w=(0,O.insert)(this.universalPathsToWatch,y);return this.refreshUniversalWatchers(),(0,T.toDisposable)(()=>{w(),this.refreshUniversalWatchers()})}refreshUniversalWatchers(){this.universalWatchRequestDelayer.trigger(()=>this.doRefreshUniversalWatchers()).catch(p=>(0,D.onUnexpectedError)(p))}doRefreshUniversalWatchers(){this.universalWatcher||(this.universalWatcher=this._register(this.createUniversalWatcher(b=>this._onDidChangeFile.fire((0,g.toFileChanges)(b)),b=>this.onWatcherLogMessage(b),this.logService.getLevel()===u.LogLevel.Trace)),this._register(this.logService.onDidChangeLogLevel(()=>{this.universalWatcher?.setVerboseLogging(this.logService.getLevel()===u.LogLevel.Trace)})));const p=this.options?.watcher?.recursive?.usePolling;if(p===!0)for(const b of this.universalPathsToWatch)(0,g.isRecursiveWatchRequest)(b)&&(b.pollingInterval=this.options?.watcher?.recursive?.pollingInterval??5e3);else if(Array.isArray(p))for(const b of this.universalPathsToWatch)(0,g.isRecursiveWatchRequest)(b)&&p.includes(b.path)&&(b.pollingInterval=this.options?.watcher?.recursive?.pollingInterval??5e3);return this.universalWatcher.watch(this.universalPathsToWatch)}watchNonRecursive(p,b){const y={path:this.toFilePath(p),excludes:b.excludes,includes:b.includes,recursive:!1},w=(0,O.insert)(this.nonRecursivePathsToWatch,y);return this.refreshNonRecursiveWatchers(),(0,T.toDisposable)(()=>{w(),this.refreshNonRecursiveWatchers()})}refreshNonRecursiveWatchers(){this.nonRecursiveWatchRequestDelayer.trigger(()=>this.doRefreshNonRecursiveWatchers()).catch(p=>(0,D.onUnexpectedError)(p))}doRefreshNonRecursiveWatchers(){return this.nonRecursiveWatcher||(this.nonRecursiveWatcher=this._register(this.createNonRecursiveWatcher(p=>this._onDidChangeFile.fire((0,g.toFileChanges)(p)),p=>this.onWatcherLogMessage(p),this.logService.getLevel()===u.LogLevel.Trace)),this._register(this.logService.onDidChangeLogLevel(()=>{this.nonRecursiveWatcher?.setVerboseLogging(this.logService.getLevel()===u.LogLevel.Trace)}))),this.nonRecursiveWatcher.watch(this.nonRecursivePathsToWatch)}onWatcherLogMessage(p){p.type==="error"&&this._onDidWatchError.fire(p.message),this.logService[p.type](p.message)}toFilePath(p){return(0,I.normalize)(p.fsPath)}}e.AbstractDiskFileSystemProvider=m}),define(J[115],Y([0,1,19,3,15,22,4,52,64,2,54,16,116,17,43,94,13,60,9]),function(j,e,O,k,D,L,T,I,g,u,m,S,p,b,y,w,E,l,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FileService=void 0;let v=class extends u.Disposable{constructor(s){super(),this.logService=s,this.BUFFER_SIZE=256*1024,this._onDidChangeFileSystemProviderRegistrations=this._register(new T.Emitter),this.onDidChangeFileSystemProviderRegistrations=this._onDidChangeFileSystemProviderRegistrations.event,this._onWillActivateFileSystemProvider=this._register(new T.Emitter),this.onWillActivateFileSystemProvider=this._onWillActivateFileSystemProvider.event,this._onDidChangeFileSystemProviderCapabilities=this._register(new T.Emitter),this.onDidChangeFileSystemProviderCapabilities=this._onDidChangeFileSystemProviderCapabilities.event,this.provider=new Map,this._onDidRunOperation=this._register(new T.Emitter),this.onDidRunOperation=this._onDidRunOperation.event,this._onDidFilesChange=this._register(new T.Emitter),this.onDidFilesChange=this._onDidFilesChange.event,this._onDidWatchError=this._register(new T.Emitter),this.onDidWatchError=this._onDidWatchError.event,this.activeWatchers=new Map,this.writeQueue=this._register(new k.ResourceQueue)}registerProvider(s,t){if(this.provider.has(s))throw new Error(`A filesystem provider for the scheme '${s}' is already registered.`);(0,p.mark)(`code/registerFilesystem/${s}`);const n=new u.DisposableStore;return this.provider.set(s,t),this._onDidChangeFileSystemProviderRegistrations.fire({added:!0,scheme:s,provider:t}),n.add(t.onDidChangeFile(i=>this._onDidFilesChange.fire(new E.FileChangesEvent(i,!this.isPathCaseSensitive(t))))),typeof t.onDidWatchError=="function"&&n.add(t.onDidWatchError(i=>this._onDidWatchError.fire(new Error(i)))),n.add(t.onDidChangeCapabilities(()=>this._onDidChangeFileSystemProviderCapabilities.fire({provider:t,scheme:s}))),(0,u.toDisposable)(()=>{this._onDidChangeFileSystemProviderRegistrations.fire({added:!1,scheme:s,provider:t}),this.provider.delete(s),(0,u.dispose)(n)})}getProvider(s){return this.provider.get(s)}async activateProvider(s){const t=[];this._onWillActivateFileSystemProvider.fire({scheme:s,join(n){t.push(n)}}),!this.provider.has(s)&&await k.Promises.settled(t)}async canHandleResource(s){return await this.activateProvider(s.scheme),this.hasProvider(s)}hasProvider(s){return this.provider.has(s.scheme)}hasCapability(s,t){const n=this.provider.get(s.scheme);return!!(n&&n.capabilities&t)}listCapabilities(){return g.Iterable.map(this.provider,([s,t])=>({scheme:s,capabilities:t.capabilities}))}async withProvider(s){if(!(0,b.isAbsolutePath)(s))throw new E.FileOperationError((0,w.localize)(0,null,this.resourceForError(s)),8);await this.activateProvider(s.scheme);const t=this.provider.get(s.scheme);if(!t){const n=new Error;throw n.name="ENOPRO",n.message=(0,w.localize)(1,null,s.toString()),n}return t}async withReadProvider(s){const t=await this.withProvider(s);if((0,E.hasOpenReadWriteCloseCapability)(t)||(0,E.hasReadWriteCapability)(t)||(0,E.hasFileReadStreamCapability)(t))return t;throw new Error(`Filesystem provider for scheme '${s.scheme}' neither has FileReadWrite, FileReadStream nor FileOpenReadWriteClose capability which is needed for the read operation.`)}async withWriteProvider(s){const t=await this.withProvider(s);if((0,E.hasOpenReadWriteCloseCapability)(t)||(0,E.hasReadWriteCapability)(t))return t;throw new Error(`Filesystem provider for scheme '${s.scheme}' neither has FileReadWrite nor FileOpenReadWriteClose capability which is needed for the write operation.`)}async resolve(s,t){try{return await this.doResolveFile(s,t)}catch(n){throw(0,E.toFileSystemProviderErrorCode)(n)===E.FileSystemProviderErrorCode.FileNotFound?new E.FileOperationError((0,w.localize)(2,null,this.resourceForError(s)),1):(0,E.ensureFileSystemProviderError)(n)}}async doResolveFile(s,t){const n=await this.withProvider(s),i=this.isPathCaseSensitive(n),r=t?.resolveTo,o=t?.resolveSingleChildDescendants,c=t?.resolveMetadata,a=await n.stat(s);let h;return this.toFileStat(n,s,a,void 0,!!c,(C,M)=>(h||(h=m.TernarySearchTree.forUris(()=>!i),h.set(s,!0),r&&h.fill(!0,r)),h.get(C.resource)||h.findSuperstr(C.resource.with({query:null,fragment:null}))?!0:C.isDirectory&&o?M===1:!1))}async toFileStat(s,t,n,i,r,o){const{providerExtUri:c}=this.getExtUri(s),a={resource:t,name:c.basename(t),isFile:(n.type&E.FileType.File)!==0,isDirectory:(n.type&E.FileType.Directory)!==0,isSymbolicLink:(n.type&E.FileType.SymbolicLink)!==0,mtime:n.mtime,ctime:n.ctime,size:n.size,readonly:Boolean((n.permissions??0)&E.FilePermission.Readonly)||Boolean(s.capabilities&2048),etag:(0,E.etag)({mtime:n.mtime,size:n.size}),children:void 0};if(a.isDirectory&&o(a,i)){try{const h=await s.readdir(t),C=await k.Promises.settled(h.map(async([M,_])=>{try{const H=c.joinPath(t,M),X=r?await s.stat(H):{type:_};return await this.toFileStat(s,H,X,h.length,r,o)}catch(H){return this.logService.trace(H),null}}));a.children=(0,O.coalesce)(C)}catch(h){this.logService.trace(h),a.children=[]}return a}return a}async resolveAll(s){return k.Promises.settled(s.map(async t=>{try{return{stat:await this.doResolveFile(t.resource,t.options),success:!0}}catch(n){return this.logService.trace(n),{stat:void 0,success:!1}}}))}async stat(s){const t=await this.withProvider(s),n=await t.stat(s);return this.toFileStat(t,s,n,void 0,!0,()=>!1)}async exists(s){const t=await this.withProvider(s);try{return!!await t.stat(s)}catch{return!1}}async canCreateFile(s,t){try{await this.doValidateCreateFile(s,t)}catch(n){return n}return!0}async doValidateCreateFile(s,t){if(!t?.overwrite&&await this.exists(s))throw new E.FileOperationError((0,w.localize)(3,null,this.resourceForError(s)),3,t)}async createFile(s,t=D.VSBuffer.fromString(""),n){await this.doValidateCreateFile(s,n);const i=await this.writeFile(s,t);return this._onDidRunOperation.fire(new E.FileOperationEvent(s,0,i)),i}async writeFile(s,t,n){const i=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(s),s),{providerExtUri:r}=this.getExtUri(i);try{await this.validateWriteFile(i,s,n)||await this.mkdirp(i,r.dirname(s));let c;if((0,E.hasReadWriteCapability)(i)&&!(t instanceof D.VSBuffer))if((0,y.isReadableStream)(t)){const a=await(0,y.peekStream)(t,3);a.ended?c=D.VSBuffer.concat(a.buffer):c=a}else c=(0,y.peekReadable)(t,a=>D.VSBuffer.concat(a),3);else c=t;!(0,E.hasOpenReadWriteCloseCapability)(i)||(0,E.hasReadWriteCapability)(i)&&c instanceof D.VSBuffer?await this.doWriteUnbuffered(i,s,n,c):await this.doWriteBuffered(i,s,n,c instanceof D.VSBuffer?(0,D.bufferToReadable)(c):c),this._onDidRunOperation.fire(new E.FileOperationEvent(s,4))}catch(o){throw new E.FileOperationError((0,w.localize)(4,null,this.resourceForError(s),(0,E.ensureFileSystemProviderError)(o).toString()),(0,E.toFileOperationResult)(o),n)}return this.resolve(s,{resolveMetadata:!0})}async validateWriteFile(s,t,n){if(!!n?.unlock&&!(s.capabilities&8192))throw new Error((0,w.localize)(5,null,this.resourceForError(t)));let r;try{r=await s.stat(t)}catch{return}if((r.type&E.FileType.Directory)!==0)throw new E.FileOperationError((0,w.localize)(6,null,this.resourceForError(t)),0,n);if(this.throwIfFileIsReadonly(t,r),typeof n?.mtime=="number"&&typeof n.etag=="string"&&n.etag!==E.ETAG_DISABLED&&typeof r.mtime=="number"&&typeof r.size=="number"&&n.mtime<r.mtime&&n.etag!==(0,E.etag)({mtime:n.mtime,size:r.size}))throw new E.FileOperationError((0,w.localize)(7,null),3,n);return r}async readFile(s,t,n){const i=await this.withReadProvider(s);return t?.atomic?this.doReadFileAtomic(i,s,t,n):this.doReadFile(i,s,t,n)}async doReadFileAtomic(s,t,n,i){return new Promise((r,o)=>{this.writeQueue.queueFor(t,this.getExtUri(s).providerExtUri).queue(async()=>{try{const c=await this.doReadFile(s,t,n,i);r(c)}catch(c){o(c)}})})}async doReadFile(s,t,n,i){const r=await this.doReadFileStream(s,t,{...n,preferUnbuffered:!0},i);return{...r,value:await(0,D.streamToBuffer)(r.value)}}async readFileStream(s,t,n){const i=await this.withReadProvider(s);return this.doReadFileStream(i,s,t,n)}async doReadFileStream(s,t,n,i){const r=new L.CancellationTokenSource(i),o=this.validateReadFile(t,n).then(a=>a,a=>{throw r.cancel(),a});let c;try{return typeof n?.etag=="string"&&n.etag!==E.ETAG_DISABLED&&await o,n?.atomic&&(0,E.hasFileAtomicReadCapability)(s)||!((0,E.hasOpenReadWriteCloseCapability)(s)||(0,E.hasFileReadStreamCapability)(s))||(0,E.hasReadWriteCapability)(s)&&n?.preferUnbuffered?c=this.readFileUnbuffered(s,t,n):(0,E.hasFileReadStreamCapability)(s)?c=this.readFileStreamed(s,t,r.token,n):c=this.readFileBuffered(s,t,r.token,n),{...await o,value:c}}catch(a){c&&await(0,y.consumeStream)(c);const h=(0,w.localize)(8,null,this.resourceForError(t),(0,E.ensureFileSystemProviderError)(a).toString());throw a instanceof E.NotModifiedSinceFileOperationError?new E.NotModifiedSinceFileOperationError(h,a.stat,n):new E.FileOperationError(h,(0,E.toFileOperationResult)(a),n)}}readFileStreamed(s,t,n,i=Object.create(null)){const r=s.readFileStream(t,i,n);return(0,y.transform)(r,{data:o=>o instanceof D.VSBuffer?o:D.VSBuffer.wrap(o),error:o=>new E.FileOperationError((0,w.localize)(9,null,this.resourceForError(t),(0,E.ensureFileSystemProviderError)(o).toString()),(0,E.toFileOperationResult)(o),i)},o=>D.VSBuffer.concat(o))}readFileBuffered(s,t,n,i=Object.create(null)){const r=(0,D.newWriteableBufferStream)();return(0,l.readFileIntoStream)(s,t,r,o=>o,{...i,bufferSize:this.BUFFER_SIZE,errorTransformer:o=>new E.FileOperationError((0,w.localize)(10,null,this.resourceForError(t),(0,E.ensureFileSystemProviderError)(o).toString()),(0,E.toFileOperationResult)(o),i)},n),r}readFileUnbuffered(s,t,n){const i=(0,y.newWriteableStream)(r=>D.VSBuffer.concat(r));return(async()=>{try{let r;n?.atomic&&(0,E.hasFileAtomicReadCapability)(s)?r=await s.readFile(t,{atomic:!0}):r=await s.readFile(t),typeof n?.position=="number"&&(r=r.slice(n.position)),typeof n?.length=="number"&&(r=r.slice(0,n.length)),this.validateReadFileLimits(t,r.byteLength,n),i.end(D.VSBuffer.wrap(r))}catch(r){i.error(r),i.end()}})(),i}async validateReadFile(s,t){const n=await this.resolve(s,{resolveMetadata:!0});if(n.isDirectory)throw new E.FileOperationError((0,w.localize)(11,null,this.resourceForError(s)),0,t);if(typeof t?.etag=="string"&&t.etag!==E.ETAG_DISABLED&&t.etag===n.etag)throw new E.NotModifiedSinceFileOperationError((0,w.localize)(12,null),n,t);return this.validateReadFileLimits(s,n.size,t),n}validateReadFileLimits(s,t,n){if(n?.limits){let i;if(typeof n.limits.memory=="number"&&t>n.limits.memory&&(i=9),typeof n.limits.size=="number"&&t>n.limits.size&&(i=7),typeof i=="number")throw new E.FileOperationError((0,w.localize)(13,null,this.resourceForError(s)),i)}}async canMove(s,t,n){return this.doCanMoveCopy(s,t,"move",n)}async canCopy(s,t,n){return this.doCanMoveCopy(s,t,"copy",n)}async doCanMoveCopy(s,t,n,i){if(s.toString()!==t.toString())try{const r=n==="move"?this.throwIfFileSystemIsReadonly(await this.withWriteProvider(s),s):await this.withReadProvider(s),o=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(t),t);await this.doValidateMoveCopy(r,s,o,t,n,i)}catch(r){return r}return!0}async move(s,t,n){const i=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(s),s),r=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(t),t),o=await this.doMoveCopy(i,s,r,t,"move",!!n),c=await this.resolve(t,{resolveMetadata:!0});return this._onDidRunOperation.fire(new E.FileOperationEvent(s,o==="move"?2:3,c)),c}async copy(s,t,n){const i=await this.withReadProvider(s),r=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(t),t),o=await this.doMoveCopy(i,s,r,t,"copy",!!n),c=await this.resolve(t,{resolveMetadata:!0});return this._onDidRunOperation.fire(new E.FileOperationEvent(s,o==="copy"?3:2,c)),c}async doMoveCopy(s,t,n,i,r,o){if(t.toString()===i.toString())return r;const{exists:c,isSameResourceWithDifferentPathCase:a}=await this.doValidateMoveCopy(s,t,n,i,r,o);if(c&&!a&&o&&await this.del(i,{recursive:!0}),await this.mkdirp(n,this.getExtUri(n).providerExtUri.dirname(i)),r==="copy"){if(s===n&&(0,E.hasFileFolderCopyCapability)(s))await s.copy(t,i,{overwrite:o});else{const h=await this.resolve(t);h.isDirectory?await this.doCopyFolder(s,h,n,i):await this.doCopyFile(s,t,n,i)}return r}else return s===n?(await s.rename(t,i,{overwrite:o}),r):(await this.doMoveCopy(s,t,n,i,"copy",o),await this.del(t,{recursive:!0}),"copy")}async doCopyFile(s,t,n,i){if((0,E.hasOpenReadWriteCloseCapability)(s)&&(0,E.hasOpenReadWriteCloseCapability)(n))return this.doPipeBuffered(s,t,n,i);if((0,E.hasOpenReadWriteCloseCapability)(s)&&(0,E.hasReadWriteCapability)(n))return this.doPipeBufferedToUnbuffered(s,t,n,i);if((0,E.hasReadWriteCapability)(s)&&(0,E.hasOpenReadWriteCloseCapability)(n))return this.doPipeUnbufferedToBuffered(s,t,n,i);if((0,E.hasReadWriteCapability)(s)&&(0,E.hasReadWriteCapability)(n))return this.doPipeUnbuffered(s,t,n,i)}async doCopyFolder(s,t,n,i){await n.mkdir(i),Array.isArray(t.children)&&await k.Promises.settled(t.children.map(async r=>{const o=this.getExtUri(n).providerExtUri.joinPath(i,r.name);return r.isDirectory?this.doCopyFolder(s,await this.resolve(r.resource),n,o):this.doCopyFile(s,r.resource,n,o)}))}async doValidateMoveCopy(s,t,n,i,r,o){let c=!1;if(s===n){const{providerExtUri:h,isPathCaseSensitive:C}=this.getExtUri(s);if(C||(c=h.isEqual(t,i)),c&&r==="copy")throw new Error((0,w.localize)(14,null,this.resourceForError(t),this.resourceForError(i)));if(!c&&h.isEqualOrParent(i,t))throw new Error((0,w.localize)(15,null,this.resourceForError(t),this.resourceForError(i)))}const a=await this.exists(i);if(a&&!c){if(!o)throw new E.FileOperationError((0,w.localize)(16,null,this.resourceForError(t),this.resourceForError(i)),4);if(s===n){const{providerExtUri:h}=this.getExtUri(s);if(h.isEqualOrParent(t,i))throw new Error((0,w.localize)(17,null,this.resourceForError(t),this.resourceForError(i)))}}return{exists:a,isSameResourceWithDifferentPathCase:c}}getExtUri(s){const t=this.isPathCaseSensitive(s);return{providerExtUri:t?b.extUri:b.extUriIgnorePathCase,isPathCaseSensitive:t}}isPathCaseSensitive(s){return!!(s.capabilities&1024)}async createFolder(s){const t=this.throwIfFileSystemIsReadonly(await this.withProvider(s),s);await this.mkdirp(t,s);const n=await this.resolve(s,{resolveMetadata:!0});return this._onDidRunOperation.fire(new E.FileOperationEvent(s,0,n)),n}async mkdirp(s,t){const n=[],{providerExtUri:i}=this.getExtUri(s);for(;!i.isEqual(t,i.dirname(t));)try{if(((await s.stat(t)).type&E.FileType.Directory)===0)throw new Error((0,w.localize)(18,null,this.resourceForError(t)));break}catch(r){if((0,E.toFileSystemProviderErrorCode)(r)!==E.FileSystemProviderErrorCode.FileNotFound)throw r;n.push(i.basename(t)),t=i.dirname(t)}for(let r=n.length-1;r>=0;r--){t=i.joinPath(t,n[r]);try{await s.mkdir(t)}catch(o){if((0,E.toFileSystemProviderErrorCode)(o)!==E.FileSystemProviderErrorCode.FileExists)throw o}}}async canDelete(s,t){try{await this.doValidateDelete(s,t)}catch(n){return n}return!0}async doValidateDelete(s,t){const n=this.throwIfFileSystemIsReadonly(await this.withProvider(s),s);if(!!t?.useTrash&&!(n.capabilities&4096))throw new Error((0,w.localize)(19,null,this.resourceForError(s)));let r;try{r=await n.stat(s)}catch{}if(r)this.throwIfFileIsReadonly(s,r);else throw new E.FileOperationError((0,w.localize)(20,null,this.resourceForError(s)),1);if(!!!t?.recursive){const c=await this.resolve(s);if(c.isDirectory&&Array.isArray(c.children)&&c.children.length>0)throw new Error((0,w.localize)(21,null,this.resourceForError(s)))}return n}async del(s,t){const n=await this.doValidateDelete(s,t),i=!!t?.useTrash,r=!!t?.recursive;await n.delete(s,{recursive:r,useTrash:i}),this._onDidRunOperation.fire(new E.FileOperationEvent(s,1))}async cloneFile(s,t){const n=await this.withProvider(s),i=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(t),t);if(n===i&&this.getExtUri(n).providerExtUri.isEqual(s,t))return;if(n===i&&(0,E.hasFileCloneCapability)(n))return n.cloneFile(s,t);await this.mkdirp(i,this.getExtUri(i).providerExtUri.dirname(t));const r=this.writeQueue.queueFor(s,this.getExtUri(n).providerExtUri);return n===i&&(0,E.hasFileFolderCopyCapability)(n)?r.queue(()=>n.copy(s,t,{overwrite:!0})):r.queue(()=>this.doCopyFile(n,s,i,t))}watch(s,t={recursive:!1,excludes:[]}){const n=new u.DisposableStore;let i=!1,r=()=>{i=!0};return n.add((0,u.toDisposable)(()=>r())),(async()=>{try{const o=await this.doWatch(s,t);i?(0,u.dispose)(o):r=()=>(0,u.dispose)(o)}catch(o){this.logService.error(o)}})(),n}async doWatch(s,t){const n=await this.withProvider(s),i=(0,I.hash)([this.getExtUri(n).providerExtUri.getComparisonKey(s),t]);let r=this.activeWatchers.get(i);return r||(r={count:0,disposable:n.watch(s,t)},this.activeWatchers.set(i,r)),r.count+=1,(0,u.toDisposable)(()=>{r&&(r.count--,r.count===0&&((0,u.dispose)(r.disposable),this.activeWatchers.delete(i)))})}dispose(){super.dispose();for(const[,s]of this.activeWatchers)(0,u.dispose)(s.disposable);this.activeWatchers.clear()}async doWriteBuffered(s,t,n,i){return this.writeQueue.queueFor(t,this.getExtUri(s).providerExtUri).queue(async()=>{const r=await s.open(t,{create:!0,unlock:n?.unlock??!1});try{(0,y.isReadableStream)(i)||(0,y.isReadableBufferedStream)(i)?await this.doWriteStreamBufferedQueued(s,r,i):await this.doWriteReadableBufferedQueued(s,r,i)}catch(o){throw(0,E.ensureFileSystemProviderError)(o)}finally{await s.close(r)}})}async doWriteStreamBufferedQueued(s,t,n){let i=0,r;if((0,y.isReadableBufferedStream)(n)){if(n.buffer.length>0){const o=D.VSBuffer.concat(n.buffer);await this.doWriteBuffer(s,t,o,o.byteLength,i,0),i+=o.byteLength}if(n.ended)return;r=n.stream}else r=n;return new Promise((o,c)=>{(0,y.listenStream)(r,{onData:async a=>{r.pause();try{await this.doWriteBuffer(s,t,a,a.byteLength,i,0)}catch(h){return c(h)}i+=a.byteLength,setTimeout(()=>r.resume())},onError:a=>c(a),onEnd:()=>o()})})}async doWriteReadableBufferedQueued(s,t,n){let i=0,r;for(;(r=n.read())!==null;)await this.doWriteBuffer(s,t,r,r.byteLength,i,0),i+=r.byteLength}async doWriteBuffer(s,t,n,i,r,o){let c=0;for(;c<i;)c+=await s.write(t,r+c,n.buffer,o+c,i-c)}async doWriteUnbuffered(s,t,n,i){return this.writeQueue.queueFor(t,this.getExtUri(s).providerExtUri).queue(()=>this.doWriteUnbufferedQueued(s,t,n,i))}async doWriteUnbufferedQueued(s,t,n,i){let r;i instanceof D.VSBuffer?r=i:(0,y.isReadableStream)(i)?r=await(0,D.streamToBuffer)(i):(0,y.isReadableBufferedStream)(i)?r=await(0,D.bufferedStreamToBuffer)(i):r=(0,D.readableToBuffer)(i),await s.writeFile(t,r.buffer,{create:!0,overwrite:!0,unlock:n?.unlock??!1})}async doPipeBuffered(s,t,n,i){return this.writeQueue.queueFor(i,this.getExtUri(n).providerExtUri).queue(()=>this.doPipeBufferedQueued(s,t,n,i))}async doPipeBufferedQueued(s,t,n,i){let r,o;try{r=await s.open(t,{create:!1}),o=await n.open(i,{create:!0,unlock:!1});const c=D.VSBuffer.alloc(this.BUFFER_SIZE);let a=0,h=0,C=0;do C=await s.read(r,a,c.buffer,h,c.byteLength-h),await this.doWriteBuffer(n,o,c,C,a,h),a+=C,h+=C,h===c.byteLength&&(h=0);while(C>0)}catch(c){throw(0,E.ensureFileSystemProviderError)(c)}finally{await k.Promises.settled([typeof r=="number"?s.close(r):Promise.resolve(),typeof o=="number"?n.close(o):Promise.resolve()])}}async doPipeUnbuffered(s,t,n,i){return this.writeQueue.queueFor(i,this.getExtUri(n).providerExtUri).queue(()=>this.doPipeUnbufferedQueued(s,t,n,i))}async doPipeUnbufferedQueued(s,t,n,i){return n.writeFile(i,await s.readFile(t),{create:!0,overwrite:!0,unlock:!1})}async doPipeUnbufferedToBuffered(s,t,n,i){return this.writeQueue.queueFor(i,this.getExtUri(n).providerExtUri).queue(()=>this.doPipeUnbufferedToBufferedQueued(s,t,n,i))}async doPipeUnbufferedToBufferedQueued(s,t,n,i){const r=await n.open(i,{create:!0,unlock:!1});try{const o=await s.readFile(t);await this.doWriteBuffer(n,r,D.VSBuffer.wrap(o),o.byteLength,0,0)}catch(o){throw(0,E.ensureFileSystemProviderError)(o)}finally{await n.close(r)}}async doPipeBufferedToUnbuffered(s,t,n,i){const r=await(0,D.streamToBuffer)(this.readFileBuffered(s,t,L.CancellationToken.None));await this.doWriteUnbuffered(n,i,void 0,r)}throwIfFileSystemIsReadonly(s,t){if(s.capabilities&2048)throw new E.FileOperationError((0,w.localize)(22,null,this.resourceForError(t)),6);return s}throwIfFileIsReadonly(s,t){if((t.permissions??0)&E.FilePermission.Readonly)throw new E.FileOperationError((0,w.localize)(23,null,this.resourceForError(s)),6)}resourceForError(s){return s.scheme===S.Schemas.file?s.fsPath:s.toString(!0)}};v=me([Z(0,d.ILogService)],v),e.FileService=v}),define(J[117],Y([0,1,118,157,3,34,15,4,158,2,14,12,17,43,20,96,13,60,114,33,112,111]),function(j,e,O,k,D,L,T,I,g,u,m,S,p,b,y,w,E,l,d,v,f,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DiskFileSystemProvider=void 0,(()=>{try{(0,k.gracefulify)(O)}catch(n){console.error(`Error enabling graceful-fs: ${(0,v.toErrorMessage)(n)}`)}})();class t extends d.AbstractDiskFileSystemProvider{constructor(i,r){super(i,r),this.onDidChangeCapabilities=I.Event.None,this.resourceLocks=new L.ResourceMap(o=>p.extUriBiasedIgnorePathCase.getComparisonKey(o)),this.mapHandleToPos=new Map,this.mapHandleToLock=new Map,this.writeHandles=new Map}get capabilities(){return this._capabilities||(this._capabilities=57374,S.isLinux&&(this._capabilities|=1024)),this._capabilities}async stat(i){try{const{stat:r,symbolicLink:o}=await y.SymlinkSupport.stat(this.toFilePath(i));return{type:this.toType(r,o),ctime:r.birthtime.getTime(),mtime:r.mtime.getTime(),size:r.size}}catch(r){throw this.toFileSystemProviderError(r)}}async readdir(i){try{const r=await y.Promises.readdir(this.toFilePath(i),{withFileTypes:!0}),o=[];return await Promise.all(r.map(async c=>{try{let a;c.isSymbolicLink()?a=(await this.stat((0,p.joinPath)(i,c.name))).type:a=this.toType(c),o.push([c.name,a])}catch(a){this.logService.trace(a)}})),o}catch(r){throw this.toFileSystemProviderError(r)}}toType(i,r){let o;return r?.dangling?o=E.FileType.Unknown:i.isFile()?o=E.FileType.File:i.isDirectory()?o=E.FileType.Directory:o=E.FileType.Unknown,r&&(o|=E.FileType.SymbolicLink),o}async createResourceLock(i){const r=this.toFilePath(i);this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - request to acquire resource lock (${r})`);let o;for(;o=this.resourceLocks.get(i);)this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - waiting for resource lock to be released (${r})`),await o.wait();const c=new D.Barrier;return this.resourceLocks.set(i,c),this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - new resource lock created (${r})`),(0,u.toDisposable)(()=>{this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock dispose() (${r})`),this.resourceLocks.get(i)===c&&(this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock removed from resource-lock map (${r})`),this.resourceLocks.delete(i)),this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock barrier open() (${r})`),c.open()})}async readFile(i,r){let o;try{r?.atomic&&(this.traceLock(`[Disk FileSystemProvider]: atomic read operation started (${this.toFilePath(i)})`),o=await this.createResourceLock(i));const c=this.toFilePath(i);return await y.Promises.readFile(c)}catch(c){throw this.toFileSystemProviderError(c)}finally{o?.dispose()}}traceLock(i){t.TRACE_LOG_RESOURCE_LOCKS&&this.logService.trace(i)}readFileStream(i,r,o){const c=(0,b.newWriteableStream)(a=>T.VSBuffer.concat(a.map(h=>T.VSBuffer.wrap(h))).buffer);return(0,l.readFileIntoStream)(this,i,c,a=>a.buffer,{...r,bufferSize:256*1024},o),c}async writeFile(i,r,o){let c;try{const a=this.toFilePath(i);if(!o.create||!o.overwrite){if(await y.Promises.exists(a)){if(!o.overwrite)throw(0,E.createFileSystemProviderError)((0,w.localize)(0,null),E.FileSystemProviderErrorCode.FileExists)}else if(!o.create)throw(0,E.createFileSystemProviderError)((0,w.localize)(1,null),E.FileSystemProviderErrorCode.FileNotFound)}c=await this.open(i,{create:!0,unlock:o.unlock}),await this.write(c,0,r,0,r.byteLength)}catch(a){throw await this.toFileSystemProviderWriteError(i,a)}finally{typeof c=="number"&&await this.close(c)}}static configureFlushOnWrite(i){t.canFlush=i}async open(i,r){const o=this.toFilePath(i);let c;(0,E.isFileOpenForWriteOptions)(r)&&(c=await this.createResourceLock(i));let a;try{if((0,E.isFileOpenForWriteOptions)(r)&&r.unlock)try{const{stat:C}=await y.SymlinkSupport.stat(o);C.mode&128||await y.Promises.chmod(o,C.mode|128)}catch(C){this.logService.trace(C)}let h;if((0,E.isFileOpenForWriteOptions)(r)){if(S.isWindows)try{await y.Promises.truncate(o,0),h="r+"}catch(C){C.code!=="ENOENT"&&this.logService.trace(C)}h||(h="w")}else h="r";a=await y.Promises.open(o,h)}catch(h){throw c?.dispose(),(0,E.isFileOpenForWriteOptions)(r)?await this.toFileSystemProviderWriteError(i,h):this.toFileSystemProviderError(h)}if(this.mapHandleToPos.set(a,0),(0,E.isFileOpenForWriteOptions)(r)&&this.writeHandles.set(a,i),c){const h=this.mapHandleToLock.get(a);this.traceLock(`[Disk FileSystemProvider]: open() - storing lock for handle ${a} (${o})`),this.mapHandleToLock.set(a,c),h&&(this.traceLock(`[Disk FileSystemProvider]: open() - disposing a previous lock that was still stored on same handle ${a} (${o})`),h.dispose())}return a}async close(i){const r=this.mapHandleToLock.get(i);try{if(this.mapHandleToPos.delete(i),this.writeHandles.delete(i)&&t.canFlush)try{await y.Promises.fdatasync(i)}catch(o){t.configureFlushOnWrite(!1),this.logService.error(o)}return await y.Promises.close(i)}catch(o){throw this.toFileSystemProviderError(o)}finally{r&&(this.mapHandleToLock.get(i)===r&&(this.traceLock(`[Disk FileSystemProvider]: close() - resource lock removed from handle-lock map ${i}`),this.mapHandleToLock.delete(i)),this.traceLock(`[Disk FileSystemProvider]: close() - disposing lock for handle ${i}`),r.dispose())}}async read(i,r,o,c,a){const h=this.normalizePos(i,r);let C=null;try{C=(await y.Promises.read(i,o,c,a,h)).bytesRead}catch(M){throw this.toFileSystemProviderError(M)}finally{this.updatePos(i,h,C)}return C}normalizePos(i,r){return r===this.mapHandleToPos.get(i)?null:r}updatePos(i,r,o){const c=this.mapHandleToPos.get(i);typeof c=="number"&&(typeof r=="number"||(typeof o=="number"?this.mapHandleToPos.set(i,c+o):this.mapHandleToPos.delete(i)))}async write(i,r,o,c,a){return(0,D.retry)(()=>this.doWrite(i,r,o,c,a),100,3)}async doWrite(i,r,o,c,a){const h=this.normalizePos(i,r);let C=null;try{C=(await y.Promises.write(i,o,c,a,h)).bytesWritten}catch(M){throw await this.toFileSystemProviderWriteError(this.writeHandles.get(i),M)}finally{this.updatePos(i,h,C)}return C}async mkdir(i){try{await y.Promises.mkdir(this.toFilePath(i))}catch(r){throw this.toFileSystemProviderError(r)}}async delete(i,r){try{const o=this.toFilePath(i);r.recursive?await y.Promises.rm(o,y.RimRafMode.MOVE):await y.Promises.unlink(o)}catch(o){throw this.toFileSystemProviderError(o)}}async rename(i,r,o){const c=this.toFilePath(i),a=this.toFilePath(r);if(c!==a)try{await this.validateTargetDeleted(i,r,"move",o.overwrite),await y.Promises.move(c,a)}catch(h){throw(h.code==="EINVAL"||h.code==="EBUSY"||h.code==="ENAMETOOLONG")&&(h=new Error((0,w.localize)(2,null,(0,m.basename)(c),(0,m.basename)((0,m.dirname)(a)),h.toString()))),this.toFileSystemProviderError(h)}}async copy(i,r,o){const c=this.toFilePath(i),a=this.toFilePath(r);if(c!==a)try{await this.validateTargetDeleted(i,r,"copy",o.overwrite),await y.Promises.copy(c,a,{preserveSymlinks:!0})}catch(h){throw(h.code==="EINVAL"||h.code==="EBUSY"||h.code==="ENAMETOOLONG")&&(h=new Error((0,w.localize)(3,null,(0,m.basename)(c),(0,m.basename)((0,m.dirname)(a)),h.toString()))),this.toFileSystemProviderError(h)}}async validateTargetDeleted(i,r,o,c){const a=this.toFilePath(i),h=this.toFilePath(r);let C=!1;if(!!(this.capabilities&1024)||(C=(0,g.isEqual)(a,h,!0)),C&&o==="copy")throw(0,E.createFileSystemProviderError)((0,w.localize)(4,null),E.FileSystemProviderErrorCode.FileExists);if(!C&&await y.Promises.exists(h)){if(!c)throw(0,E.createFileSystemProviderError)((0,w.localize)(5,null),E.FileSystemProviderErrorCode.FileExists);await this.delete(r,{recursive:!0,useTrash:!1})}}async cloneFile(i,r){return this.doCloneFile(i,r,!1)}async doCloneFile(i,r,o){const c=this.toFilePath(i),a=this.toFilePath(r),h=!!(this.capabilities&1024);if((0,g.isEqual)(c,a,!h))return;const C=new u.DisposableStore;try{const[M,_]=await Promise.all([this.createResourceLock(i),this.createResourceLock(r)]);C.add(M),C.add(_),o&&await y.Promises.mkdir((0,m.dirname)(a),{recursive:!0}),await y.Promises.copyFile(c,a)}catch(M){if(M.code==="ENOENT"&&!o)return this.doCloneFile(i,r,!0);throw this.toFileSystemProviderError(M)}finally{C.dispose()}}createUniversalWatcher(i,r,o){return new f.UniversalWatcherClient(c=>i(c),c=>r(c),o)}createNonRecursiveWatcher(i,r,o){return new s.NodeJSWatcherClient(c=>i(c),c=>r(c),o)}toFileSystemProviderError(i){if(i instanceof E.FileSystemProviderError)return i;let r;switch(i.code){case"ENOENT":r=E.FileSystemProviderErrorCode.FileNotFound;break;case"EISDIR":r=E.FileSystemProviderErrorCode.FileIsADirectory;break;case"ENOTDIR":r=E.FileSystemProviderErrorCode.FileNotADirectory;break;case"EEXIST":r=E.FileSystemProviderErrorCode.FileExists;break;case"EPERM":case"EACCES":r=E.FileSystemProviderErrorCode.NoPermissions;break;default:r=E.FileSystemProviderErrorCode.Unknown}return(0,E.createFileSystemProviderError)(i,r)}async toFileSystemProviderWriteError(i,r){let o=this.toFileSystemProviderError(r);if(i&&o.code===E.FileSystemProviderErrorCode.NoPermissions)try{const{stat:c}=await y.SymlinkSupport.stat(this.toFilePath(i));c.mode&128||(o=(0,E.createFileSystemProviderError)(r,E.FileSystemProviderErrorCode.FileWriteLocked))}catch(c){this.logService.trace(c)}return o}}e.DiskFileSystemProvider=t,t.TRACE_LOG_RESOURCE_LOCKS=!1,t.canFlush=!0}),define(J[119],Y([0,1,13,9]),function(j,e,O,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SpdLogLogger=void 0;var D;(function(u){u[u.Trace=0]="Trace",u[u.Debug=1]="Debug",u[u.Info=2]="Info",u[u.Warning=3]="Warning",u[u.Error=4]="Error",u[u.Critical=5]="Critical",u[u.Off=6]="Off"})(D||(D={}));async function L(u,m,S,p,b){try{const y=await new Promise((E,l)=>{j(["spdlog"],E,l)});y.setFlushOn(D.Trace);const w=await y.createAsyncRotatingLogger(u,m,S,p);return b?w.clearFormatters():w.setPattern("%Y-%m-%d %H:%M:%S.%e [%l] %v"),w}catch(y){console.error(y)}return null}function T(u,m,S){switch(m){case k.LogLevel.Trace:u.trace(S);break;case k.LogLevel.Debug:u.debug(S);break;case k.LogLevel.Info:u.info(S);break;case k.LogLevel.Warning:u.warn(S);break;case k.LogLevel.Error:u.error(S);break;case k.LogLevel.Off:break;default:throw new Error(`Invalid log level ${m}`)}}function I(u,m){switch(m){case k.LogLevel.Trace:u.setLevel(D.Trace);break;case k.LogLevel.Debug:u.setLevel(D.Debug);break;case k.LogLevel.Info:u.setLevel(D.Info);break;case k.LogLevel.Warning:u.setLevel(D.Warning);break;case k.LogLevel.Error:u.setLevel(D.Error);break;case k.LogLevel.Off:u.setLevel(D.Off);break;default:throw new Error(`Invalid log level ${m}`)}}class g extends k.AbstractMessageLogger{constructor(m,S,p,b,y){super(),this.buffer=[],this.setLevel(y),this._loggerCreationPromise=this._createSpdLogLogger(m,S,p,b),this._register(this.onDidChangeLogLevel(w=>{this._logger&&I(this._logger,w)}))}async _createSpdLogLogger(m,S,p,b){const y=p?6:1,w=30/y*O.ByteSize.MB,E=await L(m,S,w,y,b);if(E){this._logger=E,I(this._logger,this.getLevel());for(const{level:l,message:d}of this.buffer)T(this._logger,l,d);this.buffer=[]}}log(m,S){this._logger?T(this._logger,m,S):this.getLevel()<=m&&this.buffer.push({level:m,message:S})}flush(){this._logger?this._logger.flush():this._loggerCreationPromise.then(()=>this.flush())}dispose(){this._logger?this.disposeLogger():this._loggerCreationPromise.then(()=>this.disposeLogger())}disposeLogger(){this._logger&&(this._logger.drop(),this._logger=void 0)}}e.SpdLogLogger=g}),define(J[38],Y([0,1,4,64,2,8]),function(j,e,O,k,D,L){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NullPolicyService=e.AbstractPolicyService=e.IPolicyService=void 0,e.IPolicyService=(0,L.createDecorator)("policy");class T extends D.Disposable{constructor(){super(...arguments),this.policyDefinitions={},this.policies=new Map,this._onDidChange=this._register(new O.Emitter),this.onDidChange=this._onDidChange.event}async updatePolicyDefinitions(u){const m=Object.keys(this.policyDefinitions).length;return this.policyDefinitions={...u,...this.policyDefinitions},m!==Object.keys(this.policyDefinitions).length&&await this._updatePolicyDefinitions(u),k.Iterable.reduce(this.policies.entries(),(S,[p,b])=>({...S,[p]:b}),{})}getPolicyValue(u){return this.policies.get(u)}serialize(){return k.Iterable.reduce(Object.entries(this.policyDefinitions),(u,[m,S])=>({...u,[m]:{definition:S,value:this.policies.get(m)}}),{})}}e.AbstractPolicyService=T;class I{constructor(){this.onDidChange=O.Event.None}async updatePolicyDefinitions(){return{}}getPolicyValue(){}serialize(){}}e.NullPolicyService=I}),define(J[120],Y([0,1,3,4,64,5,13,9,38]),function(j,e,O,k,D,L,T,I,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FilePolicyService=void 0;function u(S,p){const b=[];for(const y of D.Iterable.concat(S.keys(),p.keys()))S.get(y)!==p.get(y)&&b.push(y);return b}let m=class extends g.AbstractPolicyService{constructor(p,b,y){super(),this.file=p,this.fileService=b,this.logService=y,this.throttledDelayer=this._register(new O.ThrottledDelayer(500));const w=k.Event.filter(b.onDidFilesChange,E=>E.affects(p));this._register(b.watch(p)),this._register(w(()=>this.throttledDelayer.trigger(()=>this.refresh())))}async _updatePolicyDefinitions(){await this.refresh()}async read(){const p=new Map;try{const b=await this.fileService.readFile(this.file),y=JSON.parse(b.value.toString());if(!(0,L.isObject)(y))throw new Error("Policy file isn't a JSON object");for(const w of Object.keys(y))this.policyDefinitions[w]&&p.set(w,y[w])}catch(b){b.fileOperationResult!==1&&this.logService.error("[FilePolicyService] Failed to read policies",b)}return p}async refresh(){const p=await this.read(),b=u(this.policies,p);this.policies=p,b.length>0&&this._onDidChange.fire(b)}};m=me([Z(1,T.IFileService),Z(2,I.ILogService)],m),e.FilePolicyService=m}),define(J[26],Y([0,1,8]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.productSchemaId=e.IProductService=void 0,e.IProductService=(0,O.createDecorator)("productService"),e.productSchemaId="vscode://schemas/vscode-product"}),define(J[35],Y([0,1,70,5]),function(j,e,O,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Registry=void 0;class D{constructor(){this.data=new Map}add(T,I){O.ok(k.isString(T)),O.ok(k.isObject(I)),O.ok(!this.data.has(T),"There is already an extension with this id"),this.data.set(T,I)}knows(T){return this.data.has(T)}as(T){return this.data.get(T)||null}}e.Registry=new D}),define(J[121],Y([0,1,4,35]),function(j,e,O,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Extensions=void 0,e.Extensions={JSONContribution:"base.contributions.json"};function D(I){return I.length>0&&I.charAt(I.length-1)==="#"?I.substring(0,I.length-1):I}class L{constructor(){this._onDidChangeSchema=new O.Emitter,this.onDidChangeSchema=this._onDidChangeSchema.event,this.schemasById={}}registerSchema(g,u){this.schemasById[D(g)]=u,this._onDidChangeSchema.fire(g)}notifySchemaChanged(g){this._onDidChangeSchema.fire(g)}getSchemaContributions(){return{schemas:this.schemasById}}}const T=new L;k.Registry.add(e.Extensions.JSONContribution,T)}),define(J[40],Y([0,1,19,4,5,85,21,121,35]),function(j,e,O,k,D,L,T,I,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getScopes=e.validateProperty=e.getDefaultValue=e.keyFromOverrideIdentifiers=e.overrideIdentifiersFromKey=e.OVERRIDE_PROPERTY_REGEX=e.OVERRIDE_PROPERTY_PATTERN=e.configurationDefaultsSchemaId=e.resourceLanguageSettingsSchemaId=e.resourceSettings=e.windowSettings=e.machineOverridableSettings=e.machineSettings=e.applicationSettings=e.allSettings=e.ConfigurationScope=e.Extensions=e.EditPresentationTypes=void 0;var u;(function(s){s.Multiline="multilineText",s.Singleline="singlelineText"})(u=e.EditPresentationTypes||(e.EditPresentationTypes={})),e.Extensions={Configuration:"base.contributions.configuration"};var m;(function(s){s[s.APPLICATION=1]="APPLICATION",s[s.MACHINE=2]="MACHINE",s[s.WINDOW=3]="WINDOW",s[s.RESOURCE=4]="RESOURCE",s[s.LANGUAGE_OVERRIDABLE=5]="LANGUAGE_OVERRIDABLE",s[s.MACHINE_OVERRIDABLE=6]="MACHINE_OVERRIDABLE"})(m=e.ConfigurationScope||(e.ConfigurationScope={})),e.allSettings={properties:{},patternProperties:{}},e.applicationSettings={properties:{},patternProperties:{}},e.machineSettings={properties:{},patternProperties:{}},e.machineOverridableSettings={properties:{},patternProperties:{}},e.windowSettings={properties:{},patternProperties:{}},e.resourceSettings={properties:{},patternProperties:{}},e.resourceLanguageSettingsSchemaId="vscode://schemas/settings/resourceLanguage",e.configurationDefaultsSchemaId="vscode://schemas/settings/configurationDefaults";const S=g.Registry.as(I.Extensions.JSONContribution);class p{constructor(){this.overrideIdentifiers=new Set,this._onDidSchemaChange=new k.Emitter,this.onDidSchemaChange=this._onDidSchemaChange.event,this._onDidUpdateConfiguration=new k.Emitter,this.onDidUpdateConfiguration=this._onDidUpdateConfiguration.event,this.configurationDefaultsOverrides=new Map,this.defaultLanguageConfigurationOverridesNode={id:"defaultOverrides",title:L.localize(0,null),properties:{}},this.configurationContributors=[this.defaultLanguageConfigurationOverridesNode],this.resourceLanguageSettingsSchema={properties:{},patternProperties:{},additionalProperties:!1,errorMessage:"Unknown editor configuration setting",allowTrailingCommas:!0,allowComments:!0},this.configurationProperties={},this.policyConfigurations=new Map,this.excludedConfigurationProperties={},S.registerSchema(e.resourceLanguageSettingsSchemaId,this.resourceLanguageSettingsSchema),this.registerOverridePropertyPatternKey()}registerConfiguration(t,n=!0){this.registerConfigurations([t],n)}registerConfigurations(t,n=!0){const i=this.doRegisterConfigurations(t,n);S.registerSchema(e.resourceLanguageSettingsSchemaId,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:i})}deregisterConfigurations(t){const n=this.doDeregisterConfigurations(t);S.registerSchema(e.resourceLanguageSettingsSchemaId,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:n})}updateConfigurations({add:t,remove:n}){const i=[];i.push(...this.doDeregisterConfigurations(n)),i.push(...this.doRegisterConfigurations(t,!1)),S.registerSchema(e.resourceLanguageSettingsSchemaId,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:(0,O.distinct)(i)})}registerDefaultConfigurations(t){const n=[],i=[];for(const{overrides:r,source:o}of t)for(const c in r)if(n.push(c),e.OVERRIDE_PROPERTY_REGEX.test(c)){const a=this.configurationDefaultsOverrides.get(c),h=a?.valuesSources??new Map;if(o)for(const H of Object.keys(r[c]))h.set(H,o);const C={...a?.value||{},...r[c]};this.configurationDefaultsOverrides.set(c,{source:o,value:C,valuesSources:h});const M=(0,T.getLanguageTagSettingPlainKey)(c),_={type:"object",default:C,description:L.localize(1,null,M),$ref:e.resourceLanguageSettingsSchemaId,defaultDefaultValue:C,source:D.isString(o)?void 0:o,defaultValueSource:o};i.push(...w(c)),this.configurationProperties[c]=_,this.defaultLanguageConfigurationOverridesNode.properties[c]=_}else{this.configurationDefaultsOverrides.set(c,{value:r[c],source:o});const a=this.configurationProperties[c];a&&(this.updatePropertyDefaultValue(c,a),this.updateSchema(c,a))}this.registerOverrideIdentifiers(i),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:n,defaultsOverrides:!0})}deregisterDefaultConfigurations(t){const n=[];for(const{overrides:i,source:r}of t)for(const o in i){const c=this.configurationDefaultsOverrides.get(o),a=D.isString(r)?r:r?.id,h=D.isString(c?.source)?c?.source:c?.source?.id;if(a===h)if(n.push(o),this.configurationDefaultsOverrides.delete(o),e.OVERRIDE_PROPERTY_REGEX.test(o))delete this.configurationProperties[o],delete this.defaultLanguageConfigurationOverridesNode.properties[o];else{const C=this.configurationProperties[o];C&&(this.updatePropertyDefaultValue(o,C),this.updateSchema(o,C))}}this.updateOverridePropertyPatternKey(),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:n,defaultsOverrides:!0})}notifyConfigurationSchemaUpdated(...t){this._onDidSchemaChange.fire()}registerOverrideIdentifiers(t){for(const n of t)this.overrideIdentifiers.add(n);this.updateOverridePropertyPatternKey()}doRegisterConfigurations(t,n){const i=[];return t.forEach(r=>{i.push(...this.validateAndRegisterProperties(r,n,r.extensionInfo,r.restrictedProperties)),this.configurationContributors.push(r),this.registerJSONConfiguration(r)}),i}doDeregisterConfigurations(t){const n=[],i=r=>{if(r.properties)for(const o in r.properties){n.push(o);const c=this.configurationProperties[o];c?.policy?.name&&this.policyConfigurations.delete(c.policy.name),delete this.configurationProperties[o],this.removeFromSchema(o,r.properties[o])}r.allOf?.forEach(o=>i(o))};for(const r of t){i(r);const o=this.configurationContributors.indexOf(r);o!==-1&&this.configurationContributors.splice(o,1)}return n}validateAndRegisterProperties(t,n=!0,i,r,o=3){o=D.isUndefinedOrNull(t.scope)?o:t.scope;const c=[],a=t.properties;if(a)for(const C in a){const M=a[C];if(n&&v(C,M)){delete a[C];continue}if(M.source=i,M.defaultDefaultValue=a[C].default,this.updatePropertyDefaultValue(C,M),e.OVERRIDE_PROPERTY_REGEX.test(C)?M.scope=void 0:(M.scope=D.isUndefinedOrNull(M.scope)?o:M.scope,M.restricted=D.isUndefinedOrNull(M.restricted)?!!r?.includes(C):M.restricted),a[C].hasOwnProperty("included")&&!a[C].included){this.excludedConfigurationProperties[C]=a[C],delete a[C];continue}else this.configurationProperties[C]=a[C],a[C].policy?.name&&this.policyConfigurations.set(a[C].policy.name,C);!a[C].deprecationMessage&&a[C].markdownDeprecationMessage&&(a[C].deprecationMessage=a[C].markdownDeprecationMessage),c.push(C)}const h=t.allOf;if(h)for(const C of h)c.push(...this.validateAndRegisterProperties(C,n,i,r,o));return c}getConfigurations(){return this.configurationContributors}getConfigurationProperties(){return this.configurationProperties}getPolicyConfigurations(){return this.policyConfigurations}getExcludedConfigurationProperties(){return this.excludedConfigurationProperties}getConfigurationDefaultsOverrides(){return this.configurationDefaultsOverrides}registerJSONConfiguration(t){const n=i=>{const r=i.properties;if(r)for(const c in r)this.updateSchema(c,r[c]);i.allOf?.forEach(n)};n(t)}updateSchema(t,n){switch(e.allSettings.properties[t]=n,n.scope){case 1:e.applicationSettings.properties[t]=n;break;case 2:e.machineSettings.properties[t]=n;break;case 6:e.machineOverridableSettings.properties[t]=n;break;case 3:e.windowSettings.properties[t]=n;break;case 4:e.resourceSettings.properties[t]=n;break;case 5:e.resourceSettings.properties[t]=n,this.resourceLanguageSettingsSchema.properties[t]=n;break}}removeFromSchema(t,n){switch(delete e.allSettings.properties[t],n.scope){case 1:delete e.applicationSettings.properties[t];break;case 2:delete e.machineSettings.properties[t];break;case 6:delete e.machineOverridableSettings.properties[t];break;case 3:delete e.windowSettings.properties[t];break;case 4:case 5:delete e.resourceSettings.properties[t],delete this.resourceLanguageSettingsSchema.properties[t];break}}updateOverridePropertyPatternKey(){for(const t of this.overrideIdentifiers.values()){const n=`[${t}]`,i={type:"object",description:L.localize(2,null),errorMessage:L.localize(3,null),$ref:e.resourceLanguageSettingsSchemaId};this.updatePropertyDefaultValue(n,i),e.allSettings.properties[n]=i,e.applicationSettings.properties[n]=i,e.machineSettings.properties[n]=i,e.machineOverridableSettings.properties[n]=i,e.windowSettings.properties[n]=i,e.resourceSettings.properties[n]=i}this._onDidSchemaChange.fire()}registerOverridePropertyPatternKey(){const t={type:"object",description:L.localize(4,null),errorMessage:L.localize(5,null),$ref:e.resourceLanguageSettingsSchemaId};e.allSettings.patternProperties[e.OVERRIDE_PROPERTY_PATTERN]=t,e.applicationSettings.patternProperties[e.OVERRIDE_PROPERTY_PATTERN]=t,e.machineSettings.patternProperties[e.OVERRIDE_PROPERTY_PATTERN]=t,e.machineOverridableSettings.patternProperties[e.OVERRIDE_PROPERTY_PATTERN]=t,e.windowSettings.patternProperties[e.OVERRIDE_PROPERTY_PATTERN]=t,e.resourceSettings.patternProperties[e.OVERRIDE_PROPERTY_PATTERN]=t,this._onDidSchemaChange.fire()}updatePropertyDefaultValue(t,n){const i=this.configurationDefaultsOverrides.get(t);let r=i?.value,o=i?.source;D.isUndefined(r)&&(r=n.defaultDefaultValue,o=void 0),D.isUndefined(r)&&(r=l(n.type)),n.default=r,n.defaultValueSource=o}}const b="\\[([^\\]]+)\\]",y=new RegExp(b,"g");e.OVERRIDE_PROPERTY_PATTERN=`^(${b})+$`,e.OVERRIDE_PROPERTY_REGEX=new RegExp(e.OVERRIDE_PROPERTY_PATTERN);function w(s){const t=[];if(e.OVERRIDE_PROPERTY_REGEX.test(s)){let n=y.exec(s);for(;n?.length;){const i=n[1].trim();i&&t.push(i),n=y.exec(s)}}return(0,O.distinct)(t)}e.overrideIdentifiersFromKey=w;function E(s){return s.reduce((t,n)=>`${t}[${n}]`,"")}e.keyFromOverrideIdentifiers=E;function l(s){switch(Array.isArray(s)?s[0]:s){case"boolean":return!1;case"integer":case"number":return 0;case"string":return"";case"array":return[];case"object":return{};default:return null}}e.getDefaultValue=l;const d=new p;g.Registry.add(e.Extensions.Configuration,d);function v(s,t){return s.trim()?e.OVERRIDE_PROPERTY_REGEX.test(s)?L.localize(7,null,s):d.getConfigurationProperties()[s]!==void 0?L.localize(8,null,s):t.policy?.name&&d.getPolicyConfigurations().get(t.policy?.name)!==void 0?L.localize(9,null,s,t.policy?.name,d.getPolicyConfigurations().get(t.policy?.name)):null:L.localize(6,null)}e.validateProperty=v;function f(){const s=[],t=d.getConfigurationProperties();for(const n of Object.keys(t))s.push([n,t[n].scope]);return s.push(["launch",4]),s.push(["task",4]),s}e.getScopes=f}),define(J[65],Y([0,1,19,4,50,2,34,29,5,11,21,40,35]),function(j,e,O,k,D,L,T,I,g,u,m,S,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConfigurationChangeEvent=e.mergeChanges=e.Configuration=e.UserSettings=e.ConfigurationModelParser=e.ConfigurationModel=void 0;class b{constructor(n={},i=[],r=[],o){this._contents=n,this._keys=i,this._overrides=r,this.raw=o,this.frozen=!1,this.overrideConfigurations=new Map}get rawConfiguration(){if(!this._rawConfiguration)if(this.raw?.length){const n=this.raw.map(i=>{if(i instanceof b)return i;const r=new y("");return r.parseRaw(i),r.configurationModel});this._rawConfiguration=n.reduce((i,r)=>r===i?r:i.merge(r),n[0])}else this._rawConfiguration=this;return this._rawConfiguration}get contents(){return this.checkAndFreeze(this._contents)}get overrides(){return this.checkAndFreeze(this._overrides)}get keys(){return this.checkAndFreeze(this._keys)}isEmpty(){return this._keys.length===0&&Object.keys(this._contents).length===0&&this._overrides.length===0}isFrozen(){return this.frozen}getValue(n){return n?(0,m.getConfigurationValue)(this.contents,n):this.contents}inspect(n,i){const r=this.rawConfiguration.getValue(n),o=i?this.rawConfiguration.getOverrideValue(n,i):void 0,c=i?this.rawConfiguration.override(i).getValue(n):r;return{value:r,override:o,merged:c}}getOverrideValue(n,i){const r=this.getContentsForOverrideIdentifer(i);return r?n?(0,m.getConfigurationValue)(r,n):r:void 0}getKeysForOverrideIdentifier(n){const i=[];for(const r of this.overrides)r.identifiers.includes(n)&&i.push(...r.keys);return O.distinct(i)}getAllOverrideIdentifiers(){const n=[];for(const i of this.overrides)n.push(...i.identifiers);return O.distinct(n)}override(n){let i=this.overrideConfigurations.get(n);return i||(i=this.createOverrideConfigurationModel(n),this.overrideConfigurations.set(n,i)),i}merge(...n){const i=I.deepClone(this.contents),r=I.deepClone(this.overrides),o=[...this.keys],c=this.raw?.length?[...this.raw]:[this];for(const a of n)if(c.push(...a.raw?.length?a.raw:[a]),!a.isEmpty()){this.mergeContents(i,a.contents);for(const h of a.overrides){const[C]=r.filter(M=>O.equals(M.identifiers,h.identifiers));C?(this.mergeContents(C.contents,h.contents),C.keys.push(...h.keys),C.keys=O.distinct(C.keys)):r.push(I.deepClone(h))}for(const h of a.keys)o.indexOf(h)===-1&&o.push(h)}return new b(i,o,r,c.every(a=>a instanceof b)?void 0:c)}freeze(){return this.frozen=!0,this}clone(){return new b(I.deepClone(this.contents),[...this.keys],I.deepClone(this.overrides))}createOverrideConfigurationModel(n){const i=this.getContentsForOverrideIdentifer(n);if(!i||typeof i!="object"||!Object.keys(i).length)return this;const r={};for(const o of O.distinct([...Object.keys(this.contents),...Object.keys(i)])){let c=this.contents[o];const a=i[o];a&&(typeof c=="object"&&typeof a=="object"?(c=I.deepClone(c),this.mergeContents(c,a)):c=a),r[o]=c}return new b(r,this.keys,this.overrides)}mergeContents(n,i){for(const r of Object.keys(i)){if(r in n&&g.isObject(n[r])&&g.isObject(i[r])){this.mergeContents(n[r],i[r]);continue}n[r]=I.deepClone(i[r])}}checkAndFreeze(n){return this.frozen&&!Object.isFrozen(n)?I.deepFreeze(n):n}getContentsForOverrideIdentifer(n){let i=null,r=null;const o=c=>{c&&(r?this.mergeContents(r,c):r=I.deepClone(c))};for(const c of this.overrides)O.equals(c.identifiers,[n])?i=c.contents:c.identifiers.includes(n)&&o(c.contents);return o(i),r}toJSON(){return{contents:this.contents,overrides:this.overrides,keys:this.keys}}setValue(n,i){this.addKey(n),(0,m.addToValueTree)(this.contents,n,i,r=>{throw new Error(r)})}removeValue(n){this.removeKey(n)&&(0,m.removeFromValueTree)(this.contents,n)}addKey(n){let i=this.keys.length;for(let r=0;r<i;r++)n.indexOf(this.keys[r])===0&&(i=r);this.keys.splice(i,1,n)}removeKey(n){const i=this.keys.indexOf(n);return i!==-1?(this.keys.splice(i,1),!0):!1}}e.ConfigurationModel=b;class y{constructor(n){this._name=n,this._raw=null,this._configurationModel=null,this._restrictedConfigurations=[],this._parseErrors=[]}get configurationModel(){return this._configurationModel||new b}get restrictedConfigurations(){return this._restrictedConfigurations}get errors(){return this._parseErrors}parse(n,i){if(!g.isUndefinedOrNull(n)){const r=this.doParseContent(n);this.parseRaw(r,i)}}reparse(n){this._raw&&this.parseRaw(this._raw,n)}parseRaw(n,i){this._raw=n;const{contents:r,keys:o,overrides:c,restricted:a,hasExcludedProperties:h}=this.doParseRaw(n,i);this._configurationModel=new b(r,o,c,h?[n]:void 0),this._restrictedConfigurations=a||[]}doParseContent(n){let i={},r=null,o=[];const c=[],a=[];function h(M){Array.isArray(o)?o.push(M):r!==null&&(o[r]=M)}const C={onObjectBegin:()=>{const M={};h(M),c.push(o),o=M,r=null},onObjectProperty:M=>{r=M},onObjectEnd:()=>{o=c.pop()},onArrayBegin:()=>{const M=[];h(M),c.push(o),o=M,r=null},onArrayEnd:()=>{o=c.pop()},onLiteralValue:h,onError:(M,_,H)=>{a.push({error:M,offset:_,length:H})}};if(n)try{D.visit(n,C),i=o[0]||{}}catch(M){console.error(`Error while parsing settings file ${this._name}: ${M}`),this._parseErrors=[M]}return i}doParseRaw(n,i){const r=p.Registry.as(S.Extensions.Configuration).getConfigurationProperties(),o=this.filter(n,r,!0,i);n=o.raw;const c=(0,m.toValuesTree)(n,C=>console.error(`Conflict in settings file ${this._name}: ${C}`)),a=Object.keys(n),h=this.toOverrides(n,C=>console.error(`Conflict in settings file ${this._name}: ${C}`));return{contents:c,keys:a,overrides:h,restricted:o.restricted,hasExcludedProperties:o.hasExcludedProperties}}filter(n,i,r,o){let c=!1;if(!o?.scopes&&!o?.skipRestricted)return{raw:n,restricted:[],hasExcludedProperties:c};const a={},h=[];for(const C in n)if(S.OVERRIDE_PROPERTY_REGEX.test(C)&&r){const M=this.filter(n[C],i,!1,o);a[C]=M.raw,c=c||M.hasExcludedProperties,h.push(...M.restricted)}else{const M=i[C],_=M?typeof M.scope<"u"?M.scope:3:void 0;M?.restricted&&h.push(C),(_===void 0||o.scopes===void 0||o.scopes.includes(_))&&!(o.skipRestricted&&M?.restricted)?a[C]=n[C]:c=!0}return{raw:a,restricted:h,hasExcludedProperties:c}}toOverrides(n,i){const r=[];for(const o of Object.keys(n))if(S.OVERRIDE_PROPERTY_REGEX.test(o)){const c={};for(const a in n[o])c[a]=n[o][a];r.push({identifiers:(0,S.overrideIdentifiersFromKey)(o),keys:Object.keys(c),contents:(0,m.toValuesTree)(c,i)})}return r}}e.ConfigurationModelParser=y;class w extends L.Disposable{constructor(n,i,r,o){super(),this.userSettingsResource=n,this.scopes=i,this.fileService=o,this._onDidChange=this._register(new k.Emitter),this.onDidChange=this._onDidChange.event,this.parser=new y(this.userSettingsResource.toString()),this.parseOptions={scopes:this.scopes},this._register(this.fileService.watch(r.dirname(this.userSettingsResource))),this._register(this.fileService.watch(this.userSettingsResource)),this._register(k.Event.any(k.Event.filter(this.fileService.onDidFilesChange,c=>c.contains(this.userSettingsResource)),k.Event.filter(this.fileService.onDidRunOperation,c=>(c.isOperation(0)||c.isOperation(3)||c.isOperation(1)||c.isOperation(4))&&r.isEqual(c.resource,n)))(()=>this._onDidChange.fire()))}async loadConfiguration(){try{const n=await this.fileService.readFile(this.userSettingsResource);return this.parser.parse(n.value.toString()||"{}",this.parseOptions),this.parser.configurationModel}catch{return new b}}reparse(){return this.parser.reparse(this.parseOptions),this.parser.configurationModel}getRestrictedSettings(){return this.parser.restrictedConfigurations}}e.UserSettings=w;class E{constructor(n,i,r,o,c,a,h,C,M,_,H,X,ie){this.key=n,this.overrides=i,this.value=r,this.overrideIdentifiers=o,this.defaultConfiguration=c,this.policyConfiguration=a,this.applicationConfiguration=h,this.userConfiguration=C,this.localUserConfiguration=M,this.remoteUserConfiguration=_,this.workspaceConfiguration=H,this.folderConfigurationModel=X,this.memoryInspectValue=ie}get defaultInspectValue(){return this._defaultInspectValue||(this._defaultInspectValue=this.defaultConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._defaultInspectValue}get defaultValue(){return this.defaultInspectValue.merged}get default(){return this.defaultInspectValue.value!==void 0||this.defaultInspectValue.override!==void 0?{value:this.defaultInspectValue.value,override:this.defaultInspectValue.override}:void 0}get policyInspectValue(){return this._policyInspectValue===void 0&&(this._policyInspectValue=this.policyConfiguration?this.policyConfiguration.inspect(this.key):null),this._policyInspectValue}get policyValue(){return this.policyInspectValue?.merged}get policy(){return this.policyInspectValue?.value!==void 0?{value:this.policyInspectValue.value}:void 0}get applicationInspectValue(){return this._applicationInspectValue===void 0&&(this._applicationInspectValue=this.applicationConfiguration?this.applicationConfiguration.inspect(this.key):null),this._applicationInspectValue}get applicationValue(){return this.applicationInspectValue?.merged}get application(){return this.applicationInspectValue?.value!==void 0||this.applicationInspectValue?.override!==void 0?{value:this.applicationInspectValue.value,override:this.applicationInspectValue.override}:void 0}get userInspectValue(){return this._userInspectValue||(this._userInspectValue=this.userConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._userInspectValue}get userValue(){return this.userInspectValue.merged}get user(){return this.userInspectValue.value!==void 0||this.userInspectValue.override!==void 0?{value:this.userInspectValue.value,override:this.userInspectValue.override}:void 0}get userLocalInspectValue(){return this._userLocalInspectValue||(this._userLocalInspectValue=this.localUserConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._userLocalInspectValue}get userLocalValue(){return this.userLocalInspectValue.merged}get userLocal(){return this.userLocalInspectValue.value!==void 0||this.userLocalInspectValue.override!==void 0?{value:this.userLocalInspectValue.value,override:this.userLocalInspectValue.override}:void 0}get userRemoteInspectValue(){return this._userRemoteInspectValue||(this._userRemoteInspectValue=this.remoteUserConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._userRemoteInspectValue}get userRemoteValue(){return this.userRemoteInspectValue.merged}get userRemote(){return this.userRemoteInspectValue.value!==void 0||this.userRemoteInspectValue.override!==void 0?{value:this.userRemoteInspectValue.value,override:this.userRemoteInspectValue.override}:void 0}get workspaceInspectValue(){return this._workspaceInspectValue===void 0&&(this._workspaceInspectValue=this.workspaceConfiguration?this.workspaceConfiguration.inspect(this.key,this.overrides.overrideIdentifier):null),this._workspaceInspectValue}get workspaceValue(){return this.workspaceInspectValue?.merged}get workspace(){return this.workspaceInspectValue?.value!==void 0||this.workspaceInspectValue?.override!==void 0?{value:this.workspaceInspectValue.value,override:this.workspaceInspectValue.override}:void 0}get workspaceFolderInspectValue(){return this._workspaceFolderInspectValue===void 0&&(this._workspaceFolderInspectValue=this.folderConfigurationModel?this.folderConfigurationModel.inspect(this.key,this.overrides.overrideIdentifier):null),this._workspaceFolderInspectValue}get workspaceFolderValue(){return this.workspaceFolderInspectValue?.merged}get workspaceFolder(){return this.workspaceFolderInspectValue?.value!==void 0||this.workspaceFolderInspectValue?.override!==void 0?{value:this.workspaceFolderInspectValue.value,override:this.workspaceFolderInspectValue.override}:void 0}get memoryValue(){return this.memoryInspectValue.merged}get memory(){return this.memoryInspectValue.value!==void 0||this.memoryInspectValue.override!==void 0?{value:this.memoryInspectValue.value,override:this.memoryInspectValue.override}:void 0}}class l{constructor(n,i,r,o,c=new b,a=new b,h=new T.ResourceMap,C=new b,M=new T.ResourceMap,_=!0){this._defaultConfiguration=n,this._policyConfiguration=i,this._applicationConfiguration=r,this._localUserConfiguration=o,this._remoteUserConfiguration=c,this._workspaceConfiguration=a,this._folderConfigurations=h,this._memoryConfiguration=C,this._memoryConfigurationByResource=M,this._freeze=_,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations=new T.ResourceMap,this._userConfiguration=null}getValue(n,i,r){return this.getConsolidatedConfigurationModel(n,i,r).getValue(n)}updateValue(n,i,r={}){let o;r.resource?(o=this._memoryConfigurationByResource.get(r.resource),o||(o=new b,this._memoryConfigurationByResource.set(r.resource,o))):o=this._memoryConfiguration,i===void 0?o.removeValue(n):o.setValue(n,i),r.resource||(this._workspaceConsolidatedConfiguration=null)}inspect(n,i,r){const o=this.getConsolidatedConfigurationModel(n,i,r),c=O.distinct(o.overrides.map(C=>C.identifiers).flat()).filter(C=>o.getOverrideValue(n,C)!==void 0),a=this.getFolderConfigurationModelForResource(i.resource,r),h=i.resource?this._memoryConfigurationByResource.get(i.resource)||this._memoryConfiguration:this._memoryConfiguration;return new E(n,i,o.getValue(n),c.length?c:void 0,this._defaultConfiguration,this._policyConfiguration.isEmpty()?void 0:this._policyConfiguration.freeze(),this.applicationConfiguration.isEmpty()?void 0:this.applicationConfiguration.freeze(),this.userConfiguration.freeze(),this.localUserConfiguration.freeze(),this.remoteUserConfiguration.freeze(),r?this._workspaceConfiguration.freeze():void 0,a?a.freeze():void 0,h.inspect(n,i.overrideIdentifier))}keys(n){const i=this.getFolderConfigurationModelForResource(void 0,n);return{default:this._defaultConfiguration.freeze().keys,user:this.userConfiguration.freeze().keys,workspace:this._workspaceConfiguration.freeze().keys,workspaceFolder:i?i.freeze().keys:[]}}updateDefaultConfiguration(n){this._defaultConfiguration=n,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updatePolicyConfiguration(n){this._policyConfiguration=n}updateApplicationConfiguration(n){this._applicationConfiguration=n,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateLocalUserConfiguration(n){this._localUserConfiguration=n,this._userConfiguration=null,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateRemoteUserConfiguration(n){this._remoteUserConfiguration=n,this._userConfiguration=null,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateWorkspaceConfiguration(n){this._workspaceConfiguration=n,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateFolderConfiguration(n,i){this._folderConfigurations.set(n,i),this._foldersConsolidatedConfigurations.delete(n)}deleteFolderConfiguration(n){this.folderConfigurations.delete(n),this._foldersConsolidatedConfigurations.delete(n)}compareAndUpdateDefaultConfiguration(n,i){const r=[];if(!i){const{added:o,updated:c,removed:a}=f(this._defaultConfiguration,n);i=[...o,...c,...a]}for(const o of i)for(const c of(0,S.overrideIdentifiersFromKey)(o)){const a=this._defaultConfiguration.getKeysForOverrideIdentifier(c),h=n.getKeysForOverrideIdentifier(c),C=[...h.filter(M=>a.indexOf(M)===-1),...a.filter(M=>h.indexOf(M)===-1),...a.filter(M=>!I.equals(this._defaultConfiguration.override(c).getValue(M),n.override(c).getValue(M)))];r.push([c,C])}return this.updateDefaultConfiguration(n),{keys:i,overrides:r}}compareAndUpdatePolicyConfiguration(n){const{added:i,updated:r,removed:o}=f(this._policyConfiguration,n),c=[...i,...r,...o];return c.length&&this.updatePolicyConfiguration(n),{keys:c,overrides:[]}}compareAndUpdateApplicationConfiguration(n){const{added:i,updated:r,removed:o,overrides:c}=f(this.applicationConfiguration,n),a=[...i,...r,...o];return a.length&&this.updateApplicationConfiguration(n),{keys:a,overrides:c}}compareAndUpdateLocalUserConfiguration(n){const{added:i,updated:r,removed:o,overrides:c}=f(this.localUserConfiguration,n),a=[...i,...r,...o];return a.length&&this.updateLocalUserConfiguration(n),{keys:a,overrides:c}}compareAndUpdateRemoteUserConfiguration(n){const{added:i,updated:r,removed:o,overrides:c}=f(this.remoteUserConfiguration,n),a=[...i,...r,...o];return a.length&&this.updateRemoteUserConfiguration(n),{keys:a,overrides:c}}compareAndUpdateWorkspaceConfiguration(n){const{added:i,updated:r,removed:o,overrides:c}=f(this.workspaceConfiguration,n),a=[...i,...r,...o];return a.length&&this.updateWorkspaceConfiguration(n),{keys:a,overrides:c}}compareAndUpdateFolderConfiguration(n,i){const r=this.folderConfigurations.get(n),{added:o,updated:c,removed:a,overrides:h}=f(r,i),C=[...o,...c,...a];return(C.length||!r)&&this.updateFolderConfiguration(n,i),{keys:C,overrides:h}}compareAndDeleteFolderConfiguration(n){const i=this.folderConfigurations.get(n);if(!i)throw new Error("Unknown folder");this.deleteFolderConfiguration(n);const{added:r,updated:o,removed:c,overrides:a}=f(i,void 0);return{keys:[...r,...o,...c],overrides:a}}get defaults(){return this._defaultConfiguration}get applicationConfiguration(){return this._applicationConfiguration}get userConfiguration(){return this._userConfiguration||(this._userConfiguration=this._remoteUserConfiguration.isEmpty()?this._localUserConfiguration:this._localUserConfiguration.merge(this._remoteUserConfiguration),this._freeze&&this._userConfiguration.freeze()),this._userConfiguration}get localUserConfiguration(){return this._localUserConfiguration}get remoteUserConfiguration(){return this._remoteUserConfiguration}get workspaceConfiguration(){return this._workspaceConfiguration}get folderConfigurations(){return this._folderConfigurations}getConsolidatedConfigurationModel(n,i,r){let o=this.getConsolidatedConfigurationModelForResource(i,r);return i.overrideIdentifier&&(o=o.override(i.overrideIdentifier)),!this._policyConfiguration.isEmpty()&&this._policyConfiguration.getValue(n)!==void 0&&(o=o.merge(this._policyConfiguration)),o}getConsolidatedConfigurationModelForResource({resource:n},i){let r=this.getWorkspaceConsolidatedConfiguration();if(i&&n){const o=i.getFolder(n);o&&(r=this.getFolderConsolidatedConfiguration(o.uri)||r);const c=this._memoryConfigurationByResource.get(n);c&&(r=r.merge(c))}return r}getWorkspaceConsolidatedConfiguration(){return this._workspaceConsolidatedConfiguration||(this._workspaceConsolidatedConfiguration=this._defaultConfiguration.merge(this.applicationConfiguration,this.userConfiguration,this._workspaceConfiguration,this._memoryConfiguration),this._freeze&&(this._workspaceConfiguration=this._workspaceConfiguration.freeze())),this._workspaceConsolidatedConfiguration}getFolderConsolidatedConfiguration(n){let i=this._foldersConsolidatedConfigurations.get(n);if(!i){const r=this.getWorkspaceConsolidatedConfiguration(),o=this._folderConfigurations.get(n);o?(i=r.merge(o),this._freeze&&(i=i.freeze()),this._foldersConsolidatedConfigurations.set(n,i)):i=r}return i}getFolderConfigurationModelForResource(n,i){if(i&&n){const r=i.getFolder(n);if(r)return this._folderConfigurations.get(r.uri)}}toData(){return{defaults:{contents:this._defaultConfiguration.contents,overrides:this._defaultConfiguration.overrides,keys:this._defaultConfiguration.keys},policy:{contents:this._policyConfiguration.contents,overrides:this._policyConfiguration.overrides,keys:this._policyConfiguration.keys},application:{contents:this.applicationConfiguration.contents,overrides:this.applicationConfiguration.overrides,keys:this.applicationConfiguration.keys},user:{contents:this.userConfiguration.contents,overrides:this.userConfiguration.overrides,keys:this.userConfiguration.keys},workspace:{contents:this._workspaceConfiguration.contents,overrides:this._workspaceConfiguration.overrides,keys:this._workspaceConfiguration.keys},folders:[...this._folderConfigurations.keys()].reduce((n,i)=>{const{contents:r,overrides:o,keys:c}=this._folderConfigurations.get(i);return n.push([i,{contents:r,overrides:o,keys:c}]),n},[])}}allKeys(){const n=new Set;return this._defaultConfiguration.freeze().keys.forEach(i=>n.add(i)),this.userConfiguration.freeze().keys.forEach(i=>n.add(i)),this._workspaceConfiguration.freeze().keys.forEach(i=>n.add(i)),this._folderConfigurations.forEach(i=>i.freeze().keys.forEach(r=>n.add(r))),[...n.values()]}allOverrideIdentifiers(){const n=new Set;return this._defaultConfiguration.freeze().getAllOverrideIdentifiers().forEach(i=>n.add(i)),this.userConfiguration.freeze().getAllOverrideIdentifiers().forEach(i=>n.add(i)),this._workspaceConfiguration.freeze().getAllOverrideIdentifiers().forEach(i=>n.add(i)),this._folderConfigurations.forEach(i=>i.freeze().getAllOverrideIdentifiers().forEach(r=>n.add(r))),[...n.values()]}getAllKeysForOverrideIdentifier(n){const i=new Set;return this._defaultConfiguration.getKeysForOverrideIdentifier(n).forEach(r=>i.add(r)),this.userConfiguration.getKeysForOverrideIdentifier(n).forEach(r=>i.add(r)),this._workspaceConfiguration.getKeysForOverrideIdentifier(n).forEach(r=>i.add(r)),this._folderConfigurations.forEach(r=>r.getKeysForOverrideIdentifier(n).forEach(o=>i.add(o))),[...i.values()]}static parse(n){const i=this.parseConfigurationModel(n.defaults),r=this.parseConfigurationModel(n.policy),o=this.parseConfigurationModel(n.application),c=this.parseConfigurationModel(n.user),a=this.parseConfigurationModel(n.workspace),h=n.folders.reduce((C,M)=>(C.set(u.URI.revive(M[0]),this.parseConfigurationModel(M[1])),C),new T.ResourceMap);return new l(i,r,o,c,new b,a,h,new b,new T.ResourceMap,!1)}static parseConfigurationModel(n){return new b(n.contents,n.keys,n.overrides).freeze()}}e.Configuration=l;function d(...t){if(t.length===0)return{keys:[],overrides:[]};if(t.length===1)return t[0];const n=new Set,i=new Map;for(const o of t)o.keys.forEach(c=>n.add(c)),o.overrides.forEach(([c,a])=>{const h=(0,T.getOrSet)(i,c,new Set);a.forEach(C=>h.add(C))});const r=[];return i.forEach((o,c)=>r.push([c,[...o.values()]])),{keys:[...n.values()],overrides:r}}e.mergeChanges=d;class v{constructor(n,i,r,o){this.change=n,this.previous=i,this.currentConfiguraiton=r,this.currentWorkspace=o,this._previousConfiguration=void 0;const c=new Set;n.keys.forEach(h=>c.add(h)),n.overrides.forEach(([,h])=>h.forEach(C=>c.add(C))),this.affectedKeys=[...c.values()];const a=new b;this.affectedKeys.forEach(h=>a.setValue(h,{})),this.affectedKeysTree=a.contents}get previousConfiguration(){return!this._previousConfiguration&&this.previous&&(this._previousConfiguration=l.parse(this.previous.data)),this._previousConfiguration}affectsConfiguration(n,i){if(this.doesAffectedKeysTreeContains(this.affectedKeysTree,n)){if(i){const r=this.previousConfiguration?this.previousConfiguration.getValue(n,i,this.previous?.workspace):void 0,o=this.currentConfiguraiton.getValue(n,i,this.currentWorkspace);return!I.equals(r,o)}return!0}return!1}doesAffectedKeysTreeContains(n,i){let r=(0,m.toValuesTree)({[i]:!0},()=>{}),o;for(;typeof r=="object"&&(o=Object.keys(r)[0]);){if(n=n[o],!n)return!1;r=r[o]}return!0}}e.ConfigurationChangeEvent=v;function f(t,n){const{added:i,removed:r,updated:o}=s(n?.rawConfiguration,t?.rawConfiguration),c=[],a=t?.getAllOverrideIdentifiers()||[],h=n?.getAllOverrideIdentifiers()||[];if(n){const C=h.filter(M=>!a.includes(M));for(const M of C)c.push([M,n.getKeysForOverrideIdentifier(M)])}if(t){const C=a.filter(M=>!h.includes(M));for(const M of C)c.push([M,t.getKeysForOverrideIdentifier(M)])}if(n&&t){for(const C of a)if(h.includes(C)){const M=s({contents:t.getOverrideValue(void 0,C)||{},keys:t.getKeysForOverrideIdentifier(C)},{contents:n.getOverrideValue(void 0,C)||{},keys:n.getKeysForOverrideIdentifier(C)});c.push([C,[...M.added,...M.removed,...M.updated]])}}return{added:i,removed:r,updated:o,overrides:c}}function s(t,n){const i=t?n?t.keys.filter(c=>n.keys.indexOf(c)===-1):[...t.keys]:[],r=n?t?n.keys.filter(c=>t.keys.indexOf(c)===-1):[...n.keys]:[],o=[];if(t&&n){for(const c of n.keys)if(t.keys.indexOf(c)!==-1){const a=(0,m.getConfigurationValue)(n.contents,c),h=(0,m.getConfigurationValue)(t.contents,c);I.equals(a,h)||o.push(c)}}return{added:i,removed:r,updated:o}}}),define(J[122],Y([0,1,19,4,2,29,5,21,65,40,9,38,35]),function(j,e,O,k,D,L,T,I,g,u,m,S,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PolicyConfiguration=e.NullPolicyConfiguration=e.DefaultConfigurationModel=e.DefaultConfiguration=void 0;class b extends D.Disposable{constructor(){super(...arguments),this._onDidChangeConfiguration=this._register(new k.Emitter),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event}get configurationModel(){return this._configurationModel||(this._configurationModel=new y(this.getConfigurationDefaultOverrides())),this._configurationModel}async initialize(){return this._configurationModel=void 0,this._register(p.Registry.as(u.Extensions.Configuration).onDidUpdateConfiguration(({properties:d,defaultsOverrides:v})=>this.onDidUpdateConfiguration(d,v))),this.configurationModel}reload(){return this._configurationModel=void 0,this.configurationModel}onDidUpdateConfiguration(d,v){this._configurationModel=void 0,this._onDidChangeConfiguration.fire({defaults:this.configurationModel,properties:d})}getConfigurationDefaultOverrides(){return{}}}e.DefaultConfiguration=b;class y extends g.ConfigurationModel{constructor(d={}){const v=p.Registry.as(u.Extensions.Configuration).getConfigurationProperties(),f=Object.keys(v),s=Object.create(null),t=[];for(const n in v){const i=d[n],r=i!==void 0?i:v[n].default;(0,I.addToValueTree)(s,n,r,o=>console.error(`Conflict in default settings: ${o}`))}for(const n of Object.keys(s))u.OVERRIDE_PROPERTY_REGEX.test(n)&&t.push({identifiers:(0,u.overrideIdentifiersFromKey)(n),keys:Object.keys(s[n]),contents:(0,I.toValuesTree)(s[n],i=>console.error(`Conflict in default settings file: ${i}`))});super(s,f,t)}}e.DefaultConfigurationModel=y;class w{constructor(){this.onDidChangeConfiguration=k.Event.None,this.configurationModel=new g.ConfigurationModel}async initialize(){return this.configurationModel}}e.NullPolicyConfiguration=w;let E=class extends D.Disposable{get configurationModel(){return this._configurationModel}constructor(d,v,f){super(),this.defaultConfiguration=d,this.policyService=v,this.logService=f,this._onDidChangeConfiguration=this._register(new k.Emitter),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._configurationModel=new g.ConfigurationModel}async initialize(){return this.update(await this.updatePolicyDefinitions(this.defaultConfiguration.configurationModel.keys),!1),this._register(this.policyService.onDidChange(d=>this.onDidChangePolicies(d))),this._register(this.defaultConfiguration.onDidChangeConfiguration(async({properties:d})=>this.update(await this.updatePolicyDefinitions(d),!0))),this._configurationModel}async updatePolicyDefinitions(d){const v={},f=[],s=p.Registry.as(u.Extensions.Configuration).getConfigurationProperties();for(const t of d){const n=s[t];if(!n){f.push(t);continue}if(n.policy){if(n.type!=="string"&&n.type!=="number"){this.logService.warn(`Policy ${n.policy.name} has unsupported type ${n.type}`);continue}f.push(t),v[n.policy.name]={type:n.type}}}return(0,T.isEmptyObject)(v)||await this.policyService.updatePolicyDefinitions(v),f}onDidChangePolicies(d){const v=p.Registry.as(u.Extensions.Configuration).getPolicyConfigurations(),f=(0,O.coalesce)(d.map(s=>v.get(s)));this.update(f,!0)}update(d,v){const f=p.Registry.as(u.Extensions.Configuration).getConfigurationProperties(),s=[],t=this._configurationModel.isEmpty();for(const n of d){const i=f[n]?.policy?.name;if(i){const r=this.policyService.getPolicyValue(i);(t?r!==void 0:!(0,L.equals)(this._configurationModel.getValue(n),r))&&s.push([n,r])}else this._configurationModel.getValue(n)!==void 0&&s.push([n,void 0])}if(s.length){const n=this._configurationModel;this._configurationModel=new g.ConfigurationModel;for(const i of n.keys)this._configurationModel.setValue(i,n.getValue(i));for(const[i,r]of s)r===void 0?this._configurationModel.removeValue(i):this._configurationModel.setValue(i,r);v&&this._onDidChangeConfiguration.fire(this._configurationModel)}}};E=me([Z(1,S.IPolicyService),Z(2,m.ILogService)],E),e.PolicyConfiguration=E}),define(J[123],Y([0,1,3,4,2,17,21,65,122,38]),function(j,e,O,k,D,L,T,I,g,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConfigurationService=void 0;class m extends D.Disposable{constructor(p,b,y,w){super(),this.settingsResource=p,this._onDidChangeConfiguration=this._register(new k.Emitter),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this.defaultConfiguration=this._register(new g.DefaultConfiguration),this.policyConfiguration=y instanceof u.NullPolicyService?new g.NullPolicyConfiguration:this._register(new g.PolicyConfiguration(this.defaultConfiguration,y,w)),this.userConfiguration=this._register(new I.UserSettings(this.settingsResource,void 0,L.extUriBiasedIgnorePathCase,b)),this.configuration=new I.Configuration(this.defaultConfiguration.configurationModel,this.policyConfiguration.configurationModel,new I.ConfigurationModel,new I.ConfigurationModel),this.reloadConfigurationScheduler=this._register(new O.RunOnceScheduler(()=>this.reloadConfiguration(),50)),this._register(this.defaultConfiguration.onDidChangeConfiguration(({defaults:E,properties:l})=>this.onDidDefaultConfigurationChange(E,l))),this._register(this.policyConfiguration.onDidChangeConfiguration(E=>this.onDidPolicyConfigurationChange(E))),this._register(this.userConfiguration.onDidChange(()=>this.reloadConfigurationScheduler.schedule()))}async initialize(){const[p,b,y]=await Promise.all([this.defaultConfiguration.initialize(),this.policyConfiguration.initialize(),this.userConfiguration.loadConfiguration()]);this.configuration=new I.Configuration(p,b,new I.ConfigurationModel,y)}getConfigurationData(){return this.configuration.toData()}getValue(p,b){const y=typeof p=="string"?p:void 0,w=(0,T.isConfigurationOverrides)(p)?p:(0,T.isConfigurationOverrides)(b)?b:{};return this.configuration.getValue(y,w,void 0)}updateValue(p,b,y,w){return Promise.reject(new Error("not supported"))}inspect(p){return this.configuration.inspect(p,{},void 0)}keys(){return this.configuration.keys(void 0)}async reloadConfiguration(){const p=await this.userConfiguration.loadConfiguration();this.onDidChangeUserConfiguration(p)}onDidChangeUserConfiguration(p){const b=this.configuration.toData(),y=this.configuration.compareAndUpdateLocalUserConfiguration(p);this.trigger(y,b,2)}onDidDefaultConfigurationChange(p,b){const y=this.configuration.toData(),w=this.configuration.compareAndUpdateDefaultConfiguration(p,b);this.trigger(w,y,7)}onDidPolicyConfigurationChange(p){const b=this.configuration.toData(),y=this.configuration.compareAndUpdatePolicyConfiguration(p);this.trigger(y,b,7)}trigger(p,b,y){const w=new I.ConfigurationChangeEvent(p,{data:b},this.configuration);w.source=y,w.sourceConfig=this.getTargetConfiguration(y),this._onDidChangeConfiguration.fire(w)}getTargetConfiguration(p){switch(p){case 7:return this.configuration.defaults.contents;case 2:return this.configuration.localUserConfiguration.contents}return{}}}e.ConfigurationService=m}),define(J[66],Y([0,1,16]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseAuthorityWithOptionalPort=e.parseAuthorityWithPort=e.getRemoteServerRootPath=e.getRemoteName=e.getRemoteAuthority=void 0;function k(u){return u.scheme===O.Schemas.vscodeRemote?u.authority:void 0}e.getRemoteAuthority=k;function D(u){if(!u)return;const m=u.indexOf("+");return m<0?u:u.substr(0,m)}e.getRemoteName=D;function L(u){return`/${u.quality??"oss"}-${u.commit??"dev"}`}e.getRemoteServerRootPath=L;function T(u){const{host:m,port:S}=g(u);if(typeof S>"u")throw new Error("Remote authority doesn't contain a port!");return{host:m,port:S}}e.parseAuthorityWithPort=T;function I(u,m){let{host:S,port:p}=g(u);return typeof p>"u"&&(p=m),{host:S,port:p}}e.parseAuthorityWithOptionalPort=I;function g(u){const m=u.match(/^(\[[0-9a-z:]+\]):(\d+)$/);if(m)return{host:m[1],port:parseInt(m[2],10)};const S=u.match(/^(\[[0-9a-z:]+\])$/);if(S)return{host:S[1],port:void 0};const p=u.match(/(.*):(\d+)$/);return p?{host:p[1],port:parseInt(p[2],10)}:{host:u,port:void 0}}}),define(J[27],Y([0,1,31,8,66]),function(j,e,O,k,D){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IBuiltinExtensionsScannerService=e.isResolverExtension=e.isAuthenticationProviderExtension=e.isLanguagePackExtension=e.isApplicationScopedExtension=e.ExtensionIdentifier=e.TargetPlatform=e.ExtensionType=e.EXTENSION_CATEGORIES=e.isIExtensionIdentifier=e.getWorkspaceSupportTypeMessage=e.ALL_EXTENSION_KINDS=e.UNDEFINED_PUBLISHER=e.BUILTIN_MANIFEST_CACHE_FILE=e.USER_MANIFEST_CACHE_FILE=e.MANIFEST_CACHE_FOLDER=void 0,e.MANIFEST_CACHE_FOLDER="CachedExtensions",e.USER_MANIFEST_CACHE_FILE="user",e.BUILTIN_MANIFEST_CACHE_FILE="builtin",e.UNDEFINED_PUBLISHER="undefined_publisher",e.ALL_EXTENSION_KINDS=["ui","workspace","web"];function L(y){if(typeof y=="object"&&y!==null&&y.supported!==!0)return y.description}e.getWorkspaceSupportTypeMessage=L;function T(y){return y&&typeof y=="object"&&typeof y.id=="string"&&(!y.uuid||typeof y.uuid=="string")}e.isIExtensionIdentifier=T,e.EXTENSION_CATEGORIES=["Azure","Data Science","Debuggers","Extension Packs","Education","Formatters","Keymaps","Language Packs","Linters","Machine Learning","Notebooks","Programming Languages","SCM Providers","Snippets","Testing","Themes","Visualization","Other"];var I;(function(y){y[y.System=0]="System",y[y.User=1]="User"})(I=e.ExtensionType||(e.ExtensionType={}));var g;(function(y){y.WIN32_X64="win32-x64",y.WIN32_IA32="win32-ia32",y.WIN32_ARM64="win32-arm64",y.LINUX_X64="linux-x64",y.LINUX_ARM64="linux-arm64",y.LINUX_ARMHF="linux-armhf",y.ALPINE_X64="alpine-x64",y.ALPINE_ARM64="alpine-arm64",y.DARWIN_X64="darwin-x64",y.DARWIN_ARM64="darwin-arm64",y.WEB="web",y.UNIVERSAL="universal",y.UNKNOWN="unknown",y.UNDEFINED="undefined"})(g=e.TargetPlatform||(e.TargetPlatform={}));class u{constructor(w){this.value=w,this._lower=w.toLowerCase()}static equals(w,E){if(typeof w>"u"||w===null)return typeof E>"u"||E===null;if(typeof E>"u"||E===null)return!1;if(typeof w=="string"||typeof E=="string"){const l=typeof w=="string"?w:w.value,d=typeof E=="string"?E:E.value;return O.equalsIgnoreCase(l,d)}return w._lower===E._lower}static toKey(w){return typeof w=="string"?w.toLowerCase():w._lower}}e.ExtensionIdentifier=u;function m(y){return S(y)}e.isApplicationScopedExtension=m;function S(y){return y.contributes&&y.contributes.localizations?y.contributes.localizations.length>0:!1}e.isLanguagePackExtension=S;function p(y){return y.contributes&&y.contributes.authentication?y.contributes.authentication.length>0:!1}e.isAuthenticationProviderExtension=p;function b(y,w){if(w){const E=`onResolveRemoteAuthority:${(0,D.getRemoteName)(w)}`;return y.activationEvents?.indexOf(E)!==-1}return!1}e.isResolverExtension=b,e.IBuiltinExtensionsScannerService=(0,k.createDecorator)("IBuiltinExtensionsScannerService")}),define(J[24],Y([0,1,31,23,27,12,11,10,37]),function(j,e,O,k,D,L,T,I,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.computeTargetPlatform=e.isAlpineLinux=e.getExtensionDependencies=e.BetterMergeId=e.getGalleryExtensionTelemetryData=e.getLocalExtensionTelemetryData=e.groupByExtension=e.getGalleryExtensionId=e.adoptToGalleryExtensionId=e.getExtensionId=e.getIdAndVersion=e.ExtensionKey=e.areSameExtensions=void 0;function u(n,i){return n.uuid&&i.uuid?n.uuid===i.uuid:n.id===i.id?!0:(0,O.compareIgnoreCase)(n.id,i.id)===0}e.areSameExtensions=u;const m=/^([^.]+\..+)-(\d+\.\d+\.\d+)(-(.+))?$/;class S{static create(i){const r=i.manifest?i.manifest.version:i.version,o=i.manifest?i.targetPlatform:i.properties.targetPlatform;return new S(i.identifier,r,o)}static parse(i){const r=m.exec(i);return r&&r[1]&&r[2]?new S({id:r[1]},r[2],r[4]||void 0):null}constructor(i,r,o="undefined"){this.version=r,this.targetPlatform=o,this.id=i.id}toString(){return`${this.id}-${this.version}${this.targetPlatform!=="undefined"?`-${this.targetPlatform}`:""}`}equals(i){return i instanceof S?u(this,i)&&this.version===i.version&&this.targetPlatform===i.targetPlatform:!1}}e.ExtensionKey=S;const p=/^([^.]+\..+)@((prerelease)|(\d+\.\d+\.\d+(-.*)?))$/;function b(n){const i=p.exec(n);return i&&i[1]?[w(i[1]),i[2]]:[w(n),void 0]}e.getIdAndVersion=b;function y(n,i){return`${n}.${i}`}e.getExtensionId=y;function w(n){return n.toLocaleLowerCase()}e.adoptToGalleryExtensionId=w;function E(n,i){return w(y(n,i))}e.getGalleryExtensionId=E;function l(n,i){const r=[],o=c=>{for(const a of r)if(a.some(h=>u(i(h),i(c))))return a;return null};for(const c of n){const a=o(c);a?a.push(c):r.push([c])}return r}e.groupByExtension=l;function d(n){return{id:n.identifier.id,name:n.manifest.name,galleryId:null,publisherId:n.publisherId,publisherName:n.manifest.publisher,publisherDisplayName:n.publisherDisplayName,dependencies:n.manifest.extensionDependencies&&n.manifest.extensionDependencies.length>0}}e.getLocalExtensionTelemetryData=d;function v(n){return{id:n.identifier.id,name:n.name,galleryId:n.identifier.uuid,publisherId:n.publisherId,publisherName:n.publisher,publisherDisplayName:n.publisherDisplayName,isPreReleaseVersion:n.properties.isPreReleaseVersion,dependencies:!!(n.properties.dependencies&&n.properties.dependencies.length>0),isSigned:n.isSigned,...n.telemetryData}}e.getGalleryExtensionTelemetryData=v,e.BetterMergeId=new D.ExtensionIdentifier("pprice.better-merge");function f(n,i){const r=[],o=i.manifest.extensionDependencies?.slice(0)??[];for(;o.length;){const c=o.shift();if(c&&r.every(a=>!u(a.identifier,{id:c}))){const a=n.filter(h=>u(h.identifier,{id:c}));a.length===1&&(r.push(a[0]),o.push(...a[0].manifest.extensionDependencies?.slice(0)??[]))}}return r}e.getExtensionDependencies=f;async function s(n,i){if(!L.isLinux)return!1;let r;try{r=(await n.readFile(T.URI.file("/etc/os-release"))).value.toString()}catch{try{r=(await n.readFile(T.URI.file("/usr/lib/os-release"))).value.toString()}catch(c){i.debug("Error while getting the os-release file.",(0,I.getErrorMessage)(c))}}return!!r&&(r.match(/^ID=([^\u001b\r\n]*)/m)||[])[1]==="alpine"}e.isAlpineLinux=s;async function t(n,i){const r=await s(n,i),o=(0,k.getTargetPlatform)(r?"alpine":L.platform,g.arch);return i.debug("ComputeTargetPlatform:",o),o}e.computeTargetPlatform=t}),define(J[124],Y([0,1,22,10,16,17,39,11,88,23,24,27]),function(j,e,O,k,D,L,T,I,g,u,m,S){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExtensionManagementCLI=void 0;const p=E=>(0,g.localize)(0,null,E),b=(0,g.localize)(1,null,"ms-dotnettools.csharp");function y(E,l){return l?`${E.publisher}.${E.name}@${E.version}`:`${E.publisher}.${E.name}`}let w=class{constructor(l,d){this.extensionManagementService=l,this.extensionGalleryService=d}get location(){}async listExtensions(l,d,v,f=console){let s=await this.extensionManagementService.getInstalled(1,v);const t=S.EXTENSION_CATEGORIES.map(i=>i.toLowerCase());if(d&&d!==""){if(t.indexOf(d.toLowerCase())<0){f.log("Invalid category please enter a valid category. To list valid categories run --category without a category specified");return}s=s.filter(i=>i.manifest.categories?i.manifest.categories.map(o=>o.toLowerCase()).indexOf(d.toLowerCase())>-1:!1)}else if(d===""){f.log("Possible Categories: "),t.forEach(i=>{f.log(i)});return}this.location&&f.log((0,g.localize)(2,null,this.location)),s=s.sort((i,r)=>i.identifier.id.localeCompare(r.identifier.id));let n;for(const i of s)n!==i.identifier.id&&(n=i.identifier.id,f.log(y(i.manifest,l)))}async installExtensions(l,d,v,f,s=console){const t=[],n=[];l.length&&s.log(this.location?(0,g.localize)(3,null,this.location):(0,g.localize)(4,null));const i=await this.extensionManagementService.getInstalled(1,v.profileLocation),r=(h,C)=>{const M=i.find(_=>(0,m.areSameExtensions)(_.identifier,{id:h}));if(M){if(!f&&(!C||C==="prerelease"&&M.preRelease))return s.log((0,g.localize)(5,null,h,M.manifest.version,h)),!1;if(C&&M.manifest.version===C)return s.log((0,g.localize)(6,null,`${h}@${C}`)),!1}return!0},o=(h,C,M)=>{a.push({id:h,version:C!=="prerelease"?C:void 0,installOptions:{...v,isBuiltin:M,installPreReleaseVersion:C==="prerelease"||v.installPreReleaseVersion}})},c=[],a=[];for(const h of l)if(h instanceof I.URI)c.push(h);else{const[C,M]=(0,m.getIdAndVersion)(h);r(C,M)&&o(C,M,!1)}for(const h of d){const[C,M]=(0,m.getIdAndVersion)(h);r(C,M)&&o(C,M,!0)}if(c.length&&await Promise.all(c.map(async h=>{try{const C=await this.installVSIX(h,{...v,isBuiltin:!1},f,s);C&&n.push(C)}catch(C){s.error(C.message||C.stack||C),t.push(h.toString())}})),a.length){const h=await this.getGalleryExtensions(a);await Promise.all(a.map(async C=>{const M=h.get(C.id.toLowerCase());if(M)try{const _=await this.installFromGallery(C,M,i,f,s);_&&n.push(_)}catch(_){s.error(_.message||_.stack||_),t.push(C.id)}else s.error(`${p(C.version?`${C.id}@${C.version}`:C.id)}
${b}`),t.push(C.id)}))}if(t.length)throw new Error((0,g.localize)(7,null,t.join(", ")))}async installVSIX(l,d,v,f){const s=await this.extensionManagementService.getManifest(l);if(!s)throw new Error("Invalid vsix");if(await this.validateVSIX(s,v,d.profileLocation,f))try{return await this.extensionManagementService.install(l,d),f.log((0,g.localize)(8,null,(0,L.basename)(l))),s}catch(n){if((0,k.isCancellationError)(n))return f.log((0,g.localize)(9,null,(0,L.basename)(l))),null;throw n}return null}async getGalleryExtensions(l){const d=new Map,v=l.some(s=>s.installOptions.installPreReleaseVersion),f=await this.extensionGalleryService.getExtensions(l.map(s=>({...s,preRelease:v})),O.CancellationToken.None);for(const s of f)d.set(s.identifier.id.toLowerCase(),s);return d}async installFromGallery({id:l,version:d,installOptions:v},f,s,t,n){const i=await this.extensionGalleryService.getManifest(f,O.CancellationToken.None);if(i&&!this.validateExtensionKind(i,n))return null;const r=s.find(o=>(0,m.areSameExtensions)(o.identifier,f.identifier));if(r){if(f.version===r.manifest.version)return n.log((0,g.localize)(10,null,d?`${l}@${d}`:l)),null;n.log((0,g.localize)(11,null,l,f.version))}try{v.isBuiltin?n.log(d?(0,g.localize)(12,null,l,d):(0,g.localize)(13,null,l)):n.log(d?(0,g.localize)(14,null,l,d):(0,g.localize)(15,null,l));const o=await this.extensionManagementService.installFromGallery(f,{...v,installGivenVersion:!!d});return n.log((0,g.localize)(16,null,l,o.manifest.version)),i}catch(o){if((0,k.isCancellationError)(o))return n.log((0,g.localize)(17,null,l)),null;throw o}}validateExtensionKind(l,d){return!0}async validateVSIX(l,d,v,f){const s={id:(0,m.getGalleryExtensionId)(l.publisher,l.name)},n=(await this.extensionManagementService.getInstalled(1,v)).find(i=>(0,m.areSameExtensions)(s,i.identifier)&&(0,T.gt)(i.manifest.version,l.version));return n&&!d?(f.log((0,g.localize)(18,null,n.identifier.id,n.manifest.version,l.version)),!1):this.validateExtensionKind(l,f)}async uninstallExtensions(l,d,v,f=console){const s=async n=>{if(n instanceof I.URI){const i=await this.extensionManagementService.getManifest(n);return y(i)}return n},t=[];for(const n of l){const i=await s(n),o=(await this.extensionManagementService.getInstalled(void 0,v)).filter(c=>(0,m.areSameExtensions)(c.identifier,{id:i}));if(!o.length)throw new Error(`${this.notInstalled(i)}
${b}`);if(o.some(c=>c.type===0)){f.log((0,g.localize)(19,null,i));return}if(!d&&o.some(c=>c.isBuiltin)){f.log((0,g.localize)(20,null,i));return}f.log((0,g.localize)(21,null,i));for(const c of o)await this.extensionManagementService.uninstall(c,{profileLocation:v}),t.push(c);this.location?f.log((0,g.localize)(22,null,i,this.location)):f.log((0,g.localize)(23,null,i))}}async locateExtension(l,d=console){const v=await this.extensionManagementService.getInstalled();l.forEach(f=>{v.forEach(s=>{if(s.identifier.id===f&&s.location.scheme===D.Schemas.file){d.log(s.location.fsPath);return}})})}notInstalled(l){return this.location?(0,g.localize)(24,null,l,this.location):(0,g.localize)(25,null,l)}};w=me([Z(0,u.IExtensionManagementService),Z(1,u.IExtensionGalleryService)],w),e.ExtensionManagementCLI=w}),define(J[125],Y([0,1,3,10,2,16,12,17,39,5,30,20,21,18,23,24,59,13,9,26]),function(j,e,O,k,D,L,T,I,g,u,m,S,p,b,y,w,E,l,d,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExtensionsDownloader=void 0;let f=class We extends D.Disposable{constructor(t,n,i,r,o,c,a,h){super(),this.targetPlatform=t,this.fileService=i,this.extensionGalleryService=r,this.configurationService=o,this.productService=c,this.extensionSignatureVerificationService=a,this.logService=h,this.extensionsDownloadDir=n.extensionsDownloadLocation,this.cache=20,this.cleanUpPromise=this.cleanUp()}async download(t,n){await this.cleanUpPromise;const i=(0,I.joinPath)(this.extensionsDownloadDir,this.getName(t));try{await this.downloadFile(t,i,o=>this.extensionGalleryService.download(t,o,n))}catch(o){throw new y.ExtensionManagementError(o.message,y.ExtensionManagementErrorCode.Download)}let r=!1;if(await this.checkForVerification(t)){const o=await this.downloadSignatureArchive(t);try{r=await this.extensionSignatureVerificationService.verify(i.fsPath,o.fsPath),this.logService.info(`Verified extension: ${t.identifier.id}`,r)}catch(c){throw await this.delete(o),await this.delete(i),new y.ExtensionManagementError(c.code,y.ExtensionManagementErrorCode.Signature)}}return{location:i,verified:r}}async checkForVerification(t){if(!t.isSigned||await this.targetPlatform==="linux-armhf")return!1;const i=this.configurationService.getValue("extensions.verifySignature");return(0,u.isBoolean)(i)?i:this.productService.quality!=="stable"}async downloadSignatureArchive(t){await this.cleanUpPromise;const n=(0,I.joinPath)(this.extensionsDownloadDir,`${this.getName(t)}${We.SignatureArchiveExtension}`);return await this.downloadFile(t,n,i=>this.extensionGalleryService.downloadSignatureArchive(t,i)),n}async downloadFile(t,n,i){if(await this.fileService.exists(n))return;if(n.scheme!==L.Schemas.file){await i(n);return}const r=(0,I.joinPath)(this.extensionsDownloadDir,`.${(0,m.generateUuid)()}`);await this.fileService.exists(r)||await i(r);try{await this.rename(r,n,Date.now()+2*60*1e3)}catch(o){try{await this.fileService.del(r)}catch{}if(o.code==="ENOTEMPTY")this.logService.info("Rename failed because the file was downloaded by another source. So ignoring renaming.",t.identifier.id,n.path);else throw this.logService.info(`Rename failed because of ${(0,k.getErrorMessage)(o)}. Deleted the file from downloaded location`,r.path),o}}async delete(t){await this.cleanUpPromise,await this.fileService.del(t)}async rename(t,n,i){try{await S.Promises.rename(t.fsPath,n.fsPath)}catch(r){if(T.isWindows&&r&&r.code==="EPERM"&&Date.now()<i)return this.logService.info(`Failed renaming ${t} to ${n} with 'EPERM' error. Trying again...`),this.rename(t,n,i);throw r}}async cleanUp(){try{if(!await this.fileService.exists(this.extensionsDownloadDir)){this.logService.trace("Extension VSIX downloads cache dir does not exist");return}const t=await this.fileService.resolve(this.extensionsDownloadDir,{resolveMetadata:!0});if(t.children){const n=[],i=[],r=[];for(const a of t.children)if(a.name.endsWith(We.SignatureArchiveExtension))r.push(a.resource);else{const h=w.ExtensionKey.parse(a.name);h&&i.push([h,a])}const o=(0,w.groupByExtension)(i,([a])=>a),c=[];for(const a of o)a.sort((h,C)=>g.rcompare(h[0].version,C[0].version)),n.push(...a.slice(1).map(h=>h[1].resource)),c.push(a[0][1]);c.sort((a,h)=>a.mtime-h.mtime),n.push(...c.slice(0,Math.max(0,c.length-this.cache)).map(a=>a.resource)),n.push(...r),await O.Promises.settled(n.map(a=>(this.logService.trace("Deleting from cache",a.path),this.fileService.del(a))))}}catch(t){this.logService.error(t)}}getName(t){return this.cache?w.ExtensionKey.create(t).toString().toLowerCase():(0,m.generateUuid)()}};f.SignatureArchiveExtension=".sigzip",f=me([Z(1,b.INativeEnvironmentService),Z(2,l.IFileService),Z(3,y.IExtensionGalleryService),Z(4,p.IConfigurationService),Z(5,v.IProductService),Z(6,E.IExtensionSignatureVerificationService),Z(7,d.ILogService)],f),e.ExtensionsDownloader=f}),define(J[126],Y([0,1,2,14,20,27]),function(j,e,O,k,D,L){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExtensionsManifestCache=void 0;class T extends O.Disposable{constructor(g,u){super(),this.environmentService=g,this.extensionsManifestCache=(0,k.join)(this.environmentService.userDataPath,L.MANIFEST_CACHE_FOLDER,L.USER_MANIFEST_CACHE_FILE),this._register(u.onDidInstallExtensions(m=>this.onDidInstallExtensions(m))),this._register(u.onDidUninstallExtension(m=>this.onDidUnInstallExtension(m)))}onDidInstallExtensions(g){g.some(u=>!!u.local)&&this.invalidate()}onDidUnInstallExtension(g){g.error||this.invalidate()}invalidate(){D.Promises.rm(this.extensionsManifestCache,D.RimRafMode.MOVE).then(()=>{},()=>{})}}e.ExtensionsManifestCache=T}),define(J[127],Y([0,1,4,2,34,24,27]),function(j,e,O,k,D,L,T){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExtensionsWatcher=void 0;class I extends k.Disposable{constructor(u,m,S,p,b,y,w){super(),this.extensionManagementService=u,this.extensionsScannerService=m,this.userDataProfilesService=S,this.extensionsProfileScannerService=p,this.uriIdentityService=b,this.fileService=y,this.logService=w,this._onDidChangeExtensionsByAnotherSource=this._register(new O.Emitter),this.onDidChangeExtensionsByAnotherSource=this._onDidChangeExtensionsByAnotherSource.event,this.allExtensions=new Map,this.extensionsProfileWatchDisposables=this._register(new k.DisposableMap),this.initialize().then(null,E=>w.error(E))}async initialize(){await this.extensionsScannerService.initializeDefaultProfileExtensions(),await this.onDidChangeProfiles(this.userDataProfilesService.profiles,[]),this.registerListeners(),await this.uninstallExtensionsNotInProfiles()}registerListeners(){this._register(this.userDataProfilesService.onDidChangeProfiles(u=>this.onDidChangeProfiles(u.added,u.removed))),this._register(this.extensionsProfileScannerService.onAddExtensions(u=>this.onAddExtensions(u))),this._register(this.extensionsProfileScannerService.onDidAddExtensions(u=>this.onDidAddExtensions(u))),this._register(this.extensionsProfileScannerService.onRemoveExtensions(u=>this.onRemoveExtensions(u))),this._register(this.extensionsProfileScannerService.onDidRemoveExtensions(u=>this.onDidRemoveExtensions(u))),this._register(this.fileService.onDidFilesChange(u=>this.onDidFilesChange(u)))}async onDidChangeProfiles(u,m){try{await Promise.all(m.map(S=>(this.extensionsProfileWatchDisposables.deleteAndDispose(S.id),this.removeExtensionsFromProfile(S.extensionsResource)))),u.length&&await Promise.all(u.map(S=>(this.extensionsProfileWatchDisposables.set(S.id,(0,k.combinedDisposable)(this.fileService.watch(this.uriIdentityService.extUri.dirname(S.extensionsResource)),this.fileService.watch(S.extensionsResource))),this.populateExtensionsFromProfile(S.extensionsResource))))}catch(S){throw this.logService.error(S),S}}async onAddExtensions(u){for(const m of u.extensions)this.addExtensionWithKey(this.getKey(m.identifier,m.version),u.profileLocation)}async onDidAddExtensions(u){for(const m of u.extensions){const S=this.getKey(m.identifier,m.version);u.error?this.removeExtensionWithKey(S,u.profileLocation):this.addExtensionWithKey(S,u.profileLocation)}}async onRemoveExtensions(u){for(const m of u.extensions)this.removeExtensionWithKey(this.getKey(m.identifier,m.version),u.profileLocation)}async onDidRemoveExtensions(u){let m=!1;for(const S of u.extensions){const p=this.getKey(S.identifier,S.version);u.error?this.addExtensionWithKey(p,u.profileLocation):(this.removeExtensionWithKey(p,u.profileLocation),m=m||!this.allExtensions.has(p))}m&&await this.uninstallExtensionsNotInProfiles()}onDidFilesChange(u){for(const m of this.userDataProfilesService.profiles)u.contains(m.extensionsResource,0,1)&&this.onDidExtensionsProfileChange(m.extensionsResource)}async onDidExtensionsProfileChange(u){const m=[],S=[],p=await this.extensionsProfileScannerService.scanProfileExtensions(u),b=new Set,y=new Set;for(const[w,E]of this.allExtensions)E.has(u)&&y.add(w);for(const w of p){const E=this.getKey(w.identifier,w.version);b.add(E),y.has(E)||(m.push(w.identifier),this.addExtensionWithKey(E,u))}for(const w of y)if(!b.has(w)){const E=this.fromKey(w);E&&(S.push(E.identifier),this.removeExtensionWithKey(w,u))}(m.length||S.length)&&this._onDidChangeExtensionsByAnotherSource.fire({added:m.length?{extensions:m,profileLocation:u}:void 0,removed:S.length?{extensions:S,profileLocation:u}:void 0})}async populateExtensionsFromProfile(u){const m=await this.extensionsProfileScannerService.scanProfileExtensions(u);for(const S of m)this.addExtensionWithKey(this.getKey(S.identifier,S.version),u)}async removeExtensionsFromProfile(u){for(const m of[...this.allExtensions.keys()])this.removeExtensionWithKey(m,u);await this.uninstallExtensionsNotInProfiles()}async uninstallExtensionsNotInProfiles(){const m=(await this.extensionManagementService.getAllUserInstalled()).filter(S=>S.installedTimestamp&&!this.allExtensions.has(this.getKey(S.identifier,S.manifest.version)));m.length&&await this.extensionManagementService.markAsUninstalled(...m)}addExtensionWithKey(u,m){let S=this.allExtensions.get(u);S||this.allExtensions.set(u,S=new D.ResourceSet(p=>this.uriIdentityService.extUri.getComparisonKey(p))),S.add(m)}removeExtensionWithKey(u,m){const S=this.allExtensions.get(u);S&&S.delete(m),S?.size||this.allExtensions.delete(u)}getKey(u,m){return`${T.ExtensionIdentifier.toKey(u.id)}@${m}`}fromKey(u){const[m,S]=(0,L.getIdAndVersion)(u);return S?{identifier:{id:m},version:S}:void 0}}e.ExtensionsWatcher=I}),define(J[128],Y([0,1,159,19,3,2,16,14,20,18,23,24,9,63,12,11]),function(j,e,O,k,D,L,T,I,g,u,m,S,p,b,y,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NativeLanguagePackService=void 0;let E=class extends b.LanguagePackBaseService{constructor(f,s,t,n){super(t),this.extensionManagementService=f,this.logService=n,this.cache=this._register(new l(s,n)),this.extensionManagementService.registerParticipant({postInstall:async i=>this.postInstallExtension(i),postUninstall:async i=>this.postUninstallExtension(i)})}async getBuiltInExtensionTranslationsUri(f){const t=(await this.cache.getLanguagePacks())[y.Language.value()];if(!t){this.logService.warn(`No language pack found for ${y.Language.value()}`);return}const n=t.translations[f];return n?w.URI.file(n):void 0}async getInstalledLanguages(){const f=await this.cache.getLanguagePacks(),s=Object.keys(f).map(t=>{const n=f[t];return{...this.createQuickPickItem(t,n.label),extensionId:n.extensions[0].extensionIdentifier.id}});return s.push({...this.createQuickPickItem("en","English"),extensionId:"default"}),s.sort((t,n)=>t.label.localeCompare(n.label)),s}async postInstallExtension(f){f&&f.manifest&&f.manifest.contributes&&f.manifest.contributes.localizations&&f.manifest.contributes.localizations.length&&(this.logService.info("Adding language packs from the extension",f.identifier.id),await this.update())}async postUninstallExtension(f){const s=await this.cache.getLanguagePacks();Object.keys(s).some(t=>s[t]&&s[t].extensions.some(n=>(0,S.areSameExtensions)(n.extensionIdentifier,f.identifier)))&&(this.logService.info("Removing language packs from the extension",f.identifier.id),await this.update())}async update(){const[f,s]=await Promise.all([this.cache.getLanguagePacks(),this.extensionManagementService.getInstalled()]),t=await this.cache.update(s);return!(0,k.equals)(Object.keys(f),Object.keys(t))}};E=me([Z(0,m.IExtensionManagementService),Z(1,u.INativeEnvironmentService),Z(2,m.IExtensionGalleryService),Z(3,p.ILogService)],E),e.NativeLanguagePackService=E;let l=class extends L.Disposable{constructor(f,s){super(),this.logService=s,this.languagePacks={},this.languagePacksFilePath=(0,I.join)(f.userDataPath,"languagepacks.json"),this.languagePacksFileLimiter=new D.Queue}getLanguagePacks(){return this.languagePacksFileLimiter.size||!this.initializedCache?this.withLanguagePacks().then(()=>this.languagePacks):Promise.resolve(this.languagePacks)}update(f){return this.withLanguagePacks(s=>{Object.keys(s).forEach(t=>delete s[t]),this.createLanguagePacksFromExtensions(s,...f)}).then(()=>this.languagePacks)}createLanguagePacksFromExtensions(f,...s){for(const t of s)t&&t.manifest&&t.manifest.contributes&&t.manifest.contributes.localizations&&t.manifest.contributes.localizations.length&&this.createLanguagePacksFromExtension(f,t);Object.keys(f).forEach(t=>this.updateHash(f[t]))}createLanguagePacksFromExtension(f,s){const t=s.identifier,n=s.manifest.contributes&&s.manifest.contributes.localizations?s.manifest.contributes.localizations:[];for(const i of n)if(s.location.scheme===T.Schemas.file&&d(i)){let r=f[i.languageId];r||(r={hash:"",extensions:[],translations:{},label:i.localizedLanguageName??i.languageName},f[i.languageId]=r);const o=r.extensions.filter(c=>(0,S.areSameExtensions)(c.extensionIdentifier,t))[0];o?o.version=s.manifest.version:r.extensions.push({extensionIdentifier:t,version:s.manifest.version});for(const c of i.translations)r.translations[c.id]=(0,I.join)(s.location.fsPath,c.path)}}updateHash(f){if(f){const s=(0,O.createHash)("md5");for(const t of f.extensions)s.update(t.extensionIdentifier.uuid||t.extensionIdentifier.id).update(t.version);f.hash=s.digest("hex")}}withLanguagePacks(f=()=>null){return this.languagePacksFileLimiter.queue(()=>{let s=null;return g.Promises.readFile(this.languagePacksFilePath,"utf8").then(void 0,t=>t.code==="ENOENT"?Promise.resolve("{}"):Promise.reject(t)).then(t=>{try{return JSON.parse(t)}catch{return{}}}).then(t=>(s=f(t),t)).then(t=>{for(const i of Object.keys(t))t[i]||delete t[i];this.languagePacks=t,this.initializedCache=!0;const n=JSON.stringify(this.languagePacks);return this.logService.debug("Writing language packs",n),g.Promises.writeFile(this.languagePacksFilePath,n)}).then(()=>s,t=>this.logService.error(t))})}};l=me([Z(0,u.INativeEnvironmentService),Z(1,p.ILogService)],l);function d(v){if(typeof v.languageId!="string"||!Array.isArray(v.translations)||v.translations.length===0)return!1;for(const f of v.translations)if(typeof f.id!="string"||typeof f.path!="string")return!1;return!(v.languageName&&typeof v.languageName!="string"||v.localizedLanguageName&&typeof v.localizedLanguageName!="string")}}),define(J[47],Y([0,1,15,98,40,8,35]),function(j,e,O,k,D,L,T){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.updateProxyConfigurationsScope=e.asJson=e.asTextOrError=e.asText=e.isSuccess=e.IRequestService=void 0,e.IRequestService=(0,L.createDecorator)("requestService");function I(w){return w.res.statusCode&&w.res.statusCode>=200&&w.res.statusCode<300||w.res.statusCode===1223}e.isSuccess=I;function g(w){return w.res.statusCode===204}async function u(w){return g(w)?null:(await(0,O.streamToBuffer)(w.stream)).toString()}e.asText=u;async function m(w){if(!I(w))throw new Error("Server returned "+w.res.statusCode);return u(w)}e.asTextOrError=m;async function S(w){if(!I(w))throw new Error("Server returned "+w.res.statusCode);if(g(w))return null;const l=(await(0,O.streamToBuffer)(w.stream)).toString();try{return JSON.parse(l)}catch(d){throw d.message+=`:
`+l,d}}e.asJson=S;function p(w){y(w)}e.updateProxyConfigurationsScope=p;let b;function y(w){const E=T.Registry.as(D.Extensions.Configuration),l=b;b={id:"http",order:15,title:(0,k.localize)(0,null),type:"object",scope:w,properties:{"http.proxy":{type:"string",pattern:"^(https?|socks5?)://([^:]*(:[^@]*)?@)?([^:]+|\\[[:0-9a-fA-F]+\\])(:\\d+)?/?$|^$",markdownDescription:(0,k.localize)(1,null),restricted:!0},"http.proxyStrictSSL":{type:"boolean",default:!0,description:(0,k.localize)(2,null),restricted:!0},"http.proxyAuthorization":{type:["null","string"],default:null,markdownDescription:(0,k.localize)(3,null),restricted:!0},"http.proxySupport":{type:"string",enum:["off","on","fallback","override"],enumDescriptions:[(0,k.localize)(4,null),(0,k.localize)(5,null),(0,k.localize)(6,null),(0,k.localize)(7,null)],default:"override",description:(0,k.localize)(8,null),restricted:!0},"http.systemCertificates":{type:"boolean",default:!0,description:(0,k.localize)(9,null),restricted:!0}}},E.updateConfigurations({add:[b],remove:l?[l]:[]})}y(2)}),define(J[129],Y([0,1,22,16,13,47]),function(j,e,O,k,D,L){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DownloadService=void 0;let T=class{constructor(g,u){this.requestService=g,this.fileService=u}async download(g,u,m=O.CancellationToken.None){if(g.scheme===k.Schemas.file||g.scheme===k.Schemas.vscodeRemote){await this.fileService.copy(g,u);return}const S={type:"GET",url:g.toString(!0)},p=await this.requestService.request(S,m);if(p.res.statusCode===200)await this.fileService.writeFile(u,p.stream);else{const b=await(0,L.asTextOrError)(p);throw new Error(`Expected 200, got back ${p.res.statusCode} instead.

${b}`)}}};T=me([Z(0,L.IRequestService),Z(1,D.IFileService)],T),e.DownloadService=T}),define(J[130],Y([0,1,131,5]),function(j,e,O,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getProxyAgent=void 0;function D(T,I){return T.protocol==="http:"?I.HTTP_PROXY||I.http_proxy||null:T.protocol==="https:"&&(I.HTTPS_PROXY||I.https_proxy||I.HTTP_PROXY||I.http_proxy)||null}async function L(T,I,g={}){const u=(0,O.parse)(T),m=g.proxyUrl||D(u,I);if(!m)return null;const S=(0,O.parse)(m);if(!/^https?:$/.test(S.protocol||""))return null;const p={host:S.hostname||"",port:S.port||(S.protocol==="https"?"443":"80"),auth:S.auth,rejectUnauthorized:(0,k.isBoolean)(g.strictSSL)?g.strictSSL:!0};return u.protocol==="http:"?new(await new Promise((b,y)=>{j(["http-proxy-agent"],b,y)}))(p):new(await new Promise((b,y)=>{j(["https-proxy-agent"],b,y)}))(p)}e.getProxyAgent=L}),define(J[132],Y([0,1,57,14,99,22,33,10,12,30,81,160,3]),function(j,e,O,k,D,L,T,I,g,u,m,S,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getResolvedShellEnv=void 0;const b=1e4;let y;async function w(l,d,v){return d["force-disable-user-env"]?(l.trace("resolveShellEnv(): skipped (--force-disable-user-env)"),{}):g.isWindows?(l.trace("resolveShellEnv(): skipped (Windows)"),{}):(0,S.isLaunchedFromCli)(v)&&!d["force-user-env"]?(l.trace("resolveShellEnv(): skipped (VSCODE_CLI is set)"),{}):((0,S.isLaunchedFromCli)(v)?l.trace("resolveShellEnv(): running (--force-user-env)"):l.trace("resolveShellEnv(): running (macOS/Linux)"),y||(y=p.Promises.withAsyncBody(async(f,s)=>{const t=new L.CancellationTokenSource,n=setTimeout(()=>{t.dispose(!0),s(new Error((0,D.localize)(0,null)))},b);try{f(await E(l,t.token))}catch(i){!(0,I.isCancellationError)(i)&&!t.token.isCancellationRequested?s(new Error((0,D.localize)(1,null,(0,T.toErrorMessage)(i)))):f({})}finally{clearTimeout(n),t.dispose()}})),y)}e.getResolvedShellEnv=w;async function E(l,d){const v=process.env.ELECTRON_RUN_AS_NODE;l.trace("getUnixShellEnvironment#runAsNode",v);const f=process.env.ELECTRON_NO_ATTACH_CONSOLE;l.trace("getUnixShellEnvironment#noAttach",f);const s=(0,u.generateUuid)().replace(/-/g,"").substr(0,12),t=new RegExp(s+"(.*)"+s),n={...process.env,ELECTRON_RUN_AS_NODE:"1",ELECTRON_NO_ATTACH_CONSOLE:"1"};l.trace("getUnixShellEnvironment#env",n);const i=await(0,m.getSystemShell)(g.OS,n);return l.trace("getUnixShellEnvironment#shell",i),new Promise((r,o)=>{if(d.isCancellationRequested)return o((0,I.canceled)());const c=(0,k.basename)(i);let a,h;const C=process.versions.electron&&process.versions["microsoft-build"]?"--ms-enable-electron-run-as-node":"";/^pwsh(-preview)?$/.test(c)?(a=`& '${process.execPath}' ${C} -p '''${s}'' + JSON.stringify(process.env) + ''${s}'''`,h=["-Login","-Command"]):(a=`'${process.execPath}' ${C} -p '"${s}" + JSON.stringify(process.env) + "${s}"'`,c==="tcsh"?h=["-ic"]:h=["-ilc"]),l.trace("getUnixShellEnvironment#spawn",JSON.stringify(h),a);const M=(0,O.spawn)(i,[...h,a],{detached:!0,stdio:["ignore","pipe","pipe"],env:n});d.onCancellationRequested(()=>(M.kill(),o((0,I.canceled)()))),M.on("error",X=>{l.error("getUnixShellEnvironment#errorChildProcess",(0,T.toErrorMessage)(X)),o(X)});const _=[];M.stdout.on("data",X=>_.push(X));const H=[];M.stderr.on("data",X=>H.push(X)),M.on("close",(X,ie)=>{const ne=Buffer.concat(_).toString("utf8");l.trace("getUnixShellEnvironment#raw",ne);const Q=Buffer.concat(H).toString("utf8");if(Q.trim()&&l.trace("getUnixShellEnvironment#stderr",Q),X||ie)return o(new Error((0,D.localize)(2,null,X,ie)));const ge=t.exec(ne),le=ge?ge[1]:"{}";try{const ae=JSON.parse(le);v?ae.ELECTRON_RUN_AS_NODE=v:delete ae.ELECTRON_RUN_AS_NODE,f?ae.ELECTRON_NO_ATTACH_CONSOLE=f:delete ae.ELECTRON_NO_ATTACH_CONSOLE,delete ae.XDG_RUNTIME_DIR,l.trace("getUnixShellEnvironment#result",ae),r(ae)}catch(ae){l.error("getUnixShellEnvironment#errorCaught",(0,T.toErrorMessage)(ae)),o(ae)}})})}}),define(J[67],Y([0,1,8]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IStateService=void 0,e.IStateService=(0,O.createDecorator)("stateService")}),define(J[133],Y([0,1,3,15,5,18,13,9]),function(j,e,O,k,D,L,T,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StateService=e.FileStorage=void 0;class g{constructor(S,p,b){this.storagePath=S,this.logService=p,this.fileService=b,this.storage=Object.create(null),this.lastSavedStorageContents="",this.flushDelayer=new O.ThrottledDelayer(100),this.initializing=void 0,this.closing=void 0}init(){return this.initializing||(this.initializing=this.doInit()),this.initializing}async doInit(){try{this.lastSavedStorageContents=(await this.fileService.readFile(this.storagePath)).value.toString(),this.storage=JSON.parse(this.lastSavedStorageContents)}catch(S){S.fileOperationResult!==1&&this.logService.error(S)}}getItem(S,p){const b=this.storage[S];return(0,D.isUndefinedOrNull)(b)?p:b}setItem(S,p){this.setItems([{key:S,data:p}])}setItems(S){let p=!1;for(const{key:b,data:y}of S)this.storage[b]!==y&&((0,D.isUndefinedOrNull)(y)?(0,D.isUndefined)(this.storage[b])||(this.storage[b]=void 0,p=!0):(this.storage[b]=y,p=!0));p&&this.save()}removeItem(S){(0,D.isUndefined)(this.storage[S])||(this.storage[S]=void 0,this.save())}async save(){if(!this.closing)return this.flushDelayer.trigger(()=>this.doSave())}async doSave(){if(!this.initializing)return;await this.initializing;const S=JSON.stringify(this.storage,null,4);if(S!==this.lastSavedStorageContents)try{await this.fileService.writeFile(this.storagePath,k.VSBuffer.fromString(S)),this.lastSavedStorageContents=S}catch(p){this.logService.error(p)}}async close(){return this.closing||(this.closing=this.flushDelayer.trigger(()=>this.doSave(),0)),this.closing}}e.FileStorage=g;let u=class{constructor(S,p,b){this.fileStorage=new g(S.stateResource,p,b)}async init(){await this.fileStorage.init()}getItem(S,p){return this.fileStorage.getItem(S,p)}};u=me([Z(0,L.IEnvironmentService),Z(1,I.ILogService),Z(2,T.IFileService)],u),e.StateService=u}),define(J[68],Y([0,1,12,37,11,30]),function(j,e,O,k,D,L){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.verifyMicrosoftInternalDomain=e.resolveCommonProperties=void 0;function T(u){if(O.platform===2&&/^penguin(\.|$)/i.test(u))return"chromebook"}async function I(u,m,S,p,b,y,w,E,l,d){const v=Object.create(null);v["common.machineId"]=w,v.sessionID=(0,L.generateUuid)()+Date.now(),v.commitHash=b,v.version=y,v["common.platformVersion"]=(m||"").replace(/^(\d+)(\.\d+)?(\.\d+)?(.*)/,"$1$2$3"),v["common.platform"]=(0,O.PlatformToString)(O.platform),v["common.nodePlatform"]=k.platform,v["common.nodeArch"]=p,v["common.product"]=d||"desktop",E&&(v["common.msftInternal"]=E);let f=0;const s=Date.now();Object.defineProperties(v,{timestamp:{get:()=>new Date,enumerable:!0},"common.timesincesessionstart":{get:()=>Date.now()-s,enumerable:!0},"common.sequence":{get:()=>f++,enumerable:!0}}),O.isLinuxSnap&&(v["common.snap"]="true");const t=T(S);t&&(v["common.platformDetail"]=t);try{const n=await u.readFile(D.URI.file(l));v["common.source"]=n.value.toString().slice(0,30)}catch{}return v}e.resolveCommonProperties=I;function g(u){const m=k.env.USERDNSDOMAIN;if(!m)return!1;const S=m.toLowerCase();return u.some(p=>S===p)}e.verifyMicrosoftInternalDomain=g}),define(J[32],Y([0,1,8]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TelemetryConfiguration=e.TelemetryLevel=e.TELEMETRY_OLD_SETTING_ID=e.TELEMETRY_SETTING_ID=e.TELEMETRY_SECTION_ID=e.machineIdKey=e.lastSessionDateStorageKey=e.firstSessionDateStorageKey=e.currentSessionDateStorageKey=e.ICustomEndpointTelemetryService=e.ITelemetryService=void 0,e.ITelemetryService=(0,O.createDecorator)("telemetryService"),e.ICustomEndpointTelemetryService=(0,O.createDecorator)("customEndpointTelemetryService"),e.currentSessionDateStorageKey="telemetry.currentSessionDate",e.firstSessionDateStorageKey="telemetry.firstSessionDate",e.lastSessionDateStorageKey="telemetry.lastSessionDate",e.machineIdKey="telemetry.machineId",e.TELEMETRY_SECTION_ID="telemetry",e.TELEMETRY_SETTING_ID="telemetry.telemetryLevel",e.TELEMETRY_OLD_SETTING_ID="telemetry.enableTelemetry";var k;(function(L){L[L.NONE=0]="NONE",L[L.CRASH=1]="CRASH",L[L.ERROR=2]="ERROR",L[L.USAGE=3]="USAGE"})(k=e.TelemetryLevel||(e.TelemetryLevel={}));var D;(function(L){L.OFF="off",L.CRASH="crash",L.ERROR="error",L.ON="all"})(D=e.TelemetryConfiguration||(e.TelemetryConfiguration={}))}),define(J[41],Y([0,1,29,5,21,66,68,32]),function(j,e,O,k,D,L,T,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cleanData=e.getPiiPathsFromEnvironment=e.isInternalTelemetry=e.cleanRemoteAuthority=e.validateTelemetryData=e.getTelemetryLevel=e.isLoggingOnly=e.supportsTelemetry=e.configurationTelemetry=e.NullAppender=e.NullEndpointTelemetryService=e.NullTelemetryService=e.NullTelemetryServiceShape=e.TrustedTelemetryValue=void 0;class g{constructor(c){this.value=c}}e.TrustedTelemetryValue=g;class u{constructor(){this.sendErrorTelemetry=!1,this.telemetryLevel=0}publicLog(c,a){return Promise.resolve(void 0)}publicLog2(c,a){return this.publicLog(c,a)}publicLogError(c,a){return Promise.resolve(void 0)}publicLogError2(c,a){return this.publicLogError(c,a)}setExperimentProperty(){}getTelemetryInfo(){return Promise.resolve({instanceId:"someValue.instanceId",sessionId:"someValue.sessionId",machineId:"someValue.machineId",firstSessionDate:"someValue.firstSessionDate"})}}e.NullTelemetryServiceShape=u,e.NullTelemetryService=new u;class m{async publicLog(c,a,h){}async publicLogError(c,a,h){}}e.NullEndpointTelemetryService=m,e.NullAppender={log:()=>null,flush:()=>Promise.resolve(null)};function S(o,c){return c.onDidChangeConfiguration(a=>{a.source!==7&&o.publicLog2("updateConfiguration",{configurationSource:(0,D.ConfigurationTargetToString)(a.source),configurationKeys:v(a.sourceConfig)})})}e.configurationTelemetry=S;function p(o,c){return!c.isBuilt&&!c.disableTelemetry?!0:!(c.disableTelemetry||!o.enableTelemetry||c.extensionTestsLocationURI)}e.supportsTelemetry=p;function b(o,c){return!(c.isBuilt||c.disableTelemetry||o.enableTelemetry&&o.aiConfig?.ariaKey)}e.isLoggingOnly=b;function y(o){const c=o.getValue(I.TELEMETRY_SETTING_ID),a=o.getValue("telemetry.enableCrashReporter");if(o.getValue(I.TELEMETRY_OLD_SETTING_ID)===!1||a===!1)return 0;switch(c??"all"){case"all":return 3;case"error":return 2;case"crash":return 1;case"off":return 0}}e.getTelemetryLevel=y;function w(o){const c={},a={},h={};d(o,h);for(let C in h){C=C.length>150?C.substr(C.length-149):C;const M=h[C];typeof M=="number"?a[C]=M:typeof M=="boolean"?a[C]=M?1:0:typeof M=="string"?(M.length>8192&&console.warn(`Telemetry property: ${C} has been trimmed to 8192, the original length is ${M.length}`),c[C]=M.substring(0,8191)):typeof M<"u"&&M!==null&&(c[C]=M)}return{properties:c,measurements:a}}e.validateTelemetryData=w;const E=new Set(["ssh-remote","dev-container","attached-container","wsl","tunnel","codespaces"]);function l(o){if(!o)return"none";const c=(0,L.getRemoteName)(o);return E.has(c)?c:"other"}e.cleanRemoteAuthority=l;function d(o,c,a=0,h){if(!!o)for(const C of Object.getOwnPropertyNames(o)){const M=o[C],_=h?h+C:C;Array.isArray(M)?c[_]=(0,O.safeStringify)(M):M instanceof Date?c[_]=M.toISOString():(0,k.isObject)(M)?a<2?d(M,c,a+1,_+"."):c[_]=(0,O.safeStringify)(M):c[_]=M}}function v(o){if(!o)return[];const c=[];return f(c,"",o),c}function f(o,c,a){a&&typeof a=="object"&&!Array.isArray(a)?Object.keys(a).forEach(h=>f(o,c?`${c}.${h}`:h,a[h])):o.push(c)}function s(o,c){const a=o.msftInternalDomains||[],h=c.getValue("telemetry.internalTesting");return(0,T.verifyMicrosoftInternalDomain)(a)||h}e.isInternalTelemetry=s;function t(o){return[o.appRoot,o.extensionsPath,o.userHome.fsPath,o.tmpDir.fsPath,o.userDataPath]}e.getPiiPathsFromEnvironment=t;function n(o,c){if(!o||!o.includes("/")&&!o.includes("\\"))return o;let a=o;const h=[];for(const H of c)for(;;){const X=H.exec(o);if(!X)break;h.push([X.index,H.lastIndex])}const C=/^[\\\/]?(node_modules|node_modules\.asar)[\\\/]/,M=/(file:\/\/)?([a-zA-Z]:(\\\\|\\|\/)|(\\\\|\\|\/))?([\w-\._]+(\\\\|\\|\/))+[\w-\._]*/g;let _=0;for(a="";;){const H=M.exec(o);if(!H)break;const X=h.some(([ie,ne])=>H.index<ne&&ie<M.lastIndex);!C.test(H[0])&&!X&&(a+=o.substring(_,H.index)+"<REDACTED: user-file-path>",_=M.lastIndex)}return _<o.length&&(a+=o.substr(_)),a}function i(o){if(!o)return o;const c=o.toLowerCase(),a=[{label:"Google API Key",regex:/AIza[A-Za-z0-9_\\\-]{35}/},{label:"Slack Token",regex:/xox[pbar]\-[A-Za-z0-9]/},{label:"Generic Secret",regex:/(key|token|sig|secret|signature|password|passwd|pwd|android:value)[^a-zA-Z0-9]/},{label:"Email",regex:/@[a-zA-Z0-9-]+\.[a-zA-Z0-9-]+/}];for(const h of a)if(h.regex.test(c))return`<REDACTED: ${h.label}>`;return o}function r(o,c){return(0,O.cloneAndChange)(o,a=>{if(a instanceof g)return a.value;if(typeof a=="string"){let h=a.replaceAll("%20"," ");h=n(h,c);for(const C of c)h=h.replace(C,"");return h=i(h),h}})}e.cleanData=r}),define(J[134],Y([0,1,107,41]),function(j,e,O,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.resolveMarketplaceHeaders=void 0;async function D(L,T,I,g,u,m,S){const p={"X-Market-Client-Id":`VSCode ${L}`,"User-Agent":`VSCode ${L} (${T.nameShort})`};if((0,k.supportsTelemetry)(T,I)&&(0,k.getTelemetryLevel)(g)===3){const b=await(0,O.getServiceMachineId)(I,u,m),{machineId:y}=await S.getTelemetryInfo();p["X-Market-User-Id"]=b,p["VSCode-SessionId"]=y||b}return p}e.resolveMarketplaceHeaders=D}),define(J[135],Y([0,1,10,29,41]),function(j,e,O,k,D){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractOneDataSystemAppender=void 0;const L="https://0.0.0.0/OneCollector/1.0";async function T(g,u,m){const S=await new Promise((E,l)=>{j(["@microsoft/1ds-core-js"],E,l)}),p=await new Promise((E,l)=>{j(["@microsoft/1ds-post-js"],E,l)}),b=new S.AppInsightsCore,y=new p.PostChannel,w={instrumentationKey:g,endpointUrl:L,loggingLevelTelemetry:0,loggingLevelConsole:0,disableCookiesUsage:!0,disableDbgExt:!0,disableInstrumentationKeyValidation:!0,channels:[[y]]};if(m){w.extensionConfig={};const E={alwaysUseXhrOverride:!0,httpXHROverride:m};w.extensionConfig[y.identifier]=E}return b.initialize(w,[]),b.addTelemetryInitializer(E=>{u&&(E.ext=E.ext??{},E.ext.utc=E.ext.utc??{},E.ext.utc.flags=8462029)}),b}class I{constructor(u,m,S,p,b){this._isInternalTelemetry=u,this._eventPrefix=m,this._defaultData=S,this._xhrOverride=b,this.endPointUrl=L,this._defaultData||(this._defaultData={}),typeof p=="function"?this._aiCoreOrKey=p():this._aiCoreOrKey=p,this._asyncAiCore=null}_withAIClient(u){if(!!this._aiCoreOrKey){if(typeof this._aiCoreOrKey!="string"){u(this._aiCoreOrKey);return}this._asyncAiCore||(this._asyncAiCore=T(this._aiCoreOrKey,this._isInternalTelemetry,this._xhrOverride)),this._asyncAiCore.then(m=>{u(m)},m=>{(0,O.onUnexpectedError)(m),console.error(m)})}}log(u,m){if(!this._aiCoreOrKey)return;m=(0,k.mixin)(m,this._defaultData),m=(0,D.validateTelemetryData)(m);const S=this._eventPrefix+"/"+u;try{this._withAIClient(p=>{p.pluginVersionString=m?.properties.version??"Unknown",p.track({name:S,baseData:{name:S,properties:m?.properties,measurements:m?.measurements}})})}catch{}}flush(){return this._aiCoreOrKey?new Promise(u=>{this._withAIClient(m=>{m.unload(!0,()=>{this._aiCoreOrKey=void 0,u(void 0)})})}):Promise.resolve(void 0)}}e.AbstractOneDataSystemAppender=I}),define(J[136],Y([0,1,2,29,12,31,100,21,40,137,26,35,32,41]),function(j,e,O,k,D,L,T,I,g,u,m,S,p,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TelemetryService=void 0;let y=class{constructor(l,d,v){this._configurationService=d,this._productService=v,this._experimentProperties={},this._disposables=new O.DisposableStore,this._cleanupPatterns=[],this._appenders=l.appenders,this._commonProperties=l.commonProperties||Promise.resolve({}),this._piiPaths=l.piiPaths||[],this._telemetryLevel=3,this._sendErrorTelemetry=!!l.sendErrorTelemetry,this._cleanupPatterns=[/(vscode-)?file:\/\/\/.*?\/resources\/app\//gi];for(const f of this._piiPaths)this._cleanupPatterns.push(new RegExp((0,L.escapeRegExpCharacters)(f),"gi")),f.indexOf("\\")>=0&&this._cleanupPatterns.push(new RegExp((0,L.escapeRegExpCharacters)(f.replace(/\\/g,"/")),"gi"));this._updateTelemetryLevel(),this._configurationService.onDidChangeConfiguration(this._updateTelemetryLevel,this,this._disposables)}setExperimentProperty(l,d){this._experimentProperties[l]=d}_updateTelemetryLevel(){let l=(0,b.getTelemetryLevel)(this._configurationService);const d=this._productService.enabledTelemetryLevels;if(d){this._sendErrorTelemetry=this.sendErrorTelemetry?d.error:!1;const v=d.usage?3:d.error?2:0;l=Math.min(l,v)}this._telemetryLevel=l}get sendErrorTelemetry(){return this._sendErrorTelemetry}get telemetryLevel(){return this._telemetryLevel}async getTelemetryInfo(){const l=await this._commonProperties,d=l.sessionID,v=l["common.machineId"],f=l["common.firstSessionDate"],s=l["common.msftInternal"];return{sessionId:d,machineId:v,firstSessionDate:f,msftInternal:s}}dispose(){this._disposables.dispose()}_log(l,d,v){return this._telemetryLevel<d?Promise.resolve(void 0):this._commonProperties.then(f=>{v=(0,k.mixin)(v,this._experimentProperties),v=(0,b.cleanData)(v,this._cleanupPatterns),v=(0,k.mixin)(v,f),this._appenders.forEach(s=>s.log(l,v))},f=>{console.error(f)})}publicLog(l,d){return this._log(l,3,d)}publicLog2(l,d){return this.publicLog(l,d)}publicLogError(l,d){return this._sendErrorTelemetry?this._log(l,2,d):Promise.resolve(void 0)}publicLogError2(l,d){return this.publicLogError(l,d)}};y.IDLE_START_EVENT_NAME="UserIdleStart",y.IDLE_STOP_EVENT_NAME="UserIdleStop",y=me([Z(1,I.IConfigurationService),Z(2,m.IProductService)],y),e.TelemetryService=y;function w(){const E=(0,T.localize)(0,null,u.default.nameLong),l=u.default.privacyStatementUrl?(0,T.localize)(2,null,"https://aka.ms/vscode-telemetry",u.default.privacyStatementUrl):(0,T.localize)(1,null,"https://aka.ms/vscode-telemetry"),d=D.isWeb?"":(0,T.localize)(3,null),v=(0,T.localize)(4,null),f=(0,T.localize)(5,null),s=(0,T.localize)(6,null),t=(0,T.localize)(7,null),n=`
|       | ${v} | ${f} | ${s} |
|:------|:---------------------:|:---------------:|:--------------:|
| all   |            \u2713          |        \u2713        |        \u2713       |
| error |            \u2713          |        \u2713        |        -       |
| crash |            \u2713          |        -        |        -       |
| off   |            -          |        -        |        -       |
`,i=(0,T.localize)(8,null);return`
${E} ${l} ${d}

&nbsp;

${t}
${n}

&nbsp;

${i}
`}S.Registry.as(g.Extensions.Configuration).registerConfiguration({id:p.TELEMETRY_SECTION_ID,order:110,type:"object",title:(0,T.localize)(9,null),properties:{[p.TELEMETRY_SETTING_ID]:{type:"string",enum:["all","error","crash","off"],enumDescriptions:[(0,T.localize)(10,null),(0,T.localize)(11,null),(0,T.localize)(12,null),(0,T.localize)(13,null)],markdownDescription:w(),default:"off",restricted:!0,scope:1,tags:["usesOnlineServices","telemetry"]}}}),S.Registry.as(g.Extensions.Configuration).registerConfiguration({id:p.TELEMETRY_SECTION_ID,order:110,type:"object",title:(0,T.localize)(14,null),properties:{[p.TELEMETRY_OLD_SETTING_ID]:{type:"boolean",markdownDescription:u.default.privacyStatementUrl?(0,T.localize)(16,null,u.default.nameLong,u.default.privacyStatementUrl):(0,T.localize)(15,null,u.default.nameLong),default:!0,restricted:!0,markdownDeprecationMessage:(0,T.localize)(17,null,`\`#${p.TELEMETRY_SETTING_ID}#\``),scope:1,tags:["usesOnlineServices","telemetry"]}}})}),define(J[138],Y([0,1,161,135]),function(j,e,O,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OneDataSystemAppender=void 0;class D extends k.AbstractOneDataSystemAppender{constructor(T,I,g,u){const m={sendPOST:(S,p)=>{const b={method:"POST",headers:{...S.headers,"Content-Type":"application/json","Content-Length":Buffer.byteLength(S.data)}};try{const y=O.request(S.urlString,b,w=>{w.on("data",function(E){p(w.statusCode??200,w.headers,E.toString())}),w.on("error",function(E){p(0,{})})});y.write(S.data),y.end()}catch{p(0,{})}}};super(T,I,g,u,m)}}e.OneDataSystemAppender=D}),define(J[139],Y([0,1,14,20]),function(j,e,O,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.buildTelemetryMessage=void 0;async function D(L,T){const I=Object.create(null),g=(m,S)=>{const p=JSON.parse(m);I[S]=p};if(T){const m=[],S=await k.Promises.readdir(T);for(const b of S)try{(await k.Promises.stat((0,O.join)(T,b))).isDirectory()&&m.push(b)}catch{}const p=[];for(const b of m)(await k.Promises.readdir((0,O.join)(T,b))).filter(w=>w==="telemetry.json").length===1&&p.push(b);for(const b of p){const y=(await k.Promises.readFile((0,O.join)(T,b,"telemetry.json"))).toString();g(y,b)}}let u=(await k.Promises.readFile((0,O.join)(L,"telemetry-core.json"))).toString();return g(u,"vscode-core"),u=(await k.Promises.readFile((0,O.join)(L,"telemetry-extensions.json"))).toString(),g(u,"vscode-extensions"),JSON.stringify(I,null,4)}e.buildTelemetryMessage=D}),define(J[140],Y([0,1,12,79,32]),function(j,e,O,k,D){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.resolveMachineId=void 0;async function L(T){let I=T.getItem(D.machineIdKey);return(typeof I!="string"||O.isMacintosh&&I==="6c9d2bc8f91b89624add29c0abeae7fb42bf539fa1cdb2e3e57cd668fa9bcead")&&(I=await(0,k.getMachineId)()),I}e.resolveMachineId=L}),define(J[28],Y([0,1,8]),function(j,e,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IUriIdentityService=void 0,e.IUriIdentityService=(0,O.createDecorator)("IUriIdentityService")}),define(J[141],Y([0,1,28,108,13,17,71,4,2]),function(j,e,O,k,D,L,T,I,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UriIdentityService=void 0;class u{constructor(p){this.uri=p,this.time=u._clock++}touch(){return this.time=u._clock++,this}}u._clock=0;let m=class{constructor(p){this._fileService=p,this._dispooables=new g.DisposableStore,this._limit=2**16;const b=new Map,y=w=>{let E=b.get(w.scheme);return E===void 0&&(E=p.hasProvider(w)&&!this._fileService.hasCapability(w,1024),b.set(w.scheme,E)),E};this._dispooables.add(I.Event.any(p.onDidChangeFileSystemProviderRegistrations,p.onDidChangeFileSystemProviderCapabilities)(w=>{b.delete(w.scheme)})),this.extUri=new L.ExtUri(y),this._canonicalUris=new T.SkipList((w,E)=>this.extUri.compare(w,E,!0),this._limit)}dispose(){this._dispooables.dispose(),this._canonicalUris.clear()}asCanonicalUri(p){this._fileService.hasProvider(p)&&(p=(0,L.normalizePath)(p));const b=this._canonicalUris.get(p);return b?b.touch().uri.with({fragment:p.fragment}):(this._canonicalUris.set(p,new u(p)),this._checkTrim(),p)}_checkTrim(){if(this._canonicalUris.size<this._limit)return;const p=[...this._canonicalUris.entries()].sort((y,w)=>y[1].touch<w[1].touch?1:y[1].touch>w[1].touch?-1:0);u._clock=0,this._canonicalUris.clear();const b=this._limit*.5;for(let y=0;y<b;y++)this._canonicalUris.set(p[y][0],p[y][1].touch())}};m=me([Z(0,D.IFileService)],m),e.UriIdentityService=m,(0,k.registerSingleton)(O.IUriIdentityService,m,1)}),define(J[142],Y([0,1,102,14,54,17,11,8,16]),function(j,e,O,k,D,L,T,I,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hasWorkspaceFileExtension=e.isSavedWorkspace=e.isTemporaryWorkspace=e.isUntitledWorkspace=e.UNTITLED_WORKSPACE_NAME=e.WORKSPACE_FILTER=e.WORKSPACE_SUFFIX=e.WORKSPACE_EXTENSION=e.toWorkspaceFolder=e.WorkspaceFolder=e.Workspace=e.isWorkspaceFolder=e.isWorkspace=e.WorkbenchState=e.reviveIdentifier=e.isWorkspaceIdentifier=e.toWorkspaceIdentifier=e.EXTENSION_DEVELOPMENT_EMPTY_WINDOW_WORKSPACE=e.isSingleFolderWorkspaceIdentifier=e.IWorkspaceContextService=void 0,e.IWorkspaceContextService=(0,I.createDecorator)("contextService");function u(n){const i=n;return typeof i?.id=="string"&&T.URI.isUri(i.uri)}e.isSingleFolderWorkspaceIdentifier=u,e.EXTENSION_DEVELOPMENT_EMPTY_WINDOW_WORKSPACE={id:"ext-dev"};function m(n,i){if(typeof n=="string"||typeof n>"u")return typeof n=="string"?{id:(0,k.basename)(n)}:i?e.EXTENSION_DEVELOPMENT_EMPTY_WINDOW_WORKSPACE:void 0;const r=n;if(r.configuration)return{id:r.id,configPath:r.configuration};if(r.folders.length===1)return{id:r.id,uri:r.folders[0].uri}}e.toWorkspaceIdentifier=m;function S(n){const i=n;return typeof i?.id=="string"&&T.URI.isUri(i.configPath)}e.isWorkspaceIdentifier=S;function p(n){const i=n;if(i?.uri)return{id:i.id,uri:T.URI.revive(i.uri)};const r=n;if(r?.configPath)return{id:r.id,configPath:T.URI.revive(r.configPath)};if(n?.id)return{id:n.id}}e.reviveIdentifier=p;var b;(function(n){n[n.EMPTY=1]="EMPTY",n[n.FOLDER=2]="FOLDER",n[n.WORKSPACE=3]="WORKSPACE"})(b=e.WorkbenchState||(e.WorkbenchState={}));function y(n){const i=n;return!!(i&&typeof i=="object"&&typeof i.id=="string"&&Array.isArray(i.folders))}e.isWorkspace=y;function w(n){const i=n;return!!(i&&typeof i=="object"&&T.URI.isUri(i.uri)&&typeof i.name=="string"&&typeof i.toResource=="function")}e.isWorkspaceFolder=w;class E{constructor(i,r,o,c,a){this._id=i,this._transient=o,this._configuration=c,this._ignorePathCasing=a,this._foldersMap=D.TernarySearchTree.forUris(this._ignorePathCasing,()=>!0),this.folders=r}update(i){this._id=i.id,this._configuration=i.configuration,this._transient=i.transient,this._ignorePathCasing=i._ignorePathCasing,this.folders=i.folders}get folders(){return this._folders}set folders(i){this._folders=i,this.updateFoldersMap()}get id(){return this._id}get transient(){return this._transient}get configuration(){return this._configuration}set configuration(i){this._configuration=i}getFolder(i){return i&&this._foldersMap.findSubstr(i)||null}updateFoldersMap(){this._foldersMap=D.TernarySearchTree.forUris(this._ignorePathCasing,()=>!0);for(const i of this.folders)this._foldersMap.set(i.uri,i)}toJSON(){return{id:this.id,folders:this.folders,transient:this.transient,configuration:this.configuration}}}e.Workspace=E;class l{constructor(i,r){this.raw=r,this.uri=i.uri,this.index=i.index,this.name=i.name}toResource(i){return(0,L.joinPath)(this.uri,i)}toJSON(){return{uri:this.uri,name:this.name,index:this.index}}}e.WorkspaceFolder=l;function d(n){return new l({uri:n,index:0,name:(0,L.basenameOrAuthority)(n)},{uri:n.toString()})}e.toWorkspaceFolder=d,e.WORKSPACE_EXTENSION="code-workspace",e.WORKSPACE_SUFFIX=`.${e.WORKSPACE_EXTENSION}`,e.WORKSPACE_FILTER=[{name:(0,O.localize)(0,null),extensions:[e.WORKSPACE_EXTENSION]}],e.UNTITLED_WORKSPACE_NAME="workspace.json";function v(n,i){return L.extUriBiasedIgnorePathCase.isEqualOrParent(n,i.untitledWorkspacesHome)}e.isUntitledWorkspace=v;function f(n){let i;return T.URI.isUri(n)?i=n:i=n.configuration,i?.scheme===g.Schemas.tmp}e.isTemporaryWorkspace=f;function s(n,i){return!v(n,i)&&!f(n)}e.isSavedWorkspace=s;function t(n){return(typeof n=="string"?(0,k.extname)(n):(0,L.extname)(n))===e.WORKSPACE_SUFFIX}e.hasWorkspaceFileExtension=t}),define(J[25],Y([0,1,52,4,2,17,11,101,18,13,8,9,142,34,28,3,30,31,5]),function(j,e,O,k,D,L,T,I,g,u,m,S,p,b,y,w,E,l,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InMemoryUserDataProfilesService=e.UserDataProfilesService=e.toUserDataProfile=e.reviveProfile=e.IUserDataProfilesService=e.PROFILES_ENABLEMENT_CONFIG=e.isUserDataProfile=void 0;function v(i){const r=i;return!!(r&&typeof r=="object"&&typeof r.id=="string"&&typeof r.isDefault=="boolean"&&typeof r.name=="string"&&T.URI.isUri(r.location)&&T.URI.isUri(r.globalStorageHome)&&T.URI.isUri(r.settingsResource)&&T.URI.isUri(r.keybindingsResource)&&T.URI.isUri(r.tasksResource)&&T.URI.isUri(r.snippetsHome)&&T.URI.isUri(r.extensionsResource))}e.isUserDataProfile=v,e.PROFILES_ENABLEMENT_CONFIG="workbench.experimental.settingsProfiles.enabled",e.IUserDataProfilesService=(0,m.createDecorator)("IUserDataProfilesService");function f(i,r){return{id:i.id,isDefault:i.isDefault,name:i.name,shortName:i.shortName,location:T.URI.revive(i.location).with({scheme:r}),globalStorageHome:T.URI.revive(i.globalStorageHome).with({scheme:r}),settingsResource:T.URI.revive(i.settingsResource).with({scheme:r}),keybindingsResource:T.URI.revive(i.keybindingsResource).with({scheme:r}),tasksResource:T.URI.revive(i.tasksResource).with({scheme:r}),snippetsHome:T.URI.revive(i.snippetsHome).with({scheme:r}),extensionsResource:T.URI.revive(i.extensionsResource)?.with({scheme:r}),useDefaultFlags:i.useDefaultFlags,isTransient:i.isTransient}}e.reviveProfile=f;function s(i,r,o,c){return{id:i,name:r,location:o,isDefault:!1,shortName:c?.shortName,globalStorageHome:(0,L.joinPath)(o,"globalStorage"),settingsResource:(0,L.joinPath)(o,"settings.json"),keybindingsResource:(0,L.joinPath)(o,"keybindings.json"),tasksResource:(0,L.joinPath)(o,"tasks.json"),snippetsHome:(0,L.joinPath)(o,"snippets"),extensionsResource:(0,L.joinPath)(o,"extensions.json"),useDefaultFlags:c?.useDefaultFlags,isTransient:c?.transient}}e.toUserDataProfile=s;let t=class extends D.Disposable{get defaultProfile(){return this.profiles[0]}get profiles(){return[...this.profilesObject.profiles,...this.transientProfilesObject.profiles]}constructor(r,o,c,a){super(),this.environmentService=r,this.fileService=o,this.uriIdentityService=c,this.logService=a,this.enabled=!1,this._onDidChangeProfiles=this._register(new k.Emitter),this.onDidChangeProfiles=this._onDidChangeProfiles.event,this._onWillCreateProfile=this._register(new k.Emitter),this.onWillCreateProfile=this._onWillCreateProfile.event,this._onWillRemoveProfile=this._register(new k.Emitter),this.onWillRemoveProfile=this._onWillRemoveProfile.event,this._onDidResetWorkspaces=this._register(new k.Emitter),this.onDidResetWorkspaces=this._onDidResetWorkspaces.event,this.profileCreationPromises=new Map,this.transientProfilesObject={profiles:[],workspaces:new b.ResourceMap},this.profilesHome=(0,L.joinPath)(this.environmentService.userRoamingDataHome,"profiles")}setEnablement(r){this.enabled!==r&&(this._profilesObject=void 0,this.enabled=r)}isEnabled(){return this.enabled}get profilesObject(){if(!this._profilesObject){const r=[];if(this.enabled)for(const h of this.getStoredProfiles()){if(!h.name||!(0,d.isString)(h.name)||!h.location){this.logService.warn("Skipping the invalid stored profile",h.location||h.name);continue}r.push(s((0,L.basename)(h.location),h.name,h.location,{shortName:h.shortName,useDefaultFlags:h.useDefaultFlags}))}let o;const c=new b.ResourceMap,a=s((0,O.hash)(this.environmentService.userRoamingDataHome.path).toString(16),(0,I.localize)(0,null),this.environmentService.userRoamingDataHome);if(r.unshift({...a,extensionsResource:this.getDefaultProfileExtensionsLocation()??a.extensionsResource,isDefault:!0}),r.length){const h=this.getStoredProfileAssociations();if(h.workspaces)for(const[C,M]of Object.entries(h.workspaces)){const _=T.URI.parse(C),H=T.URI.parse(M),X=r.find(ie=>this.uriIdentityService.extUri.isEqual(ie.location,H));X&&c.set(_,X)}if(h.emptyWindow){const C=T.URI.parse(h.emptyWindow);o=r.find(M=>this.uriIdentityService.extUri.isEqual(M.location,C))}}this._profilesObject={profiles:r,workspaces:c,emptyWindow:o}}return this._profilesObject}async createTransientProfile(r){const o="Temp",c=new RegExp(`${(0,l.escapeRegExpCharacters)(o)}\\s(\\d+)`);let a=0;for(const C of this.profiles){const M=c.exec(C.name),_=M?parseInt(M[1]):0;a=_>a?_:a}const h=`${o} ${a+1}`;return this.createProfile((0,O.hash)((0,E.generateUuid)()).toString(16),h,{transient:!0},r)}async createNamedProfile(r,o,c){return this.createProfile((0,O.hash)((0,E.generateUuid)()).toString(16),r,o,c)}async createProfile(r,o,c,a){if(!this.enabled)throw new Error(`Profiles are disabled. Enable them via the '${e.PROFILES_ENABLEMENT_CONFIG}' setting.`);const h=await this.doCreateProfile(r,o,c);return a&&await this.setProfileForWorkspace(a,h),h}async doCreateProfile(r,o,c){if(!(0,d.isString)(o)||!o)throw new Error("Name of the profile is mandatory and must be of type `string`");let a=this.profileCreationPromises.get(o);return a||(a=(async()=>{try{const h=this.profiles.find(_=>_.name===o||_.id===r);if(h)return h;const C=s(r,o,(0,L.joinPath)(this.profilesHome,r),c);await this.fileService.createFolder(C.location);const M=[];return this._onWillCreateProfile.fire({profile:C,join(_){M.push(_)}}),await w.Promises.settled(M),this.updateProfiles([C],[],[]),C}finally{this.profileCreationPromises.delete(o)}})(),this.profileCreationPromises.set(o,a)),a}async updateProfile(r,o){if(!this.enabled)throw new Error(`Profiles are disabled. Enable them via the '${e.PROFILES_ENABLEMENT_CONFIG}' setting.`);let c=this.profiles.find(a=>a.id===r.id);if(!c)throw new Error(`Profile '${r.name}' does not exist`);return c=s(c.id,o.name??c.name,c.location,{shortName:o.shortName??c.shortName,transient:o.transient??c.isTransient,useDefaultFlags:o.useDefaultFlags??c.useDefaultFlags}),this.updateProfiles([],[],[c]),c}async removeProfile(r){if(!this.enabled)throw new Error(`Profiles are disabled. Enable them via the '${e.PROFILES_ENABLEMENT_CONFIG}' setting.`);if(r.isDefault)throw new Error("Cannot remove default profile");const o=this.profiles.find(a=>a.id===r.id);if(!o)throw new Error(`Profile '${r.name}' does not exist`);const c=[];this._onWillRemoveProfile.fire({profile:o,join(a){c.push(a)}});try{await Promise.allSettled(c)}catch(a){this.logService.error(a)}o.id===this.profilesObject.emptyWindow?.id&&(this.profilesObject.emptyWindow=void 0);for(const a of[...this.profilesObject.workspaces.keys()])o.id===this.profilesObject.workspaces.get(a)?.id&&this.profilesObject.workspaces.delete(a);this.updateStoredProfileAssociations(),this.updateProfiles([],[o],[]);try{this.profiles.length===1?await this.fileService.del(this.profilesHome,{recursive:!0}):await this.fileService.del(o.location,{recursive:!0})}catch(a){this.logService.error(a)}}getOrSetProfileForWorkspace(r,o=this.defaultProfile){if(!this.enabled)return this.defaultProfile;let c=this.getProfileForWorkspace(r);return c||(c=o,this.profiles.length>1&&this.setProfileForWorkspaceSync(r,c)),c}async setProfileForWorkspace(r,o){this.setProfileForWorkspaceSync(r,o)}setProfileForWorkspaceSync(r,o){if(!this.enabled)throw new Error(`Profiles are disabled. Enable them via the '${e.PROFILES_ENABLEMENT_CONFIG}' setting.`);const c=this.profiles.find(a=>a.id===o.id);if(!c)throw new Error(`Profile '${o.name}' does not exist`);this.updateWorkspaceAssociation(r,c)}unsetWorkspace(r,o){if(!this.enabled)throw new Error(`Profiles are disabled. Enable them via the '${e.PROFILES_ENABLEMENT_CONFIG}' setting.`);this.updateWorkspaceAssociation(r,void 0,o)}async resetWorkspaces(){this.transientProfilesObject.workspaces.clear(),this.transientProfilesObject.emptyWindow=void 0,this.profilesObject.workspaces.clear(),this.profilesObject.emptyWindow=void 0,this.updateStoredProfileAssociations(),this._onDidResetWorkspaces.fire()}async cleanUp(){if(!!this.enabled&&await this.fileService.exists(this.profilesHome)){const r=await this.fileService.resolve(this.profilesHome);await Promise.all((r.children||[]).filter(o=>o.isDirectory&&this.profiles.every(c=>!this.uriIdentityService.extUri.isEqual(c.location,o.resource))).map(o=>this.fileService.del(o.resource,{recursive:!0})))}}async cleanUpTransientProfiles(){if(!this.enabled)return;const r=this.transientProfilesObject.profiles.filter(o=>!this.isProfileAssociatedToWorkspace(o));await Promise.allSettled(r.map(o=>this.removeProfile(o)))}getProfileForWorkspace(r){const o=this.getWorkspace(r);return T.URI.isUri(o)?this.transientProfilesObject.workspaces.get(o)??this.profilesObject.workspaces.get(o):this.transientProfilesObject.emptyWindow??this.profilesObject.emptyWindow}getWorkspace(r){return(0,p.isSingleFolderWorkspaceIdentifier)(r)?r.uri:(0,p.isWorkspaceIdentifier)(r)?r.configPath:"empty-window"}isProfileAssociatedToWorkspace(r){return!!(this.uriIdentityService.extUri.isEqual(this.transientProfilesObject.emptyWindow?.location,r.location)||[...this.transientProfilesObject.workspaces.values()].some(o=>this.uriIdentityService.extUri.isEqual(o.location,r.location))||this.uriIdentityService.extUri.isEqual(this.profilesObject.emptyWindow?.location,r.location)||[...this.profilesObject.workspaces.values()].some(o=>this.uriIdentityService.extUri.isEqual(o.location,r.location)))}updateProfiles(r,o,c){const a=[...this.profiles,...r],h=[];this.transientProfilesObject.profiles=[];for(let C of a)C.isDefault||o.some(M=>C.id===M.id)||(C=c.find(M=>C.id===M.id)??C,C.isTransient?this.transientProfilesObject.profiles.push(C):h.push({location:C.location,name:C.name,shortName:C.shortName,useDefaultFlags:C.useDefaultFlags}));this.saveStoredProfiles(h),this._profilesObject=void 0,this.triggerProfilesChanges(r,o,c)}triggerProfilesChanges(r,o,c){this._onDidChangeProfiles.fire({added:r,removed:o,updated:c,all:this.profiles})}updateWorkspaceAssociation(r,o,c){c=o?.isTransient?!0:c,c||this.updateWorkspaceAssociation(r,void 0,!0);const a=this.getWorkspace(r),h=c?this.transientProfilesObject:this.profilesObject;T.URI.isUri(a)?(h.workspaces.delete(a),o&&h.workspaces.set(a,o)):h.emptyWindow=o,c||this.updateStoredProfileAssociations()}updateStoredProfileAssociations(){const r={};for(const[c,a]of this.profilesObject.workspaces.entries())r[c.toString()]=a.location.toString();const o=this.profilesObject.emptyWindow?.location.toString();this.saveStoredProfileAssociations({workspaces:r,emptyWindow:o}),this._profilesObject=void 0}getStoredProfiles(){return[]}saveStoredProfiles(r){throw new Error("not implemented")}getStoredProfileAssociations(){return{}}saveStoredProfileAssociations(r){throw new Error("not implemented")}getDefaultProfileExtensionsLocation(){}};t.PROFILES_KEY="userDataProfiles",t.PROFILE_ASSOCIATIONS_KEY="profileAssociations",t=me([Z(0,g.IEnvironmentService),Z(1,u.IFileService),Z(2,y.IUriIdentityService),Z(3,S.ILogService)],t),e.UserDataProfilesService=t;class n extends t{constructor(){super(...arguments),this.storedProfiles=[],this.storedProfileAssociations={}}getStoredProfiles(){return this.storedProfiles}saveStoredProfiles(r){this.storedProfiles=r}getStoredProfileAssociations(){return this.storedProfileAssociations}saveStoredProfileAssociations(r){this.storedProfileAssociations=r}}e.InMemoryUserDataProfilesService=n}),define(J[143],Y([0,1,19,3,22,10,4,2,12,11,86,23,24,27,9,26,32,25]),function(j,e,O,k,D,L,T,I,g,u,m,S,p,b,y,w,E,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractExtensionTask=e.reportTelemetry=e.joinErrors=e.AbstractExtensionManagementService=void 0;let d=class extends I.Disposable{get onInstallExtension(){return this._onInstallExtension.event}get onDidInstallExtensions(){return this._onDidInstallExtensions.event}get onUninstallExtension(){return this._onUninstallExtension.event}get onDidUninstallExtension(){return this._onDidUninstallExtension.event}constructor(i,r,o,c,a){super(),this.galleryService=i,this.telemetryService=r,this.logService=o,this.productService=c,this.userDataProfilesService=a,this.lastReportTimestamp=0,this.installingExtensions=new Map,this.uninstallingExtensions=new Map,this._onInstallExtension=this._register(new T.Emitter),this._onDidInstallExtensions=this._register(new T.Emitter),this._onUninstallExtension=this._register(new T.Emitter),this._onDidUninstallExtension=this._register(new T.Emitter),this.participants=[],this._register((0,I.toDisposable)(()=>{this.installingExtensions.forEach(({task:h})=>h.cancel()),this.uninstallingExtensions.forEach(h=>h.cancel()),this.installingExtensions.clear(),this.uninstallingExtensions.clear()}))}async canInstall(i){const r=await this.getTargetPlatform();return i.allTargetPlatforms.some(o=>(0,S.isTargetPlatformCompatible)(o,i.allTargetPlatforms,r))}async installFromGallery(i,r={}){try{if(!this.galleryService.isEnabled())throw new S.ExtensionManagementError(m.localize(0,null),S.ExtensionManagementErrorCode.Internal);const o=await this.checkAndGetCompatibleVersion(i,!!r.installGivenVersion,!!r.installPreReleaseVersion);return await this.installExtension(o.manifest,o.extension,r)}catch(o){throw s(this.telemetryService,"extensionGallery:install",{extensionData:(0,p.getGalleryExtensionTelemetryData)(i),error:o}),this.logService.error("Failed to install extension.",i.identifier.id),this.logService.error(o),f(o)}}async uninstall(i,r={}){return this.logService.trace("ExtensionManagementService#uninstall",i.identifier.id),this.uninstallExtension(i,r)}getExtensionsControlManifest(){const i=new Date().getTime();return(!this.extensionsControlManifest||i-this.lastReportTimestamp>1e3*60*5)&&(this.extensionsControlManifest=this.updateControlCache(),this.lastReportTimestamp=i),this.extensionsControlManifest}registerParticipant(i){this.participants.push(i)}async installExtension(i,r,o){const c={...o,installOnlyNewlyAddedFromExtensionPack:u.URI.isUri(r)?o.installOnlyNewlyAddedFromExtensionPack:!0,profileLocation:(0,b.isApplicationScopedExtension)(i)?this.userDataProfilesService.defaultProfile.extensionsResource:o.profileLocation??this.getCurrentExtensionsManifestLocation()},a=X=>`${p.ExtensionKey.create(X).toString()}${c.profileLocation?`-${c.profileLocation.toString()}`:""}`;if(!u.URI.isUri(r)){const X=this.installingExtensions.get(a(r));if(X){this.logService.info("Extensions is already requested to install",r.identifier.id);const{local:ie}=await X.task.waitUntilTaskIsFinished();return ie}}const h=[],C=[],M=[],_=this.createInstallExtensionTask(i,r,c);u.URI.isUri(r)||this.installingExtensions.set(a(r),{task:_,waitingTasks:[]}),this._onInstallExtension.fire({identifier:_.identifier,source:r,profileLocation:c.profileLocation}),this.logService.info("Installing extension:",_.identifier.id),h.push({task:_,manifest:i});let H=!1;try{if(c.donotIncludePackAndDependencies)this.logService.info("Installing the extension without checking dependencies and pack",_.identifier.id);else try{const ie=await this.getAllDepsAndPackExtensions(_.identifier,i,!!c.installOnlyNewlyAddedFromExtensionPack,!!c.installPreReleaseVersion,c.profileLocation),ne=await this.getInstalled(void 0,c.profileLocation);for(const{gallery:Q,manifest:ge}of(0,O.distinct)(ie,({gallery:le})=>le.identifier.id)){H=H||!!ge.extensionDependencies?.some(de=>(0,p.areSameExtensions)({id:de},_.identifier));const le=a(Q),ae=this.installingExtensions.get(le);if(ae){if(this.canWaitForTask(_,ae.task)){const de=ae.task.identifier;this.logService.info("Waiting for already requested installing extension",de.id,_.identifier.id),ae.waitingTasks.push(_),C.push(T.Event.toPromise(T.Event.filter(this.onDidInstallExtensions,F=>F.some(A=>(0,p.areSameExtensions)(A.identifier,de)))).then(F=>{if(this.logService.info("Finished waiting for already requested installing extension",de.id,_.identifier.id),!F.find(x=>(0,p.areSameExtensions)(x.identifier,de))?.local)throw new Error(`Extension ${de.id} is not installed`)}))}}else if(!ne.some(({identifier:de})=>(0,p.areSameExtensions)(de,Q.identifier))){const de=this.createInstallExtensionTask(ge,Q,{...c,donotIncludePackAndDependencies:!0});this.installingExtensions.set(le,{task:de,waitingTasks:[_]}),this._onInstallExtension.fire({identifier:de.identifier,source:Q,profileLocation:c.profileLocation}),this.logService.info("Installing extension:",de.identifier.id,_.identifier.id),h.push({task:de,manifest:ge})}}}catch(ie){if(u.URI.isUri(_.source))(0,O.isNonEmptyArray)(i.extensionDependencies)&&this.logService.warn("Cannot install dependencies of extension:",_.identifier.id,ie.message),(0,O.isNonEmptyArray)(i.extensionPack)&&this.logService.warn("Cannot install packed extensions of extension:",_.identifier.id,ie.message);else throw this.logService.error("Error while preparing to install dependencies and extension packs of the extension:",_.identifier.id),ie}const X=h.reduce((ie,{task:ne,manifest:Q})=>(ie.set(ne.identifier.id.toLowerCase(),{task:ne,manifest:Q}),ie),new Map);for(;X.size;){let ie;const ne=[...X.values()].filter(({manifest:Q})=>!Q.extensionDependencies?.some(ge=>X.has(ge.toLowerCase())));ne.length?ie=X.size===1?ne:ne.filter(({task:Q})=>!(Q===_&&!H)):(this.logService.info("Found extensions with circular dependencies",ne.map(({task:Q})=>Q.identifier.id)),ie=[...X.values()]),await this.joinAllSettled(ie.map(async({task:Q})=>{const ge=new Date().getTime();try{const{local:le}=await Q.run();if(await this.joinAllSettled(this.participants.map(ae=>ae.postInstall(le,Q.source,c,D.CancellationToken.None))),!u.URI.isUri(Q.source)){const ae=Q.operation===3,de=ae?void 0:(new Date().getTime()-Q.source.lastUpdated)/1e3;if(s(this.telemetryService,ae?"extensionGallery:update":"extensionGallery:install",{extensionData:(0,p.getGalleryExtensionTelemetryData)(Q.source),wasVerified:Q.wasVerified,duration:new Date().getTime()-ge,durationSinceUpdate:de}),g.isWeb&&Q.operation!==3)try{await this.galleryService.reportStatistic(le.manifest.publisher,le.manifest.name,le.manifest.version,"install")}catch{}}M.push({local:le,identifier:Q.identifier,operation:Q.operation,source:Q.source,context:c.context,profileLocation:c.profileLocation,applicationScoped:le.isApplicationScoped})}catch(le){throw u.URI.isUri(Q.source)||s(this.telemetryService,Q.operation===3?"extensionGallery:update":"extensionGallery:install",{extensionData:(0,p.getGalleryExtensionTelemetryData)(Q.source),wasVerified:Q.wasVerified,duration:new Date().getTime()-ge,error:le}),this.logService.error("Error while installing the extension:",Q.identifier.id),le}finally{X.delete(Q.identifier.id.toLowerCase())}}))}return C.length&&await this.joinAllSettled(C),M.forEach(({identifier:ie})=>this.logService.info("Extension installed successfully:",ie.id)),this._onDidInstallExtensions.fire(M),M.filter(({identifier:ie})=>(0,p.areSameExtensions)(ie,_.identifier))[0].local}catch(X){if(h.forEach(({task:ie})=>ie.cancel()),M.length)try{const ie=await Promise.allSettled(M.map(({local:ne})=>this.createUninstallExtensionTask(ne,{versionOnly:!0,profileLocation:c.profileLocation}).run()));for(let ne=0;ne<ie.length;ne++){const Q=ie[ne],{identifier:ge}=M[ne];Q.status==="fulfilled"?this.logService.info("Rollback: Uninstalled extension",ge.id):this.logService.warn("Rollback: Error while uninstalling extension",ge.id,(0,L.getErrorMessage)(Q.reason))}}catch(ie){this.logService.warn("Error while rolling back extensions",(0,L.getErrorMessage)(ie),M.map(({identifier:ne})=>ne.id))}throw this._onDidInstallExtensions.fire(h.map(({task:ie})=>({identifier:ie.identifier,operation:2,source:ie.source,context:c.context,profileLocation:c.profileLocation}))),X}finally{for(const{task:X}of h)X.source&&!u.URI.isUri(X.source)&&this.installingExtensions.delete(a(X.source))}}canWaitForTask(i,r){for(const[,{task:o,waitingTasks:c}]of this.installingExtensions.entries())if(o===i&&(c.includes(r)||c.some(a=>this.canWaitForTask(a,r)))||o===r&&c[0]&&!this.canWaitForTask(i,c[0]))return!1;return!0}async joinAllSettled(i){const r=[],o=[],c=await Promise.allSettled(i);for(const a of c)a.status==="fulfilled"?r.push(a.value):o.push(a.reason);if(o.length)throw v(o);return r}async getAllDepsAndPackExtensions(i,r,o,c,a){if(!this.galleryService.isEnabled())return[];const h=await this.getInstalled(void 0,a),C=[],M=[],_=async(H,X)=>{C.push(H);const ie=X.extensionDependencies||[],ne=[...ie];if(X.extensionPack){const Q=o?h.find(ge=>(0,p.areSameExtensions)(ge.identifier,H)):void 0;for(const ge of X.extensionPack)Q&&Q.manifest.extensionPack&&Q.manifest.extensionPack.some(le=>(0,p.areSameExtensions)({id:le},{id:ge}))||ne.every(le=>!(0,p.areSameExtensions)({id:le},{id:ge}))&&ne.push(ge)}if(ne.length){const Q=ne.filter(ge=>C.every(le=>!(0,p.areSameExtensions)(le,{id:ge})));if(Q.length){const ge=await this.galleryService.getExtensions(Q.map(le=>({id:le,preRelease:c})),D.CancellationToken.None);for(const le of ge){if(C.find(F=>(0,p.areSameExtensions)(F,le.identifier)))continue;const ae=ie.some(F=>(0,p.areSameExtensions)({id:F},le.identifier));let de;try{de=await this.checkAndGetCompatibleVersion(le,!1,c)}catch(F){if(F instanceof S.ExtensionManagementError&&F.code===S.ExtensionManagementErrorCode.IncompatibleTargetPlatform&&!ae){this.logService.info("Skipping the packed extension as it cannot be installed",le.identifier.id);continue}else throw F}M.push({gallery:de.extension,manifest:de.manifest}),await _(de.extension.identifier,de.manifest)}}}};return await _(i,r),M}async checkAndGetCompatibleVersion(i,r,o){if((await this.getExtensionsControlManifest()).malicious.some(C=>(0,p.areSameExtensions)(i.identifier,C)))throw new S.ExtensionManagementError(m.localize(1,null,i.identifier.id),S.ExtensionManagementErrorCode.Malicious);if(!await this.canInstall(i)){const C=await this.getTargetPlatform();throw new S.ExtensionManagementError(m.localize(2,null,i.identifier.id,this.productService.nameLong,(0,S.TargetPlatformToString)(C)),S.ExtensionManagementErrorCode.IncompatibleTargetPlatform)}const a=await this.getCompatibleVersion(i,r,o);if(a){if(o&&!r&&i.hasPreReleaseVersion&&!a.properties.isPreReleaseVersion)throw new S.ExtensionManagementError(m.localize(3,null,i.identifier.id,this.productService.nameLong,this.productService.version),S.ExtensionManagementErrorCode.IncompatiblePreRelease)}else throw!o&&i.properties.isPreReleaseVersion&&(await this.galleryService.getExtensions([i.identifier],D.CancellationToken.None))[0]?new S.ExtensionManagementError(m.localize(4,null,i.identifier.id),S.ExtensionManagementErrorCode.ReleaseVersionNotFound):new S.ExtensionManagementError(m.localize(5,null,i.identifier.id,this.productService.nameLong,this.productService.version),S.ExtensionManagementErrorCode.Incompatible);this.logService.info("Getting Manifest...",a.identifier.id);const h=await this.galleryService.getManifest(a,D.CancellationToken.None);if(h===null)throw new S.ExtensionManagementError(`Missing manifest for extension ${i.identifier.id}`,S.ExtensionManagementErrorCode.Invalid);if(h.version!==a.version)throw new S.ExtensionManagementError(`Cannot install '${i.identifier.id}' extension because of version mismatch in Marketplace`,S.ExtensionManagementErrorCode.Invalid);return{extension:a,manifest:h}}async getCompatibleVersion(i,r,o){const c=await this.getTargetPlatform();let a=null;return!r&&i.hasPreReleaseVersion&&i.properties.isPreReleaseVersion!==o&&(a=(await this.galleryService.getExtensions([{...i.identifier,preRelease:o}],{targetPlatform:c,compatible:!0},D.CancellationToken.None))[0]||null),!a&&await this.galleryService.isExtensionCompatible(i,o,c)&&(a=i),a||(r?a=(await this.galleryService.getExtensions([{...i.identifier,version:i.version}],{targetPlatform:c,compatible:!0},D.CancellationToken.None))[0]||null:a=await this.galleryService.getCompatibleExtension(i,o,c)),a}async uninstallExtension(i,r){const o={...r,profileLocation:i.isApplicationScoped?this.userDataProfilesService.defaultProfile.extensionsResource:r.profileLocation??this.getCurrentExtensionsManifestLocation()},c=H=>`${H.id.toLowerCase()}${o.versionOnly?`-${i.manifest.version}`:""}${o.profileLocation?`@${o.profileLocation.toString()}`:""}`,a=this.uninstallingExtensions.get(c(i.identifier));if(a)return this.logService.info("Extensions is already requested to uninstall",i.identifier.id),a.waitUntilTaskIsFinished();const h=H=>{const X=this.createUninstallExtensionTask(H,o);return this.uninstallingExtensions.set(c(X.extension.identifier),X),o.profileLocation?this.logService.info("Uninstalling extension from the profile:",`${H.identifier.id}@${H.manifest.version}`,o.profileLocation.toString()):this.logService.info("Uninstalling extension:",`${H.identifier.id}@${H.manifest.version}`),this._onUninstallExtension.fire({identifier:H.identifier,profileLocation:o.profileLocation,applicationScoped:H.isApplicationScoped}),X},C=(H,X)=>{X?o.profileLocation?this.logService.error("Failed to uninstall extension from the profile:",`${H.identifier.id}@${H.manifest.version}`,o.profileLocation.toString(),X.message):this.logService.error("Failed to uninstall extension:",`${H.identifier.id}@${H.manifest.version}`,X.message):o.profileLocation?this.logService.info("Successfully uninstalled extension from the profile",`${H.identifier.id}@${H.manifest.version}`,o.profileLocation.toString()):this.logService.info("Successfully uninstalled extension:",`${H.identifier.id}@${H.manifest.version}`),s(this.telemetryService,"extensionGallery:uninstall",{extensionData:(0,p.getLocalExtensionTelemetryData)(H),error:X}),this._onDidUninstallExtension.fire({identifier:H.identifier,error:X?.code,profileLocation:o.profileLocation,applicationScoped:H.isApplicationScoped})},M=[],_=[];try{M.push(h(i));const H=await this.getInstalled(1,o.profileLocation);if(o.donotIncludePack)this.logService.info("Uninstalling the extension without including packed extension",`${i.identifier.id}@${i.manifest.version}`);else{const X=this.getAllPackExtensionsToUninstall(i,H);for(const ie of X)this.uninstallingExtensions.has(c(ie.identifier))?this.logService.info("Extensions is already requested to uninstall",ie.identifier.id):M.push(h(ie))}o.donotCheckDependents?this.logService.info("Uninstalling the extension without checking dependents",`${i.identifier.id}@${i.manifest.version}`):this.checkForDependents(M.map(X=>X.extension),H,i),await this.joinAllSettled(M.map(async X=>{try{if(await X.run(),await this.joinAllSettled(this.participants.map(ie=>ie.postUninstall(X.extension,o,D.CancellationToken.None))),X.extension.identifier.uuid)try{await this.galleryService.reportStatistic(X.extension.manifest.publisher,X.extension.manifest.name,X.extension.manifest.version,"uninstall")}catch{}C(X.extension)}catch(ie){const ne=ie instanceof S.ExtensionManagementError?ie:new S.ExtensionManagementError((0,L.getErrorMessage)(ie),S.ExtensionManagementErrorCode.Internal);throw C(X.extension,ne),ne}finally{_.push(X)}}))}catch(H){const X=H instanceof S.ExtensionManagementError?H:new S.ExtensionManagementError((0,L.getErrorMessage)(H),S.ExtensionManagementErrorCode.Internal);for(const ie of M){try{ie.cancel()}catch{}_.includes(ie)||C(ie.extension,X)}throw X}finally{for(const H of M)this.uninstallingExtensions.delete(c(H.extension.identifier))||this.logService.warn("Uninstallation task is not found in the cache",H.extension.identifier.id)}}checkForDependents(i,r,o){for(const c of i){const a=this.getDependents(c,r);if(a.length){const h=a.filter(C=>!i.some(M=>(0,p.areSameExtensions)(M.identifier,C.identifier)));if(h.length)throw new Error(this.getDependentsErrorMessage(c,h,o))}}}getDependentsErrorMessage(i,r,o){return o===i?r.length===1?m.localize(6,null,o.manifest.displayName||o.manifest.name,r[0].manifest.displayName||r[0].manifest.name):r.length===2?m.localize(7,null,o.manifest.displayName||o.manifest.name,r[0].manifest.displayName||r[0].manifest.name,r[1].manifest.displayName||r[1].manifest.name):m.localize(8,null,o.manifest.displayName||o.manifest.name,r[0].manifest.displayName||r[0].manifest.name,r[1].manifest.displayName||r[1].manifest.name):r.length===1?m.localize(9,null,o.manifest.displayName||o.manifest.name,i.manifest.displayName||i.manifest.name,r[0].manifest.displayName||r[0].manifest.name):r.length===2?m.localize(10,null,o.manifest.displayName||o.manifest.name,i.manifest.displayName||i.manifest.name,r[0].manifest.displayName||r[0].manifest.name,r[1].manifest.displayName||r[1].manifest.name):m.localize(11,null,o.manifest.displayName||o.manifest.name,i.manifest.displayName||i.manifest.name,r[0].manifest.displayName||r[0].manifest.name,r[1].manifest.displayName||r[1].manifest.name)}getAllPackExtensionsToUninstall(i,r,o=[]){if(o.indexOf(i)!==-1)return[];o.push(i);const c=i.manifest.extensionPack?i.manifest.extensionPack:[];if(c.length){const a=r.filter(C=>!C.isBuiltin&&c.some(M=>(0,p.areSameExtensions)({id:M},C.identifier))),h=[];for(const C of a)h.push(...this.getAllPackExtensionsToUninstall(C,r,o));return[...a,...h]}return[]}getDependents(i,r){return r.filter(o=>o.manifest.extensionDependencies&&o.manifest.extensionDependencies.some(c=>(0,p.areSameExtensions)({id:c},i.identifier)))}async updateControlCache(){try{this.logService.trace("ExtensionManagementService.refreshReportedCache");const i=await this.galleryService.getExtensionsControlManifest();return this.logService.trace("ExtensionManagementService.refreshControlCache",i),i}catch{return this.logService.trace("ExtensionManagementService.refreshControlCache - failed to get extension control manifest"),{malicious:[],deprecated:{}}}}};d=me([Z(0,S.IExtensionGalleryService),Z(1,E.ITelemetryService),Z(2,y.ILogService),Z(3,w.IProductService),Z(4,l.IUserDataProfilesService)],d),e.AbstractExtensionManagementService=d;function v(n){const i=Array.isArray(n)?n:[n];return i.length===1?i[0]instanceof Error?i[0]:new Error(i[0]):i.reduce((r,o)=>new Error(`${r.message}${r.message?",":""}${o instanceof Error?o.message:o}`),new Error(""))}e.joinErrors=v;function f(n){if(n instanceof S.ExtensionManagementError)return n;const i=new S.ExtensionManagementError(n.message,S.ExtensionManagementErrorCode.Internal);return i.stack=n.stack,i}function s(n,i,{extensionData:r,wasVerified:o,duration:c,error:a,durationSinceUpdate:h}){let C,M;a&&(a instanceof S.ExtensionManagementError?(C=a.code,a.code===S.ExtensionManagementErrorCode.Signature&&(M=a.message)):C=S.ExtensionManagementErrorCode.Internal),n.publicLog(i,{...r,wasVerified:o,success:!a,duration:c,errorcode:C,errorcodeDetail:M,durationSinceUpdate:h})}e.reportTelemetry=s;class t{constructor(){this.barrier=new k.Barrier}async waitUntilTaskIsFinished(){return await this.barrier.wait(),this.cancellablePromise}async run(){return this.cancellablePromise||(this.cancellablePromise=(0,k.createCancelablePromise)(i=>this.doRun(i))),this.barrier.open(),this.cancellablePromise}cancel(){this.cancellablePromise||(this.cancellablePromise=(0,k.createCancelablePromise)(i=>new Promise((r,o)=>{const c=i.onCancellationRequested(()=>{c.dispose(),o(new L.CancellationError)})})),this.barrier.open()),this.cancellablePromise.cancel()}}e.AbstractExtensionTask=t}),define(J[42],Y([0,1,3,15,2,4,34,11,24,27,13,8,9,25,28]),function(j,e,O,k,D,L,T,I,g,u,m,S,p,b,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExtensionsProfileScannerService=e.IExtensionsProfileScannerService=void 0,e.IExtensionsProfileScannerService=(0,S.createDecorator)("IExtensionsProfileScannerService");let w=class extends D.Disposable{constructor(d,v,f,s){super(),this.fileService=d,this.userDataProfilesService=v,this.uriIdentityService=f,this.logService=s,this._onAddExtensions=this._register(new L.Emitter),this.onAddExtensions=this._onAddExtensions.event,this._onDidAddExtensions=this._register(new L.Emitter),this.onDidAddExtensions=this._onDidAddExtensions.event,this._onRemoveExtensions=this._register(new L.Emitter),this.onRemoveExtensions=this._onRemoveExtensions.event,this._onDidRemoveExtensions=this._register(new L.Emitter),this.onDidRemoveExtensions=this._onDidRemoveExtensions.event,this.resourcesAccessQueueMap=new T.ResourceMap}scanProfileExtensions(d){return this.withProfileExtensions(d)}async addExtensionsToProfile(d,v){const f=[],s=[];try{return await this.withProfileExtensions(v,t=>{const n=[];for(const i of t)d.some(([r])=>(0,g.areSameExtensions)(r.identifier,i.identifier)&&r.manifest.version!==i.version)?f.push(i):n.push(i);for(const[i,r]of d)if(!n.some(o=>(0,g.areSameExtensions)(o.identifier,i.identifier)&&o.version===i.manifest.version)){const o={identifier:i.identifier,version:i.manifest.version,location:i.location,metadata:r};s.push(o),n.push(o)}return s.length&&this._onAddExtensions.fire({extensions:s,profileLocation:v}),f.length&&this._onRemoveExtensions.fire({extensions:f,profileLocation:v}),n}),s.length&&this._onDidAddExtensions.fire({extensions:s,profileLocation:v}),f.length&&this._onDidRemoveExtensions.fire({extensions:f,profileLocation:v}),s}catch(t){throw s.length&&this._onDidAddExtensions.fire({extensions:s,error:t,profileLocation:v}),f.length&&this._onDidRemoveExtensions.fire({extensions:f,error:t,profileLocation:v}),t}}async removeExtensionFromProfile(d,v){const f=[];this._onRemoveExtensions.fire({extensions:f,profileLocation:v});try{await this.withProfileExtensions(v,s=>{const t=[];for(const n of s)(0,g.areSameExtensions)(n.identifier,d.identifier)?f.push(n):t.push(n);return f.length&&this._onRemoveExtensions.fire({extensions:f,profileLocation:v}),t}),f.length&&this._onDidRemoveExtensions.fire({extensions:f,profileLocation:v})}catch(s){throw f.length&&this._onDidRemoveExtensions.fire({extensions:f,error:s,profileLocation:v}),s}}async withProfileExtensions(d,v){return this.getResourceAccessQueue(d).queue(async()=>{let f=[],s;try{const t=await this.fileService.readFile(d);s=JSON.parse(t.value.toString())}catch(t){if((0,m.toFileOperationResult)(t)!==1)throw t;this.uriIdentityService.extUri.isEqual(d,this.userDataProfilesService.defaultProfile.extensionsResource)&&(s=await this.migrateFromOldDefaultProfileExtensionsLocation())}if(s)for(const t of s){if(!t.identifier){this.logService.info("Ignoring invalid extension while scanning. Identifier does not exist.",t);continue}if(!t.location){this.logService.info("Ignoring invalid extension while scanning. Location does not exist.",t);continue}if(!t.version){this.logService.info("Ignoring invalid extension while scanning. Version does not exist.",t);continue}f.push({identifier:t.identifier,location:I.URI.revive(t.location),version:t.version,metadata:t.metadata})}if(v){f=v(f);const t=f.map(n=>({identifier:n.identifier,version:n.version,location:n.location.toJSON(),metadata:n.metadata}));await this.fileService.writeFile(d,k.VSBuffer.fromString(JSON.stringify(t)))}return f})}async migrateFromOldDefaultProfileExtensionsLocation(){return this._migrationPromise||(this._migrationPromise=(async()=>{const d=this.uriIdentityService.extUri.joinPath(this.userDataProfilesService.defaultProfile.location,"extensions.json");let v;try{v=(await this.fileService.readFile(d)).value.toString()}catch(s){if((0,m.toFileOperationResult)(s)===1)return;throw s}this.logService.info("Migrating extensions from old default profile location",d.toString());let f;try{const s=JSON.parse(v);Array.isArray(s)&&s.every(t=>!!(t&&typeof t=="object"&&(0,u.isIExtensionIdentifier)(t.identifier)&&E(t.location)&&t.version&&typeof t.version=="string"))?f=s:this.logService.warn("Skipping migrating from old default profile locaiton: Found invalid data",s)}catch(s){this.logService.error(s)}if(f)try{await this.fileService.createFile(this.userDataProfilesService.defaultProfile.extensionsResource,k.VSBuffer.fromString(JSON.stringify(f)),{overwrite:!1}),this.logService.info("Migrated extensions from old default profile location to new location",d.toString(),this.userDataProfilesService.defaultProfile.extensionsResource.toString())}catch(s){if((0,m.toFileOperationResult)(s)===3)this.logService.info("Migration from old default profile location to new location is done by another window",d.toString(),this.userDataProfilesService.defaultProfile.extensionsResource.toString());else throw s}try{await this.fileService.del(d)}catch(s){(0,m.toFileOperationResult)(s)!==1&&this.logService.error(s)}return f})()),this._migrationPromise}getResourceAccessQueue(d){let v=this.resourcesAccessQueueMap.get(d);return v||(v=new O.Queue,this.resourcesAccessQueueMap.set(d,v)),v}};w=me([Z(0,m.IFileService),Z(1,b.IUserDataProfilesService),Z(2,y.IUriIdentityService),Z(3,p.ILogService)],w),e.ExtensionsProfileScannerService=w;function E(l){return l?typeof l.path=="string"&&typeof l.scheme=="string":!1}}),define(J[48],Y([0,1,19,3,29,15,10,50,77,2,16,14,12,17,39,53,5,11,90,18,24,27,45,13,8,9,26,4,44,42,25,28,105,106]),function(j,e,O,k,D,L,T,I,g,u,m,S,p,b,y,w,E,l,d,v,f,s,t,n,i,r,o,c,a,h,C,M,_,H){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NativeExtensionsScannerService=e.toExtensionDescription=e.AbstractExtensionsScannerService=e.IExtensionsScannerService=e.Translations=void 0;var X;(function(de){function F(A,x){if(A===x)return!0;const W=Object.keys(A),q=new Set;for(const B of Object.keys(x))q.add(B);if(W.length!==q.size)return!1;for(const B of W){if(A[B]!==x[B])return!1;q.delete(B)}return q.size===0}de.equals=F})(X=e.Translations||(e.Translations={})),e.IExtensionsScannerService=(0,i.createDecorator)("IExtensionsScannerService");let ie=class extends u.Disposable{constructor(F,A,x,W,q,B,ee,P,R,N,U,z){super(),this.systemExtensionsLocation=F,this.userExtensionsLocation=A,this.extensionsControlLocation=x,this.cacheLocation=W,this.userDataProfilesService=q,this.extensionsProfileScannerService=B,this.fileService=ee,this.logService=P,this.environmentService=R,this.productService=N,this.uriIdentityService=U,this.instantiationService=z,this._onDidChangeCache=this._register(new c.Emitter),this.onDidChangeCache=this._onDidChangeCache.event,this.obsoleteFile=(0,b.joinPath)(this.userExtensionsLocation,".obsolete"),this.systemExtensionsCachedScanner=this._register(this.instantiationService.createInstance(ge,(0,b.joinPath)(this.cacheLocation,s.BUILTIN_MANIFEST_CACHE_FILE),this.obsoleteFile)),this.userExtensionsCachedScanner=this._register(this.instantiationService.createInstance(ge,(0,b.joinPath)(this.cacheLocation,s.USER_MANIFEST_CACHE_FILE),this.obsoleteFile)),this.extensionsScanner=this._register(this.instantiationService.createInstance(Q,this.obsoleteFile)),this._initializeDefaultProfileExtensionsPromise=void 0,this._register(this.systemExtensionsCachedScanner.onDidChangeCache(()=>this._onDidChangeCache.fire(0))),this._register(this.userExtensionsCachedScanner.onDidChangeCache(()=>this._onDidChangeCache.fire(1)))}getTargetPlatform(){return this._targetPlatformPromise||(this._targetPlatformPromise=(0,f.computeTargetPlatform)(this.fileService,this.logService)),this._targetPlatformPromise}async scanAllExtensions(F,A,x){const[W,q]=await Promise.all([this.scanSystemExtensions(F),this.scanUserExtensions(A)]),B=x?await this.scanExtensionsUnderDevelopment(F,[...W,...q]):[];return this.dedupExtensions(W,q,B,await this.getTargetPlatform(),!0)}async scanSystemExtensions(F){const A=[];A.push(this.scanDefaultSystemExtensions(!!F.useCache,F.language)),A.push(this.scanDevSystemExtensions(F.language,!!F.checkControlFile));const[x,W]=await Promise.all(A);return this.applyScanOptions([...x,...W],0,F,!1)}async scanUserExtensions(F){const A=F.profileLocation??this.userExtensionsLocation;this.logService.trace("Started scanning user extensions",A);const x=await this.createExtensionScannerInput(A,!!F.profileLocation,1,!F.includeUninstalled,F.language);let q=await(F.useCache&&!x.devMode&&x.excludeObsolete?this.userExtensionsCachedScanner:this.extensionsScanner).scanExtensions(x);return q=await this.applyScanOptions(q,1,F,!0),this.logService.trace("Scanned user extensions:",q.length),q}async scanExtensionsUnderDevelopment(F,A){if(this.environmentService.isExtensionDevelopment&&this.environmentService.extensionDevelopmentLocationURI){const x=(await Promise.all(this.environmentService.extensionDevelopmentLocationURI.filter(W=>W.scheme===m.Schemas.file).map(async W=>{const q=await this.createExtensionScannerInput(W,!1,1,!0,F.language,!1);return(await this.extensionsScanner.scanOneOrMultipleExtensions(q)).map(ee=>(ee.type=A.find(P=>(0,f.areSameExtensions)(P.identifier,ee.identifier))?.type??ee.type,this.extensionsScanner.validate(ee,q)))}))).flat();return this.applyScanOptions(x,"development",F,!0)}return[]}async scanExistingExtension(F,A,x){const W=await this.createExtensionScannerInput(F,!1,A,!0,x.language),q=await this.extensionsScanner.scanExtension(W);return!q||!x.includeInvalid&&!q.isValid?null:q}async scanOneOrMultipleExtensions(F,A,x){const W=await this.createExtensionScannerInput(F,!1,A,!0,x.language),q=await this.extensionsScanner.scanOneOrMultipleExtensions(W);return this.applyScanOptions(q,A,x,!0)}async scanMetadata(F){const A=(0,b.joinPath)(F,"package.json"),x=(await this.fileService.readFile(A)).value.toString();return JSON.parse(x).__metadata}async updateMetadata(F,A){const x=(0,b.joinPath)(F,"package.json"),W=(await this.fileService.readFile(x)).value.toString(),q=JSON.parse(W);A.isMachineScoped=A.isMachineScoped||void 0,A.isBuiltin=A.isBuiltin||void 0,A.installedTimestamp=A.installedTimestamp||void 0,q.__metadata={...q.__metadata,...A},await this.fileService.writeFile((0,b.joinPath)(F,"package.json"),L.VSBuffer.fromString(JSON.stringify(q,null,"	")))}initializeDefaultProfileExtensions(){return this._initializeDefaultProfileExtensionsPromise||(this._initializeDefaultProfileExtensionsPromise=(async()=>{try{const F=this.uriIdentityService.extUri.joinPath(this.userExtensionsLocation,".init-default-profile-extensions");if(await this.fileService.exists(F))return;if(!await this.fileService.exists(this.userDataProfilesService.defaultProfile.extensionsResource)&&!await this.fileService.exists(this.uriIdentityService.extUri.joinPath(this.userDataProfilesService.defaultProfile.location,"extensions.json"))){this.logService.info("Started initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString());const A=await this.scanUserExtensions({includeInvalid:!0});await this.extensionsProfileScannerService.addExtensionsToProfile(A.map(x=>[x,x.metadata]),this.userDataProfilesService.defaultProfile.extensionsResource),this.logService.info("Completed initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString())}try{await this.fileService.createFile(F,L.VSBuffer.fromString(""))}catch(A){(0,n.toFileOperationResult)(A)!==1&&this.logService.warn("Failed to create default profile extensions initialize marker in extensions installation folder.",this.userExtensionsLocation.toString(),(0,T.getErrorMessage)(A))}}catch(F){throw this.logService.error(F),F}})()),this._initializeDefaultProfileExtensionsPromise}async applyScanOptions(F,A,x,W){return x.includeAllVersions||(F=this.dedupExtensions(A===0?F:void 0,A===1?F:void 0,A==="development"?F:void 0,await this.getTargetPlatform(),W)),x.includeInvalid||(F=F.filter(q=>q.isValid)),F.sort((q,B)=>{const ee=S.basename(q.location.fsPath),P=S.basename(B.location.fsPath);return ee<P?-1:ee>P?1:0})}dedupExtensions(F,A,x,W,q){const B=(P,R,N)=>{if(P.isValid&&!R.isValid)return!1;if(P.isValid===R.isValid){if(q&&y.gt(P.manifest.version,R.manifest.version))return this.logService.debug(`Skipping extension ${R.location.path} with lower version ${R.manifest.version} in favour of ${P.location.path} with version ${P.manifest.version}`),!1;if(y.eq(P.manifest.version,R.manifest.version)){if(P.type===0)return this.logService.debug(`Skipping extension ${R.location.path} in favour of system extension ${P.location.path} with same version`),!1;if(P.targetPlatform===W)return this.logService.debug(`Skipping extension ${R.location.path} from different target platform ${R.targetPlatform}`),!1}}return N?this.logService.warn(`Overwriting user extension ${P.location.path} with ${R.location.path}.`):this.logService.debug(`Overwriting user extension ${P.location.path} with ${R.location.path}.`),!0},ee=new Map;return F?.forEach(P=>{const R=s.ExtensionIdentifier.toKey(P.identifier.id),N=ee.get(R);(!N||B(N,P,!1))&&ee.set(R,P)}),A?.forEach(P=>{const R=s.ExtensionIdentifier.toKey(P.identifier.id),N=ee.get(R);if(!N&&F&&P.type===0){this.logService.debug(`Skipping obsolete system extension ${P.location.path}.`);return}(!N||B(N,P,!1))&&ee.set(R,P)}),x?.forEach(P=>{const R=s.ExtensionIdentifier.toKey(P.identifier.id),N=ee.get(R);(!N||B(N,P,!0))&&ee.set(R,P),ee.set(R,P)}),[...ee.values()]}async scanDefaultSystemExtensions(F,A){this.logService.trace("Started scanning system extensions");const x=await this.createExtensionScannerInput(this.systemExtensionsLocation,!1,0,!0,A),q=await(F&&!x.devMode?this.systemExtensionsCachedScanner:this.extensionsScanner).scanExtensions(x);return this.logService.trace("Scanned system extensions:",q.length),q}async scanDevSystemExtensions(F,A){const x=this.environmentService.isBuilt?[]:this.productService.builtInExtensions;if(!x?.length)return[];this.logService.trace("Started scanning dev system extensions");const W=A?await this.getBuiltInExtensionControl():{},q=[],B=l.URI.file(S.normalize(S.join(m.FileAccess.asFileUri("").fsPath,"..",".build","builtInExtensions")));for(const P of x){const R=W[P.name]||"marketplace";switch(R){case"disabled":break;case"marketplace":q.push((0,b.joinPath)(B,P.name));break;default:q.push(l.URI.file(R));break}}const ee=await Promise.all(q.map(async P=>this.extensionsScanner.scanExtension(await this.createExtensionScannerInput(P,!1,0,!0,F))));return this.logService.trace("Scanned dev system extensions:",ee.length),(0,O.coalesce)(ee)}async getBuiltInExtensionControl(){try{const F=await this.fileService.readFile(this.extensionsControlLocation);return JSON.parse(F.value.toString())}catch{return{}}}async createExtensionScannerInput(F,A,x,W,q,B=!0){const ee=await this.getTranslations(q??p.language),P=await this.getMtime(F),R=A&&!this.uriIdentityService.extUri.isEqual(F,this.userDataProfilesService.defaultProfile.extensionsResource)?this.userDataProfilesService.defaultProfile.extensionsResource:void 0,N=R?await this.getMtime(R):void 0;return new ne(F,P,R,N,A,x,W,B,this.productService.version,this.productService.date,this.productService.commit,!this.environmentService.isBuilt,q,ee)}async getMtime(F){try{const A=await this.fileService.stat(F);if(typeof A.mtime=="number")return A.mtime}catch{}}};ie=me([Z(4,C.IUserDataProfilesService),Z(5,h.IExtensionsProfileScannerService),Z(6,n.IFileService),Z(7,r.ILogService),Z(8,v.IEnvironmentService),Z(9,o.IProductService),Z(10,M.IUriIdentityService),Z(11,i.IInstantiationService)],ie),e.AbstractExtensionsScannerService=ie;class ne{constructor(F,A,x,W,q,B,ee,P,R,N,U,z,$,te){this.location=F,this.mtime=A,this.applicationExtensionslocation=x,this.applicationExtensionslocationMtime=W,this.profile=q,this.type=B,this.excludeObsolete=ee,this.validate=P,this.productVersion=R,this.productDate=N,this.productCommit=U,this.devMode=z,this.language=$,this.translations=te}static createNlsConfiguration(F){return{language:F.language,pseudo:F.language==="pseudo",devMode:F.devMode,translations:F.translations}}static equals(F,A){return(0,b.isEqual)(F.location,A.location)&&F.mtime===A.mtime&&(0,b.isEqual)(F.applicationExtensionslocation,A.applicationExtensionslocation)&&F.applicationExtensionslocationMtime===A.applicationExtensionslocationMtime&&F.profile===A.profile&&F.type===A.type&&F.excludeObsolete===A.excludeObsolete&&F.validate===A.validate&&F.productVersion===A.productVersion&&F.productDate===A.productDate&&F.productCommit===A.productCommit&&F.devMode===A.devMode&&F.language===A.language&&X.equals(F.translations,A.translations)}}let Q=class extends u.Disposable{constructor(F,A,x,W,q){super(),this.obsoleteFile=F,this.extensionsProfileScannerService=A,this.uriIdentityService=x,this.fileService=W,this.logService=q}async scanExtensions(F){const A=F.profile?await this.scanExtensionsFromProfile(F):await this.scanExtensionsFromLocation(F);let x={};if(F.excludeObsolete&&F.type===1)try{const W=(await this.fileService.readFile(this.obsoleteFile)).value.toString();x=JSON.parse(W)}catch{}return(0,E.isEmptyObject)(x)?A:A.filter(W=>!x[f.ExtensionKey.create(W).toString()])}async scanExtensionsFromLocation(F){const A=await this.fileService.resolve(F.location);if(!A.children?.length)return[];const x=await Promise.all(A.children.map(async W=>{if(!W.isDirectory||F.type===1&&(0,b.basename)(W.resource).indexOf(".")===0)return null;const q=new ne(W.resource,F.mtime,F.applicationExtensionslocation,F.applicationExtensionslocationMtime,F.profile,F.type,F.excludeObsolete,F.validate,F.productVersion,F.productDate,F.productCommit,F.devMode,F.language,F.translations);return this.scanExtension(q)}));return(0,O.coalesce)(x).sort((W,q)=>W.location.path<q.location.path?-1:1)}async scanExtensionsFromProfile(F){let A=await this.scanExtensionsFromProfileResource(F.location,()=>!0,F);if(F.applicationExtensionslocation&&!this.uriIdentityService.extUri.isEqual(F.location,F.applicationExtensionslocation)){A=A.filter(W=>!W.metadata?.isApplicationScoped);const x=await this.scanExtensionsFromProfileResource(F.applicationExtensionslocation,W=>!!W.metadata?.isApplicationScoped,F);A.push(...x)}return A}async scanExtensionsFromProfileResource(F,A,x){const W=await this.extensionsProfileScannerService.scanProfileExtensions(F);if(!W.length)return[];const q=await Promise.all(W.map(async B=>{if(A(B)){const ee=new ne(B.location,x.mtime,x.applicationExtensionslocation,x.applicationExtensionslocationMtime,x.profile,x.type,x.excludeObsolete,x.validate,x.productVersion,x.productDate,x.productCommit,x.devMode,x.language,x.translations);return this.scanExtension(ee,B.metadata)}return null}));return(0,O.coalesce)(q)}async scanOneOrMultipleExtensions(F){try{if(await this.fileService.exists((0,b.joinPath)(F.location,"package.json"))){const A=await this.scanExtension(F);return A?[A]:[]}else return await this.scanExtensions(F)}catch(A){return this.logService.error(`Error scanning extensions at ${F.location.path}:`,(0,T.getErrorMessage)(A)),[]}}async scanExtension(F,A){try{let x=await this.scanExtensionManifest(F.location);if(x){x.publisher||(x.publisher=s.UNDEFINED_PUBLISHER),A=A??x.__metadata,delete x.__metadata;const W=(0,f.getGalleryExtensionId)(x.publisher,x.name),q=A?.id?{id:W,uuid:A.id}:{id:W},B=A?.isSystem?0:F.type,ee=B===0||!!A?.isBuiltin;H.ImplicitActivationEvents.updateManifest(x),x=await this.translateManifest(F.location,x,ne.createNlsConfiguration(F));const P={type:B,identifier:q,manifest:x,location:F.location,isBuiltin:ee,targetPlatform:A?.targetPlatform??"undefined",metadata:A,isValid:!0,validations:[]};return F.validate?this.validate(P,F):P}}catch(x){F.type!==0&&this.logService.error(x)}return null}validate(F,A){let x=!0;const W=(0,t.validateExtensionManifest)(A.productVersion,A.productDate,A.location,F.manifest,F.isBuiltin);for(const[q,B]of W)q===w.default.Error&&(x=!1,this.logService.error(this.formatMessage(A.location,B)));return F.isValid=x,F.validations=W,F}async scanExtensionManifest(F){const A=(0,b.joinPath)(F,"package.json");let x;try{x=(await this.fileService.readFile(A)).value.toString()}catch(q){return(0,n.toFileOperationResult)(q)!==1&&this.logService.error(this.formatMessage(F,(0,d.localize)(0,null,A.path,q.message))),null}let W;try{W=JSON.parse(x)}catch{const B=[];(0,I.parse)(x,B);for(const ee of B)this.logService.error(this.formatMessage(F,(0,d.localize)(1,null,A.path,ee.offset,ee.length,(0,g.getParseErrorMessage)(ee.error))));return null}return(0,I.getNodeType)(W)!=="object"?(this.logService.error(this.formatMessage(F,(0,d.localize)(2,null,A.path))),null):W}async translateManifest(F,A,x){const W=await this.getLocalizedMessages(F,A,x);if(W)try{const q=[],B=await this.resolveOriginalMessageBundle(W.default,q);if(q.length>0)return q.forEach(P=>{this.logService.error(this.formatMessage(F,(0,d.localize)(3,null,W.default?.path,(0,g.getParseErrorMessage)(P.error))))}),A;if((0,I.getNodeType)(W)!=="object")return this.logService.error(this.formatMessage(F,(0,d.localize)(4,null,W.default?.path))),A;const ee=W.values||Object.create(null);return(0,_.localizeManifest)(A,ee,B)}catch{}return A}async getLocalizedMessages(F,A,x){const W=(0,b.joinPath)(F,"package.nls.json"),q=(R,N)=>{N.forEach(U=>{this.logService.error(this.formatMessage(F,(0,d.localize)(5,null,R?.path,(0,g.getParseErrorMessage)(U.error))))})},B=R=>{this.logService.error(this.formatMessage(F,(0,d.localize)(6,null,R?.path)))},ee=`${A.publisher}.${A.name}`,P=x.translations[ee];if(P)try{const R=l.URI.file(P),N=(await this.fileService.readFile(R)).value.toString(),U=[],z=(0,I.parse)(N,U);return U.length>0?(q(R,U),{values:void 0,default:W}):(0,I.getNodeType)(z)!=="object"?(B(R),{values:void 0,default:W}):{values:z.contents?z.contents.package:void 0,default:W}}catch{return{values:void 0,default:W}}else{if(!await this.fileService.exists(W))return;let N;try{N=await this.findMessageBundles(F,x)}catch{return}if(!N.localized)return{values:void 0,default:N.original};try{const U=(await this.fileService.readFile(N.localized)).value.toString(),z=[],$=(0,I.parse)(U,z);return z.length>0?(q(N.localized,z),{values:void 0,default:N.original}):(0,I.getNodeType)($)!=="object"?(B(N.localized),{values:void 0,default:N.original}):{values:$,default:N.original}}catch{return{values:void 0,default:N.original}}}}async resolveOriginalMessageBundle(F,A){if(F)try{const x=(await this.fileService.readFile(F)).value.toString();return(0,I.parse)(x,A)}catch{}}findMessageBundles(F,A){return new Promise((x,W)=>{const q=B=>{const ee=(0,b.joinPath)(F,`package.nls.${B}.json`);this.fileService.exists(ee).then(P=>{P&&x({localized:ee,original:(0,b.joinPath)(F,"package.nls.json")});const R=B.lastIndexOf("-");R===-1?x({localized:(0,b.joinPath)(F,"package.nls.json"),original:null}):(B=B.substring(0,R),q(B))})};if(A.devMode||A.pseudo||!A.language)return x({localized:(0,b.joinPath)(F,"package.nls.json"),original:null});q(A.language)})}formatMessage(F,A){return`[${F.path}]: ${A}`}};Q=me([Z(1,h.IExtensionsProfileScannerService),Z(2,M.IUriIdentityService),Z(3,n.IFileService),Z(4,r.ILogService)],Q);let ge=class extends Q{constructor(F,A,x,W,q,B){super(A,x,W,q,B),this.cacheFile=F,this.cacheValidatorThrottler=this._register(new k.ThrottledDelayer(3e3)),this._onDidChangeCache=this._register(new c.Emitter),this.onDidChangeCache=this._onDidChangeCache.event}async scanExtensions(F){const A=await this.readExtensionCache();if(this.input=F,A&&A.input&&ne.equals(A.input,this.input))return this.cacheValidatorThrottler.trigger(()=>this.validateCache()),A.result.map(W=>(W.location=l.URI.revive(W.location),W));const x=await super.scanExtensions(F);return await this.writeExtensionCache({input:F,result:x}),x}async readExtensionCache(){try{const F=await this.fileService.readFile(this.cacheFile),A=JSON.parse(F.value.toString());return{result:A.result,input:(0,a.revive)(A.input)}}catch(F){this.logService.debug("Error while reading the extension cache file:",this.cacheFile.path,(0,T.getErrorMessage)(F))}return null}async writeExtensionCache(F){try{await this.fileService.writeFile(this.cacheFile,L.VSBuffer.fromString(JSON.stringify(F)))}catch(A){this.logService.debug("Error while writing the extension cache file:",this.cacheFile.path,(0,T.getErrorMessage)(A))}}async validateCache(){if(!this.input)return;const F=await this.readExtensionCache();if(!F)return;const A=F.result,x=JSON.parse(JSON.stringify(await super.scanExtensions(this.input)));if(!D.equals(x,A))try{await this.fileService.del(this.cacheFile),this._onDidChangeCache.fire()}catch(W){this.logService.error(W)}}};ge=me([Z(2,h.IExtensionsProfileScannerService),Z(3,M.IUriIdentityService),Z(4,n.IFileService),Z(5,r.ILogService)],ge);function le(de,F){const A=(0,f.getExtensionId)(de.manifest.publisher,de.manifest.name);return{id:A,identifier:new s.ExtensionIdentifier(A),isBuiltin:de.type===0,isUserBuiltin:de.type===1&&de.isBuiltin,isUnderDevelopment:F,extensionLocation:de.location,uuid:de.identifier.uuid,targetPlatform:de.targetPlatform,...de.manifest}}e.toExtensionDescription=le;class ae extends ie{constructor(F,A,x,W,q,B,ee,P,R,N,U,z){super(F,A,(0,b.joinPath)(x,".vscode-oss-dev","extensions","control.json"),(0,b.joinPath)(W,s.MANIFEST_CACHE_FOLDER),q,B,ee,P,R,N,U,z),this.translationsPromise=(async()=>{if(p.translationsConfigFile)try{const $=await this.fileService.readFile(l.URI.file(p.translationsConfigFile));return JSON.parse($.value.toString())}catch{}return Object.create(null)})()}getTranslations(F){return this.translationsPromise}}e.NativeExtensionsScannerService=ae}),define(J[144],Y([0,1,57,3,33,4,2,16,14,20,9,25]),function(j,e,O,k,D,L,T,I,g,u,m,S){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExtensionsLifecycle=void 0;let p=class extends T.Disposable{constructor(y,w){super(),this.userDataProfilesService=y,this.logService=w,this.processesLimiter=new k.Limiter(5)}async postUninstall(y){const w=this.parseScript(y,"uninstall");return w&&(this.logService.info(y.identifier.id,y.manifest.version,"Running post uninstall script"),await this.processesLimiter.queue(()=>this.runLifecycleHook(w.script,"uninstall",w.args,!0,y).then(()=>this.logService.info(y.identifier.id,y.manifest.version,"Finished running post uninstall script"),E=>this.logService.error(y.identifier.id,y.manifest.version,`Failed to run post uninstall script: ${E}`)))),u.Promises.rm(this.getExtensionStoragePath(y)).then(void 0,E=>this.logService.error("Error while removing extension storage path",E))}parseScript(y,w){const E=`vscode:${w}`;if(y.location.scheme===I.Schemas.file&&y.manifest&&y.manifest.scripts&&typeof y.manifest.scripts[E]=="string"){const l=y.manifest.scripts[E].split(" ");return l.length<2||l[0]!=="node"||!l[1]?(this.logService.warn(y.identifier.id,y.manifest.version,`${E} should be a node script`),null):{script:(0,g.join)(y.location.fsPath,l[1]),args:l.slice(2)||[]}}return null}runLifecycleHook(y,w,E,l,d){return new Promise((v,f)=>{const s=this.start(y,w,E,d);let t;const n=i=>{t&&(clearTimeout(t),t=null),i?f(i):v(void 0)};s.on("error",i=>{n((0,D.toErrorMessage)(i)||"Unknown")}),s.on("exit",(i,r)=>{n(i?`post-${w} process exited with code ${i}`:void 0)}),l&&(t=setTimeout(()=>{t=null,s.kill(),f("timed out")},5e3))})}start(y,w,E,l){const d={silent:!0,execArgv:void 0},v=(0,O.fork)(y,[`--type=extension-post-${w}`,...E],d);v.stdout.setEncoding("utf8"),v.stderr.setEncoding("utf8");const f=L.Event.fromNodeEventEmitter(v.stdout,"data"),s=L.Event.fromNodeEventEmitter(v.stderr,"data");f(i=>this.logService.info(l.identifier.id,l.manifest.version,`post-${w}`,i)),s(i=>this.logService.error(l.identifier.id,l.manifest.version,`post-${w}`,i));const t=L.Event.any(L.Event.map(f,i=>({data:`%c${i}`,format:[""]})),L.Event.map(s,i=>({data:`%c${i}`,format:["color: red"]})));return L.Event.debounce(t,(i,r)=>i?{data:i.data+r.data,format:[...i.format,...r.format]}:{data:r.data,format:r.format},100)(i=>{console.group(l.identifier.id),console.log(i.data,...i.format),console.groupEnd()}),v}getExtensionStoragePath(y){return(0,g.join)(this.userDataProfilesService.defaultProfile.globalStorageHome.fsPath,y.identifier.id.toLowerCase())}};p=me([Z(0,S.IUserDataProfilesService),Z(1,m.ILogService)],p),e.ExtensionsLifecycle=p}),define(J[145],Y([0,1,11,18,42,48,13,8,9,26,28,25]),function(j,e,O,k,D,L,T,I,g,u,m,S){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExtensionsScannerService=void 0;let p=class extends L.NativeExtensionsScannerService{constructor(y,w,E,l,d,v,f,s){super(O.URI.file(d.builtinExtensionsPath),O.URI.file(d.extensionsPath),d.userHome,O.URI.file(d.userDataPath),y,w,E,l,d,v,f,s)}};p=me([Z(0,S.IUserDataProfilesService),Z(1,D.IExtensionsProfileScannerService),Z(2,T.IFileService),Z(3,g.ILogService),Z(4,k.INativeEnvironmentService),Z(5,u.IProductService),Z(6,m.IUriIdentityService),Z(7,I.IInstantiationService)],p),e.ExtensionsScannerService=p}),define(J[146],Y([0,1,3,4,2,116,5,83,8,25]),function(j,e,O,k,D,L,T,I,g,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.logStorage=e.InMemoryStorageService=e.isProfileUsingDefaultStorage=e.AbstractStorageService=e.loadKeyTargets=e.StorageTarget=e.StorageScope=e.WillSaveStateReason=e.IStorageService=e.TARGET_KEY=e.IS_NEW_KEY=void 0,e.IS_NEW_KEY="__$__isNewStorageMarker",e.TARGET_KEY="__$__targetStorageMarker",e.IStorageService=(0,g.createDecorator)("storageService");var m;(function(d){d[d.NONE=0]="NONE",d[d.SHUTDOWN=1]="SHUTDOWN"})(m=e.WillSaveStateReason||(e.WillSaveStateReason={}));var S;(function(d){d[d.APPLICATION=-1]="APPLICATION",d[d.PROFILE=0]="PROFILE",d[d.WORKSPACE=1]="WORKSPACE"})(S=e.StorageScope||(e.StorageScope={}));var p;(function(d){d[d.USER=0]="USER",d[d.MACHINE=1]="MACHINE"})(p=e.StorageTarget||(e.StorageTarget={}));function b(d){const v=d.get(e.TARGET_KEY);if(v)try{return JSON.parse(v)}catch{}return Object.create(null)}e.loadKeyTargets=b;class y extends D.Disposable{constructor(v={flushInterval:y.DEFAULT_FLUSH_INTERVAL}){super(),this.options=v,this._onDidChangeValue=this._register(new k.PauseableEmitter),this.onDidChangeValue=this._onDidChangeValue.event,this._onDidChangeTarget=this._register(new k.PauseableEmitter),this.onDidChangeTarget=this._onDidChangeTarget.event,this._onWillSaveState=this._register(new k.Emitter),this.onWillSaveState=this._onWillSaveState.event,this.flushWhenIdleScheduler=this._register(new O.RunOnceScheduler(()=>this.doFlushWhenIdle(),this.options.flushInterval)),this.runFlushWhenIdle=this._register(new D.MutableDisposable),this._workspaceKeyTargets=void 0,this._profileKeyTargets=void 0,this._applicationKeyTargets=void 0}doFlushWhenIdle(){this.runFlushWhenIdle.value=(0,O.runWhenIdle)(()=>{this.shouldFlushWhenIdle()&&this.flush(),this.flushWhenIdleScheduler.schedule()})}shouldFlushWhenIdle(){return!0}stopFlushWhenIdle(){(0,D.dispose)([this.runFlushWhenIdle,this.flushWhenIdleScheduler])}initialize(){return this.initializationPromise||(this.initializationPromise=(async()=>{(0,L.mark)("code/willInitStorage");try{await this.doInitialize()}finally{(0,L.mark)("code/didInitStorage")}this.flushWhenIdleScheduler.schedule()})()),this.initializationPromise}emitDidChangeValue(v,f){if(f===e.TARGET_KEY){switch(v){case-1:this._applicationKeyTargets=void 0;break;case 0:this._profileKeyTargets=void 0;break;case 1:this._workspaceKeyTargets=void 0;break}this._onDidChangeTarget.fire({scope:v})}else this._onDidChangeValue.fire({scope:v,key:f,target:this.getKeyTargets(v)[f]})}emitWillSaveState(v){this._onWillSaveState.fire({reason:v})}get(v,f,s){return this.getStorage(f)?.get(v,s)}getBoolean(v,f,s){return this.getStorage(f)?.getBoolean(v,s)}getNumber(v,f,s){return this.getStorage(f)?.getNumber(v,s)}store(v,f,s,t){if((0,T.isUndefinedOrNull)(f)){this.remove(v,s);return}this.withPausedEmitters(()=>{this.updateKeyTarget(v,s,t),this.getStorage(s)?.set(v,f)})}remove(v,f){this.withPausedEmitters(()=>{this.updateKeyTarget(v,f,void 0),this.getStorage(f)?.delete(v)})}withPausedEmitters(v){this._onDidChangeValue.pause(),this._onDidChangeTarget.pause();try{v()}finally{this._onDidChangeValue.resume(),this._onDidChangeTarget.resume()}}keys(v,f){const s=[],t=this.getKeyTargets(v);for(const n of Object.keys(t))t[n]===f&&s.push(n);return s}updateKeyTarget(v,f,s){const t=this.getKeyTargets(f);typeof s=="number"?t[v]!==s&&(t[v]=s,this.getStorage(f)?.set(e.TARGET_KEY,JSON.stringify(t))):typeof t[v]=="number"&&(delete t[v],this.getStorage(f)?.set(e.TARGET_KEY,JSON.stringify(t)))}get workspaceKeyTargets(){return this._workspaceKeyTargets||(this._workspaceKeyTargets=this.loadKeyTargets(1)),this._workspaceKeyTargets}get profileKeyTargets(){return this._profileKeyTargets||(this._profileKeyTargets=this.loadKeyTargets(0)),this._profileKeyTargets}get applicationKeyTargets(){return this._applicationKeyTargets||(this._applicationKeyTargets=this.loadKeyTargets(-1)),this._applicationKeyTargets}getKeyTargets(v){switch(v){case-1:return this.applicationKeyTargets;case 0:return this.profileKeyTargets;default:return this.workspaceKeyTargets}}loadKeyTargets(v){const f=this.getStorage(v);return f?b(f):Object.create(null)}isNew(v){return this.getBoolean(e.IS_NEW_KEY,v)===!0}async flush(v=m.NONE){this._onWillSaveState.fire({reason:v});const f=this.getStorage(-1),s=this.getStorage(0),t=this.getStorage(1);switch(v){case m.NONE:await O.Promises.settled([f?.whenFlushed()??Promise.resolve(),s?.whenFlushed()??Promise.resolve(),t?.whenFlushed()??Promise.resolve()]);break;case m.SHUTDOWN:await O.Promises.settled([f?.flush(0)??Promise.resolve(),s?.flush(0)??Promise.resolve(),t?.flush(0)??Promise.resolve()]);break}}async log(){const v=this.getStorage(-1)?.items??new Map,f=this.getStorage(0)?.items??new Map,s=this.getStorage(1)?.items??new Map;return l(v,f,s,this.getLogDetails(-1)??"",this.getLogDetails(0)??"",this.getLogDetails(1)??"")}async switch(v,f){return this.emitWillSaveState(m.NONE),(0,u.isUserDataProfile)(v)?this.switchToProfile(v,f):this.switchToWorkspace(v,f)}canSwitchProfile(v,f){return!(v.id===f.id||w(f)&&w(v))}switchData(v,f,s,t){this.withPausedEmitters(()=>{if(t)for(const[n,i]of v)f.set(n,i);else{const n=new Set;for(const[i,r]of v)n.add(i),f.get(i)!==r&&this.emitDidChangeValue(s,i);for(const[i]of f.items)n.has(i)||this.emitDidChangeValue(s,i)}})}}e.AbstractStorageService=y,y.DEFAULT_FLUSH_INTERVAL=60*1e3;function w(d){return d.isDefault||!!d.useDefaultFlags?.uiState}e.isProfileUsingDefaultStorage=w;class E extends y{constructor(){super(),this.applicationStorage=this._register(new I.Storage(new I.InMemoryStorageDatabase,{hint:I.StorageHint.STORAGE_IN_MEMORY})),this.profileStorage=this._register(new I.Storage(new I.InMemoryStorageDatabase,{hint:I.StorageHint.STORAGE_IN_MEMORY})),this.workspaceStorage=this._register(new I.Storage(new I.InMemoryStorageDatabase,{hint:I.StorageHint.STORAGE_IN_MEMORY})),this._register(this.workspaceStorage.onDidChangeStorage(v=>this.emitDidChangeValue(1,v))),this._register(this.profileStorage.onDidChangeStorage(v=>this.emitDidChangeValue(0,v))),this._register(this.applicationStorage.onDidChangeStorage(v=>this.emitDidChangeValue(-1,v)))}getStorage(v){switch(v){case-1:return this.applicationStorage;case 0:return this.profileStorage;default:return this.workspaceStorage}}getLogDetails(v){switch(v){case-1:return"inMemory (application)";case 0:return"inMemory (profile)";default:return"inMemory (workspace)"}}async doInitialize(){}async switchToProfile(){}async switchToWorkspace(){}hasScope(v){return!1}}e.InMemoryStorageService=E;async function l(d,v,f,s,t,n){const i=H=>{try{return JSON.parse(H)}catch{return H}},r=new Map,o=new Map;d.forEach((H,X)=>{r.set(X,H),o.set(X,i(H))});const c=new Map,a=new Map;v.forEach((H,X)=>{c.set(X,H),a.set(X,i(H))});const h=new Map,C=new Map;f.forEach((H,X)=>{h.set(X,H),C.set(X,i(H))}),console.group(s!==t?`Storage: Application (path: ${s})`:`Storage: Application & Profile (path: ${s}, default profile)`);const M=[];if(r.forEach((H,X)=>{M.push({key:X,value:H})}),console.table(M),console.groupEnd(),console.log(o),s!==t){console.group(`Storage: Profile (path: ${t}, profile specific)`);const H=[];c.forEach((X,ie)=>{H.push({key:ie,value:X})}),console.table(H),console.groupEnd(),console.log(a)}console.group(`Storage: Workspace (path: ${n})`);const _=[];h.forEach((H,X)=>{_.push({key:X,value:H})}),console.table(_),console.groupEnd(),console.log(C)}e.logStorage=l}),define(J[147],Y([0,1,19,22,10,12,37,5,11,21,18,23,24,45,13,9,26,47,134,146,32]),function(j,e,O,k,D,L,T,I,g,u,m,S,p,b,y,w,E,l,d,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExtensionGalleryServiceWithNoStorageService=e.ExtensionGalleryService=e.sortExtensionVersions=void 0;const s=L.isWeb?"web":(0,S.getTargetPlatform)(L.platform,T.arch);var t;(function(P){P[P.None=0]="None",P[P.IncludeVersions=1]="IncludeVersions",P[P.IncludeFiles=2]="IncludeFiles",P[P.IncludeCategoryAndTags=4]="IncludeCategoryAndTags",P[P.IncludeSharedAccounts=8]="IncludeSharedAccounts",P[P.IncludeVersionProperties=16]="IncludeVersionProperties",P[P.ExcludeNonValidated=32]="ExcludeNonValidated",P[P.IncludeInstallationTargets=64]="IncludeInstallationTargets",P[P.IncludeAssetUri=128]="IncludeAssetUri",P[P.IncludeStatistics=256]="IncludeStatistics",P[P.IncludeLatestVersionOnly=512]="IncludeLatestVersionOnly",P[P.Unpublished=4096]="Unpublished",P[P.IncludeNameConflictInfo=32768]="IncludeNameConflictInfo"})(t||(t={}));function n(...P){return String(P.reduce((R,N)=>R|N,0))}var i;(function(P){P[P.Tag=1]="Tag",P[P.ExtensionId=4]="ExtensionId",P[P.Category=5]="Category",P[P.ExtensionName=7]="ExtensionName",P[P.Target=8]="Target",P[P.Featured=9]="Featured",P[P.SearchText=10]="SearchText",P[P.ExcludeWithFlags=12]="ExcludeWithFlags"})(i||(i={}));const r={Icon:"Microsoft.VisualStudio.Services.Icons.Default",Details:"Microsoft.VisualStudio.Services.Content.Details",Changelog:"Microsoft.VisualStudio.Services.Content.Changelog",Manifest:"Microsoft.VisualStudio.Code.Manifest",VSIX:"Microsoft.VisualStudio.Services.VSIXPackage",License:"Microsoft.VisualStudio.Services.Content.License",Repository:"Microsoft.VisualStudio.Services.Links.Source",Signature:"Microsoft.VisualStudio.Services.VsixSignature"},o={Dependency:"Microsoft.VisualStudio.Code.ExtensionDependencies",ExtensionPack:"Microsoft.VisualStudio.Code.ExtensionPack",Engine:"Microsoft.VisualStudio.Code.Engine",PreRelease:"Microsoft.VisualStudio.Code.PreRelease",LocalizedLanguages:"Microsoft.VisualStudio.Code.LocalizedLanguages",WebExtension:"Microsoft.VisualStudio.Code.WebExtension",SponsorLink:"Microsoft.VisualStudio.Code.SponsorLink"},a={pageNumber:1,pageSize:10,sortBy:0,sortOrder:0,flags:t.None,criteria:[],assetTypes:[]};class h{constructor(R=a){this.state=R}get pageNumber(){return this.state.pageNumber}get pageSize(){return this.state.pageSize}get sortBy(){return this.state.sortBy}get sortOrder(){return this.state.sortOrder}get flags(){return this.state.flags}get criteria(){return this.state.criteria}withPage(R,N=this.state.pageSize){return new h({...this.state,pageNumber:R,pageSize:N})}withFilter(R,...N){const U=[...this.state.criteria,...N.length?N.map(z=>({filterType:R,value:z})):[{filterType:R}]];return new h({...this.state,criteria:U})}withSortBy(R){return new h({...this.state,sortBy:R})}withSortOrder(R){return new h({...this.state,sortOrder:R})}withFlags(...R){return new h({...this.state,flags:R.reduce((N,U)=>N|U,0)})}withAssetTypes(...R){return new h({...this.state,assetTypes:R})}withSource(R){return new h({...this.state,source:R})}get raw(){const{criteria:R,pageNumber:N,pageSize:U,sortBy:z,sortOrder:$,flags:te,assetTypes:re}=this.state;return{filters:[{criteria:R,pageNumber:N,pageSize:U,sortBy:z,sortOrder:$}],assetTypes:re,flags:te}}get searchText(){const R=this.state.criteria.filter(N=>N.filterType===i.SearchText)[0];return R&&R.value?R.value:""}get telemetryData(){return{filterTypes:this.state.criteria.map(R=>String(R.filterType)),flags:this.state.flags,sortBy:String(this.sortBy),sortOrder:String(this.sortOrder),pageNumber:String(this.pageNumber),source:this.state.source,searchTextLength:this.searchText.length}}}function C(P,R){const N=(P||[]).filter(U=>U.statisticName===R)[0];return N?N.value:0}function M(P){const R="Microsoft.VisualStudio.Code.Translation.";return P.files.filter(U=>U.assetType.indexOf(R)===0).reduce((U,z)=>{const $=X(P,z.assetType);return $&&U.push([z.assetType.substring(R.length),$]),U},[])}function _(P){if(P.properties){const R=P.properties.filter(z=>z.key===r.Repository),N=new RegExp("((git|ssh|http(s)?)|(git@[\\w.]+))(:(//)?)([\\w.@:/\\-~]+)(.git)(/)?"),U=R.filter(z=>N.test(z.value))[0];return U?{uri:U.value,fallbackUri:U.value}:null}return X(P,r.Repository)}function H(P){return{uri:`${P.fallbackAssetUri}/${r.VSIX}?redirect=true${P.targetPlatform?`&targetPlatform=${P.targetPlatform}`:""}`,fallbackUri:`${P.fallbackAssetUri}/${r.VSIX}${P.targetPlatform?`?targetPlatform=${P.targetPlatform}`:""}`}}function X(P,R){return P.files.filter(U=>U.assetType===R)[0]?{uri:`${P.assetUri}/${R}${P.targetPlatform?`?targetPlatform=${P.targetPlatform}`:""}`,fallbackUri:`${P.fallbackAssetUri}/${R}${P.targetPlatform?`?targetPlatform=${P.targetPlatform}`:""}`}:null}function ie(P,R){const N=P.properties?P.properties.filter(z=>z.key===R):[],U=N.length>0&&N[0].value;return U?U.split(",").map(z=>(0,p.adoptToGalleryExtensionId)(z)):[]}function ne(P){const R=P.properties?P.properties.filter(N=>N.key===o.Engine):[];return R.length>0&&R[0].value||""}function Q(P){const R=P.properties?P.properties.filter(N=>N.key===o.PreRelease):[];return R.length>0&&R[0].value==="true"}function ge(P){const R=P.properties?P.properties.filter(U=>U.key===o.LocalizedLanguages):[],N=R.length>0&&R[0].value||"";return N?N.split(","):[]}function le(P){return P.properties?.find(R=>R.key===o.SponsorLink)?.value}function ae(P){return P.indexOf("preview")!==-1}function de(P){return P.targetPlatform?(0,S.toTargetPlatform)(P.targetPlatform):"undefined"}function F(P){const R=(0,O.distinct)(P.versions.map(de)),N=!!P.tags?.includes(S.WEB_EXTENSION_TAG),U=R.indexOf("web");return N?U===-1&&R.push("web"):U!==-1&&R.splice(U,1),R}function A(P,R){const N=(0,S.getFallbackTargetPlarforms)(R);for(let U=0;U<P.length;U++){const z=P[U];if(z.version===P[U-1]?.version){let $=U;const te=de(z);if(te===R)for(;$>0&&P[$-1].version===z.version;)$--;else if(N.includes(te))for(;$>0&&P[$-1].version===z.version&&de(P[$-1])!==R;)$--;$!==U&&(P.splice(U,1),P.splice($,0,z))}}return P}e.sortExtensionVersions=A;function x(P,R,N){P.telemetryData={index:R,querySource:N}}function W(P,R,N){const U=P.versions[0],z={manifest:X(R,r.Manifest),readme:X(R,r.Details),changelog:X(R,r.Changelog),license:X(R,r.License),repository:_(R),download:H(R),icon:X(R,r.Icon),signature:X(R,r.Signature),coreTranslations:M(R)};return{identifier:{id:(0,p.getGalleryExtensionId)(P.publisher.publisherName,P.extensionName),uuid:P.extensionId},name:P.extensionName,version:R.version,displayName:P.displayName,publisherId:P.publisher.publisherId,publisher:P.publisher.publisherName,publisherDisplayName:P.publisher.displayName,publisherDomain:P.publisher.domain?{link:P.publisher.domain,verified:!!P.publisher.isDomainVerified}:void 0,publisherSponsorLink:le(U),description:P.shortDescription||"",installCount:C(P.statistics,"install"),rating:C(P.statistics,"averagerating"),ratingCount:C(P.statistics,"ratingcount"),categories:P.categories||[],tags:P.tags||[],releaseDate:Date.parse(P.releaseDate),lastUpdated:Date.parse(P.lastUpdated),allTargetPlatforms:N,assets:z,properties:{dependencies:ie(R,o.Dependency),extensionPack:ie(R,o.ExtensionPack),engine:ne(R),localizedLanguages:ge(R),targetPlatform:de(R),isPreReleaseVersion:Q(R)},hasPreReleaseVersion:Q(U),hasReleaseVersion:!0,preview:ae(P.flags),isSigned:!!z.signature}}let q=class{constructor(R,N,U,z,$,te,re,pe){this.requestService=N,this.logService=U,this.environmentService=z,this.telemetryService=$,this.fileService=te,this.productService=re,this.configurationService=pe;const Se=re.extensionsGallery,oe=Se?.servicePPEUrl&&pe.getValue("_extensionsGallery.enablePPE");this.extensionsGalleryUrl=oe?Se.servicePPEUrl:Se?.serviceUrl,this.extensionsGallerySearchUrl=oe?void 0:Se?.searchUrl,this.extensionsControlUrl=Se?.controlUrl,this.commonHeadersPromise=(0,d.resolveMarketplaceHeaders)(re.version,re,this.environmentService,this.configurationService,this.fileService,R,this.telemetryService)}api(R=""){return`${this.extensionsGalleryUrl}${R}`}isEnabled(){return!!this.extensionsGalleryUrl}async getExtensions(R,N,U){const z=k.CancellationToken.isCancellationToken(N)?{}:N,$=k.CancellationToken.isCancellationToken(N)?N:U,te=[],re=[],pe=[],Se=[];let oe=!0;for(const se of R){se.uuid?re.push(se.uuid):te.push(se.id);const fe=!!(se.version||se.preRelease);pe.push({id:se.id,uuid:se.uuid,includePreRelease:fe}),se.version&&Se.push({id:se.id,uuid:se.uuid,version:se.version}),oe=oe&&!!se.hasPreRelease&&!fe}if(!re.length&&!te.length)return[];let ue=new h().withPage(1,R.length);re.length&&(ue=ue.withFilter(i.ExtensionId,...re)),te.length&&(ue=ue.withFilter(i.ExtensionName,...te)),(z.queryAllVersions||oe)&&(ue=ue.withFlags(ue.flags,t.IncludeVersions)),z.source&&(ue=ue.withSource(z.source));const{extensions:ce}=await this.queryGalleryExtensions(ue,{targetPlatform:z.targetPlatform??s,includePreRelease:pe,versions:Se,compatible:!!z.compatible},$);return z.source&&ce.forEach((se,fe)=>x(se,fe,z.source)),ce}async getCompatibleExtension(R,N,U){if((0,S.isNotWebExtensionInWebTargetPlatform)(R.allTargetPlatforms,U))return null;if(await this.isExtensionCompatible(R,N,U))return R;const z=new h().withFlags(t.IncludeVersions).withPage(1,1).withFilter(i.ExtensionId,R.identifier.uuid),{extensions:$}=await this.queryGalleryExtensions(z,{targetPlatform:U,compatible:!0,includePreRelease:N},k.CancellationToken.None);return $[0]||null}async isExtensionCompatible(R,N,U){if(!(0,S.isTargetPlatformCompatible)(R.properties.targetPlatform,R.allTargetPlatforms,U)||!N&&R.properties.isPreReleaseVersion)return!1;let z=R.properties.engine;if(!z){const $=await this.getManifest(R,k.CancellationToken.None);if(!$)throw new Error("Manifest was not found");z=$.engines.vscode}return(0,b.isEngineValid)(z,this.productService.version,this.productService.date)}async isValidVersion(R,N,U,z,$){if(!(0,S.isTargetPlatformCompatible)(de(R),z,$)||N!=="any"&&Q(R)!==(N==="prerelease"))return!1;if(U)try{const te=await this.getEngine(R);if(!(0,b.isEngineValid)(te,this.productService.version,this.productService.date))return!1}catch(te){return this.logService.error(`Error while getting the engine for the version ${R.version}.`,(0,D.getErrorMessage)(te)),!1}return!0}async query(R,N){let U=R.text||"";const z=R.pageSize??50;let $=new h().withPage(1,z);U?(U=U.replace(/\bcategory:("([^"]*)"|([^"]\S*))(\s+|\b|$)/g,(oe,ue,ce)=>($=$.withFilter(i.Category,ce||ue),"")),U=U.replace(/\btag:("([^"]*)"|([^"]\S*))(\s+|\b|$)/g,(oe,ue,ce)=>($=$.withFilter(i.Tag,ce||ue),"")),U=U.replace(/\bfeatured(\s+|\b|$)/g,()=>($=$.withFilter(i.Featured),"")),U=U.trim(),U&&(U=U.length<200?U:U.substring(0,200),$=$.withFilter(i.SearchText,U)),$=$.withSortBy(0)):R.ids?$=$.withFilter(i.ExtensionId,...R.ids):R.names?$=$.withFilter(i.ExtensionName,...R.names):$=$.withSortBy(4),typeof R.sortBy=="number"&&($=$.withSortBy(R.sortBy)),typeof R.sortOrder=="number"&&($=$.withSortOrder(R.sortOrder)),R.source&&($=$.withSource(R.source));const te=async(oe,ue)=>{const{extensions:ce,total:se}=await this.queryGalleryExtensions(oe,{targetPlatform:s,compatible:!1,includePreRelease:!!R.includePreRelease},ue);return ce.forEach((fe,Le)=>x(fe,(oe.pageNumber-1)*oe.pageSize+Le,R.source)),{extensions:ce,total:se}},{extensions:re,total:pe}=await te($,N),Se=async(oe,ue)=>{if(ue.isCancellationRequested)throw new D.CancellationError;const{extensions:ce}=await te($.withPage(oe+1),ue);return ce};return{firstPage:re,total:pe,pageSize:$.pageSize,getPage:Se}}async queryGalleryExtensions(R,N,U){const z=R.flags;!!(R.flags&t.IncludeLatestVersionOnly)&&!!(R.flags&t.IncludeVersions)&&(R=R.withFlags(R.flags&~t.IncludeVersions,t.IncludeLatestVersionOnly)),!(R.flags&t.IncludeLatestVersionOnly)&&!(R.flags&t.IncludeVersions)&&(R=R.withFlags(R.flags,t.IncludeLatestVersionOnly)),N.versions?.length&&(R=R.withFlags(R.flags&~t.IncludeLatestVersionOnly,t.IncludeVersions)),R=R.withFlags(R.flags,t.IncludeAssetUri,t.IncludeCategoryAndTags,t.IncludeFiles,t.IncludeStatistics,t.IncludeVersionProperties);const{galleryExtensions:$,total:te}=await this.queryRawGalleryExtensions(R,U);if(!(R.flags&t.IncludeLatestVersionOnly)){const oe=[];for(const ue of $){const ce=await this.toGalleryExtensionWithCriteria(ue,N);ce&&oe.push(ce)}return{extensions:oe,total:te}}const pe=[],Se=new Map;for(let oe=0;oe<$.length;oe++){const ue=$[oe],ce={id:(0,p.getGalleryExtensionId)(ue.publisher.publisherName,ue.extensionName),uuid:ue.extensionId},se=(0,I.isBoolean)(N.includePreRelease)?N.includePreRelease:!!N.includePreRelease.find(Le=>(0,p.areSameExtensions)(Le,ce))?.includePreRelease;if(N.compatible&&(0,S.isNotWebExtensionInWebTargetPlatform)(F(ue),N.targetPlatform))continue;const fe=await this.toGalleryExtensionWithCriteria(ue,N);!fe||fe.properties.isPreReleaseVersion&&(!se||!fe.hasReleaseVersion)||!fe.properties.isPreReleaseVersion&&fe.properties.targetPlatform!==N.targetPlatform&&fe.hasPreReleaseVersion?Se.set(ue.extensionId,oe):pe.push([oe,fe])}if(Se.size){const oe=new Date().getTime(),ue=new h().withFlags(z&~t.IncludeLatestVersionOnly,t.IncludeVersions).withPage(1,Se.size).withFilter(i.ExtensionId,...Se.keys()),{extensions:ce}=await this.queryGalleryExtensions(ue,N,U);this.telemetryService.publicLog2("galleryService:additionalQuery",{duration:new Date().getTime()-oe,count:Se.size});for(const se of ce){const fe=Se.get(se.identifier.uuid);pe.push([fe,se])}}return{extensions:pe.sort((oe,ue)=>oe[0]-ue[0]).map(([,oe])=>oe),total:te}}async toGalleryExtensionWithCriteria(R,N){const U={id:(0,p.getGalleryExtensionId)(R.publisher.publisherName,R.extensionName),uuid:R.extensionId},z=N.versions?.find(pe=>(0,p.areSameExtensions)(pe,U))?.version,$=(0,I.isBoolean)(N.includePreRelease)?N.includePreRelease:!!N.includePreRelease.find(pe=>(0,p.areSameExtensions)(pe,U))?.includePreRelease,te=F(R),re=A(R.versions,N.targetPlatform);if(N.compatible&&(0,S.isNotWebExtensionInWebTargetPlatform)(te,N.targetPlatform))return null;for(let pe=0;pe<re.length;pe++){const Se=re[pe];if(!(z&&Se.version!==z)){if(await this.isValidVersion(Se,$?"any":"release",N.compatible,te,N.targetPlatform))return W(R,Se,te);if(z&&Se.version===z)return null}}return z||N.compatible?null:W(R,R.versions[0],te)}async queryRawGalleryExtensions(R,N){if(!this.isEnabled())throw new Error("No extension gallery service configured.");R=R.withFlags(R.flags,t.ExcludeNonValidated).withFilter(i.Target,"Microsoft.VisualStudio.Code").withFilter(i.ExcludeWithFlags,n(t.Unpublished));const U=await this.commonHeadersPromise,z=JSON.stringify(R.raw),$={...U,"Content-Type":"application/json",Accept:"application/json;api-version=3.0-preview.1","Accept-Encoding":"gzip","Content-Length":String(z.length)},te=new Date().getTime();let re,pe,Se=0;try{if(re=await this.requestService.request({type:"POST",url:this.extensionsGallerySearchUrl&&R.criteria.some(ue=>ue.filterType===i.SearchText)?this.extensionsGallerySearchUrl:this.api("/extensionquery"),data:z,headers:$},N),re.res.statusCode&&re.res.statusCode>=400&&re.res.statusCode<500)return{galleryExtensions:[],total:Se};const oe=await(0,l.asJson)(re);if(oe){const ue=oe.results[0],ce=ue.extensions,se=ue.resultMetadata&&ue.resultMetadata.filter(fe=>fe.metadataType==="ResultCount")[0];return Se=se&&se.metadataItems.filter(fe=>fe.name==="TotalCount")[0].count||0,{galleryExtensions:ce,total:Se}}return{galleryExtensions:[],total:Se}}catch(oe){throw pe=oe,oe}finally{this.telemetryService.publicLog2("galleryService:query",{...R.telemetryData,requestBodySize:String(z.length),duration:new Date().getTime()-te,success:!!re&&(0,l.isSuccess)(re),responseBodySize:re?.res.headers["Content-Length"],statusCode:re?String(re.res.statusCode):void 0,errorCode:pe?(0,D.isCancellationError)(pe)?"canceled":(0,D.getErrorMessage)(pe).startsWith("XHR timeout")?"timeout":"failed":void 0,count:String(Se)})}}async reportStatistic(R,N,U,z){if(!this.isEnabled())return;const $=L.isWeb?this.api(`/itemName/${R}.${N}/version/${U}/statType/${z==="install"?"1":"3"}/vscodewebextension`):this.api(`/publishers/${R}/extensions/${N}/${U}/stats?statType=${z}`),te=L.isWeb?"api-version=6.1-preview.1":"*/*;api-version=4.0-preview.1",pe={...await this.commonHeadersPromise,Accept:te};try{await this.requestService.request({type:"POST",url:$,headers:pe},k.CancellationToken.None)}catch{}}async download(R,N,U){this.logService.trace("ExtensionGalleryService#download",R.identifier.id);const z=(0,p.getGalleryExtensionTelemetryData)(R),$=new Date().getTime(),te=oe=>this.telemetryService.publicLog("galleryService:downloadVSIX",{...z,duration:oe}),re=U===2?"install":U===3?"update":"",pe=re?{uri:`${R.assets.download.uri}${g.URI.parse(R.assets.download.uri).query?"&":"?"}${re}=true`,fallbackUri:`${R.assets.download.fallbackUri}${g.URI.parse(R.assets.download.fallbackUri).query?"&":"?"}${re}=true`}:R.assets.download,Se=await this.getAsset(pe);await this.fileService.writeFile(N,Se.stream),te(new Date().getTime()-$)}async downloadSignatureArchive(R,N){if(!R.assets.signature)throw new Error("No signature asset found");this.logService.trace("ExtensionGalleryService#downloadSignatureArchive",R.identifier.id);const U=await this.getAsset(R.assets.signature);await this.fileService.writeFile(N,U.stream)}async getReadme(R,N){if(R.assets.readme){const U=await this.getAsset(R.assets.readme,{},N);return await(0,l.asTextOrError)(U)||""}return""}async getManifest(R,N){if(R.assets.manifest){const U=await this.getAsset(R.assets.manifest,{},N),z=await(0,l.asTextOrError)(U);return z?JSON.parse(z):null}return null}async getManifestFromRawExtensionVersion(R,N){const U=X(R,r.Manifest);if(!U)throw new Error("Manifest was not found");const z={"Accept-Encoding":"gzip"},$=await this.getAsset(U,{headers:z});return await(0,l.asJson)($)}async getCoreTranslation(R,N){const U=R.assets.coreTranslations.filter(z=>z[0]===N.toUpperCase())[0];if(U){const z=await this.getAsset(U[1]),$=await(0,l.asTextOrError)(z);return $?JSON.parse($):null}return null}async getChangelog(R,N){if(R.assets.changelog){const U=await this.getAsset(R.assets.changelog,{},N);return await(0,l.asTextOrError)(U)||""}return""}async getAllCompatibleVersions(R,N,U){let z=new h().withFlags(t.IncludeVersions,t.IncludeCategoryAndTags,t.IncludeFiles,t.IncludeVersionProperties).withPage(1,1);R.identifier.uuid?z=z.withFilter(i.ExtensionId,R.identifier.uuid):z=z.withFilter(i.ExtensionName,R.identifier.id);const{galleryExtensions:$}=await this.queryRawGalleryExtensions(z,k.CancellationToken.None);if(!$.length)return[];const te=F($[0]);if((0,S.isNotWebExtensionInWebTargetPlatform)(te,U))return[];const re=[];await Promise.all($[0].versions.map(async oe=>{try{await this.isValidVersion(oe,N?"any":"release",!0,te,U)&&re.push(oe)}catch{}}));const pe=[],Se=new Set;for(const oe of A(re,U))Se.has(oe.version)||(Se.add(oe.version),pe.push({version:oe.version,date:oe.lastUpdated,isPreReleaseVersion:Q(oe)}));return pe}async getAsset(R,N={},U=k.CancellationToken.None){const z=await this.commonHeadersPromise,$={type:"GET"},te={...z,...N.headers||{}};N={...N,...$,headers:te};const re=R.uri,pe=R.fallbackUri,Se={...N,url:re};try{const oe=await this.requestService.request(Se,U);if(oe.res.statusCode===200)return oe;const ue=await(0,l.asTextOrError)(oe);throw new Error(`Expected 200, got back ${oe.res.statusCode} instead.

${ue}`)}catch(oe){if((0,D.isCancellationError)(oe))throw oe;const ue=(0,D.getErrorMessage)(oe);this.telemetryService.publicLog2("galleryService:cdnFallback",{url:re,message:ue});const ce={...N,url:pe};return this.requestService.request(ce,U)}}async getEngine(R){let N=ne(R);if(!N){const U=await this.getManifestFromRawExtensionVersion(R,k.CancellationToken.None);if(!U)throw new Error("Manifest was not found");N=U.engines.vscode}return N}async getExtensionsControlManifest(){if(!this.isEnabled())throw new Error("No extension gallery service configured.");if(!this.extensionsControlUrl)return{malicious:[],deprecated:{}};const R=await this.requestService.request({type:"GET",url:this.extensionsControlUrl},k.CancellationToken.None);if(R.res.statusCode!==200)throw new Error("Could not get extensions report.");const N=await(0,l.asJson)(R),U=[],z={};if(N){for(const $ of N.malicious)U.push({id:$});if(N.migrateToPreRelease)for(const[$,te]of Object.entries(N.migrateToPreRelease))(!te.engine||(0,b.isEngineValid)(te.engine,this.productService.version,this.productService.date))&&(z[$.toLowerCase()]={disallowInstall:!0,extension:{id:te.id,displayName:te.displayName,autoMigrate:{storage:!!te.migrateStorage},preRelease:!0}});if(N.deprecated)for(const[$,te]of Object.entries(N.deprecated))te&&(z[$.toLowerCase()]=(0,I.isBoolean)(te)?{}:te)}return{malicious:U,deprecated:z}}};q=me([Z(1,l.IRequestService),Z(2,w.ILogService),Z(3,m.IEnvironmentService),Z(4,f.ITelemetryService),Z(5,y.IFileService),Z(6,E.IProductService),Z(7,u.IConfigurationService)],q);let B=class extends q{constructor(R,N,U,z,$,te,re,pe){super(R,N,U,z,$,te,re,pe)}};B=me([Z(0,v.IStorageService),Z(1,l.IRequestService),Z(2,w.ILogService),Z(3,m.IEnvironmentService),Z(4,f.ITelemetryService),Z(5,y.IFileService),Z(6,E.IProductService),Z(7,u.IConfigurationService)],B),e.ExtensionGalleryService=B;let ee=class extends q{constructor(R,N,U,z,$,te,re){super(void 0,R,N,U,z,$,te,re)}};ee=me([Z(0,l.IRequestService),Z(1,w.ILogService),Z(2,m.IEnvironmentService),Z(3,f.ITelemetryService),Z(4,y.IFileService),Z(5,E.IProductService),Z(6,u.IConfigurationService)],ee),e.ExtensionGalleryServiceWithNoStorageService=ee}),define(J[148],Y([0,1,44,11,18,13,9,67,28,25]),function(j,e,O,k,D,L,T,I,g,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UserDataProfilesService=void 0;let m=class je extends u.UserDataProfilesService{constructor(p,b,y,w,E){super(y,w,b,E),this.stateService=p,this.nativeEnvironmentService=y}getStoredProfiles(){return(0,O.revive)(this.stateService.getItem(je.PROFILES_KEY,[]))}getStoredProfileAssociations(){return(0,O.revive)(this.stateService.getItem(je.PROFILE_ASSOCIATIONS_KEY,{}))}getDefaultProfileExtensionsLocation(){return this.uriIdentityService.extUri.joinPath(k.URI.file(this.nativeEnvironmentService.extensionsPath).with({scheme:this.profilesHome.scheme}),"extensions.json")}};m=me([Z(0,I.IStateService),Z(1,g.IUriIdentityService),Z(2,D.INativeEnvironmentService),Z(3,L.IFileService),Z(4,T.ILogService)],m),e.UserDataProfilesService=m}),define(J[149],Y([0,1,38,3,162,2,9]),function(j,e,O,k,D,L,T){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NativePolicyService=void 0;let I=class extends O.AbstractPolicyService{constructor(u,m){super(),this.logService=u,this.productName=m,this.throttler=new k.Throttler,this.watcher=this._register(new L.MutableDisposable)}async _updatePolicyDefinitions(u){this.logService.trace(`NativePolicyService#_updatePolicyDefinitions - Found ${Object.keys(u).length} policy definitions`),await this.throttler.queue(()=>new Promise((m,S)=>{try{this.watcher.value=(0,D.createWatcher)(this.productName,u,p=>{this._onDidPolicyChange(p),m()})}catch(p){this.logService.error("NativePolicyService#_updatePolicyDefinitions - Error creating watcher:",p),S(p)}}))}_onDidPolicyChange(u){this.logService.trace(`NativePolicyService#_onDidPolicyChange - Updated policy values: ${JSON.stringify(u)}`);for(const m in u){const S=u[m];S===void 0?this.policies.delete(m):this.policies.set(m,S)}this._onDidChange.fire(Object.keys(u))}};I=me([Z(0,T.ILogService)],I),e.NativePolicyService=I}),define(J[69],Y([0,1,118,3,14,5,20,84,163,164]),function(j,e,O,k,D,L,T,I,g,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.buffer=e.extract=e.zip=e.ExtractError=void 0;class m extends Error{constructor(t,n){let i=n.message;switch(t){case"CorruptZip":i=`Corrupt ZIP: ${i}`;break}super(i),this.type=t,this.cause=n}}e.ExtractError=m;function S(s){const t=s.externalFileAttributes>>16||33188;return[448,56,7].map(n=>t&n).reduce((n,i)=>n+i,t&61440)}function p(s){if(s instanceof m)return s;let t;return/end of central directory record signature not found/.test(s.message)&&(t="CorruptZip"),new m(t,s)}function b(s,t,n,i,r,o){const c=D.dirname(t),a=D.join(i,c);if(!a.startsWith(i))return Promise.reject(new Error(I.localize(0,null,t)));const h=D.join(i,t);let C;return o.onCancellationRequested(()=>{C?.destroy()}),Promise.resolve(T.Promises.mkdir(a,{recursive:!0})).then(()=>new Promise((M,_)=>{if(!o.isCancellationRequested)try{C=(0,O.createWriteStream)(h,{mode:n}),C.once("close",()=>M()),C.once("error",_),s.once("error",_),s.pipe(C)}catch(H){_(H)}}))}function y(s,t,n,i){let r=(0,k.createCancelablePromise)(()=>Promise.resolve()),o=0;return i.onCancellationRequested(()=>{r.cancel(),s.close()}),new Promise((c,a)=>{const h=new k.Sequencer,C=M=>{M.isCancellationRequested||(o++,s.readEntry())};s.once("error",a),s.once("close",()=>r.then(()=>{i.isCancellationRequested||s.entryCount===o?c():a(new m("Incomplete",new Error(I.localize(1,null,o,s.entryCount))))},a)),s.readEntry(),s.on("entry",M=>{if(i.isCancellationRequested)return;if(!n.sourcePathRegex.test(M.fileName)){C(i);return}const _=M.fileName.replace(n.sourcePathRegex,"");if(/\/$/.test(_)){const ie=D.join(t,_);r=(0,k.createCancelablePromise)(ne=>T.Promises.mkdir(ie,{recursive:!0}).then(()=>C(ne)).then(void 0,a));return}const H=E(s,M),X=S(M);r=(0,k.createCancelablePromise)(ie=>h.queue(()=>H.then(ne=>b(ne,_,X,t,n,ie).then(()=>C(ie)))).then(null,a))})})}function w(s,t=!1){return new Promise((n,i)=>{(0,g.open)(s,t?{lazyEntries:!0}:void 0,(r,o)=>{r?i(p(r)):n((0,L.assertIsDefined)(o))})})}function E(s,t){return new Promise((n,i)=>{s.openReadStream(t,(r,o)=>{r?i(p(r)):n((0,L.assertIsDefined)(o))})})}function l(s,t){return new Promise((n,i)=>{const r=new u.ZipFile;t.forEach(c=>{c.contents?r.addBuffer(typeof c.contents=="string"?Buffer.from(c.contents,"utf8"):c.contents,c.path):c.localPath&&r.addFile(c.localPath,c.path)}),r.end();const o=(0,O.createWriteStream)(s);r.outputStream.pipe(o),r.outputStream.once("error",i),o.once("error",i),o.once("finish",()=>n(s))})}e.zip=l;function d(s,t,n={},i){const r=new RegExp(n.sourcePath?`^${n.sourcePath}`:"");let o=w(s,!0);return n.overwrite&&(o=o.then(c=>T.Promises.rm(t).then(()=>c))),o.then(c=>y(c,t,{sourcePathRegex:r},i))}e.extract=d;function v(s,t){return w(s).then(n=>new Promise((i,r)=>{n.on("entry",o=>{o.fileName===t&&E(n,o).then(c=>i(c),c=>r(c))}),n.once("close",()=>r(new Error(I.localize(2,null,t))))}))}function f(s,t){return v(s,t).then(n=>new Promise((i,r)=>{const o=[];n.once("error",r),n.on("data",c=>o.push(c)),n.on("end",()=>i(Buffer.concat(o)))}))}e.buffer=f}),define(J[150],Y([0,1,69,92]),function(j,e,O,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getManifest=void 0;function D(L){return(0,O.buffer)(L,"extension/package.json").then(T=>{try{return JSON.parse(T.toString("utf8"))}catch{throw new Error((0,k.localize)(0,null))}})}e.getManifest=D}),define(J[151],Y([0,1,3,22,33,10,4,2,34,16,14,12,17,39,5,11,30,20,69,91,58,18,143,23,24,42,48,125,144,150,126,127,27,45,13,8,9,26,32,28,25]),function(j,e,O,k,D,L,T,I,g,u,m,S,p,b,y,w,E,l,d,v,f,s,t,n,i,r,o,c,a,h,C,M,_,H,X,ie,ne,Q,ge,le,ae){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InstallGalleryExtensionTask=e.ExtensionsScanner=e.ExtensionManagementService=e.INativeServerExtensionManagementService=void 0,e.INativeServerExtensionManagementService=(0,ie.refineServiceDecorator)(n.IExtensionManagementService);let de=class extends t.AbstractExtensionManagementService{constructor(P,R,N,U,z,$,te,re,pe,Se,oe,ue){super(P,R,N,Se,ue),this.extensionsScannerService=z,this.extensionsProfileScannerService=$,this.downloadService=te,this.fileService=pe,this.uriIdentityService=oe,this.installGalleryExtensionsTasks=new Map,this.knownDirectories=new g.ResourceSet;const ce=this._register(re.createInstance(a.ExtensionsLifecycle));this.extensionsScanner=this._register(re.createInstance(F,fe=>ce.postUninstall(fe))),this.manifestCache=this._register(new C.ExtensionsManifestCache(U,this)),this.extensionsDownloader=this._register(re.createInstance(c.ExtensionsDownloader,this.getTargetPlatform()));const se=this._register(new M.ExtensionsWatcher(this,this.extensionsScannerService,ue,$,oe,pe,N));this._register(se.onDidChangeExtensionsByAnotherSource(fe=>this.onDidChangeExtensionsFromAnotherSource(fe))),this.watchForExtensionsNotInstalledBySystem()}getTargetPlatform(){return this._targetPlatformPromise||(this._targetPlatformPromise=(0,i.computeTargetPlatform)(this.fileService,this.logService)),this._targetPlatformPromise}async zip(P){this.logService.trace("ExtensionManagementService#zip",P.identifier.id);const R=await this.collectFiles(P),N=await(0,d.zip)((0,p.joinPath)(this.extensionsDownloader.extensionsDownloadDir,(0,E.generateUuid)()).fsPath,R);return w.URI.file(N)}async unzip(P){return this.logService.trace("ExtensionManagementService#unzip",P.toString()),(await this.install(P)).identifier}async getManifest(P){const{location:R,cleanup:N}=await this.downloadVsix(P),U=m.resolve(R.fsPath);try{return await(0,h.getManifest)(U)}finally{await N()}}getInstalled(P,R){return this.extensionsScanner.scanExtensions(P??null,R)}getAllUserInstalled(){return this.extensionsScanner.scanAllUserExtensions(!1)}async install(P,R={}){this.logService.trace("ExtensionManagementService#install",P.toString());const{location:N,cleanup:U}=await this.downloadVsix(P);try{const z=await(0,h.getManifest)(m.resolve(N.fsPath));if(z.engines&&z.engines.vscode&&!(0,H.isEngineValid)(z.engines.vscode,this.productService.version,this.productService.date))throw new Error(v.localize(0,null,(0,i.getGalleryExtensionId)(z.publisher,z.name),this.productService.version));return await this.installExtension(z,N,R)}finally{await U()}}async installFromLocation(P,R){this.logService.trace("ExtensionManagementService#installFromLocation",P.toString());const N=await this.extensionsScanner.scanUserExtensionAtLocation(P);if(!N)throw new Error(`Cannot find a valid extension from the location ${P.toString()}`);return await this.addExtensionsToProfile([N],R),this.logService.info("Successfully installed extension",N.identifier.id,R.toString()),N}getMetadata(P){return this.extensionsScannerService.scanMetadata(P.location)}async updateMetadata(P,R){this.logService.trace("ExtensionManagementService#updateMetadata",P.identifier.id);const N={...R};return R.isPreReleaseVersion&&(N.preRelease=!0),P=await this.extensionsScanner.updateMetadata(P,N),this.manifestCache.invalidate(),P}async updateExtensionScope(P,R){return this.logService.trace("ExtensionManagementService#updateExtensionScope",P.identifier.id),P=await this.extensionsScanner.updateMetadata(P,{isMachineScoped:R}),this.manifestCache.invalidate(),P}async reinstallFromGallery(P){if(this.logService.trace("ExtensionManagementService#reinstallFromGallery",P.identifier.id),!this.galleryService.isEnabled())throw new Error(v.localize(1,null));const R=await this.getTargetPlatform(),[N]=await this.galleryService.getExtensions([{...P.identifier,preRelease:P.preRelease}],{targetPlatform:R,compatible:!0},k.CancellationToken.None);if(!N)throw new Error(v.localize(2,null));await this.extensionsScanner.setUninstalled(P);try{await this.extensionsScanner.removeUninstalledExtension(P)}catch(U){throw new Error(v.localize(3,null,(0,D.toErrorMessage)(U)))}await this.installFromGallery(N)}markAsUninstalled(...P){return this.extensionsScanner.setUninstalled(...P)}removeUninstalledExtensions(){return this.extensionsScanner.cleanUp()}async download(P,R){const{location:N}=await this.extensionsDownloader.download(P,R);return N}async downloadVsix(P){if(P.scheme===u.Schemas.file)return{location:P,async cleanup(){}};this.logService.trace("Downloading extension from",P.toString());const R=(0,p.joinPath)(this.extensionsDownloader.extensionsDownloadDir,(0,E.generateUuid)());return await this.downloadService.download(P,R),this.logService.info("Downloaded extension to",R.toString()),{location:R,cleanup:async()=>{try{await this.fileService.del(R)}catch(U){this.logService.error(U)}}}}getCurrentExtensionsManifestLocation(){return this.userDataProfilesService.defaultProfile.extensionsResource}createInstallExtensionTask(P,R,N){let U;if(w.URI.isUri(R))U=new W(P,R,N,this.galleryService,this.extensionsScanner,this.logService);else{const z=i.ExtensionKey.create(R).toString();U=this.installGalleryExtensionsTasks.get(z),U||(this.installGalleryExtensionsTasks.set(z,U=new x(P,R,N,this.extensionsDownloader,this.extensionsScanner,this.logService)),U.waitUntilTaskIsFinished().then(()=>this.installGalleryExtensionsTasks.delete(z)))}return new q(U,N.profileLocation,this.extensionsProfileScannerService)}createUninstallExtensionTask(P,R){return new B(P,R.profileLocation,this.extensionsProfileScannerService)}async collectFiles(P){const R=async U=>{let z=await l.Promises.readdir(U);z=z.map(re=>m.join(U,re));const $=await Promise.all(z.map(re=>l.Promises.stat(re)));let te=Promise.resolve([]);return $.forEach((re,pe)=>{const Se=z[pe];re.isFile()&&(te=te.then(oe=>[...oe,Se])),re.isDirectory()&&(te=te.then(oe=>R(Se).then(ue=>[...oe,...ue])))}),te};return(await R(P.location.fsPath)).map(U=>({path:`extension/${m.relative(P.location.fsPath,U)}`,localPath:U}))}async onDidChangeExtensionsFromAnotherSource({added:P,removed:R}){if(R)for(const N of R.extensions)this.logService.info("Extensions removed from another source",N.id,R.profileLocation.toString()),this._onDidUninstallExtension.fire({identifier:N,profileLocation:R.profileLocation});if(P){const U=(await this.extensionsScanner.scanExtensions(1,P.profileLocation)).filter(z=>P.extensions.some($=>(0,i.areSameExtensions)($,z.identifier)));this._onDidInstallExtensions.fire(U.map(z=>(this.logService.info("Extensions added from another source",z.identifier.id,P.profileLocation.toString()),{identifier:z.identifier,local:z,profileLocation:P.profileLocation,operation:1})))}}async watchForExtensionsNotInstalledBySystem(){this._register(this.extensionsScanner.onExtract(R=>this.knownDirectories.add(R)));const P=await this.fileService.resolve(this.extensionsScannerService.userExtensionsLocation);for(const R of P.children??[])R.isDirectory&&this.knownDirectories.add(R.resource);this._register(this.fileService.watch(this.extensionsScannerService.userExtensionsLocation)),this._register(this.fileService.onDidFilesChange(R=>this.onDidFilesChange(R)))}async onDidFilesChange(P){const R=[];for(const N of P.rawAdded){if(this.knownDirectories.has(N)||!this.uriIdentityService.extUri.isEqual(this.uriIdentityService.extUri.dirname(N),this.extensionsScannerService.userExtensionsLocation)||this.uriIdentityService.extUri.isEqual(N,this.uriIdentityService.extUri.joinPath(this.extensionsScannerService.userExtensionsLocation,".obsolete"))||this.uriIdentityService.extUri.basename(N).startsWith(".")||!(await this.fileService.stat(N)).isDirectory)continue;const U=await this.extensionsScanner.scanUserExtensionAtLocation(N);U&&U.installedTimestamp===void 0&&(this.knownDirectories.add(N),R.push(U))}R.length&&(await this.addExtensionsToProfile(R,this.userDataProfilesService.defaultProfile.extensionsResource),this.logService.info("Added extensions to default profile from external source",R.map(N=>N.identifier.id)))}async addExtensionsToProfile(P,R){await this.extensionsProfileScannerService.addExtensionsToProfile(P.map(N=>[N,void 0]),R),this._onDidInstallExtensions.fire(P.map(N=>({local:N,identifier:N.identifier,operation:1,profileLocation:R})))}};de=me([Z(0,n.IExtensionGalleryService),Z(1,ge.ITelemetryService),Z(2,ne.ILogService),Z(3,s.INativeEnvironmentService),Z(4,o.IExtensionsScannerService),Z(5,r.IExtensionsProfileScannerService),Z(6,f.IDownloadService),Z(7,ie.IInstantiationService),Z(8,X.IFileService),Z(9,Q.IProductService),Z(10,le.IUriIdentityService),Z(11,ae.IUserDataProfilesService)],de),e.ExtensionManagementService=de;let F=class extends I.Disposable{constructor(P,R,N,U){super(),this.beforeRemovingExtension=P,this.fileService=R,this.extensionsScannerService=N,this.logService=U,this._onExtract=this._register(new T.Emitter),this.onExtract=this._onExtract.event,this.uninstalledPath=(0,p.joinPath)(this.extensionsScannerService.userExtensionsLocation,".obsolete").fsPath,this.uninstalledFileLimiter=new O.Queue}async cleanUp(){await this.removeUninstalledExtensions()}async scanExtensions(P,R){await this.extensionsScannerService.initializeDefaultProfileExtensions();const N={includeInvalid:!0,profileLocation:R};let U=[];return P===null||P===0?U.push(...await this.extensionsScannerService.scanAllExtensions({includeInvalid:!0},N,!1)):P===1&&U.push(...await this.extensionsScannerService.scanUserExtensions(N)),U=P!==null?U.filter(z=>z.type===P):U,Promise.all(U.map(z=>this.toLocalExtension(z)))}async scanAllUserExtensions(P){const R=await this.extensionsScannerService.scanUserExtensions({includeAllVersions:!P,includeInvalid:!0});return Promise.all(R.map(N=>this.toLocalExtension(N)))}async scanUserExtensionAtLocation(P){try{const R=await this.extensionsScannerService.scanExistingExtension(P,1,{includeInvalid:!0});if(R)return await this.toLocalExtension(R)}catch(R){this.logService.error(R)}return null}async extractUserExtension(P,R,N,U){await this.extensionsScannerService.initializeDefaultProfileExtensions();const z=P.toString(),$=m.join(this.extensionsScannerService.userExtensionsLocation.fsPath,`.${(0,E.generateUuid)()}`),te=m.join(this.extensionsScannerService.userExtensionsLocation.fsPath,z);try{await l.Promises.rm(te)}catch{throw new n.ExtensionManagementError(v.localize(4,null,te,P.id),n.ExtensionManagementErrorCode.Delete)}await this.extractAtLocation(P,R,$,U),await this.extensionsScannerService.updateMetadata(w.URI.file($),N);try{this._onExtract.fire(w.URI.file(te)),await this.rename(P,$,te,Date.now()+2*60*1e3),this.logService.info("Renamed to",te)}catch(re){try{await l.Promises.rm($)}catch{}if(re.code==="ENOTEMPTY")this.logService.info("Rename failed because extension was installed by another source. So ignoring renaming.",P.id);else throw this.logService.info(`Rename failed because of ${(0,L.getErrorMessage)(re)}. Deleted from extracted location`,$),re}return this.scanLocalExtension(w.URI.file(te),1)}async updateMetadata(P,R){return await this.extensionsScannerService.updateMetadata(P.location,R),this.scanLocalExtension(P.location,P.type)}getUninstalledExtensions(){return this.withUninstalledExtensions()}async setUninstalled(...P){const R=P.map(N=>i.ExtensionKey.create(N));await this.withUninstalledExtensions(N=>R.forEach(U=>{N[U.toString()]=!0,this.logService.info("Marked extension as uninstalled",U.toString())}))}async setInstalled(P){await this.withUninstalledExtensions(U=>delete U[P.toString()]);const N=(await this.scanAllUserExtensions(!0)).find(U=>i.ExtensionKey.create(U).equals(P))||null;return N?this.updateMetadata(N,{installedTimestamp:Date.now()}):null}async removeExtension(P,R){this.logService.trace(`Deleting ${R} extension from disk`,P.identifier.id,P.location.fsPath),await l.Promises.rm(P.location.fsPath),this.logService.info("Deleted from disk",P.identifier.id,P.location.fsPath)}async removeUninstalledExtension(P){await this.removeExtension(P,"uninstalled"),await this.withUninstalledExtensions(R=>delete R[i.ExtensionKey.create(P).toString()])}async withUninstalledExtensions(P){return this.uninstalledFileLimiter.queue(async()=>{let R;try{R=await l.Promises.readFile(this.uninstalledPath,"utf8")}catch(U){if(U.code!=="ENOENT")throw U}let N={};if(R)try{N=JSON.parse(R)}catch{}return P&&(P(N),Object.keys(N).length?await l.Promises.writeFile(this.uninstalledPath,JSON.stringify(N)):await l.Promises.rm(this.uninstalledPath)),N})}async extractAtLocation(P,R,N,U){this.logService.trace(`Started extracting the extension from ${R} to ${N}`);try{await l.Promises.rm(N)}catch(z){throw new n.ExtensionManagementError(this.joinErrors(z).message,n.ExtensionManagementErrorCode.Delete)}try{await(0,d.extract)(R,N,{sourcePath:"extension",overwrite:!0},U),this.logService.info(`Extracted extension to ${N}:`,P.id)}catch(z){try{await l.Promises.rm(N)}catch{}let $=n.ExtensionManagementErrorCode.Extract;throw z instanceof d.ExtractError&&(z.type==="CorruptZip"?$=n.ExtensionManagementErrorCode.CorruptZip:z.type==="Incomplete"&&($=n.ExtensionManagementErrorCode.IncompleteZip)),new n.ExtensionManagementError(z.message,$)}}async rename(P,R,N,U){try{await l.Promises.rename(R,N)}catch(z){if(S.isWindows&&z&&z.code==="EPERM"&&Date.now()<U)return this.logService.info(`Failed renaming ${R} to ${N} with 'EPERM' error. Trying again...`,P.id),this.rename(P,R,N,U);throw new n.ExtensionManagementError(z.message||v.localize(5,null,R,N),z.code||n.ExtensionManagementErrorCode.Rename)}}async scanLocalExtension(P,R){const N=await this.extensionsScannerService.scanExistingExtension(P,R,{includeInvalid:!0});if(N)return this.toLocalExtension(N);throw new Error(v.localize(6,null,P.path))}async toLocalExtension(P){const R=await this.fileService.resolve(P.location);let N,U;return R.children&&(N=R.children.find(({name:z})=>/^readme(\.txt|\.md|)$/i.test(z))?.resource,U=R.children.find(({name:z})=>/^changelog(\.txt|\.md|)$/i.test(z))?.resource),{identifier:P.identifier,type:P.type,isBuiltin:P.isBuiltin||!!P.metadata?.isBuiltin,location:P.location,manifest:P.manifest,targetPlatform:P.targetPlatform,validations:P.validations,isValid:P.isValid,readmeUrl:N,changelogUrl:U,publisherDisplayName:P.metadata?.publisherDisplayName||null,publisherId:P.metadata?.publisherId||null,isApplicationScoped:!!P.metadata?.isApplicationScoped,isMachineScoped:!!P.metadata?.isMachineScoped,isPreReleaseVersion:!!P.metadata?.isPreReleaseVersion,preRelease:!!P.metadata?.preRelease,installedTimestamp:P.metadata?.installedTimestamp,updated:!!P.metadata?.updated}}async removeUninstalledExtensions(){const P=await this.getUninstalledExtensions(),R=await this.extensionsScannerService.scanUserExtensions({includeAllVersions:!0,includeUninstalled:!0,includeInvalid:!0}),N=new Set;for(const $ of R)P[i.ExtensionKey.create($).toString()]||N.add($.identifier.id.toLowerCase());const U=(0,i.groupByExtension)(R,$=>$.identifier);await O.Promises.settled(U.map(async $=>{const te=$.sort((re,pe)=>b.rcompare(re.manifest.version,pe.manifest.version))[0];N.has(te.identifier.id.toLowerCase())||await this.beforeRemovingExtension(await this.toLocalExtension(te))}));const z=R.filter($=>$.metadata&&P[i.ExtensionKey.create($).toString()]);await O.Promises.settled(z.map($=>this.removeUninstalledExtension($)))}joinErrors(P){const R=Array.isArray(P)?P:[P];return R.length===1?R[0]instanceof Error?R[0]:new Error(R[0]):R.reduce((N,U)=>new Error(`${N.message}${N.message?",":""}${U instanceof Error?U.message:U}`),new Error(""))}};F=me([Z(1,X.IFileService),Z(2,o.IExtensionsScannerService),Z(3,ne.ILogService)],F),e.ExtensionsScanner=F;class A extends t.AbstractExtensionTask{get operation(){return(0,y.isUndefined)(this.options.operation)?this._operation:this.options.operation}constructor(P,R,N,U,z){super(),this.identifier=P,this.source=R,this.options=N,this.extensionsScanner=U,this.logService=z,this.wasVerified=!1,this._operation=2}async installExtension(P,R){try{const N=await this.unsetUninstalledAndGetLocal(P.key);if(N)return this.extensionsScanner.updateMetadata(N,P.metadata)}catch{throw S.isMacintosh?new n.ExtensionManagementError(v.localize(7,null),n.ExtensionManagementErrorCode.Internal):new n.ExtensionManagementError(v.localize(8,null),n.ExtensionManagementErrorCode.Internal)}return this.extract(P,R)}async unsetUninstalledAndGetLocal(P){if(!await this.isUninstalled(P))return null;this.logService.trace("Removing the extension from uninstalled list:",P.id);const N=await this.extensionsScanner.setInstalled(P);return this.logService.info("Removed the extension from uninstalled list:",P.id),N}async isUninstalled(P){return!!(await this.extensionsScanner.getUninstalledExtensions())[P.toString()]}async extract({zipPath:P,key:R,metadata:N},U){const z=await this.extensionsScanner.extractUserExtension(R,P,N,U);return this.logService.info("Extracting completed.",R.id),z}}class x extends A{constructor(P,R,N,U,z,$){super(R.identifier,R,N,z,$),this.manifest=P,this.gallery=R,this.extensionsDownloader=U}async doRun(P){const N=(await this.extensionsScanner.scanExtensions(null,void 0)).find(te=>(0,i.areSameExtensions)(te.identifier,this.gallery.identifier));N&&(this._operation=3);const U={id:this.gallery.identifier.uuid,publisherId:this.gallery.publisherId,publisherDisplayName:this.gallery.publisherDisplayName,targetPlatform:this.gallery.properties.targetPlatform,isApplicationScoped:(0,_.isApplicationScopedExtension)(this.manifest),isMachineScoped:this.options.isMachineScoped||N?.isMachineScoped,isBuiltin:this.options.isBuiltin||N?.isBuiltin,isSystem:N?.type===0?!0:void 0,updated:!!N,isPreReleaseVersion:this.gallery.properties.isPreReleaseVersion,installedTimestamp:Date.now(),preRelease:this.gallery.properties.isPreReleaseVersion||((0,y.isBoolean)(this.options.installPreReleaseVersion)?this.options.installPreReleaseVersion:N?.preRelease)};if(N?.manifest.version===this.gallery.version)return{local:await this.extensionsScanner.updateMetadata(N,U),metadata:U};const{location:z,verified:$}=await this.extensionsDownloader.download(this.gallery,this._operation);try{return this.wasVerified=!!$,this.validateManifest(z.fsPath),{local:await this.installExtension({zipPath:z.fsPath,key:i.ExtensionKey.create(this.gallery),metadata:U},P),metadata:U}}catch(te){try{await this.extensionsDownloader.delete(z)}catch(re){this.logService.warn("Error while deleting the downloaded file",z.toString(),(0,L.getErrorMessage)(re))}throw te}}async validateManifest(P){try{await(0,h.getManifest)(P)}catch(R){throw new n.ExtensionManagementError((0,t.joinErrors)(R).message,n.ExtensionManagementErrorCode.Invalid)}}}e.InstallGalleryExtensionTask=x;class W extends A{constructor(P,R,N,U,z,$){super({id:(0,i.getGalleryExtensionId)(P.publisher,P.name)},R,N,z,$),this.manifest=P,this.location=R,this.galleryService=U}async doRun(P){const R=new i.ExtensionKey(this.identifier,this.manifest.version),U=(await this.extensionsScanner.scanExtensions(1,void 0)).find(te=>(0,i.areSameExtensions)(this.identifier,te.identifier)),z=await this.getMetadata(this.identifier.id,this.manifest.version,P);if(z.isApplicationScoped=(0,_.isApplicationScopedExtension)(this.manifest),z.isMachineScoped=this.options.isMachineScoped||U?.isMachineScoped,z.isBuiltin=this.options.isBuiltin||U?.isBuiltin,z.installedTimestamp=Date.now(),U)if(this._operation=3,R.equals(new i.ExtensionKey(U.identifier,U.manifest.version)))try{await this.extensionsScanner.removeExtension(U,"existing")}catch{throw new Error(v.localize(9,null,this.manifest.displayName||this.manifest.name))}else!this.options.profileLocation&&b.gt(U.manifest.version,this.manifest.version)&&await this.extensionsScanner.setUninstalled(U);else{const te=await this.unsetUninstalledAndGetLocal(R);if(te)try{await this.extensionsScanner.removeExtension(te,"existing")}catch{throw new Error(v.localize(10,null,this.manifest.displayName||this.manifest.name))}}return{local:await this.installExtension({zipPath:m.resolve(this.location.fsPath),key:R,metadata:z},P),metadata:z}}async getMetadata(P,R,N){try{let[U]=await this.galleryService.getExtensions([{id:P,version:R}],N);if(U||([U]=await this.galleryService.getExtensions([{id:P}],N)),U)return{id:U.identifier.uuid,publisherDisplayName:U.publisherDisplayName,publisherId:U.publisherId,isPreReleaseVersion:U.properties.isPreReleaseVersion,preRelease:U.properties.isPreReleaseVersion||this.options.installPreReleaseVersion}}catch{}return{}}}class q{constructor(P,R,N){this.task=P,this.profileLocation=R,this.extensionsProfileScannerService=N,this.identifier=this.task.identifier,this.source=this.task.source,this.operation=this.task.operation,this.promise=this.waitAndAddExtensionToProfile()}async waitAndAddExtensionToProfile(){const P=await this.task.waitUntilTaskIsFinished();return await this.extensionsProfileScannerService.addExtensionsToProfile([[P.local,P.metadata]],this.profileLocation),P}async run(){return await this.task.run(),this.promise}waitUntilTaskIsFinished(){return this.promise}cancel(){return this.task.cancel()}}class B extends t.AbstractExtensionTask{constructor(P,R,N){super(),this.extension=P,this.profileLocation=R,this.extensionsProfileScannerService=N}async doRun(P){await this.extensionsProfileScannerService.removeExtensionFromProfile(this.extension,this.profileLocation)}}}),define(J[152],Y([0,1,131,3,15,10,2,5,21,18,132,9,130,165]),function(j,e,O,k,D,L,T,I,g,u,m,S,p,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RequestService=void 0;let y=class extends T.Disposable{constructor(E,l,d){super(),this.environmentService=l,this.logService=d,this.configure(E.getValue()),this._register(E.onDidChangeConfiguration(()=>this.configure(E.getValue()),this))}configure(E){this.proxyUrl=E.http&&E.http.proxy,this.strictSSL=!!(E.http&&E.http.proxyStrictSSL),this.authorization=E.http&&E.http.proxyAuthorization}async request(E,l){this.logService.trace("RequestService#request (node) - begin",E.url);const{proxyUrl:d,strictSSL:v}=this;let f;try{f=await(0,m.getResolvedShellEnv)(this.logService,this.environmentService.args,process.env)}catch(n){this.shellEnvErrorLogged||(this.shellEnvErrorLogged=!0,this.logService.error("RequestService#request (node) resolving shell environment failed",n))}const s={...process.env,...f},t=E.agent?E.agent:await(0,p.getProxyAgent)(E.url||"",s,{proxyUrl:d,strictSSL:v});E.agent=t,E.strictSSL=v,this.authorization&&(E.headers={...E.headers||{},"Proxy-Authorization":this.authorization});try{const n=await this._request(E,l);return this.logService.trace("RequestService#request (node) - success",E.url),n}catch(n){throw this.logService.trace("RequestService#request (node) - error",E.url,n),n}}async getNodeRequest(E){return((0,O.parse)(E.url).protocol==="https:"?await new Promise((v,f)=>{j(["https"],v,f)}):await new Promise((v,f)=>{j(["http"],v,f)})).request}_request(E,l){return k.Promises.withAsyncBody(async(d,v)=>{const f=(0,O.parse)(E.url),s=E.getRawRequest?E.getRawRequest(E):await this.getNodeRequest(E),t={hostname:f.hostname,port:f.port?parseInt(f.port):f.protocol==="https:"?443:80,protocol:f.protocol,path:f.path,method:E.type||"GET",headers:E.headers,agent:E.agent,rejectUnauthorized:(0,I.isBoolean)(E.strictSSL)?E.strictSSL:!0};E.user&&E.password&&(t.auth=E.user+":"+E.password);const n=s(t,i=>{const r=(0,I.isNumber)(E.followRedirects)?E.followRedirects:3;if(i.statusCode&&i.statusCode>=300&&i.statusCode<400&&r>0&&i.headers.location)this._request({...E,url:i.headers.location,followRedirects:r-1},l).then(d,v);else{let o=i;!E.isChromiumNetwork&&i.headers["content-encoding"]==="gzip"&&(o=i.pipe((0,b.createGunzip)())),d({res:i,stream:(0,D.streamToBufferReadableStream)(o)})}});n.on("error",v),E.timeout&&n.setTimeout(E.timeout),E.isChromiumNetwork&&n.removeHeader("Content-Length"),E.data&&typeof E.data=="string"&&n.write(E.data),n.end(),l.onCancellationRequested(()=>{n.abort(),v(new L.CancellationError)})})}async resolveProxy(E){}};y=me([Z(0,g.IConfigurationService),Z(1,u.INativeEnvironmentService),Z(2,S.ILogService)],y),e.RequestService=y}),define(J[166],Y([0,1,36,3,15,33,10,2,16,14,12,37,11,20,21,123,58,129,18,104,147,23,59,124,42,48,151,145,13,115,117,46,113,62,63,128,9,119,120,38,149,137,26,47,152,67,133,68,32,136,41,138,139,28,141,25,148,140]),function(j,e,O,k,D,L,T,I,g,u,m,S,p,b,y,w,E,l,d,v,f,s,t,n,i,r,o,c,a,h,C,M,_,H,X,ie,ne,Q,ge,le,ae,de,F,A,x,W,q,B,ee,P,R,N,U,z,$,te,re,pe){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.main=void 0;class Se extends I.Disposable{constructor(ce){super(),this.argv=ce,this.registerListeners()}registerListeners(){process.once("exit",()=>this.dispose())}async run(){const[ce,se]=await this.initServices();return ce.invokeFunction(async fe=>{const Le=fe.get(ne.ILogService),Ue=fe.get(a.IFileService),Re=fe.get(d.INativeEnvironmentService),Fe=fe.get(te.IUserDataProfilesService);Le.info("CLI main",this.argv),this.registerErrorHandler(Le),await this.doRun(Re,Ue,Fe,ce),await Promise.all(se.map(V=>{(0,k.raceTimeout)(V.flush(),1e3)}))})}async initServices(){const ce=new H.ServiceCollection,se={_serviceBrand:void 0,...de.default};ce.set(F.IProductService,se);const fe=new v.NativeEnvironmentService(this.argv,se);ce.set(d.INativeEnvironmentService,fe),await Promise.all([fe.appSettingsHome.fsPath,fe.extensionsPath].map(Ie=>Ie?b.Promises.mkdir(Ie,{recursive:!0}):void 0));const Le=(0,ne.getLogLevel)(fe),Ue=[];Ue.push(new Q.SpdLogLogger("cli",(0,u.join)(fe.logsPath,"cli.log"),!0,!1,Le)),Le===ne.LogLevel.Trace&&Ue.push(new ne.ConsoleLogger(Le));const Re=this._register(new ne.MultiplexLogService(Ue));ce.set(ne.ILogService,Re);const Fe=this._register(new h.FileService(Re));ce.set(a.IFileService,Fe);const V=this._register(new C.DiskFileSystemProvider(Re));Fe.registerProvider(g.Schemas.file,V);const G=new q.StateService(fe,Re,Fe);ce.set(W.IStateService,G);const K=new $.UriIdentityService(Fe);ce.set(z.IUriIdentityService,K);const he=new re.UserDataProfilesService(G,K,fe,Fe,Re);ce.set(te.IUserDataProfilesService,he);const ve=m.isWindows&&se.win32RegValueName?this._register(new ae.NativePolicyService(Re,se.win32RegValueName)):fe.policyFile?this._register(new ge.FilePolicyService(fe.policyFile,Fe,Re)):new le.NullPolicyService;ce.set(le.IPolicyService,ve);const Ce=this._register(new w.ConfigurationService(he.defaultProfile.settingsResource,Fe,ve,Re));ce.set(y.IConfigurationService,Ce),await Promise.all([G.init(),Ce.initialize()]),he.setEnablement(se.quality!=="stable"||Ce.getValue(te.PROFILES_ENABLEMENT_CONFIG)),ce.set(z.IUriIdentityService,new $.UriIdentityService(Fe)),ce.set(A.IRequestService,new M.SyncDescriptor(x.RequestService,void 0,!0)),ce.set(E.IDownloadService,new M.SyncDescriptor(l.DownloadService,void 0,!0)),ce.set(i.IExtensionsProfileScannerService,new M.SyncDescriptor(i.ExtensionsProfileScannerService,void 0,!0)),ce.set(r.IExtensionsScannerService,new M.SyncDescriptor(c.ExtensionsScannerService,void 0,!0)),ce.set(t.IExtensionSignatureVerificationService,new M.SyncDescriptor(t.ExtensionSignatureVerificationService,void 0,!0)),ce.set(o.INativeServerExtensionManagementService,new M.SyncDescriptor(o.ExtensionManagementService,void 0,!0)),ce.set(s.IExtensionGalleryService,new M.SyncDescriptor(f.ExtensionGalleryServiceWithNoStorageService,void 0,!0)),ce.set(X.ILanguagePackService,new M.SyncDescriptor(ie.NativeLanguagePackService,void 0,!1));const we=[],Oe=(0,R.isInternalTelemetry)(se,Ce);if((0,R.supportsTelemetry)(se,fe)){se.aiConfig&&se.aiConfig.ariaKey&&we.push(new N.OneDataSystemAppender(Oe,"monacoworkbench",null,se.aiConfig.ariaKey));const{installSourcePath:Ie}=fe,ke={appenders:we,sendErrorTelemetry:!1,commonProperties:(async()=>{let Me;try{Me=await(0,pe.resolveMachineId)(G)}catch(be){be.code!=="ENOENT"&&Re.error(be)}return(0,B.resolveCommonProperties)(Fe,(0,O.release)(),(0,O.hostname)(),process.arch,se.commit,se.version,Me,Oe,Ie)})(),piiPaths:(0,R.getPiiPathsFromEnvironment)(fe)};ce.set(ee.ITelemetryService,new M.SyncDescriptor(P.TelemetryService,[ke],!1))}else ce.set(ee.ITelemetryService,R.NullTelemetryService);return[new _.InstantiationService(ce),we]}registerErrorHandler(ce){(0,T.setUnexpectedErrorHandler)(se=>{const fe=(0,L.toErrorMessage)(se,!0);!fe||ce.error(`[uncaught exception in CLI]: ${fe}`)}),process.on("uncaughtException",se=>(0,T.onUnexpectedError)(se)),process.on("unhandledRejection",se=>(0,T.onUnexpectedError)(se))}async doRun(ce,se,fe,Le){const Ue=(ce.args.profile?fe.profiles.find(Re=>Re.name===ce.args.profile)??fe.defaultProfile:fe.defaultProfile).extensionsResource;if(this.argv["install-source"])return this.setInstallSource(ce,se,this.argv["install-source"]);if(this.argv["list-extensions"])return Le.createInstance(n.ExtensionManagementCLI).listExtensions(!!this.argv["show-versions"],this.argv.category,Ue);if(this.argv["install-extension"]||this.argv["install-builtin-extension"]){const Re={isMachineScoped:!!this.argv["do-not-sync"],installPreReleaseVersion:!!this.argv["pre-release"],profileLocation:Ue};return Le.createInstance(n.ExtensionManagementCLI).installExtensions(this.asExtensionIdOrVSIX(this.argv["install-extension"]||[]),this.argv["install-builtin-extension"]||[],Re,!!this.argv.force)}else{if(this.argv["uninstall-extension"])return Le.createInstance(n.ExtensionManagementCLI).uninstallExtensions(this.asExtensionIdOrVSIX(this.argv["uninstall-extension"]),!!this.argv.force,Ue);if(this.argv["locate-extension"])return Le.createInstance(n.ExtensionManagementCLI).locateExtension(this.argv["locate-extension"]);this.argv.telemetry&&console.log(await(0,U.buildTelemetryMessage)(ce.appRoot,ce.extensionsPath))}}asExtensionIdOrVSIX(ce){return ce.map(se=>/\.vsix$/i.test(se)?p.URI.file((0,u.isAbsolute)(se)?se:(0,u.join)((0,S.cwd)(),se)):se)}async setInstallSource(ce,se,fe){await se.writeFile(p.URI.file(ce.installSourcePath),D.VSBuffer.fromString(fe.slice(0,30)))}}async function oe(ue){const ce=new Se(ue);try{await ce.run()}finally{ce.dispose()}}e.main=oe})}).call(this);

//# sourceMappingURL=https://ticino.blob.core.windows.net/sourcemaps/d2c422ca15f1fbc976eed3e02e3392bbb39c5824/core/vs\code\node\cliProcessMain.js.map
